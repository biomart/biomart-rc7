!function(e){"use strict";e.module("martVisualEnrichment",["ui.bootstrap","martVisualEnrichment.services","martVisualEnrichment.controllers","martVisualEnrichment.directives"]).run(["$templateCache",function(e){e.put("partials/table-of-results.html",document.getElementById("table-of-results.html").textContent),e.put("partials/vis.html",document.getElementById("vis.html").textContent),window.parent.biomart.datasource.done("results")}]).value("dataContainerId","enrichment-data")}(angular),function(e){"use strict";e.module("martVisualEnrichment.services",[]).service("searchPattern",function(){this._p="",this.pattern=function(t){return e.isString(t)?(this._p=t,this):this._p}}).value("annotationLook",{}).value("geneLook",{}).value("edgeLook",{})}(angular),function(e){"use strict";e.module("martVisualEnrichment.services").factory("dataRetrieve",["$document","$q","dataContainerId","$rootScope",function(e,t,n,r){var i=t.defer(),o=e[0].getElementById(n),s=null,c=null;return setTimeout(function(){try{o?(s=JSON.parse(o.textContent),r.$apply(function(){i.resolve(s)})):(c="Cannot find element with id `"+n+"`",r.$apply(function(){i.reject(c)}))}catch(e){c=e.name+": "+e.message,r.$apply(function(){i.reject(c)})}},1),i.promise}])}(angular),function(e){"use strict";e.module("martVisualEnrichment.services").factory("tabs",["dataRetrieve","$log",function(e,t){return e.then(function(e){var t=e.graphs;return Object.keys(t).map(function(e){var n=t[e];return{title:e,nodes:n.nodes,edges:n.edges}})},function(e){return t.error("ERROR: tabs service: "+e),{}})}])}(angular),function(e){"use strict";e.module("martVisualEnrichment.services").factory("termsAsync",function(){return function(e){this._all=e.then(function(e){return e.filter(function(e){return"term"===e.type})}),this._filtered=this._all,this.all=function(){return this._clearFilters(),this},this._clearFilters=function(){return this._filtered=null,this._filtered=this._all,this},this.filterByDescription=function(e){if(e&&""!==e){var t=new RegExp(e,"i");this._filtered=this._filtered.then(function(e){return e.filter(function(e){return e.description.match(t)})})}return this},this.filterByScore=function(e,t){return this._filtered=this._filtered.then(function(n){return n.filter(function(n){return n["p-value"]>=e&&n["p-value"]<t})}),this},this.then=function(e,t,n){var r=this._filtered.then(e,t,n);return this._clearFilters(),r}}})}(angular),function(e){"use strict";e.module("martVisualEnrichment.services").factory("termsSync",function(){function e(e){this._all=e.filter(function(e){return"term"===e.type}),this._filtered=this._all}return e.prototype.all=function(){return this._clearFilters(),this._filtered},e.prototype.clear=function(){return this._clearFilters(),this},e.prototype._clearFilters=function(){return this._filtered=null,this._filtered=this._all,this},e.prototype.filterByDescription=function(e){if(e&&""!==e){var t=new RegExp(e,"i");this._filtered=this._filtered.filter(function(e){return e.description.match(t)})}return this._filtered},e.prototype.filterByScore=function(e,t){return this._filtered=this._filtered.filter(function(n){return n["p-value"]>=e&&n["p-value"]<t}),this._filtered},e})}(angular),function(e){"use strict";e.module("martVisualEnrichment.services").service("terms",["termsSync",function(e){this.get=function(t){return new e(t)}}])}(angular),function(e){"use strict";e.module("martVisualEnrichment.controllers",[]).controller("MartVisualCtrl",["$scope","tabs",function(e,t){e.mvTabs=[],t.then(function(t){e.mvTabs=t})}]).controller("ResultsTableCtrl",["$scope","terms",function(e,t){e.terms=t.get(e.mvTab.nodes),e.results=e.terms.all(),e.filterByDescription=function(t){e.mvTab.pattern=t.toLowerCase(),e.terms.all(),e.results=e.terms.filterByDescription(t)}}]).controller("GraphCtrl",["$scope","$timeout",function(e,t){var n=null;e.nodes=e.mvTab.nodes,e.edges=e.mvTab.edges,e.$watch(function(e){return e.mvTab.pattern},function(){n&&t.cancel(n),n=t(function(){e.search=e.mvTab.pattern},500)})}])}(angular),function(e){"use strict";e.module("martVisualEnrichment.directives",[])}(angular),function(e){"use strict";function t(e){return e.stylesheet().selector("node").css({"font-family":"helvetica","font-size":7,"text-valign":"center","text-outline-width":1,color:"#fff","text-outline-opacity":1,"border-width":2}).selector(":selected").css({"background-color":"#2316BA"}).selector("node[type='term']").css({content:"data(shortDesc)","text-outline-color":"#000078","background-color":"#FF1FA1","border-color":"#F668C5",width:"mapData(pvalue, 0, 1, 3, 60)",height:"mapData(pvalue, 0, 1, 3, 60)"}).selector("node[type='gene']").css({content:"data(id)","background-color":"#00D57F","border-color":"#64FC3F","text-outline-color":"#000078",width:15,height:15}).selector(":active").css({"background-color":"#f00","line-color":"#FFFD1E"}).selector(".faded").css({opacity:.25,"text-opacity":0}).selector("edge").css({"line-color":"#2316BA"}).selector(".link-hightlight").css({"line-color":"#FF185A"}).selector("core").css({"selection-box-color":"#FAB8D8","selection-box-opacity":.5,"selection-box-border-color":"#E273B1","selection-box-border-width":3})}function n(e){return e[0]}function r(e){return e.map(function(e){return{data:e}})}function i(e){e.forEach(function(e){var t=16;e.shortDesc=e.description.length>t?e.description.substr(0,t-1)+"...":e.description})}function o(e){return function(){{var t=e.cy=this;t.elements()}t.on("tap","node",function(e){var n=e.cyTarget,r=n.neighborhood().add(n),i=r.filter("edge");t.elements().addClass("faded"),r.removeClass("faded"),i.addClass("link-hightlight")}),t.on("tap",function(e){e.cyTarget===t&&t.elements().removeClass("faded link-hightlight")})}}function s(e){return e.layout={name:"cose",padding:20,hideEdgesOnViewport:!0},e.showOverlay=!1,e.elements={},e}function c(e,t){var n=null;""!==t&&t?(e.cy.elements().hide(),n=e.cy.nodes("[type='term']").nodes("[description@*='"+t+"']"),n.neighborhood().add(n).show()):e.cy.elements().show()}e.module("martVisualEnrichment.directives").directive("mvGraph",["$rootScope",function(l){function a(a,u){l.$on("term.mouseover",function(e,t){m.$("node#"+t.id).select()}),l.$on("term.mouseout",function(e,t){m.$("node#"+t.id).unselect()}),a.$on("$destroy",function(){a.cy.elements().remove()}),e.element(window).on("resize",function(){u.css("height",e.element(window).prop("innerHeight")+"px"),u.css("width",e.element(window).prop("innerWidth")+"px"),m.forceRender()});var d=!0;a.$watch(function(e){return e.filterPattern},function(e,t){d?d=!1:e!==t&&c(a,e)});var f=s({});f.style=t(cytoscape),f.container=n(u),f.ready=o(a),i(a.nodes),f.elements.edges=r(a.edges),f.elements.nodes=r(a.nodes),f.pan={x:u.prop("clientWidth")/2,y:u.prop("clientHeight")/2};var m=cytoscape(f)}return{restrict:"E",replace:!0,templateUrl:"partials/vis.html",scope:{nodes:"=nodes",edges:"=edges",filterPattern:"="},compile:function(t){var n=e.element(window).prop("innerHeight");return t.css("height",n+"px"),a}}}])}(angular),function(e){"use strict";e.module("martVisualEnrichment.directives").directive("mvRange",function(){return{restrict:"E",templateUrl:"partials/range.html",scope:{minRange:"=",maxRange:"=",value:"=",step:"=",currentValue:"="},link:function(e,t){t.on("click",e.clickHandler),e.on("$destroy",function(){t.off(e.clickHandler)}),$scope.clickHandler=function(e){this.currentValue=e.target.value}}}})}(angular),function(e){"use strict";e.module("martVisualEnrichment.directives").directive("mvResultsTable",["$rootScope",function(t){return{restrict:"E",templateUrl:"partials/table-of-results.html",link:function(n,r){function i(n){return function(r){var i=null,o=r.target;if("TD"===o.tagName?i=o.parentNode:"TR"===o.tagName&&(i=o),i){var s=e.element(o);t.$emit(n,s.scope().term)}}}r.on("mouseover",i("term.mouseover")),r.on("mouseout",i("term.mouseout"))}}}])}(angular);