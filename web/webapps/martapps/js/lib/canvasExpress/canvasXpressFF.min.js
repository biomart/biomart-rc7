
/*
 * CanvasXpress 4.0 - JavaScript Canvas Library
 *
 * Copyright (c) 2009-2010 Isaac Neuhaus
 *
 * imnphd@gmail.com
 *
 * Redistributions of this source code must retain this copyright
 * notice and the following disclaimer.
 *
 * CanvasXpress is licensed under the terms of the Open Source
 * LGPL 3.0 license.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 * Commercial use is permitted to the extent that this source code
 * do NOT become part of any other Open Source or Commercially licensed
 * development library or toolkit without explicit permission.
 *
 * Network graphs were implemented based on the HeyGraph by Tom Martin
 * <http://www.heychinaski.com>.
 *
 * Thanks to Mingyi Liu for his contributions in extending the Ext panel
 * and adding major capabilities to the network graphs and animations.
 *
 */

var DumperIndent=1;var DumperIndentText=" ";var DumperNewline="\n";var DumperObject=null;var DumperMaxDepth=-1;var DumperIgnoreStandardObjects=true;var DumperProperties=null;var DumperTagProperties=new Object();function DumperGetArgs(b,d){var c=new Array();for(var e=d;e<b.length;e++){c[c.length]=b[e]}return c}function DumperPopup(b){var a=window.open("about:blank");a.document.open();a.document.writeln("<HTML><BODY><PRE>");a.document.writeln(Dumper(b,DumperGetArgs(arguments,1)));a.document.writeln("</PRE></BODY></HTML>");a.document.close()}function DumperAlert(a){alert(Dumper(a,DumperGetArgs(arguments,1)))}function DumperWrite(e){var f=1;var c=document;if(arguments.length>1&&arguments[1]==window.document){c=arguments[1];f=2}var a=DumperIndentText;var b=DumperGetArgs(arguments,f);DumperIndentText="&nbsp;";c.write(Dumper(e,b));DumperIndentText=a}function DumperPad(a){var b="";for(var c=0;c<a;c++){b+=DumperIndentText}return b}function Dumper(d){var a=1;var k=DumperIndent;var j="";if(arguments.length>1&&typeof(arguments[1])=="number"){a=arguments[1];k=arguments[2];if(d==DumperObject){return"[original object]"}}else{DumperObject=d;if(arguments.length>1){var h=arguments;var e=1;if(typeof(arguments[1])=="object"){h=arguments[1];e=0}for(var f=e;f<h.length;f++){if(DumperProperties==null){DumperProperties=new Object()}DumperProperties[h[f]]=1}}}if(DumperMaxDepth!=-1&&a>DumperMaxDepth){return"..."}if(DumperIgnoreStandardObjects){if(d==window||d==window.document){return"[Ignored Object]"}}if(d==null){j="[null]";return j}if(typeof(d)=="function"){j="[function]";return j}if(typeof(d)=="boolean"){j=(d)?"true":"false";return j}if(typeof(d)=="string"){j="'"+d+"'";return j}if(typeof(d)=="number"){j=d;return j}if(typeof(d)=="object"){if(typeof(d.length)=="number"){j="[";for(var f=0;f<d.length;f++){if(f>0){j+=","+DumperNewline+DumperPad(k)}else{j+=DumperNewline+DumperPad(k)}j+=Dumper(d[f],a+1,k-0+DumperIndent)}if(f>0){j+=DumperNewline+DumperPad(k-DumperIndent)}j+="]";return j}else{j="{";var g=0;for(f in d){if(d==DumperObject&&DumperProperties!=null&&DumperProperties[f]!=1){}else{if(typeof(d[f])!="unknown"){var c=true;if(typeof(d.tagName)!="undefined"){if(typeof(DumperTagProperties[d.tagName])!="undefined"){c=false;for(var b=0;b<DumperTagProperties[d.tagName].length;b++){if(DumperTagProperties[d.tagName][b]==f){c=true;break}}}}if(c){if(g++>0){j+=","+DumperNewline+DumperPad(k)}else{j+=DumperNewline+DumperPad(k)}j+="'"+f+"' => "+Dumper(d[f],a+1,k-0+f.length+6+DumperIndent)}}}}if(g>0){j+=DumperNewline+DumperPad(k-DumperIndent)}j+="}";return j}}};function str_repeat(b,a){for(var c=[];a>0;c[--a]=b){}return(c.join(""))}function sprintf(){var g=0,e,h=arguments[g++],k=[],d,j,l,b;while(h){if(d=/^[^\x25]+/.exec(h)){k.push(d[0])}else{if(d=/^\x25{2}/.exec(h)){k.push("%")}else{if(d=/^\x25(?:(\d+)\$)?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(h)){if(((e=arguments[d[1]||g++])==null)||(e==undefined)){throw ("Too few arguments.")}if(/[^s]/.test(d[7])&&(typeof(e)!="number")){throw ("Expecting number but found "+typeof(e))}switch(d[7]){case"b":e=e.toString(2);break;case"c":e=String.fromCharCode(e);break;case"d":e=parseInt(e);break;case"e":e=d[6]?e.toExponential(d[6]):e.toExponential();break;case"f":e=d[6]?parseFloat(e).toFixed(d[6]):parseFloat(e);break;case"o":e=e.toString(8);break;case"s":e=((e=String(e))&&d[6]?e.substring(0,d[6]):e);break;case"u":e=Math.abs(e);break;case"x":e=e.toString(16);break;case"X":e=e.toString(16).toUpperCase();break}e=(/[def]/.test(d[7])&&d[2]&&e>0?"+"+e:e);l=d[3]?d[3]=="0"?"0":d[3].charAt(1):" ";b=d[5]-String(e).length;j=d[5]?str_repeat(l,b):"";k.push(d[4]?e+j:j+e)}else{throw ("Huh ?!")}}}h=h.substring(d[0].length)}return k.join("")};var dateFormat=function(){var a=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,b=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,d=/[^-+\dA-Z]/g,c=function(f,e){f=String(f);e=e||2;while(f.length<e){f="0"+f}return f};return function(i,v,q){var g=dateFormat;if(arguments.length==1&&Object.prototype.toString.call(i)=="[object String]"&&!/\d/.test(i)){v=i;i=undefined}i=i?new Date(i):new Date;if(isNaN(i)){throw SyntaxError("invalid date")}v=String(g.masks[v]||v||g.masks["default"]);if(v.slice(0,4)=="UTC:"){v=v.slice(4);q=true}var t=q?"getUTC":"get",l=i[t+"Date"](),e=i[t+"Day"](),j=i[t+"Month"](),p=i[t+"FullYear"](),r=i[t+"Hours"](),k=i[t+"Minutes"](),u=i[t+"Seconds"](),n=i[t+"Milliseconds"](),f=q?0:i.getTimezoneOffset(),h={d:l,dd:c(l),ddd:g.i18n.dayNames[e],dddd:g.i18n.dayNames[e+7],m:j+1,mm:c(j+1),mmm:g.i18n.monthNames[j],mmmm:g.i18n.monthNames[j+12],yy:String(p).slice(2),yyyy:p,h:r%12||12,hh:c(r%12||12),H:r,HH:c(r),M:k,MM:c(k),s:u,ss:c(u),l:c(n,3),L:c(n>99?Math.round(n/10):n),t:r<12?"a":"p",tt:r<12?"am":"pm",T:r<12?"A":"P",TT:r<12?"AM":"PM",Z:q?"UTC":(String(i).match(b)||[""]).pop().replace(d,""),o:(f>0?"-":"+")+c(Math.floor(Math.abs(f)/60)*100+Math.abs(f)%60,4),S:["th","st","nd","rd"][l%10>3?0:(l%100-l%10!=10)*l%10]};return v.replace(a,function(m){return m in h?h[m]:m.slice(1,m.length-1)})}}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};Date.prototype.format=function(a,b){return dateFormat(this,a,b)};if(typeof(CanvasXpress)=="undefined"){CanvasXpress={}}var CanvasXpress=function(h,f,a,b,d){if(!h){document.body.appendChild(c);h=this.createNewTarget()}else{if(typeof(h)=="object"){f=h.data||false;a=h.config||false;b=h.events||false;d=h.hidden||false;h=h.renderTo||this.createNewTarget()}}if(f){try{JSON.stringify(f)}catch(g){alert("Data object malformed:\n"+g)}}if(!a){a={};this.userConfig={}}else{try{JSON.stringify(a)}catch(g){alert("Config object malformed:\n"+g)}this.userConfig=a}if(b){}this.createNewTarget=function(){var o=document.createElement("canvas");var m=0;var j="canvasXpress"+m;var k=document.getElementById(j);while(k){m++;j="canvasXpress"+m;k=document.getElementById(j)}o.id=j;document.body.appendChild(o);return j};this.insertTarget=function(k,n,j,m,e){if(k&&n){var o=document.getElementById(k);if(o){return}else{o=document.createElement("canvas")}o.id=k;o.width=j;o.height=m;if(e){n.parentNode.insertBefore(o,n.nextSibling)}else{n.parentNode.insertBefore(o,n)}}};this.removeTarget=function(e){var j=document.getElementById(e);if(j){j.parentNode.removeChild(j)}};this.setConfig=function(e){if(a.graphType=="Network"){if(!a.backgroundType){this.backgroundType="gradient";this.nodeFontColor=this.background}}if(a){for(var j=0;j<e.length;j++){var k=e[j];if(a.hasOwnProperty(k)){this[k]=a[k]}}}if(this.isVML){this.showAnimation=false}};this.setInitialConfig=function(){if(a){for(var e in a){this[e]=a[e]}}};this.resetConfig=function(e){var k={};for(var j=0;j<e.length;j++){k[e[j]]=this[e[j]]}this.initConfig(true);for(var j in k){this[j]=k[j]}};this.updateConfig=function(j){if(j){this.userConfig=j;for(var e in j){this[e]=j[e]}}};this.getConfig=function(){var m={};for(var k=0;k<this.config.length;k++){var e=this.config[k];if(this[e]!=undefined){m[e]=this[e]}}return m};this.getUserConfig=function(){return this.userConfig};this.updateData=function(e){this.initData(e);this.initEvents();this.initGraph()};this.save=function(){return{renderTo:this.target,data:this.data,config:this.getConfig(),events:this.events}};this.writeToConsole=function(j){for(var e=0;e<j.length;e++){console.log(this.target+": "+j[e])}};this.dumpToConsole=function(e){console.log(Dumper(e,DumperGetArgs(arguments,1)))};this.isSubstandardBrowser=function(){if((this.browser=="Firefox"&&this.browserVersion>2)||(this.browser=="Opera"&&this.browserVersion>9)||(this.browser=="Safari"&&this.browserVersion>4)||(this.browser=="Chrome"&&this.browserVersion>1)){return false}else{return true}};this.isMobileApp=function(){if(this.browser.match(/iPhone|iPod|iPad|Android|BlackBerry/i)){return true}else{return false}};this.setCanvas=function(){this.version=4;this.target=h;this.events=b;var e=document.getElementById("wrapper-"+this.target);if(!e){var k=document.createElement("div");k.id="wrapper-"+this.target;k.style.position="relative";k.style.cssFloat="left";if(d){k.style.display="none"}var m=document.getElementById(this.target);var j=m.parentNode;j.insertBefore(k,m);k.appendChild(m.parentNode.appendChild(m))}if(window.G_vmlCanvasManager&&window.attachEvent&&!window.opera){this.isIE=true;this.subBrowser=true;this.mobileApp=false;if(this.browserVersion>=9){this.isVML=false;this.canvas=m}else{this.isVML=true;this.canvas=window.G_vmlCanvasManager.initElement(m)}}else{this.isIE=false;this.subBrowser=this.isSubstandardBrowser();this.mobileApp=this.isMobileApp();this.isVML=false;this.canvas=m}this.ctx=this.canvas.getContext("2d")};this.setPath=function(){var k=document.getElementsByTagName("script");if(k){for(var j=0;j<k.length;j++){if(!k[j].src){continue}var m=k[j].src;var e=m.lastIndexOf("/");var o=m.substring(0,e+1);var n=m.substring(e+1);if(n.match(/canvasXpress/)){this.path=o}}}};this.initialize=function(){this.initBrowser();this.addCSS();this.setCanvas();this.setPath();this.initConfig();this.initData(f);this.initLayout();this.initEvents();this.initAnimation();this.initRemote();this.initGraph()};this.initialize();CanvasXpress.references.push(this)};CanvasXpress.references=[];CanvasXpress.cacheImages={};CanvasXpress.prototype.addCSS=function(){var a="table.shorts {border: 1px solid; border-collapse: collapse; font-size: x-small}";a+="td.k {text-align: center; padding: 2px 5px; margin: 2px 5px; border: 1px solid;}";a+="td.d {padding: 2px 5px; margin: 2px 5px; border: 1px solid;}";a+="th.d {padding: 2px 5px; margin: 2px 5px; border: 1px solid;}";var b=document.createElement("style");b.type="text/css";if(b.styleSheet){b.styleSheet.cssText=a}else{b.appendChild(document.createTextNode(a))}document.getElementsByTagName("head")[0].appendChild(b)};CanvasXpress.prototype.initBrowser=function(){this.dataBrowser=[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"},{string:navigator.platform,subString:"iPhone",identity:"iPhone"},{string:navigator.platform,subString:"iPod",identity:"iPod"},{string:navigator.userAgent,subString:"iPad",identity:"iPad"},{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.userAgent,subString:"BlackBerry",identity:"BlackBerry"}];this.dataOS=[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.platform,subString:"iPhone",identity:"iPhone"},{string:navigator.platform,subString:"iPod",identity:"iPod"},{string:navigator.userAgent,subString:"iPad",identity:"iPad"},{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.userAgent,subString:"BlackBerry",identity:"BlackBerry"},{string:navigator.platform,subString:"Linux",identity:"Linux"}];this.searchString=function(e){for(var a=0;a<e.length;a++){var b=e[a].string;var d=e[a].prop;this.versionSearchString=e[a].versionSearch||e[a].identity;if(b){if(b.indexOf(e[a].subString)!=-1){return e[a].identity}}else{if(d){return e[a].identity}}}};this.searchVersion=function(b){var a=b.indexOf(this.versionSearchString);if(a==-1){return}return parseFloat(b.substring(a+this.versionSearchString.length+1))};this.initializeBrowser=function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.browserVersion=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.browserOS=this.searchString(this.dataOS)||"an unknown OS"};this.initializeBrowser()};CanvasXpress.prototype.initConfig=function(a){this.config=[];this.graphType="Bar";this.config.push("graphType");this.graphOrientation="horizontal";this.config.push("graphOrientation");this.foreground="rgb(0,0,0)";this.config.push("foreground");this.foregroundWindow="rgb(0,0,0)";this.config.push("foregroundWindow");this.background="rgb(255,255,255)";this.config.push("background");this.backgroundWindow="rgb(255,255,255)";this.config.push("backgroundWindow");this.backgroundType="solid";this.config.push("backgroundType");this.backgroundImage=false;this.config.push("backgroundImage");this.backgroundWindowGradientOrientation="vertical";this.config.push("backgroundWindowGradientOrientation");this.backgroundGradient1Color="rgb(0,0,200)";this.config.push("backgroundGradient1Color");this.backgroundGradient2Color="rgb(0,0,36)";this.config.push("backgroundGradient2Color");this.backgroundWindowGradient1Color="rgb(0,0,200)";this.config.push("backgroundWindowGradient1Color");this.backgroundWindowGradient2Color="rgb(0,0,36)";this.config.push("backgroundWindowGradient2Color");this.gradient=false;this.config.push("gradient");this.gradientType="radial";this.config.push("gradientType");this.gradientRatio=1.3;this.config.push("gradientRatio");this.transparency=null;this.config.push("transparency");this.margin=5;this.config.push("margin");this.showShadow=false;this.config.push("showShadow");this.shadowOffsetX=3;this.config.push("shadowOffsetX");this.shadowOffsetY=3;this.config.push("shadowOffsetY");this.shadowBlur=2;this.config.push("shadowBlur");this.shadowColor="rgba(0,0,0,0.5)";this.config.push("shadowColor");this.functions=[];this.fonts=this.isVML||this.subBrowser?["Gentilis","Helvetiker","Optimer"]:["Gentilis","Helvetiker","Optimer","Verdana, sans-serif"];this.fontName=this.isVML?"Gentilis":this.subBrowser?"Optimer":"Verdana, sans-serif";this.config.push("fontName");this.fontStyle=false;this.config.push("fontStyle");this.fontSize=12;this.config.push("fontSize");this.font=this.fontStyle?this.fontStyle+this.fontSize+"pt "+this.fontName:this.fontSize+"pt "+this.fontName;this.align="center";this.config.push("align");this.baseline="middle";this.config.push("baseline");this.maxTextSize=14;this.config.push("maxTextSize");this.minTextSize=4;this.config.push("minTextSize");this.autoScaleFont=true;this.config.push("autoScaleFont");this.scaleTextConstantMult=40;this.scaleTextConstantAdd=2.5;this.title=false;this.config.push("title");this.titleHeight=30;this.config.push("titleHeight");this.subtitle=false;this.config.push("subtitle");this.subtitleHeight=16;this.config.push("subtitleHeight");this.dashLength=8;this.config.push("dashLength");this.dotLength=5;this.config.push("dotLength");this.arrowPointSize=10;this.config.push("arrowPointSize");this.capType="butt";this.config.push("capType");this.outlineWidth=1;this.config.push("outlineWidth");this.lines=[];this.colorScheme="user";this.config.push("colorScheme");this.colors=["rgb(255,0,0)","rgb(0,0,255)","rgb(0,255,0)","rgb(255,255,0)","rgb(0,255,255)","rgb(255,0,255)","rgb(153,51,0)","rgb(0,0,128)","rgb(128,128,0)","rgb(255,102,0)","rgb(0,128,128)","rgb(102,0,102)","rgb(255,153,204)","rgb(102,102,153)","rgb(51,51,0)","rgb(255,204,153)","rgb(204,255,255)","rgb(153,153,255)","rgb(255,128,128)","rgb(51,102,255)","rgb(51,153,102)","rgb(255,204,0)","rgb(0,204,255)","rgb(208,32,144)","rgb(153,51,102)","rgb(0,102,204)","rgb(153,204,0)","rgb(255,153,0)","rgb(51,204,204)","rgb(204,153,255)","rgb(128,0,0)","rgb(51,51,153)","rgb(0,128,0)","rgb(255,255,204)","rgb(153,204,255)","rgb(128,0,128)"];this.colors0=["rgb(0,0,255)","rgb(255,0,77)","rgb(255,191,0)","rgb(116,255,0)","rgb(164,0,255)","rgb(255,116,0)","rgb(255,255,0)","rgb(0,255,255)","rgb(255,0,0)","rgb(255,211,0)","rgb(61,0,255)","rgb(0,255,0)","rgb(255,0,255)","rgb(255,146,0)","rgb(211,255,0)","rgb(0,144,255)","rgb(109,0,255)","rgb(255,73,0)","rgb(255,232,0)","rgb(0,255,146)","rgb(255,0,144)","rgb(255,170,0)","rgb(170,255,0)","rgb(0,77,255)"];this.colors1=["rgb(60,60,157)","rgb(157,60,90)","rgb(157,133,60)","rgb(104,157,60)","rgb(122,60,157)","rgb(157,104,60)","rgb(157,157,60)","rgb(60,157,157)","rgb(157,60,60)","rgb(157,140,60)","rgb(83,60,157)","rgb(60,157,60)","rgb(157,60,157)","rgb(157,115,60)","rgb(140,157,60)","rgb(60,115,157)","rgb(102,60,157)","rgb(157,88,60)","rgb(157,148,60)","rgb(60,157,115)","rgb(157,60,115)","rgb(157,125,60)","rgb(125,157,60)","rgb(60,90,157)"];this.colors2=["rgb(0,0,117)","rgb(117,0,36)","rgb(117,88,0)","rgb(53,117,0)","rgb(76,0,117)","rgb(117,53,0)","rgb(117,117,0)","rgb(0,117,117)","rgb(117,0,0)","rgb(117,97,0)","rgb(28,0,117)","rgb(0,117,0)","rgb(117,0,117)","rgb(117,67,0)","rgb(97,117,0)","rgb(0,66,117)","rgb(50,0,117)","rgb(117,33,0)","rgb(117,107,0)","rgb(0,117,67)","rgb(117,0,66)","rgb(117,78,0)","rgb(78,117,0)","rgb(0,36,117)"];this.colors3=["rgb(101,101,255)","rgb(255,101,147)","rgb(255,216,101)","rgb(171,255,101)","rgb(200,101,255)","rgb(255,171,101)","rgb(255,255,101)","rgb(101,255,255)","rgb(255,101,101)","rgb(255,229,101)","rgb(137,101,255)","rgb(101,255,101)","rgb(255,101,255)","rgb(255,189,101)","rgb(229,255,101)","rgb(101,188,255)","rgb(167,101,255)","rgb(255,145,101)","rgb(255,241,101)","rgb(101,255,189)","rgb(255,101,188)","rgb(255,204,101)","rgb(204,255,101)","rgb(101,147,255)"];this.colors4=["rgb(181,181,255)","rgb(255,181,203)","rgb(255,237,181)","rgb(215,255,181)","rgb(229,181,255)","rgb(255,215,181)","rgb(255,255,181)","rgb(181,255,255)","rgb(255,181,181)","rgb(255,242,181)","rgb(199,181,255)","rgb(181,255,181)","rgb(255,181,255)","rgb(255,223,181)","rgb(242,255,181)","rgb(181,223,255)","rgb(213,181,255)","rgb(255,202,181)","rgb(255,248,181)","rgb(181,255,223)","rgb(255,181,223)","rgb(255,230,181)","rgb(230,255,181)","rgb(181,203,255)"];this.config.push("colors");this.shapes=["sphere","square","triangle","star","rhombus","octagon","oval","plus","minus","pacman","mdavid","rect2","rect3","rectangle","image"];this.sizes=[4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34];this.timeFormat="isoDate";this.config.push("timeFormat");this.autoExtend=false;this.config.push("autoExtend");this.maxSmpStringLen=50;this.config.push("maxSmpStringLen");this.maxVarStringLen=30;this.config.push("maxVarStringLen");this.smpLabelDescription=false;this.config.push("smpLabelDescription");this.smpTitle=false;this.config.push("smpTitle");this.smpTitleFontSize=10;this.config.push("smpTitleFontSize");this.smpTitleFont=(this.smpTitleFontSize)+"Pt "+this.fontName;this.smpTitleColor=this.foreground;this.config.push("smpTitleColor");this.scaleSmpTitleFontFactor=1;this.config.push("scaleSmpTitleFontFactor");this.smpLabelFontSize=10;this.config.push("smpLabelFontSize");this.smpLabelFont=(this.smpLabelFontSize)+"Pt "+this.fontName;this.smpLabelColor=this.foreground;this.config.push("smpLabelColor");this.scaleSmpLabelFontFactor=1;this.config.push("scaleSmpLabelFontFactor");this.smpLabelRotate=0;this.config.push("smpLabelRotate");this.varLabelDescription=false;this.config.push("varLabelDescription");this.varTitle=false;this.config.push("varTitle");this.varTitleFontSize=10;this.config.push("varTitleFontSize");this.varTitleFont=(this.varTitleFontSize)+"Pt "+this.fontName;this.varTitleColor=this.foreground;this.config.push("varTitleColor");this.scaleVarTitleFontFactor=1;this.config.push("scaleVarTitleFontFactor");this.varLabelFontSize=10;this.config.push("varLabelFontSize");this.varLabelFont=(this.varLabelFontSize)+"Pt "+this.fontName;this.varLabelColor=this.foreground;this.config.push("varLabelColor");this.scaleVarLabelFontFactor=1;this.config.push("scaleVarLabelFontFactor");this.varLabelRotate=0;this.config.push("varLabelRotate");this.varTitleLabelOverlayPosition="bottom";this.config.push("varTitleLabelOverlayPosition");this.showSampleNames=true;this.config.push("showSampleNames");this.showVariableNames=true;this.config.push("showVariableNames");this.highlightVar=[];this.config.push("highlightVar");this.highlightSmp=[];this.config.push("highlightSmp");this.highlightNode=[];this.config.push("highlightNode");this.smpHighlightColor="rgb(255,0,0)";this.config.push("smpHighlightColor");this.varHighlightColor="rgb(255,0,0)";this.config.push("varHighlightColor");this.nodeHighlightColor="rgb(255,0,0)";this.config.push("nodeHighlightColor");this.selectNode={};this.isSelectNodes=0;this.overlaysWidth=30;this.config.push("overlaysWidth");this.overlays=[];this.smpOverlays=[];this.config.push("smpOverlays");this.varOverlays=[];this.config.push("varOverlays");this.showOverlays=true;this.config.push("showOverlays");this.overlayFontSize=6;this.config.push("overlayFontSize");this.overlayFont=(this.overlayFontSize)+"Pt "+this.fontName;this.overlayFontColor=this.foreground;this.config.push("overlayFontColor");this.scaleOverlayFontFactor=1;this.config.push("scaleOverlayFontFactor");this.showLegend=true;this.config.push("showLegend");this.legendPosition="right";this.config.push("legendPosition");this.legendBox=true;this.config.push("legendBox");this.legendFontSize=10;this.config.push("legendFontSize");this.legendFont=(this.legendFontSize)+"Pt "+this.fontName;this.legendColor=this.foreground;this.config.push("legendColor");this.legendBackgroundColor=this.background;this.config.push("legendBackgroundColor");this.scaleLegendFontFactor=1;this.config.push("scaleLegendFontFactor");this.showIndicators=true;this.config.push("showIndicators");this.indicatorsPosition="bottom";this.config.push("indicatorsPosition");this.showDecorations=false;this.config.push("showDecorations");this.decorationsPosition="bottom";this.config.push("decorationsPosition");this.decorationsColor=this.foreground;this.config.push("decorationsColor");this.decorationFontSize=10;this.config.push("decorationFontSize");this.decorationFont=(this.decorationFontSize)+"Pt "+this.fontName;this.scaleDecorationFontFactor=1;this.config.push("scaleDecorationFontFactor");this.decorationsWidth=10;this.config.push("decorationsWidth");this.decorationsHeight=20;this.config.push("decorationsHeight");this.decorationsType="bar";this.config.push("decorationsType");this.decorations=[];this.config.push("decorations");this.decorationsColors=[];this.config.push("decorationsColors");this.axisTickFontSize=10;this.config.push("axisTickFontSize");this.axisTickFont=(this.axisTickFontSize)+"Pt "+this.fontName;this.axisTickColor=this.foreground;this.config.push("axisTickColor");this.scaleTickFontFactor=1;this.config.push("scaleTickFontFactor");this.tickRotate=0;this.config.push("tickRotate");this.axisTitleFontSize=10;this.config.push("axisTitleFontSize");this.axisTitleFont=(this.axisTitleFontSize)+"Pt "+this.fontName;this.axisTitleColor=this.foreground;this.config.push("axisTitleColor");this.scaleTitleFontFactor=1;this.config.push("scaleTitleFontFactor");this.isGroupedData=false;this.isTransformedData=false;this.isBoxPlotCalc=false;this.isMarketDataFormated=false;this.isMarketSwitched=false;this.isGraphTime=false;this.config.push("isGraphTime");this.groupingFactors=[];this.config.push("groupingFactors");this.segregateSamplesBy=false;this.config.push("segregateSamplesBy");this.segregateVariablesBy=false;this.config.push("segregateVariablesBy");this.isLogData=false;this.config.push("isLogData");this.smpSort=-1;this.varSort=-1;this.tmpAsciiArray=[];this.sortDir="ascending";this.config.push("sortDir");this.transformBase=2;this.config.push("transformBase");this.transformType=false;this.config.push("transformType");this.ratioReference=0;this.config.push("ratioReference");this.zscoreAxis="samples";this.config.push("zscoreAxis");this.showErrorBars=true;this.config.push("showErrorBars");this.randomData=false;this.config.push("randomData");this.randomDataMean=100;this.config.push("randomDataMean");this.randomDataSigma=50;this.config.push("randomDataSigma");this.randomDataVariables=6;this.config.push("randomDataVariables");this.randomDataSamples=12;this.config.push("randomDataSamples");this.randomDataVariableAnnotations=2;this.config.push("randomDataVariableAnnotations");this.randomDataSampleAnnotations=3;this.config.push("randomDataSampleAnnotations");this.randomDataVariableAnnotationRatio=2;this.config.push("randomDataVariableAnnotationRatio");this.randomDataSampleAnnotationRatio=2;this.config.push("randomDataSampleAnnotationRatio");this.randomMissingDataPercentage=0;this.config.push("randomMissingDataPercentage");this.zoom=1;this.config.push("zoom");this.zoomStep=0.1;this.config.push("zoomStep");this.panningX=0;this.config.push("panningX");this.panningY=0;this.config.push("panningY");this.panningGlobalX=0;this.panningGlobalY=0;this.panningStep=0.1;this.config.push("panningStep");this.distance="euclidian";this.config.push("distance");this.linkage="single";this.config.push("linkage");this.clusterAxis="samples";this.config.push("clusterAxis");this.kmeansClusters=3;this.config.push("kmeansClusters");this.maxIterations=10;this.config.push("maxIterations");this.imputeMethod="mean";this.config.push("imputeMethod");this.centerData=false;this.config.push("centerData");this.xAxisAbsMax=null;this.xAxisAbsMin=null;this.xAxis2AbsMax=null;this.xAxis2AbsMin=null;this.yAxisAbsMax=null;this.yAxisAbsMin=null;this.zAxisAbsMax=null;this.zAxisAbsMin=null;this.xAxisMaxStrLength=false;this.xAxis2MaxStrLength=false;this.yAxisMaxStrLength=false;this.zAxisMaxStrLength=false;this.setMax=null;this.config.push("setMax");this.setMin=null;this.config.push("setMin");this.setMax2=null;this.config.push("setMax2");this.setMin2=null;this.config.push("setMin2");this.setMaxX=null;this.config.push("setMaxX");this.setMinX=null;this.config.push("setMinX");this.setMaxY=null;this.config.push("setMaxY");this.setMinY=null;this.config.push("setMinY");this.setMaxZ=null;this.config.push("setMaxZ");this.setMinZ=null;this.config.push("setMinZ");this.xAxisCurrent=0;this.config.push("xAxisCurrent");this.yAxisCurrent=0;this.config.push("yAxisCurrent");this.zAxisCurrent=0;this.config.push("zAxisCurrent");this.xAxisTitle=false;this.config.push("xAxisTitle");this.yAxisTitle=false;this.config.push("yAxisTitle");this.zAxisTitle=false;this.config.push("zAxisTitle");this.xAxis=[];this.config.push("xAxis");this.xAxis2=[];this.config.push("xAxis2");this.yAxis=[];this.config.push("yAxis");this.zAxis=[];this.config.push("zAxis");this.xAxisTickStyle="solid";this.config.push("xAxisTickStyle");this.yAxisTickStyle="solid";this.config.push("yAxisTickStyle");this.zAxisTickStyle="solid";this.config.push("zAxisTickStyle");this.xAxisTickColor="rgb(220,220,220)";this.config.push("xAxisTickColor");this.yAxisTickColor="rgb(220,220,220)";this.config.push("yAxisTickColor");this.zAxisTickColor="rgb(220,220,220)";this.config.push("zAxisTickColor");this.axisExtension=0.1;this.config.push("axisExtension");this.axisExact=false;this.config.push("axisExact");this.xAxisExact=false;this.config.push("xAxisExact");this.xAxis2Exact=false;this.config.push("xAxis2Exact");this.yAxisExact=false;this.config.push("yAxisExact");this.zAxisExact=false;this.config.push("zAxisExact");this.timeValues=[];this.config.push("timeValues");this.timeValueIndices=[];this.config.push("timeValueIndices");this.xAxisValues=[];this.config.push("xAxisValues");this.xAxis2Values=[];this.config.push("xAxis2Values");this.yAxisValues=[];this.config.push("yAxisValues");this.zAxisValues=[];this.config.push("zAxisValues");this.xAxisMinorValues=[];this.config.push("xAxisMinorValues");this.xAxis2MinorValues=[];this.config.push("xAxis2MinorValues");this.yAxisMinorValues=[];this.config.push("yAxisMinorValues");this.zAxisMinorValues=[];this.config.push("zAxisMinorValues");this.xAxisTransform=false;this.config.push("xAxisTransform");this.yAxisTransform=false;this.config.push("yAxisTransform");this.zAxisTransform=false;this.config.push("zAxisTransform");this.xAxisTransformTicks=true;this.config.push("xAxisTransformTicks");this.yAxisTransformTicks=true;this.config.push("yAxisTransformTicks");this.zAxisTransformTicks=true;this.config.push("zAxisTransformTicks");this.xAxisShow=true;this.config.push("xAxisShow");this.yAxisShow=true;this.config.push("yAxisShow");this.zAxisShow=true;this.config.push("zAxisShow");this.ticks=50;this.config.push("ticks");this.timeTicksFirst=false;this.config.push("timeTicksFirst");this.xAxisTicks=5;this.config.push("xAxisTicks");this.xAxis2Ticks=5;this.config.push("xAxis2Ticks");this.yAxisTicks=5;this.config.push("yAxisTicks");this.zAxisTicks=5;this.config.push("zAxisTicks");this.xAxisMinorTicks=true;this.config.push("xAxisMinorTicks");this.xAxis2MinorTicks=true;this.config.push("xAxis2MinorTicks");this.yAxisMinorTicks=true;this.config.push("yAxisMinorTicks");this.zAxisMinorTicks=false;this.config.push("zAxisMinorTicks");this.smpHairline="dotted";this.config.push("smpHairline");this.smpHairlineColor="rgb(220,220,220)";this.config.push("smpHairlineColor");this.blockContrast=false;this.config.push("blockContrast");this.blockContrastOddColor=this.background;this.config.push("blockContrastOddColor");this.blockContrastEvenColor="rgb(240,240,240)";this.config.push("blockContrastEvenColor");this.blockSeparationFactor=1;this.config.push("blockSeparationFactor");this.blockFactor=1;this.config.push("blockFactor");this.showDataValues=false;this.config.push("showDataValues");this.lineDecoration="symbol";this.config.push("lineDecoration");this.coordinateLineColor=true;this.config.push("coordinateLineColor");this.lineThickness=1;this.config.push("lineTickness");this.colorBy=false;this.config.push("colorBy");this.shapeBy=false;this.config.push("shapeBy");this.sizeBy=false;this.config.push("sizeBy");this.isScatterLine=false;this.config.push("isScatterLine");this.selectDataPoint=[];this.hideDataPoint=[];this.isSelectDataPoints=0;this.isHistogram=false;this.config.push("isHistogram");this.histogramBarWidth=0.5;this.config.push("histogramBarWidth");this.histogramBins=20;this.config.push("histogramBins");this.isCreateHistogram=false;this.allVsAll=false;this.config.push("allVsAll");this.allVsAllType="both";this.config.push("allVsAllType");this.functionIntervals=20;this.config.push("functionIntervals");this.xRotate=45;this.config.push("xRotate");this.yRotate=0;this.config.push("yRotate");this.zRotate=0;this.config.push("zRotate");this.rotationDelay=100;this.config.push("rotationDelay");this.rotationSensitivity=45;this.config.push("rotationSensitivity");this.rotationStep=2;this.config.push("rotationStep");this.indicatorCenter="white";this.config.push("indicatorCenter");this.indicatorHeight=8;this.config.push("indicatorHeight");this.indicatorWidth=1;this.config.push("indicatorWidth");this.heatmapType="blue-red";this.config.push("heatmapType");this.varIndicesStart=-1;this.smpIndicesStart=-1;this.correlationAxis="samples";this.config.push("correlationAxis");this.correlationAnchorLegend=false;this.config.push("correlationAnchorLegend");this.correlationAnchorLegendAlignWidth=40;this.config.push("correlationAnchorLegendAlignWidth");this.showSmpDendrogram=false;this.config.push("showSmpDendrogram");this.showVarDendrogram=false;this.config.push("showVarDendrogram");this.varDendrogramPosition="top";this.config.push("varDendrogramPosition");this.smpDendrogramPosition="left";this.config.push("smpDendrogramPosition");this.dendrogramSpace=6;this.config.push("dendrogramSpace");this.dendrogramHang=false;this.config.push("dendrogramHang");this.dendrogramHeight=false;this.config.push("dendrogramHeight");this.vennGroups=4;this.config.push("vennGroups");this.vennCompartments=["A","B","AB","C","AC","BC","ABC","D","AD","BD","CD","ABD","ACD","BCD","ABCD"];this.vennColors=false;this.config.push("vennColors");this.pieType="separated";this.config.push("pieType");this.pieSegmentPrecision=0;this.config.push("pieSegmentPrecision");this.pieSegmentSeparation=3;this.config.push("pieSegmentSeparation");this.pieSegmentLabels="inside";this.config.push("pieSegmentLabels");this.maxPieSectors=20;this.config.push("maxPieSectors");this.showPieGrid=true;this.config.push("showPieGrid");this.showPieSampleLabel=true;this.config.push("showPieSampleLabel");this.showVolume=true;this.config.push("showVolume");this.showSma5=false;this.config.push("showSma5");this.sma5Color="rgb(255,0,0)";this.config.push("sma5Color");this.showSma10=false;this.config.push("showSma10");this.sma10Color="rgb(0,255,0)";this.config.push("sma1Color");this.showSma25=false;this.config.push("showSma25");this.sma25Color="rgb(0,0,255)";this.config.push("sma25Color");this.showSma50=false;this.config.push("showSma50");this.sma50Color="rgb(0,0,0)";this.config.push("sma50Color");this.calculateLayout=true;this.config.push("calculateLayout");this.networkFreeze=false;this.config.push("networkFreeze");this.networkFreezeOnLoad=false;this.config.push("networkFreezeOnLoad");this.networkStack=[];this.networkStack[0]=[];this.networkStack[1]=[];this.networkStackStates=5;this.config.push("networkStackStates");this.approximateNodePositions=false;this.config.push("approximateNodePositions");this.networkLayoutType="forceDirected";this.config.push("networkLayoutType");this.networkRoot=false;this.config.push("networkRoot");this.showNetworkRadialLayout=false;this.config.push("showNetworkRadialLayout");this.networkDepth=0;this.networkDivisions=0;this.preScaleNetwork=false;this.config.push("preScaleNetwork");this.showNodeNameThreshold=50;this.config.push("showNodeNameThreshold");this.showHiddenChildEdges=true;this.config.push("showHiddenChildEdges");this.nodeSize=this.preScaleNetwork?10:20;this.config.push("nodeSize");this.edgeWidth=1;this.config.push("edgeWidth");this.layoutTime=15;this.config.push("layoutTime");this.nodeFontSize=this.nodeSize;this.config.push("nodeFontSize");this.nodeFont=this.nodeFontSize+"Pt "+this.fontName;this.nodeFontColor=this.foreground;this.config.push("nodeFontColor");this.scaleNodeFontFactor=1;this.config.push("scaleNodeFontFactor");this.randomNetwork=false;this.config.push("randomNetwork");this.reduceRandomNetwork=false;this.config.push("reduceRandomNetwork");this.randomNetworkNodes=50;this.config.push("randomNetworkNodes");this.randomNetworkNodeEdgesMax=5;this.config.push("randomNetworkNodeEdgesMax");this.colorNodeBy=false;this.config.push("colorNodeBy");this.shapeNodeBy=false;this.config.push("shapeNodeBy");this.sizeNodeBy=false;this.config.push("sizeNodeBy");this.colorEdgeBy=false;this.config.push("colorEdgeBy");this.shapeEdgeBy=false;this.config.push("shapeEdgeBy");this.sizeEdgeBy=false;this.config.push("sizeEdgeBy");this.is3DNetwork=false;this.config.push("is3DNetwork");this.network2DRotate=0;this.skipClick=false;this.trackNameFontSize=10;this.config.push("trackNameFontSize");this.trackNameFont=(this.trackNameFontSize)+"Pt "+this.fontName;this.trackNameFontColor=this.background;this.config.push("trackNameFontColor");this.showFeatureNameThereshold=20;this.config.push("showFeatureNameThereshold ");this.featureNameFontSize=8;this.config.push("featureNameFontSize");this.featureNameFont=(this.featureNameFontSize)+"Pt "+this.fontName;this.featureNameFontColor=this.background;this.config.push("featureNameFontColor");this.featureWidthDefault=3;this.config.push("featureWidthDefault");this.featureHeightDefault=8;this.config.push("featureHeightDefault");this.featureTypeDefault="line";this.config.push("featureTypeDefault");this.sequenceFontSize=10;this.config.push("sequenceFontSize");this.sequenceFont=(this.sequenceFontSize)+"Pt "+this.fontName;this.sequenceAColor="rgb(255,255,0)";this.config.push("sequenceAColor");this.sequenceCColor="rgb(0,255,255)";this.config.push("sequenceCColor");this.sequenceGColor="rgb(0,255,0)";this.config.push("sequenceGColor");this.sequenceTColor="rgb(255,0,0)";this.config.push("sequenceTColor");this.sequenceMColor="rgb(255,0,255)";this.config.push("sequenceMColor");this.wireColor=this.isVML?"rgb(220,220,220)":"rgba(220,220,220,0.1)";this.config.push("wireColor");this.periodTicksLabels=5;this.config.push("periodTicksLabels");this.tension=0.3;this.config.push("tension");this.debug=true;this.config.push("debug");this.showVersion=true;this.config.push("showVersion");this.disableConfigurator=false;this.config.push("disableConfigurator");this.disableEvents=false;this.config.push("disableEvents");this.eventKeys=true;this.config.push("eventKeys");this.dragAreaColor="rgb(208,222,240)";this.config.push("dragAreaColor");this.selectedBackgroundColor="rgb(255,0,0)";this.config.push("selectedBackgroundColor");this.infoAreaColor="rgb(208,222,240)";this.config.push("infoAreaColor");this.infoTimeOut=3000;this.config.push("infoTimeOut");this.modelEvent="global";this.config.push("modelEvent");this.dataEvent=[];this.isBroadcasting=true;this.config.push("isBroadcasting");this.resizerAreaColor=this.isVML?"rgb(210,210,210)":"rgba(210,210,210,0.7)";this.config.push("resizerAreaColor");this.resizerAreaColorCurrent="rgb(237,247,255)";this.config.push("resizerAreaColorCurrent");this.resizerAreaColorOutlineCurrent="rgb(59,138,229)";this.config.push("resizerAreaColorOutlineCurrent");this.resizerTransparency=true;this.config.push("resizerTransparency");this.resizerType=false;this.config.push("resizerType");this.resizerDraw=false;this.config.push("resizerDraw");this.resizerPosition="bottom";this.config.push("resizerPosition");this.resizerWidth=50;this.config.push("resizerWidth");this.resizerBackgroundImage=false;this.config.push("resizerBackgroundImage");this.resizerDataIndex=0;this.config.push("resizerDataIndex");this.resizerEventData={};this.showAnimation=false;this.config.push("showAnimation");this.showAnimationFontSize=10;this.config.push("showAnimationFontSize");this.showAnimationFont=(this.showAnimationFontSize)+"Pt "+this.fontName;this.showAnimationFontColor=this.background;this.config.push("showAnimationFontColor");this.animationTime=30;this.config.push("animationTime");this.animationType="grow";this.config.push("animationType");this.animationCycles=20;this.config.push("animationCycles");this.snapshotCopyChangeOnly=true;this.config.push("snapshotCopyChangeOnly");this.snapshots=[];this.isAnimation=false;this.weight=1;this.scaleX=1;this.scaleY=1;this.translateX=0;this.translateY=0;this.offsetX=0;this.offsetY=0;this.layoutWidth=0;this.layoutHeight=0;this.layout="1X1";this.config.push("layout");this.layoutComb=false;this.config.push("layoutComb");this.layoutAdjust=false;this.config.push("layoutAdjust");this.layoutCurrent=0;this.layoutMaxLegend=0;this.layoutMulticolor=true;this.config.push("layoutMulticolor");this.layoutAxis=3;this.imageDir="http://canvasxpress.org/images/";this.config.push("imageDir");this.playButton="play.png";this.config.push("playButton");this.stopButton="stop.png";this.config.push("stopButton");this.previousButton="rewind.png";this.config.push("previousButton");this.nextButton="fast_forward.png";this.config.push("nextButton");this.remoteService=false;this.config.push("remoteService");this.remoteParams={};this.config.push("remoteParams");this.remoteDirection="next";this.config.push("remoteDirection");this.remoteDataIndex=0;this.remoteWindow=1;this.config.push("remoteWindow");this.remoteAutoPlay=false;this.config.push("remoteAutoPlay");this.remoteAutoPlayDelay=1000;this.config.push("remoteAutoPlayDelay");this.remoteUpdating=false;if(!a){this.setConfig(this.config);this.initDimensions();this.initUtils();this.initApi();this.initText();this.initTime();this.initAttributes()}};CanvasXpress.prototype.initDimensions=function(){if(this.canvas.width){this.originalWidth=this.canvas.width;this.width=this.canvas.width}else{if(this.width){this.originalWidth=this.width;this.canvas.width=this.width}else{this.width=600;this.originalWidth=this.width;this.canvas.width=this.width}}if(this.canvas.height){this.originalHeight=this.canvas.height;this.height=this.canvas.height}else{if(this.height){this.originalHeight=this.height;this.canvas.height=this.height}else{this.height=600;this.originalHeight=this.height;this.canvas.height=this.height}}this.top=this.margin;if(this.title){this.top+=this.titleHeight+this.margin;if(this.subtitle){this.top+=this.subtitleHeight+this.margin}}this.left=this.margin;this.right=this.margin;this.bottom=this.margin;this.x=this.width-(this.left+this.right);this.y=this.height-(this.top+this.bottom)};CanvasXpress.prototype.initUtils=function(){this.validateColor=function(b,a){if(b.match(/^rgba?\((\d{1,3},\d{1,3},\d{1,3})(?:,([0-9\.]+))?/i)){if(RegExp.$2){b="rgba("+RegExp.$1+","+RegExp.$2+")"}else{b="rgb("+RegExp.$1+")"}}else{if(b.match(/^#?[0-9abcdef]/i)){b=this.hexToRgb(b)}else{b=false}}return b&&a!=null?this.addColorTransparency(b,a):b};this.hexToRgb=function(d){var b=function(){return parseInt(d.substring(0,2),16)};var a=function(){return parseInt(d.substring(2,4),16)};var e=function(){return parseInt(d.substring(4,6),16)};d=d.charAt(0)=="#"?d.substring(1,7):d;return"rgb("+b()+","+a()+","+e()+")"};this.addColorTransparency=function(b,a){if(b.match(/^rgba?\((\d{1,3},\d{1,3},\d{1,3})(?:,([0-9\.]+))?/i)){if(RegExp.$2){return"rgba("+RegExp.$1+","+a+")"}else{return"rgba("+RegExp.$1+","+a+")"}}else{return false}};this.disableGradientTransparency=function(){this.gradientTemp=this.gradient;this.transparencyTemp=this.transparency;this.gradient=false;this.transparency=null};this.enableGradientTransparency=function(){this.gradient=this.gradientTemp;this.transparency=this.transparencyTemp};this.getGradientColor=function(h){if(h.match(/^rgba?\((\d{1,3}),(\d{1,3}),(\d{1,3})(?:,([0-9\.]+))?/i)){var f=Math.floor(parseInt(RegExp.$1)/this.gradientRatio);var e=Math.floor(parseInt(RegExp.$2)/this.gradientRatio);var a=Math.floor(parseInt(RegExp.$3)/this.gradientRatio);var d=RegExp.$4?parseFloat(RegExp.$4):false;if(d){return"rgba("+f+","+e+","+a+","+d+")"}else{return"rgb("+f+","+e+","+a+")"}}else{return false}};this.setGradient=function(f,e,d,b,a){if(this.gradientType=="radial"){this.setRadialGradient(f,e,d,b,false,false,true)}else{this.setLinearGradient(f,e,d,b,a,false,true)}};this.setLinearGradient=function(d,k,a,h,f,b,e){if(!e){this.ctx.save()}var j=this.ctx.createLinearGradient(d,k,a,h);if(!b){b=this.getGradientColor(f);j.addColorStop(0,b);j.addColorStop(0.6,f);j.addColorStop(1,f)}else{j.addColorStop(0,f);j.addColorStop(1,b)}this.ctx.fillStyle=j};this.setRadialGradient=function(m,j,a,f,e,d,k){if(!k){this.ctx.save()}var b=a/5.5;var h=this.ctx.createRadialGradient(m-b,j-b,1,m,j,a);if(!e){if(this.transparency!=null){e="rgba(0,0,0,"+this.transparency+")"}else{e="rgb(0,0,0)"}}if(!d){d="rgba(0,0,0,0)"}h.addColorStop(0,f);h.addColorStop(1,e);h.addColorStop(1,d);this.ctx.fillStyle=h};this.getVarColor=function(a){if(this.isArray(this.highlightVar)){for(var b=0;b<this.highlightVar.length;b++){if(this.highlightVar[b]==a){return this.varHighlightColor}}}else{if(this.highlightVar==a){return this.varHighlightColor}}return this.varLabelColor};this.getSmpColor=function(b){if(this.isArray(this.highlightSmp)){for(var a=0;a<this.highlightSmp.length;a++){if(this.highlightSmp[a]==b){return this.smpHighlightColor}}}else{if(this.highlightSmp==b){return this.smpHighlightColor}}return this.smpLabelColor};this.getNodeColor=function(b){if(this.isArray(this.highlightNode)){for(var a=0;a<this.highlightNode.length;a++){if(this.highlightNode[a]==b){return this.nodeHighlightColor}}}else{if(this.highlightNode==b){return this.nodeHighlightColor}}return this.selectNode.hasOwnProperty(b)?this.nodeHighlightColor:this.nodeFontColor};this.drawTitle=function(){var d;var b;var a;if(this.title){b=this.titleHeight/2;d=this.scaleTextToFont(this.title,this.titleHeight-b,this.x);this.drawText(this.title,this.width/2,this.titleHeight/2,d,false,"center","middle");if(this.subtitle){a=this.subtitleHeight/4;d=this.scaleTextToFont(this.subtitle,this.subtitleHeight-a,this.x);this.drawText(this.subtitle,this.width/2,(this.titleHeight+this.subtitleHeight)-(b/2),d,false,"center","middle")}}};this.resizeCanvas=function(d,a,b){if(this.ctx){this.disableGradientTransparency();if(d||a||b){if(a||b){if(a){this.width=a;this.originalWidth=a}if(b){this.height=b;this.originalHeight=b}}else{if(d){this.width=this.originalWidth;this.height=this.originalHeight}}this.top=this.margin;if(this.title){this.top+=this.titleHeight+this.margin;if(this.subtitle){this.top+=this.subtitleHeight+this.margin}}this.left=this.margin;this.right=this.margin;this.bottom=this.margin;this.resetMap()}this.canvas.width=this.width;this.canvas.height=this.height;if(this.backgroundType=="image"||this.backgroundType=="windowImage"){this.ctx.save();this.ctx.translate(0,0);this.ctx.drawImage(CanvasXpress.cacheImages[this.backgroundImage],0,0,this.width,this.height);this.ctx.restore()}else{if(this.backgroundType=="solid"||this.backgroundType=="window"||this.backgroundType=="windowSolidGradient"){this.rectangle(0,0,this.width,this.height,this.background,this.background)}else{this.setLinearGradient(0,0,0,this.height,this.backgroundGradient1Color,this.backgroundGradient2Color);this.ctx.fillRect(0,0,this.width,this.height)}}this.enableGradientTransparency()}};this.drawPlotWindow=function(){if(this.backgroundType.match("window")){this.disableGradientTransparency();if(this.backgroundType=="windowGradient2"||this.backgroundType=="windowSolidGradient"){this.ctx.save();if(this.backgroundWindowGradientOrientation=="horizontal"){this.setLinearGradient(this.offsetX,this.offsetY,this.offsetX+this.x,this.offsetY,this.backgroundWindowGradient1Color,this.backgroundWindowGradient2Color);this.ctx.fillRect(this.offsetX+this.left,this.offsetY+this.top,this.x,this.y)}else{this.setLinearGradient(this.offsetX,this.offsetY,this.offsetX,this.offsetY+this.y,this.backgroundWindowGradient1Color,this.backgroundWindowGradient2Color);this.ctx.fillRect(this.offsetX+this.left,this.offsetY+this.top,this.x,this.y)}}else{this.rectangle(this.offsetX+this.left,this.offsetY+this.top,this.x,this.y,this.backgroundWindow,this.backgroundWindow)}this.enableGradientTransparency()}};this.maskPlotArea=function(){var b=this.layoutComb?this.layoutWidth:this.width;var a=this.layoutComb?this.layoutHeight:this.height;this.disableGradientTransparency();if(this.backgroundType=="image"||this.backgroundType=="windowImage"){this.ctx.save();this.ctx.translate(0,0);this.ctx.drawImage(CanvasXpress.cacheImages[this.backgroundImage],0,0,this.width,this.top-1,this.offsetX,this.offsetY,b,this.top);this.ctx.drawImage(CanvasXpress.cacheImages[this.backgroundImage],0,0,this.left-1,this.height,this.offsetX,this.offsetY,this.left,a);this.ctx.drawImage(CanvasXpress.cacheImages[this.backgroundImage],0,this.height-this.bottom,this.width,this.bottom,this.offsetX,(this.offsetY+a+1)-this.bottom,b,this.bottom);this.ctx.drawImage(CanvasXpress.cacheImages[this.backgroundImage],this.width-this.right,0,this.right,this.height,(this.offsetX+b+1)-this.right,this.offsetY,this.right,a);this.ctx.restore()}else{if(this.backgroundType=="solid"||this.backgroundType=="window"||this.backgroundType=="windowSolidGradient"){this.rectangle(this.offsetX,this.offsetY,b,this.top-1,this.background,this.background);this.rectangle(this.offsetX,this.offsetY,this.left-1,a,this.background,this.background);this.rectangle(this.offsetX,(this.offsetY+a+1)-this.bottom,b,this.bottom,this.background,this.background);this.rectangle((this.offsetX+b+1)-this.right,this.offsetY,this.right,a,this.background,this.background)}else{this.setLinearGradient(0,0,0,this.height,this.backgroundGradient1Color,this.backgroundGradient2Color);this.ctx.fillRect(this.offsetX,this.offsetY,b,this.top-1);this.ctx.fillRect(this.offsetX,this.offsetY,this.left-1,a);this.ctx.fillRect(this.offsetX,(this.offsetY+a+1)-this.bottom,b,this.bottom);this.ctx.fillRect((this.offsetX+b+1)-this.right,this.offsetY,this.right,a)}}this.enableGradientTransparency()};this.maskTreeArea=function(){this.disableGradientTransparency();if(this.backgroundType=="image"||this.backgroundType=="windowImage"){this.ctx.save();this.ctx.translate(0,0);this.ctx.drawImage(CanvasXpress.cacheImages[this.backgroundImage],0,0,this.left,this.top,this.offsetX,this.offsetY,this.left,this.top);this.ctx.drawImage(CanvasXpress.cacheImages[this.backgroundImage],this.left+this.x,0,this.right,this.top,this.offsetX+this.left+this.x,this.offsetY,this.right,this.top);this.ctx.drawImage(CanvasXpress.cacheImages[this.backgroundImage],0,this.top+this.y,this.left,this.bottom,this.offsetX,this.offsetY+this.top+this.y,this.left,this.bottom);this.ctx.drawImage(CanvasXpress.cacheImages[this.backgroundImage],this.left+this.x,this.top+this.y,this.right,this.bottom,this.offsetX+this.left+this.x,this.offsetY+this.top+this.y,this.right,this.bottom);this.ctx.restore()}else{if(this.backgroundType=="solid"||this.backgroundType=="window"||this.backgroundType=="windowSolidGradient"){this.rectangle(this.offsetX,this.offsetY,this.left,this.top,this.background,this.background);this.rectangle(this.offsetX+this.left+this.x,this.offsetY,this.right,this.top,this.background,this.background);this.rectangle(this.offsetX,this.offsetY+this.top+this.y,this.left,this.bottom,this.background,this.background);this.rectangle(this.offsetX+this.left+this.x,this.offsetY+this.top+this.y,this.right,this.bottom,this.background,this.background)}else{this.setLinearGradient(0,0,0,this.height,this.backgroundGradient1Color,this.backgroundGradient2Color);this.ctx.fillRect(this.offsetX,this.offsetY,this.left,this.top);this.ctx.fillRect(this.offsetX+this.left+this.x,this.offsetY,this.right,this.top);this.ctx.fillRect(this.offsetX,this.offsetY+this.top+this.y,this.left,this.bottom);this.ctx.fillRect(this.offsetX+this.left+this.x,this.offsetY+this.top+this.y,this.right,this.bottom)}}this.enableGradientTransparency()};this.modifyObjectArray=function(g,b,h){var a=this[h];if(b){var e={};var d=[];if(this.isArray(g)){for(var f=0;f<g.length;f++){e[g[f]]=1}}else{e[g]=1}for(var f=0;f<a.length;f++){if(!e.hasOwnProperty(a[f])){d.push(a[f])}}this[h]=d}else{if(this.isArray(g)){for(var f=0;f<g.length;f++){a.push(g[f])}}else{a.push(g)}}};this.getObjectArray=function(a){var b={};for(var d=0;d<a.length;d++){b[a[d]]=1}return b};this.isInArray=function(e,b){if(b&&!(b.propertyIsEnumerable("length"))&&typeof b==="object"&&typeof b.length==="number"){for(var d=0;d<b.length;d++){if(b[d]==e){return true}}}return false};this.isArray=function(a){if(a&&!(a.propertyIsEnumerable("length"))&&typeof a==="object"&&typeof a.length==="number"){return true}else{return false}};this.toArray=function(a){return this.isArray(a)?a:[a]};this.toNumber=function(b,g){var h=[];var d=this.isArray(b);b=this.toArray(b);for(var e=0;e<b.length;e++){if(g){h.push(parseFloat(b[e]))}else{h.push(parseInt(b[e]))}}return d?h:h[0]};this.cloneObject=function(d){if(d==null||typeof(d)!="object"){return d}var a=new d.constructor();for(var b in d){a[b]=this.cloneObject(d[b])}return a};this.isSameObject=function(e,d){if(e===d){return true}if(typeof(e)!="object"||typeof(d)!="object"){return false}for(var f in e){if(e[f]===d[f]){continue}if(d[f]===undefined||typeof(e[f])!=typeof(d[f])){return false}if(!this.isSameObject(e[f],d[f])){return false}}for(var f in d){if(e[f]===undefined){return false}}return true};this.drawDecorationData=function(){if(this.showDecorations&&this.data.d){if(this.data.d.nlfit){var U,v,W;var h=this.smpIndices;var s,a;for(var T=0;T<this.data.d.nlfit.length;T++){var D=[];var C=[];var m=T%this.colors.length;var P=this.data.d.nlfit[T].param[0];var M=this.data.d.nlfit[T].param[1];var L=this.data.d.nlfit[T].param[2];var J=this.data.d.nlfit[T].param[3];var E=this.xAxisIndices[T];if(this.xAxisTransform=="percentile"){U=this.getAxisRangeBySample(E);W=U[0];v=U[1]}var F=this.data.y.data[E];h.sort(function(k,j){return F[k]-F[j]});m=this.data.d.nlfit[T].color?this.data.d.nlfit[T].color:this.colors[m];for(var S=0;S<h.length;S++){var o=h[S];var I=this.getDataAtPos(E,o,false,this.xAxisTransform,W,v);var H;var p=[];if(I>0){if(S>0){var b=h[S-1];var G=this.getDataAtPos(E,b,false,this.xAxisTransform,W,v);if(G>0){var d=(I-G)/this.functionIntervals;for(var R=0;R<this.functionIntervals;R++){p.push(G);G+=d}}}else{p=[I]}for(var R=0;R<p.length;R++){if(this.data.d.nlfit[T].type=="reg"){H=P+((M-P)/(1+L/(Math.pow(p[R],J))))}else{H=P+((M-P)/(1+(Math.pow((p[R]/L),J))))}s=(this.offsetX+this.left)+((p[R]-this.xAxisMin)*this.xAxisUnit);a=(this.offsetY+this.top+this.y)-((H-this.yAxisMin)*this.yAxisUnit);D.push(s);C.push(a)}}}if(D.length>0){this.drawShape("path",D,C,false,false,m,m,"open");if(this.data.d.nlfit[T].type=="reg"){H=P+((M-P)/(1+L/(Math.pow(L,J))))}else{H=P+((M-P)/(1+(Math.pow((L/L),J))))}s=(this.offsetX+this.left)+((L-this.xAxisMin)*this.xAxisUnit);a=(this.offsetY+this.top+this.y)-((H-this.yAxisMin)*this.yAxisUnit);this.drawLine("dashedLine",this.left,a,s,a,m);this.drawLine("dashedLine",s,a,s,(this.top+this.y),m)}}}if(this.data.d.line){for(var T=0;T<this.data.d.line.length;T++){if(this.data.d.line[T].x||this.data.d.line[T].y){var m=this.data.d.line[T].color?this.data.d.line[T].color:this.colors[T%this.colors.length];var Y=this.data.d.line[T].type?this.data.d.line[T].type:"line";var I=this.data.d.line[T].x?this.data.d.line[T].x:false;var H=this.data.d.line[T].y?this.data.d.line[T].y:false;var s,a,q,Z;if(I){s=(this.offsetX+this.left)+(I*this.xAxisUnit)-(this.xAxisMin*this.xAxisUnit);a=this.offsetY+this.top;q=s;Z=a+this.y;this.drawLine(Y,s,a,q,Z,m)}if(H){s=this.offsetX+this.left;a=this.offsetY+this.top+(H*this.yAxisUnit)+(this.yAxisMin*this.yAxisUnit);q=s+this.x;Z=a;this.drawLine(Y,s,a,q,Z,m)}}}}if(this.data.d.reg){for(var T=0;T<this.data.d.reg.length;T++){if(this.data.d.reg[T].slope&&this.data.d.reg[T].intercept){var m=T%this.colors.length;var Y=this.data.d.reg[T].type?this.data.d.reg[T].type:"line";var u=this.data.d.reg[T].slope;var N=this.data.d.reg[T].intercept;var f=this.data.d.reg[T].cor;var s=this.data.d.reg[T].start?this.data.d.reg[T].start:this.xAxisMin;var a=(u*s)+N;var q=this.data.d.reg[T].end?this.data.d.reg[T].end:this.xAxisMax;var Z=(u*q)+N;s=(this.offsetX+this.left)+(s*this.xAxisUnit)-(this.xAxisMin*this.xAxisUnit);a=(this.offsetY+this.top+this.y)-(a*this.yAxisUnit)+(this.yAxisMin*this.yAxisUnit);q=(this.offsetX+this.left)+(q*this.xAxisUnit)-(this.xAxisMin*this.xAxisUnit);Z=(this.offsetY+this.top+this.y)-(Z*this.yAxisUnit)+(this.yAxisMin*this.yAxisUnit);m=this.data.d.reg[T].color?this.data.d.reg[T].color:this.colors[m];this.drawLine(Y,s,a,q,Z,m)}}}if(this.data.d.nor){for(var T=0;T<this.data.d.nor.length;T++){if(this.data.d.nor[T].mu&&this.data.d.nor[T].sigma){var Q=[];var O=[];var B=[];var s,a;var m=T%this.colors.length;var n=this.data.d.nor[T].mu;var e=this.data.d.nor[T].sigma;var z=this.data.d.nor[T].start?this.data.d.nor[T].start:this.data.d.nor[T].yAxis?this.yAxisMin:this.xAxisMin;var t=this.data.d.nor[T].end?this.data.d.nor[T].end:this.data.d.nor[T].yAxis?this.yAxisMax:this.xAxisMax;var g=120;if(z<n&&n<t){var G,r,w,V;var d=(n-z)/g;var X=e*e;var K=X*2;var A=1/Math.sqrt(2*Math.PI*X);if(this.data.d.nor[T].yAxis){w=this.data.d.nor[T].max?this.data.d.nor[T].max*this.xAxisUnit:this.x-(this.x*this.axisExtension);V=w/A;G=z;for(var S=0;S<g-1;S++){r=(A*Math.pow(Math.E,-Math.pow(G-n,2)/X));B.push([G,r]);s=(this.offsetX+this.left)+(r*V);a=(this.offsetY+this.top+this.y)-(G*this.yAxisUnit)+(this.yAxisMin*this.yAxisUnit);Q.push(s);O.push(a);G+=d}d=(t-n)/g;G=n;for(var S=0;S<g;S++){r=(A*Math.pow(Math.E,-Math.pow(G-n,2)/X));B.push([G,r]);s=(this.offsetX+this.left)+(r*V);a=(this.offsetY+this.top+this.y)-(G*this.yAxisUnit)+(this.yAxisMin*this.yAxisUnit);Q.push(s);O.push(a);G+=d}m=this.data.d.nor[T].color?this.data.d.nor[T].color:this.colors[m];this.drawShape("path",Q,O,false,false,m,m,"open")}else{w=this.data.d.nor[T].max?this.data.d.nor[T].max*this.yAxisUnit:this.y-(this.y*this.axisExtension);V=w/A;G=z;for(var S=0;S<g-1;S++){r=(A*Math.pow(Math.E,-Math.pow(G-n,2)/X));B.push([G,r]);s=(this.offsetX+this.left)+(G*this.xAxisUnit)-(this.xAxisMin*this.xAxisUnit);a=(this.offsetY+this.top+this.y)-(r*V);Q.push(s);O.push(a);G+=d}d=(t-n)/g;G=n;for(var S=0;S<g;S++){r=(A*Math.pow(Math.E,-Math.pow(G-n,2)/X));B.push([G,r]);s=(this.offsetX+this.left)+(G*this.xAxisUnit)-(this.xAxisMin*this.xAxisUnit);a=(this.offsetY+this.top+this.y)-(r*V);Q.push(s);O.push(a);G+=d}m=this.data.d.nor[T].color?this.data.d.nor[T].color:this.colors[m];this.drawShape("path",Q,O,false,false,m,m,"open")}}}}}if(this.data.d.area){for(var T=0;T<this.data.d.area.length;T++){if(this.data.d.area[T].type&&this.data.d.area[T].x&&this.data.d.area[T].y&&this.data.d.area[T].size){if(this.isValidShape(this.data.d.area[T].type)){var s=(this.offsetX+this.left)+(this.data.d.area[T].x*this.xAxisUnit)-(this.xAxisMin*this.xAxisUnit);var a=(this.offsetY+this.top+this.y)-(this.data.d.area[T].y*this.yAxisUnit)+(this.yAxisMin*this.yAxisUnit);var m=this.data.d.area[T].color?this.data.d.area[T].color:this.colors[T%this.colors.length];this[this.data.d.area[T].type](s,a,m,this.data.d.area[T].size)}}}}}};this.setDecorationLegendDimension=function(){this.legendDecorationWidth=0;this.legendDecorationHeight=0;if(this.showDecorations&&this.data.d){var h=this.getFontPt(this.decorationFont);var f=0;var b=0;var f=0;var g=0;if(this.data.d.nlfit){var j=this.measureText(sprintf("%75s","X"),this.decorationFont)+(this.margin*4);var a=0;for(var e=0;e<this.data.d.nlfit.length;e++){var d=this.measureText(this.data.d.nlfit[e].label,this.decorationFont);a=Math.max(d,a)}f=this.margin+a+this.margin+j+this.margin;this.legendDecorationHeight=(this.data.d.nlfit.length*h*2)+h+this.margin}if(this.data.d.line){var a=0;for(var e=0;e<this.data.d.line.length;e++){var d=this.measureText(this.data.d.line[e].label,this.decorationFont);a=Math.max(d,a)}g=this.margin+a+this.margin;this.legendDecorationHeight+=(this.data.d.line.length*h*2)+this.margin}if(this.data.d.reg){var j=this.measureText(sprintf("%45s","X"),this.decorationFont)+(this.margin*2);var a=0;for(var e=0;e<this.data.d.reg.length;e++){var d=this.measureText(this.data.d.reg[e].label,this.decorationFont);a=Math.max(d,a)}b=this.margin+a+this.margin+j+this.margin;this.legendDecorationHeight+=(this.data.d.reg.length*h*2)+h+this.margin}if(this.data.d.nor){var j=this.measureText(sprintf("%30s","X"),this.decorationFont)+(this.margin*1);var a=0;for(var e=0;e<this.data.d.nor.length;e++){var d=this.measureText(this.data.d.nor[e].label,this.decorationFont);a=Math.max(d,a)}f=this.margin+a+this.margin+j+this.margin;this.legendDecorationHeight+=(this.data.d.nor.length*h*2)+h+this.margin}if(this.data.d.area){var a=0;for(var e=0;e<this.data.d.area.length;e++){var d=this.measureText(this.data.d.area[e].label,this.decorationFont);a=Math.max(d,a)}g=this.margin+a+this.margin;this.legendDecorationHeight+=(this.data.d.area.length*h*2)+this.margin}this.legendDecorationWidth=Math.max(Math.max(Math.max(f,b),f),g)}};this.drawDecorationLegend=function(){if(this.showDecorations&&this.data.d){var n=this.getFontPt(this.decorationFont);var d=this.measureText(sprintf("%15s","X"),this.decorationFont);var a,k,h,m;if(this.decorationsPosition=="right"){k=this.offsetY+this.top+(n/2)+((this.y-this.legendDecorationHeight)/2)}else{k=(this.offsetY+this.top+this.y+this.bottom)-this.legendDecorationHeight}if(this.data.d.nlfit){m=(this.margin*5)+(5*d);if(this.decorationsPosition=="right"){h=(this.offsetX+this.left+this.x+this.right+d)-m}else{h=this.offsetX+this.left+((this.x-this.legendDecorationWidth)/2)+(this.legendDecorationWidth-m)+d}a=h;this.drawText("Min",a,k,this.decorationFont,this.decorationsColor,"right","middle");a+=d+this.margin;this.drawText("Max",a,k,this.decorationFont,this.decorationsColor,"right","middle");a+=d+this.margin;this.drawText("EC50",a,k,this.decorationFont,this.decorationsColor,"right","middle");a+=d+this.margin;this.drawText("Slope",a,k,this.decorationFont,this.decorationsColor,"right","middle");a+=d+this.margin;this.drawText("p-Val",a,k,this.decorationFont,this.decorationsColor,"right","middle");k+=n+n;for(var g=0;g<this.data.d.nlfit.length;g++){var e=g%this.colors.length;e=this.data.d.nlfit[g].color?this.data.d.nlfit[g].color:this.colors[e];a=(h+this.margin)-d;if(this.graphType=="ScatterBubble2D"&&this.decorationsPosition=="right"&&this.zAxisShow){a+=this.margin+this.getFontPt(this.axisTitleFont)+this.margin}this.drawText(this.data.d.nlfit[g].label,a,k,this.decorationFont,e,"right","middle");a=h;for(var f=0;f<5;f++){var b=this.data.d.nlfit[g].param[f];this.drawText(this.formatNumber(b),a,k,this.decorationFont,this.decorationsColor,"right","middle");a+=d+this.margin}k+=n+n}}if(this.data.d.line){for(var g=0;g<this.data.d.line.length;g++){if(this.data.d.line[g].label){if(this.decorationsPosition=="right"){a=this.offsetX+this.left+this.x+this.margin}else{a=this.offsetX+this.left+((this.x-this.legendDecorationWidth)/2)+this.margin}for(var g=0;g<this.data.d.line.length;g++){var e=this.data.d.line[g].color?this.data.d.line[g].color:this.colors[g%this.colors.length];if(this.graphType=="ScatterBubble2D"&&this.decorationsPosition=="right"&&this.zAxisShow){a+=this.margin+this.getFontPt(this.axisTitleFont)+this.margin}this.drawText(this.data.d.line[g].label,a,k,this.decorationFont,e,"left","middle");k+=n+n}}}}if(this.data.d.reg){m=(this.margin*3)+(3*d);if(this.decorationsPosition=="right"){h=(this.offsetX+this.left+this.x+this.right)-m}else{h=this.offsetX+this.left+((this.x-this.legendDecorationWidth)/2)+(this.legendDecorationWidth-m)+d}a=h;this.drawText("Slope",a,k,this.decorationFont,this.decorationsColor,"right","middle");a+=d+this.margin;this.drawText("Int",a,k,this.decorationFont,this.decorationsColor,"right","middle");a+=d+this.margin;this.drawText("Cor",a,k,this.decorationFont,this.decorationsColor,"right","middle");k+=n+n;for(var g=0;g<this.data.d.reg.length;g++){var e=g%this.colors.length;e=this.data.d.reg[g].color?this.data.d.reg[g].color:this.colors[e];a=(h+this.margin)-d;if(this.graphType=="ScatterBubble2D"&&this.decorationsPosition=="right"&&this.zAxisShow){a+=this.margin+this.getFontPt(this.axisTitleFont)+this.margin}this.drawText(this.data.d.reg[g].label,a,k,this.decorationFont,e,"right","middle");a=h;this.drawText(this.formatNumber(this.data.d.reg[g].slope),a,k,this.decorationFont,this.decorationsColor,"right","middle");a+=d+this.margin;this.drawText(this.formatNumber(this.data.d.reg[g].intercept),a,k,this.decorationFont,this.decorationsColor,"right","middle");a+=d+this.margin;this.drawText(this.formatNumber(this.data.d.reg[g].cor),a,k,this.decorationFont,this.decorationsColor,"right","middle");a+=d+this.margin;k+=n+n}}if(this.data.d.nor){m=(this.margin*2)+(2*d);if(this.decorationsPosition=="right"){h=(this.offsetX+this.left+this.x+this.right)-m}else{h=this.offsetX+this.left+((this.x-this.legendDecorationWidth)/2)+(this.legendDecorationWidth-m)+d}a=h;this.drawText("Mu",a,k,this.decorationFont,this.decorationsColor,"right","middle");a+=d+this.margin;this.drawText("Sigma",a,k,this.decorationFont,this.decorationsColor,"right","middle");k+=n+n;for(var g=0;g<this.data.d.nor.length;g++){var e=g%this.colors.length;e=this.data.d.nor[g].color?this.data.d.nor[g].color:this.colors[e];a=(h+this.margin)-d;if(this.graphType=="ScatterBubble2D"&&this.decorationsPosition=="right"&&this.zAxisShow){a+=this.margin+this.getFontPt(this.axisTitleFont)+this.margin}this.drawText(this.data.d.nor[g].label,a,k,this.decorationFont,e,"right","middle");a=h;this.drawText(this.formatNumber(this.data.d.nor[g].mu),a,k,this.decorationFont,this.decorationsColor,"right","middle");a+=d+this.margin;this.drawText(this.formatNumber(this.data.d.nor[g].sigma),a,k,this.decorationFont,this.decorationsColor,"right","middle");a+=d+this.margin;k+=n+n}}if(this.data.d.area){for(var g=0;g<this.data.d.area.length;g++){if(this.data.d.area[g].label){if(this.decorationsPosition=="right"){a=this.offsetX+this.left+this.x+this.margin}else{a=this.offsetX+this.left+((this.x-this.legendDecorationWidth)/2)+this.margin}for(var g=0;g<this.data.d.area.length;g++){var e=this.data.d.area[g].color?this.data.d.area[g].color:this.colors[g%this.colors.length];if(this.graphType=="ScatterBubble2D"&&this.decorationsPosition=="right"&&this.zAxisShow){a+=this.margin+this.getFontPt(this.axisTitleFont)+this.margin}this.drawText(this.data.d.area[g].label,a,k,this.decorationFont,e,"left","middle");k+=n+n}}}}}};this.setLegendFont=function(){if(this.autoScaleFont){if(this.layoutComb){this.legendFont=(parseInt(Math.max(this.minTextSize,this.legendFontSize-Math.min(this.layoutRows,this.layoutCols))*this.scaleLegendFontFactor))}else{this.legendFont=(parseInt(this.legendFontSize*this.scaleLegendFontFactor))}this.legendFont=this.legendFont+"Pt "+this.fontName}else{this.legendFont=parseInt(this.legendFontSize)+"Pt "+this.fontName}};this.setSampleLegendDimension=function(){this.legendSampleWidth=0;this.legendSampleHeight=0;if(this.xAxisIndices.length!=this.yAxisIndices.length||this.xAxisIndices.length>1){var e=this.getFontPt(this.legendFont);var b=0;if(this.xAxisIndices.length==this.yAxisIndices.length&&this.xAxisIndices.length>1){for(var d=0;d<this.xAxisIndices.length;d++){var a=this.measureText(this.shortenText(this.xAxis[d],this.maxSmpStringLen)+" vs "+this.shortenText(this.yAxis[d],this.maxSmpStringLen),this.legendFont);b=Math.max(a,b)}}else{if(this.xAxisIndices.length>this.yAxisIndices.length){b=this.measureText(this.shortenText(this.getMaxText(this.xAxis),this.maxSmpStringLen)+" vs "+this.shortenText(this.yAxis[0],this.maxSmpStringLen),this.legendFont)}else{if(this.yAxisIndices.length>this.xAxisIndices.length){b=this.measureText(this.shortenText(this.getMaxText(this.yAxis),this.maxSmpStringLen)+" vs "+this.shortenText(this.xAxis[0],this.maxSmpStringLen),this.legendFont)}}}this.legendSampleWidth=(e-1)+b+(this.margin*3);this.legendSampleHeight=(Math.max(this.xAxisIndices.length,this.yAxisIndices.length)*(e+this.margin))+this.margin}};this.drawSampleLegend=function(b,k){var j=b;var e=k;var q=this.getFontPt(this.legendFont);var p=(q-1)/2;k+=this.margin+p;if(this.legendBox){this.disableGradientTransparency();this.rectangle(j,e,this.legendSampleWidth,this.legendSampleHeight,this.legendBackgroundColor);this.enableGradientTransparency()}var n=Math.max(this.xAxisIndices.length,this.yAxisIndices.length);for(var g=0;g<n;g++){var d=g%this.colors.length;var o=0;var h=this.xAxisIndices.length==this.yAxisIndices.length?this.yAxis[g]:this.xAxisIndices.length>this.yAxisIndices.length?this.yAxis[0]:this.xAxis[0];var m=this.shortenText(this.xAxisIndices.length<this.yAxisIndices.length?this.yAxis[g]:this.xAxis[g],this.maxSmpStringLen)+" vs "+this.shortenText(h,this.maxSmpStringLen);var f=b+p+this.margin;var a=k+p+this.margin;if(this.colorBy){this.drawShape(this.shapes[o],f,k,q-1,q-1,this.background,this.colors[d],"open")}else{this.drawShape(this.shapes[o],f,k,q-1,q-1,this.colors[d],this.foreground,"closed")}this.drawText(m,f+p+this.margin,k,this.legendFont,this.legendColor,"left","middle");k+=q+this.margin}if(this.legendBox){this.rectangle(j,e,this.legendSampleWidth,this.legendSampleHeight,false,this.foreground,"open")}this.addArea(["rect",j,e,j+this.legendSampleWidth,e+this.legendSampleHeight],[-1],"-legend-sample")};this.setVariableLegendDimension=function(){this.legendVariableWidth=0;this.legendVariableHeight=0;if((this.colorBy&&this.colorBy=="variable")||(this.shapeBy&&this.shapeBy=="variable")||(this.sizeBy&&this.sizeBy=="variable")){var a=this.sizeBy&&this.sizeBy=="variable"?Math.max(this.sizes[this.varIndices.length-1],this.getFontPt(this.legendFont)):this.getFontPt(this.legendFont);var b=this.shortenText(this.maxVarNameStr,this.maxVarStringLen);this.legendVariableWidth=(a-1)+this.measureText(b,this.legendFont)+(this.margin*3);this.legendVariableHeight=(this.varIndices.length*(a+this.margin))+this.margin}};this.drawVariableLegend=function(d,n){if((this.colorBy&&this.colorBy=="variable")||(this.shapeBy&&this.shapeBy=="variable")||(this.sizeBy&&this.sizeBy=="variable")){var k=d;var f=n;var r=this.getFontPt(this.legendFont);var m=this.sizeBy&&this.sizeBy=="variable"?Math.max(this.sizes[this.varIndices.length-1],r):r;n+=this.margin+(m/2);if(this.legendBox&&this.legendBackgroundColor){this.disableGradientTransparency();this.rectangle(k,f,this.legendVariableWidth,this.legendVariableHeight,this.legendBackgroundColor);this.enableGradientTransparency()}for(var h=0;h<this.varIndices.length;h++){var o=this.varIndices[h];var e=this.colorBy&&this.colorBy=="variable"?h%this.colors.length:0;var q=this.shapeBy&&this.shapeBy=="variable"?h%this.shapes.length:0;var b=this.sizeBy&&this.sizeBy=="variable"?this.sizes[h%this.sizes.length]:m;var p=m/2;var g=d+p+this.margin;var a=n+p+this.margin;var j=this.shortenText(this.data.y.vars[o],this.maxVarStringLen);if(this.colorBy&&this.colorBy!="variable"){this.drawShape(this.shapes[q],g,n,b,b,this.background,this.foreground,"open")}else{this.drawShape(this.shapes[q],g,n,b,b,this.colors[e],this.foreground,"closed")}this.drawText(j,g+p+this.margin,n,this.legendFont,this.legendColor,"left","middle");n+=m+this.margin}if(this.legendBox){this.rectangle(k,f,this.legendVariableWidth,this.legendVariableHeight,false,this.foreground,"open")}this.addArea(["rect",k,f,k+this.legendVariableWidth,f+this.legendVariableHeight],[-1],"-legend-variable")}};this.setColorLegendIndicatorDimensions=function(){var a=this.heatmapType.split("-");if(this.heatmapType.split("-").length>1){this.legendColorIndicatorWidth=parseInt(2*256*this.indicatorWidth/this.indicatorBins)+(this.margin*4)+1}else{this.legendColorIndicatorWidth=parseInt(1*256*this.indicatorWidth/this.indicatorBins)+(this.margin*4)+1}this.legendColorIndicatorHeight=this.indicatorHeight+(this.margin*3)+this.getFontPt(this.legendFont);if(this.colorBy){this.legendColorIndicatorHeight+=this.getFontPt(this.legendFont)+this.margin}};this.getHeatmapColor=function(e,d,f){var b=Math.abs(e);e+=b;d+=b;f+=b;var a=(f*this.heatmapColors.length/d).toFixed()-1;return this.heatmapColors[Math.max(0,a)]};this.drawColorIndicator=function(b,n,e,k,g){var j=b;var d=n;var a=this.indicatorHeight;var m=this.indicatorHeight;if(this.indicatorsPosition=="bottom"){for(var f=0;f<this.heatmapColors.length;f++){var h=this.transparency!=null?this.addColorTransparency(this.heatmapColors[f],this.transparency):this.heatmapColors[f];this.drawLine("line",b,n,b,n+m,h,this.indicatorWidth+0.5);b+=this.indicatorWidth}b=j-(this.indicatorWidth/2);n+=m+this.margin;this.drawText(sprintf("%."+g+"f",e),b,n,this.legendFont,this.legendColor,"center","top");b+=(this.heatmapColors.length*this.indicatorWidth/2)-(this.indicatorWidth/2);if(this.heatmapColors.length>=10){this.drawText(sprintf("%."+g+"f",(e+k)/2),b,n,this.legendFont,this.legendColor,"center","top")}if(this.colorBy){this.drawText(this.colorBy,b,n+this.margin+this.getFontPt(this.legendFont),this.legendFont,this.legendColor,"center","top")}b+=(this.heatmapColors.length*this.indicatorWidth/2)-(this.indicatorWidth/2);this.drawText(sprintf("%."+g+"f",k),b,n,this.legendFont,this.legendColor,"center","top");this.addArea(["rect",j-(this.margin*2),d-this.margin,b+(this.margin*2),n+this.getFontPt(this.legendFont)+this.margin],[-1],"-legend-indicator-color")}else{for(var f=0;f<this.heatmapColors.length;f++){var h=this.transparency!=null?this.addColorTransparency(this.heatmapColors[f],this.transparency):this.heatmapColors[f];this.drawLine("line",b,n,b+a,n,h,this.indicatorWidth+0.5);n-=this.indicatorWidth}b+=a+this.margin;n=d-(this.indicatorWidth/2);this.drawText(sprintf("%."+g+"f",e),b,n,this.legendFont,this.legendColor,"center","top",-Math.PI/2);n-=(this.heatmapColors.length*this.indicatorWidth/2)-(this.indicatorWidth/2);if(this.heatmapColors.length>=10){this.drawText(sprintf("%."+g+"f",(e+k)/2),b,n,this.legendFont,this.legendColor,"center","top",-Math.PI/2)}if(this.colorBy){this.drawText(this.colorBy,b+this.margin+this.getFontPt(this.legendFont),n,this.legendFont,this.legendColor,"center","top",-Math.PI/2)}n-=(this.heatmapColors.length*this.indicatorWidth/2)-(this.indicatorWidth/2);this.drawText(sprintf("%."+g+"f",k),b,n,this.legendFont,this.legendColor,"center","top",-Math.PI/2);this.addArea(["rect",j-this.margin,n-(this.margin*2),b+this.margin+this.getFontPt(this.legendFont),d+(this.margin*2)],[-1],"-legend-indicator-color")}};this.setShapeLegendIndicatorDimensions=function(){this.legendShapeIndicatorWidth=(10*(this.indicatorHeight+this.margin))+(this.margin*2);this.legendShapeIndicatorHeight=this.indicatorHeight+(this.margin*3)+this.getFontPt(this.legendFont);if(this.shapeBy){this.legendShapeIndicatorHeight+=this.getFontPt(this.legendFont)+this.margin}};this.drawShapeIndicator=function(b,o,f,n,j){var m=b;var d=o;var k=this.indicatorHeight/2;var e=b;var a=o;if(this.indicatorsPosition=="bottom"){for(var g=0;g<10;g++){this.drawShape("pie"+g,e,a+this.margin,this.indicatorHeight,this.indicatorHeight,this.background,this.foreground,"open");e+=this.indicatorHeight+k}b=m;o+=this.indicatorHeight+this.margin;this.drawText(sprintf("%."+j+"f",f),b,o,this.legendFont,this.legendColor,"center","top");b+=this.indicatorHeight*7;this.drawText(sprintf("%."+j+"f",(f+n)/2),b,o,this.legendFont,this.legendColor,"center","top");if(this.shapeBy){this.drawText(this.shapeBy,b,o+this.margin+this.getFontPt(this.legendFont),this.legendFont,this.legendColor,"center","top")}b+=this.indicatorHeight*7;this.drawText(sprintf("%."+j+"f",n),b,o,this.legendFont,this.legendColor,"center","top");this.addArea(["rect",m-(this.margin*2),d-this.margin,b+(this.margin*2),o+this.getFontPt(this.legendFont)+this.margin],[-1],"-legend-indicator-shape")}else{for(var g=0;g<10;g++){this["pie"+g](e+this.margin,a,this.background,this.indicatorHeight,"open",this.foreground);a-=this.indicatorHeight+k}b+=this.indicatorHeight+this.margin;o=d;this.drawText(sprintf("%."+j+"f",f),b,o,this.legendFont,this.legendColor,"center","top",-Math.PI/2);o-=this.indicatorHeight*7;if(this.heatmapColors.length>=10){this.drawText(sprintf("%."+j+"f",(f+n)/2),b,o,this.legendFont,this.legendColor,"center","top",-Math.PI/2)}if(this.shapeBy){this.drawText(this.shapeBy,b+this.margin+this.getFontPt(this.legendFont),o,this.legendFont,this.legendColor,"center","top",-Math.PI/2)}o-=this.indicatorHeight*7;this.drawText(sprintf("%."+j+"f",n),b,o,this.legendFont,this.legendColor,"center","top",-Math.PI/2);this.addArea(["rect",m-this.margin,o-(this.margin*2),b+this.margin+this.getFontPt(this.legendFont),d+(this.margin*2)],[-1],"-legend-indicator-shape")}};this.setSizeLegendIndicatorDimensions=function(){var a=0;var d=this.indicatorHeight/2;for(var b=0;b<10;b++){a+=this.sizes[b]+d}this.legendSizeIndicatorWidth=(a-(this.sizes[0]+this.sizes[9]))+(this.margin*4);this.legendSizeIndicatorHeight=this.sizes[9]+(this.margin*3)+this.getFontPt(this.legendFont);if(this.sizeBy){this.legendSizeIndicatorHeight+=this.getFontPt(this.legendFont)+this.margin}};this.drawSizeIndicator=function(e,r,j,q,m){var p=e;var f=r;var n=this.indicatorHeight/2;var s=this.sizes[9];var g=e;var a=r;var o=e;var d=r;if(this.indicatorsPosition=="bottom"){for(var k=0;k<10;k++){var b=this.sizes[k];this.drawShape("sphere",g,a+(s/2),b,b,this.background,this.foreground,"open");g+=b+n;if(k<4){o+=b+n}else{if(k==5){o+=(b+n)/2}}}r+=s+this.margin;this.drawText(sprintf("%."+m+"f",j),p,r,this.legendFont,this.legendColor,"center","top");this.drawText(sprintf("%."+m+"f",(j+q)/2),o,r,this.legendFont,this.legendColor,"center","top");if(this.sizeBy){this.drawText(this.sizeBy,p+(this.legendColorIndicatorWidth/2),r+this.margin+this.getFontPt(this.legendFont),this.legendFont,this.legendColor,"center","top")}this.drawText(sprintf("%."+m+"f",q),g-(s+n),r,this.legendFont,this.legendColor,"center","top");this.addArea(["rect",p-(this.margin*2),f-this.margin,(g-s)+(this.margin*2),r+this.getFontPt(this.legendFont)+this.margin],[-1],"-legend-indicator-size")}else{for(var k=0;k<10;k++){var b=this.sizes[k];this.drawShape("sphere",g+(s/2),a,b,b,this.background,this.foreground,"open");a-=(b+n);if(k<4){d-=(b+n)}else{if(k==5){d-=((b+n)/2)}}}e+=s+this.margin;this.drawText(sprintf("%."+m+"f",j),e,r,this.legendFont,this.legendColor,"center","top",-Math.PI/2);this.drawText(sprintf("%."+m+"f",(j+q)/2),e,d,this.legendFont,this.legendColor,"center","top",-Math.PI/2);if(this.sizeBy){this.drawText(this.sizeBy,e+this.margin+this.getFontPt(this.legendFont),f-(this.legendColorIndicatorWidth/2),this.legendFont,this.legendColor,"center","top",-Math.PI/2)}this.drawText(sprintf("%."+m+"f",q),e,a+(s+n),this.legendFont,this.legendColor,"center","top",-Math.PI/2);this.addArea(["rect",p-this.margin,(a+(s+n))-(this.margin*2),e+this.margin+this.getFontPt(this.legendFont),f+(this.margin*2)],[-1],"-legend-indicator-size")}};this.setDataColorShapeSizeIndicatorDimensions=function(){this.setColorLegendIndicatorDimensions();this.setShapeLegendIndicatorDimensions();this.setSizeLegendIndicatorDimensions()};this.drawSelectedBackground=function(g,k,m,b,e,f,d,a,j){if(this.isSelectDataPoints){if(this.selectDataPoint[g]){if(this.selectDataPoint[g].hasOwnProperty(k)){this.drawShape(m,b,e,f+12,d+12,this.selectedBackgroundColor,this.foreground,"closed",a,1,j)}}}};this.isVisibleSelectedDataPoint=function(a,b){if(this.isSelectDataPoints){if(this.hideDataPoint.length>0&&this.hideDataPoint[a]){if(this.hideDataPoint[a].hasOwnProperty(b)){return false}}}return true};this.getDiameterLegend=function(){var a;if(this.autoExtend){a=10}else{a=this.x>=600?10:this.x>=400?8:this.x>=200?6:4}return a};this.setColorLegendDimensions=function(a){this.legendColorWidth=0;this.legendColorHeight=0;if(this.colorBy){var g,f;var k=this.getDiameterLegend();if(a&&this.data.x.hasOwnProperty(this.colorBy)){g=this.setMaxSmpStringAnnt(this.colorBy);f=this.setMaxSmpStringLabel(this.colorBy)}else{if(this.data.z.hasOwnProperty(this.colorBy)){g=this.setMaxVarStringAnnt(this.colorBy);f=this.setMaxVarStringLabel(this.colorBy)}}var b=this.measureText(g,this.legendFont);var e=this.measureText(f,this.legendFont)+k+this.margin;this.legendColorWidth=Math.max(b,e)+(this.margin*2);var j=this.getFontPt(this.legendFont);var h=Math.max(k,j);this.legendColorHeight=(this.legendColorsN*(h+this.margin))+j+(this.margin*3)}};this.drawColorLegend=function(e,f){if(this.colorBy&&((this.data.x&&this.data.x.hasOwnProperty(this.colorBy))||(this.data.z&&this.data.z.hasOwnProperty(this.colorBy)))){var j=this.getDiameterLegend();var g=this.getFontPt(this.legendFont);var k=g/2;var h=f+this.margin+k;var a=Math.max(j,g);this.disableGradientTransparency();if(this.legendBackgroundColor){this.rectangle(e,f,this.legendColorWidth,this.legendColorHeight,this.legendBackgroundColor)}else{this.rectangle(e,f,this.legendColorWidth,this.legendColorHeight,false,this.foreground,"open")}this.enableGradientTransparency();this.drawText(this.colorBy,e+(this.legendColorWidth/2),h,this.legendFont,this.colorLegend,"center","middle");h+=k+this.margin;this.drawLine("line",e,h,e+this.legendColorWidth,h,this.foreground);h+=this.margin+(a/2);for(var b in this.legendColors){this.drawShape("circle",e+this.margin+(j/2),h,j,j,this.legendColors[b],this.foreground,"closed");this.drawText(b,e+(this.margin*2)+j,h,this.legendFont,this.colorLegend,"left","middle");h+=this.margin+a}this.addArea(["rect",e,f,e+this.legendColorWidth,f+this.legendColorHeight],[-1],"-legend-color")}};this.setShapeLegendDimensions=function(){this.legendShapeWidth=0;this.legendShapeHeight=0;if(this.shapeBy&&this.data.z.hasOwnProperty(this.shapeBy)){var j=this.getDiameterLegend();var f=this.setMaxVarStringAnnt(this.shapeBy);var e=this.setMaxVarStringLabel(this.shapeBy);var a=this.measureText(f,this.legendFont);var b=this.measureText(e,this.legendFont)+j+this.margin;this.legendShapeWidth=Math.max(a,b)+(this.margin*2);var h=this.getFontPt(this.legendFont);var g=Math.max(j,h);this.legendShapeHeight=(this.legendShapesN*(g+this.margin))+h+(this.margin*3)}};this.drawShapeLegend=function(b,e){if(this.shapeBy&&this.data.z.hasOwnProperty(this.shapeBy)){var j=this.getDiameterLegend();var f=this.getFontPt(this.legendFont);var k=f/2;var h=e+this.margin+k;var a=Math.max(j,f);this.disableGradientTransparency();if(this.legendBackgroundColor){this.rectangle(b,e,this.legendShapeWidth,this.legendShapeHeight,this.legendBackgroundColor)}else{this.rectangle(b,e,this.legendShapeWidth,this.legendShapeHeight,false,this.foreground,"open")}this.enableGradientTransparency();this.drawText(this.shapeBy,b+(this.legendShapeWidth/2),h,this.legendFont,this.colorLegend,"center","middle");h+=k+this.margin;this.drawLine("line",b,h,b+this.legendShapeWidth,h,this.foreground);h+=this.margin+(a/2);for(var g in this.legendShapes){this.drawShape(this.legendShapes[g],b+this.margin+(j/2),h,j,j,this.background,this.foreground,"closed");this.drawText(g,b+(this.margin*2)+j,h,this.legendFont,this.colorLegend,"left","middle");h+=this.margin+a}this.addArea(["rect",b,e,b+this.legendShapeWidth,e+this.legendShapeHeight],[-1],"-legend-shape")}};this.setSizeLegendDimensions=function(){this.legendSizeWidth=0;this.legendSizeHeight=0;if(this.sizeBy&&this.data.z.hasOwnProperty(this.sizeBy)){var j=this.sizes[this.legendSizesN-1];var f=this.setMaxVarStringAnnt(this.sizeBy);var e=this.setMaxVarStringLabel(this.sizeBy);var a=this.measureText(f,this.legendFont);var b=this.measureText(e,this.legendFont)+j+this.margin;this.legendSizeWidth=Math.max(a,b)+(this.margin*2);var h=this.getFontPt(this.legendFont);var g=Math.max(j,h);this.legendSizeHeight=(this.legendSizesN*(g+this.margin))+h+(this.margin*3)}};this.drawSizeLegend=function(e,f){if(this.sizeBy&&this.data.z.hasOwnProperty(this.sizeBy)){var j=this.sizes[this.legendSizesN-1];var g=this.getFontPt(this.legendFont);var k=g/2;var h=f+this.margin+k;var a=Math.max(j,g);this.disableGradientTransparency();if(this.legendBackgroundColor){this.rectangle(e,f,this.legendSizeWidth,this.legendSizeHeight,this.legendBackgroundColor)}else{this.rectangle(e,f,this.legendSizeWidth,this.legendSizeHeight,false,this.foreground,"open")}this.enableGradientTransparency();this.drawText(this.sizeBy,e+(this.legendSizeWidth/2),h,this.legendFont,this.colorLegend,"center","middle");h+=k+this.margin;this.drawLine("line",e,h,e+this.legendSizeWidth,h,this.foreground);h+=this.margin+(a/2);for(var b in this.legendSizes){this.drawShape("circle",e+this.margin+(j/2),h,this.legendSizes[b],this.legendSizes[b],this.background,this.foreground,"closed");this.drawText(b,e+(this.margin*2)+j,h,this.legendFont,this.colorLegend,"left","middle");h+=this.margin+a}this.addArea(["rect",e,f,e+this.legendSizeWidth,f+this.legendSizeHeight],[-1],"-legend-size")}};this.setDataColorShapeSizeDimensions=function(){this.setColorLegendDimensions();this.setShapeLegendDimensions();this.setSizeLegendDimensions()};this.setDataColor=function(g){if(this.colorBy){var j=0;var a={};var h="rgb(255,255,0)";this.dataColors=[];this.legendColors={};this.legendColorsN=0;if(g){if(!this.isGroupedData&&this.data.x&&this.data.x.hasOwnProperty(this.colorBy)){if(this.isNumeric(this.data.x[this.colorBy],true)){var f=this.range(this.data.x[this.colorBy],true);for(var e=0;e<this.smpIndices.length;e++){var k=this.smpIndices[e];var d=this.data.x[this.colorBy][k];var b=!isNaN(d)?this.getHeatmapColor(f[0],f[1],d):h;this.dataColors.push(b)}this.legendColorsN=-1;this.legendColorRange=f;this.legendColorDecs=this.getAxisDecimals(this.getAxisIncrements(f[0],f[1],this.heatmapColors.length));this.setColorLegendIndicatorDimensions()}else{for(var e=0;e<this.smpIndices.length;e++){var k=this.smpIndices[e];var b=this.data.x[this.colorBy][k];if(!a.hasOwnProperty(b)){a[b]=j%this.colors.length;this.legendColors[b]=this.colors[a[b]];j++}this.dataColors.push(this.colors[a[b]])}this.legendColorsN=j;this.setColorLegendDimensions(g)}}}else{if(this.data.z&&this.data.z.hasOwnProperty(this.colorBy)){if(this.isNumeric(this.data.z[this.colorBy],false,true)){var f=this.range(this.data.z[this.colorBy],false,true);for(var e=0;e<this.varIndices.length;e++){var k=this.varIndices[e];var d=this.data.z[this.colorBy][k];if(!isNaN(d)){this.dataColors.push(this.getHeatmapColor(f[0],f[1],d))}else{this.dataColors.push(h)}}this.legendColorRange=f;this.legendColorDecs=this.getAxisDecimals(this.getAxisIncrements(f[0],f[1],this.heatmapColors.length));this.setColorLegendIndicatorDimensions()}else{for(var e=0;e<this.varIndices.length;e++){var k=this.varIndices[e];var b=this.data.z[this.colorBy][k];if(!a.hasOwnProperty(b)){a[b]=j%this.colors.length;this.legendColors[b]=this.colors[a[b]];j++}this.dataColors.push(this.colors[a[b]])}this.legendColorsN=j;this.setColorLegendDimensions()}}else{if(this.getSampleIndices(this.colorBy)>-1){j=this.getSampleIndices(this.colorBy);var f=this.getAxisRangeBySample(j);for(var e=0;e<this.varIndices.length;e++){var k=this.varIndices[e];var d=this.getDataAtPos(k,j);if(!isNaN(d)){this.dataColors.push(this.getHeatmapColor(f[0],f[1],d))}else{this.dataColors.push(h)}}this.legendColorRange=f;this.legendColorDecs=this.getAxisDecimals(this.getAxisIncrements(f[0],f[1],this.heatmapColors.length));this.setColorLegendIndicatorDimensions()}else{if(this.colorBy=="variable"){for(var e=0;e<this.varIndices.length;e++){var b=e%this.colors.length;this.dataColors.push(this.colors[b])}this.setVariableLegendDimension()}else{for(var e=0;e<this.varIndices.length;e++){this.dataColors.push(this.colors[0])}}}}}}};this.setDataShape=function(){if(this.shapeBy){var g=0;var a={};var k="square";this.dataShapes=[];this.legendShapes={};this.legendShapesN=0;if(this.data.z&&this.data.z.hasOwnProperty(this.shapeBy)){if(this.isNumeric(this.data.z[this.shapeBy],false,true)){var f=this.range(this.data.z[this.shapeBy],false,true);for(var e=0;e<this.varIndices.length;e++){var h=this.varIndices[e];var b=this.data.z[this.shapeBy][h];if(!isNaN(b)){var d=this.percentile(f[0],f[1],b);var j=parseInt(d/10);if(j>0){j--}this.dataShapes.push("pie"+j)}else{this.dataShapes.push(k)}}this.legendShapeRange=f;this.legendShapeDecs=this.getAxisDecimals(this.getAxisIncrements(f[0],f[1],10));this.setShapeLegendIndicatorDimensions()}else{for(var e=0;e<this.varIndices.length;e++){var h=this.varIndices[e];var j=this.data.z[this.shapeBy][h];if(!a.hasOwnProperty(j)){a[j]=g%this.shapes.length;this.legendShapes[j]=this.shapes[a[j]];g++}this.dataShapes.push(this.shapes[a[j]])}this.legendShapesN=g;this.setShapeLegendDimensions()}}else{if(this.getSampleIndices(this.shapeBy)>-1){g=this.getSampleIndices(this.shapeBy);var f=this.getAxisRangeBySample(g);for(var e=0;e<this.varIndices.length;e++){var h=this.varIndices[e];var b=this.getDataAtPos(h,g);if(!isNaN(b)){var d=this.percentile(f[0],f[1],b);var j=parseInt(d/10);if(j>0){j--}this.dataShapes.push("pie"+j)}else{this.dataShapes.push(k)}}this.legendShapeRange=f;this.legendShapeDecs=this.getAxisDecimals(this.getAxisIncrements(f[0],f[1],10));this.setShapeLegendIndicatorDimensions()}else{if(this.shapeBy=="variable"){for(var e=0;e<this.varIndices.length;e++){var j=e%this.shapes.length;this.dataShapes.push(this.shapes[j])}this.setVariableLegendDimension()}else{for(var e=0;e<this.varIndices.length;e++){this.dataShapes.push(this.shapes[0])}}}}}};this.setDataSize=function(){if(this.sizeBy){var a=0;var d={};this.dataSizes=[];this.legendSizes={};this.legendSizesN=0;if(this.data.z&&this.data.z.hasOwnProperty(this.sizeBy)){if(this.isNumeric(this.data.z[this.sizeBy],false,true)){var e=this.range(this.data.z[this.sizeBy],false,true);for(var f=0;f<this.varIndices.length;f++){var g=this.varIndices[f];var h=this.data.z[this.sizeBy][g];if(!isNaN(h)){var j=this.percentile(e[0],e[1],h);var b=parseInt(j/10);if(b>0){b--}this.dataSizes.push(this.sizes[b])}else{this.dataSizes.push(0)}}this.legendSizeRange=e;this.legendSizeDecs=this.getAxisDecimals(this.getAxisIncrements(e[0],e[1],10));this.setSizeLegendIndicatorDimensions()}else{for(var f=0;f<this.varIndices.length;f++){var g=this.varIndices[f];var b=this.data.z[this.sizeBy][g];if(!d.hasOwnProperty(b)){d[b]=a%this.sizes.length;this.legendSizes[b]=this.sizes[d[b]];a++}this.dataSizes.push(this.sizes[d[b]])}this.legendSizesN=a;this.setSizeLegendDimensions()}}else{if(this.getSampleIndices(this.sizeBy)>-1){a=this.getSampleIndices(this.sizeBy);var e=this.getAxisRangeBySample(a);for(var f=0;f<this.varIndices.length;f++){var g=this.varIndices[f];var h=this.getDataAtPos(g,a);if(!isNaN(h)){var j=this.percentile(e[0],e[1],h);var b=parseInt(j/10);if(b>0){b--}this.dataSizes.push(this.sizes[b])}else{this.dataSizes.push(0)}}this.legendSizeRange=e;this.legendSizeDecs=this.getAxisDecimals(this.getAxisIncrements(e[0],e[1],10));this.setSizeLegendIndicatorDimensions()}else{if(this.sizeBy=="variable"){for(var f=0;f<this.varIndices.length;f++){var b=f%this.sizes.length;this.dataSizes.push(this.sizes[b])}this.setVariableLegendDimension()}else{for(var f=0;f<this.varIndices.length;f++){this.dataSizes.push(this.scatterPointSize)}}}}}};this.setDataColorShapeSize=function(){this.setLegendFont();this.setDataColor();this.setDataShape();this.setDataSize();if(this.graphType=="Scatter2D"||this.graphType=="ScatterBubble2d"){this.setSampleLegendDimension()}};this.setLegendDimensions=function(){this.legendLayout=[];var a=this.margin;var n=this.margin;if(this.showIndicators){var g=["Color","Shape","Size"];for(var d=0;d<g.length;d++){var k=this["legend"+g[d]+"IndicatorWidth"];var e=this["legend"+g[d]+"IndicatorHeight"];if(k){if(this.indicatorsPosition=="bottom"){n+=this.margin+e}else{a+=this.margin+e}}}}var b=0;var m=0;var j=0;if(this.showLegend){var f=["Color","Shape","Size","Variable","Sample"];for(var d=0;d<f.length;d++){var k=this["legend"+f[d]+"Width"];var e=this["legend"+f[d]+"Height"];if(k>0){if(this.legendPosition=="right"){if(m+this.margin+e>this.height){a+=this.margin+k;b=k;m=e;j++;this.legendLayout[j]=[f[d]]}else{if(k>b){a+=(k-b);b=k}m+=e;if(!this.legendLayout[j]){this.legendLayout[j]=[]}this.legendLayout[j].push(f[d])}}else{if(b+this.margin+k>this.width){n+=this.margin+e;b=k;m=e;j++;this.legendLayout[d]=[f[d]]}else{if(e>m){n+=(e-m);m=e}b+=k;if(!this.legendLayout[j]){this.legendLayout[j]=[]}this.legendLayout[j].push(f[d])}}}}}this.legendWidth=a+this.margin;this.legendHeight=n+this.margin};this.getXYLegendCoords=function(p,a,r){var o,f,n,k;var m=0;var d=0;var q=-1;var g=-1;if(this.legendLayout){for(var e=0;e<this.legendLayout.length;e++){o=0;f=0;for(var b=0;b<this.legendLayout[e].length;b++){if(this.legendLayout[e][b]==p){g=b}o+=this["legend"+this.legendLayout[e][b]+"Width"]+this.margin;f+=this["legend"+this.legendLayout[e][b]+"Height"]+this.margin;m=Math.max(m,o);d=Math.max(d,f)}if(g>-1){q=e;break}}if(this.legendPosition=="right"){r=g==0?this.offsetY+this.top:r;n=a;k=g==0?this.offsetY+this.top+((this.y-d)/2):r;a=g==this.legendLayout[q].length-1?a+m:a;r=k+this["legend"+this.legendLayout[q][g]+"Height"]+this.margin}else{a=g==0?this.offsetX+this.left:a;n=g==0?this.offsetX+this.left+((this.x-m)/2)+this.margin:a+this.margin;k=r;a=n+this["legend"+this.legendLayout[q][g]+"Width"]+this.margin;r=g==this.legendLayout[q].length-1?r+d:r}}return[n,k,a,r]};this.drawScatterLegend=function(){var d=this.offsetX+this.left+this.x;var m=this.offsetY+this.top+this.y;if(this.showIndicators){var q,j;var a,p;if(this.graphType=="Scatter2D"||this.graphType=="ScatterBubble2D"){d+=(this.margin*2);m+=this.get2DXAxisHeight()+this.margin;if(this.graphType=="ScatterBubble2D"&&this.zAxisShow){d+=this.getFontPt(this.axisTitleFont)+(this.margin*2)}}var n=["Color","Shape","Size"];for(var f=0;f<n.length;f++){q=this["legend"+n[f]+"IndicatorWidth"];j=this["legend"+n[f]+"IndicatorHeight"];if(q){var b="draw"+n[f]+"Indicator";var g=this["legend"+n[f]+"Range"];var e=this["legend"+n[f]+"Decs"];if(this.indicatorsPosition=="bottom"){a=this.offsetX+this.left+((this.x-q)/2);p=m;this[b](a,p,g[0],g[1],e);m+=j+this.margin}else{a=d;p=this.offsetY+this.top+(this.y-((this.y-q)/2));this[b](a,p,g[0],g[1],e);d+=j+this.margin}}}}if(this.showLegend){var k=["Color","Shape","Size","Variable","Sample"];for(var f=0;f<k.length;f++){q=this["legend"+k[f]+"Width"];j=this["legend"+k[f]+"Height"];if(q>0){var b="draw"+k[f]+"Legend";var o=this.getXYLegendCoords(k[f],d,m);this[b](o[0],o[1]);if(this.legendPosition=="right"){m=o[3]+this.margin}else{d=o[2]+this.margin}}}}};this.set3DRotation=function(){var a;var d=0;var b=0;if(this.graphType=="Network"){d=360;b=360}else{if(this.graphType=="Scatter3D"){d=90;b=0}}if(this.xRotate>d){this.xRotate=d}if(this.xRotate<0){this.xRotate=b}if(this.yRotate>d){this.yRotate=d}if(this.yRotate<0){this.yRotate=b}if(this.zRotate>d){this.zRotate=d}if(this.zRotate<0){this.zRotate=b}if(this.xRotate>0){a=180/this.xRotate;this.ry=Math.PI/a}else{this.ry=0}if(this.yRotate>0){a=180/this.yRotate;this.rx=Math.PI/a}else{this.rx=0}if(this.zRotate>0){a=180/this.zRotate;this.rz=Math.PI/a}else{this.rz=0}};this.set3DParams=function(){this.perspective=this.x*1.5;this.len=this.x/4;this.pad=this.x/2};this.get3DTransfrom=function(f,g,h){var e,d,b;var a=[];d=g;b=h;g=d*Math.cos(this.rx)-b*Math.sin(this.rx);h=d*Math.sin(this.rx)+b*Math.cos(this.rx);e=f;b=h;f=b*Math.sin(this.ry)+e*Math.cos(this.ry);h=b*Math.cos(this.ry)-e*Math.sin(this.ry);e=f;d=g;f=e*Math.cos(this.rz)-d*Math.sin(this.rz);g=e*Math.sin(this.rz)+d*Math.cos(this.rz);f=f*(this.perspective/(h+this.perspective));g=g*(this.perspective/(h+this.perspective));a.push(f+this.pad);a.push(g+this.pad);a.push(h+this.pad);return a}};CanvasXpress.prototype.initApi=function(){this.getValidGraphTypes=function(){return this.validGraphTypes};this.setHeatmapScheme=function(){this.initializeAttributes()};this.hasIndicator=function(){if(this.graphType.match(/Scatter/)||this.graphType=="Bar"){return true}else{return false}};this.hasLegend=function(){if(this.graphType!="Network"&&this.graphType!="Genome"&&this.graphType!="Correlation"&&this.graphType!="Heatmap"){return true}else{return false}};this.hasLegendProperties=function(){if(this.graphType!="Network"&&this.graphType!="Genome"&&this.graphType!="Correlation"&&this.graphType!="Heatmap"&&this.graphType!="Pie"){return true}else{return false}};this.hasData=function(){if(this.graphType!="Network"&&this.graphType!="Genome"&&this.graphType!="Venn"){return true}else{return false}};this.hasDataSamples=function(){if(this.graphType!="Network"&&this.graphType!="Genome"&&this.graphType!="Venn"&&this.graphType!="Pie"&&!this.graphType.match(/Scatter/)){if(this.graphType=="Correlation"&&this.correlationAxis!="samples"){return false}return true}else{return false}};this.hasDataGroups=function(){if(this.graphType!="Network"&&this.graphType!="Genome"&&this.graphType!="Venn"&&this.graphType!="Pie"&&!this.graphType.match(/Scatter/)){if(this.graphType=="Correlation"&&this.correlationAxis!="samples"){return false}if(this.data.x){return true}else{return false}}else{return false}};this.hasDataVariables=function(){if(this.graphType!="Network"&&this.graphType!="Genome"&&this.graphType!="Venn"){if(this.graphType=="Correlation"&&this.correlationAxis!="variables"){return false}return true}else{return false}};this.hasDataProperties=function(){if(this.graphType!="Network"&&this.graphType!="Genome"&&this.graphType!="Heatmap"&&this.graphType!="Venn"&&this.graphType!="Pie"&&this.graphType!="Correlation"){return true}else{return false}};this.hasOrientation=function(){if(this.graphType!="Network"&&this.graphType!="Genome"&&this.graphType!="Venn"&&this.graphType!="Pie"&&this.graphType!="Correlation"&&!this.graphType.match(/Scatter/)){return true}else{return false}};this.hasOverlays=function(){if(this.graphType!="Network"&&this.graphType!="Genome"&&this.graphType!="Venn"&&this.graphType!="Pie"&&this.graphType!="Correlation"&&!this.graphType.match(/Scatter/)){return true}else{return false}};this.hasDendrograms=function(){if(this.graphType!="Heatmap"&&(this.data.t.smps||this.data.t.vars)){return true}else{return false}};this.hasDecorations=function(){return this.data.d&&(this.data.d.nlfit||this.data.d.line||this.data.d.reg||this.data.d.nor||this.data.d.area)?true:false};this.isSegregable=function(){if(this.graphType!="Network"&&this.graphType!="Genome"&&this.graphType!="Venn"&&this.graphType!="Pie"&&this.graphType!="Correlation"&&!this.graphType.match(/Scatter/)){return true}else{return false}};this.getLineTypes=function(){var f=["line"];var d=["","dashed","dotted","bezierY","bezierX","curved"];var a=["arrow","arrowHead","arrowTail","arrowHeadSquareTail","arrowTailSquareHead","square","squareHead","squareTail","squareHeadArrowTail","squareTailArrowHead"];for(var e=0;e<a.length;e++){f.push(a[e]+"Line")}for(var e=1;e<d.length;e++){for(var b=0;b<a.length;b++){f.push(d[e]+this.capitalize(a[b])+"Line")}}return f};this.isValidShape=function(b){for(var a=0;a<this.shapes.length;a++){if(this.shapes[a]==b){return true}}return false};this.modifyHighlights=function(d,b,e){var a=e?"highlightVar":"highlightSmp";this.modifyObjectArray(d,b,a)};this.getHighlights=function(b){var a=b?this.highlightVar:this.highlightSmp;return this.getObjectArray(a)};this.modifySmpOverlays=function(b,a){this.modifyObjectArray(b,a,"smpOverlays")};this.modifyVarOverlays=function(b,a){this.modifyObjectArray(b,a,"varOverlays")};this.getSmpOverlays=function(){return this.getObjectArray(this.smpOverlays)};this.getVarOverlays=function(){return this.getObjectArray(this.varOverlays)};this.clusterSamples=function(){this.clusterAxis="samples";this.showSmpDendrogram=true;if(!this.data.t){this.data.t={}}this.data.t.smps=this.cluster();this.draw()};this.clusterVariables=function(){this.clusterAxis="variables";this.showVarDendrogram=true;if(!this.data.t){this.data.t={}}this.data.t.vars=this.cluster();this.draw()};this.kmeansSamples=function(){this.clusterAxis="samples";this.showOverlays=true;if(!this.data.x){this.data.x={}}this.data.x["k-Means"]=this.kmeans();if(!this.isInArray("k-Means",this.smpOverlays)){this.smpOverlays.push("k-Means")}this.draw()};this.kmeansVariables=function(){this.clusterAxis="variables";this.showOverlays=true;if(!this.data.z){this.data.z={}}this.data.z["k-Means"]=this.kmeans();if(!this.isInArray("k-Means",this.varOverlays)){this.varOverlays.push("k-Means")}this.draw()};this.functions.push("clusterSamples");this.functions.push("clusterVariables");this.functions.push("kmeansSamples");this.functions.push("kmeansVariables");this.functions.push("addDataTable");this.functions.push("resetDataTable");this.functions.push("undoNetworkOp");this.functions.push("redoNetworkOp");this.functions.push("print")};CanvasXpress.prototype.initText=function(){this.drawText=function(q,o,j,g,h,n,k,d,e,r){if(!q){return}if(!this.ctx){if(this.debug){alert("Dude, there is no canvas")}return}if(isNaN(o)||isNaN(j)){if(this.debug){alert("Not a valid coordinate ("+o+", "+j+") to draw "+q)}return}if(d<(Math.PI/-2)||d>(Math.PI/2)){if(this.debug){alert("Dude, you can only rotate between -PI/2 and PI/2")}return}if(!isNaN(q)){q=this.formatNumber(q)}if(!o){o=0}if(!j){j=0}if(!g){g=this.font}if(!h){h=this.foreground}if(!n){n=this.align}if(!k){k=this.baseline}if(e){var p=this.measureText(q,g);while(p>e){q=q.substring(0,q.length-1);p=this.measureText(q,g)}}this.ctx.save();this.ctx.strokeStyle=h;this.ctx.fillStyle=h;this.ctx.font=g;this.ctx.save();this.ctx.translate(o,j);this.ctx.textAlign=n;this.ctx.textBaseline=k;if(this.showShadow){this.ctx.shadowOffsetX=this.shadowOffsetX;this.ctx.shadowOffsetY=this.shadowOffsetY;this.ctx.shadowBlur=this.shadowBlur;this.ctx.shadowColor=this.shadowColor}if(d){this.ctx.rotate(d)}if(r){this.ctx.strokeText(q,0,0)}else{this.ctx.fillText(q,0,0)}this.ctx.restore();if(this.showShadow){this.ctx.shadowOffsetX=0;this.ctx.shadowOffsetY=0;this.ctx.shadowBlur=0;this.ctx.shadowColor=this.background}return q};this.capitalize=function(a){if(a){return a.charAt(0).toUpperCase()+a.slice(1)}};this.measureText=function(a,b){if(!this.ctx){return 0}if(!b){b=this.font}this.ctx.font=b;return this.ctx.measureText(a).width};this.scaleTextToFont=function(b,e,a){var d=e+"pt "+this.fontName;if(b){while(this.measureText(b,d)>a&&e>=this.minTextSize){e-=2;d=e+"pt "+this.fontName}}return d};this.getFontPt=function(a){return parseInt(a.match(/^\d+/)[0])};this.scaleTextToSize=function(a){var d=this.scaleTextConstantMult;if(!a){a=1}return Math.ceil(1/Math.sqrt(a)*d)};this.formatNumber=function(d){if(d.toString().length>=7){var b=sprintf("%.2e",Number(d));var a=sprintf("%.2f",Number(d));if(a.toString().length>b.toString().length){return b.toString()}else{return a.toString()}}else{return d.toString()}};this.getMaxText=function(d){var f="";var b=0;for(var e=0;e<d.length;e++){if(d[e].length>b){f=d[e];b=d[e].length}}return f};this.shortenText=function(b,a){if(b.length<=a){return b}else{return b.substring(0,a-3)+" ..."}};this.convertToNumber=function(a){if(!isNaN(a)){return parseFloat(a)}else{return a}}};CanvasXpress.prototype.initTime=function(){Date.prototype.getWeek=function(){var a=new Date(this.getFullYear(),0,1);return Math.ceil((((this-a)/86400000)+a.getDay()+1)/7)};this.getYearWeek=function(a){return a.getFullYear()+"-"+a.getWeek()};this.getYearMonth=function(a){return a.getFullYear()+"-"+a.getMonth()};this.getYear=function(a){return a.getFullYear()};this.times={second:1000,minute:60000,hour:3600000,day:86400000,week:604800000,month:2592000000,year:31556952000};this.parseDate=function(e){var f=parseInt(e.toString().substring(0,4));var a=parseInt(e.toString().substring(4,6).replace(/^0/,""));var b=parseInt(e.toString().substring(6,8).replace(/^0/,""));return new Date(f,a-1,b,0,0)};this.setTimeAxis=function(){var j=this.validateTimeAxis();if(j){var h=Date.parse(j[j.length-1])-Date.parse(j[0]);var e;var b={};var d=[];this.timeValues=[];this.timeValueIndices=[];if(h>this.times.year*2){e="getYear"}else{if(h>this.times.month*2){e="getYearMonth"}else{if(h>this.times.week*2){e="getYearWeek"}else{e=false}}}if(e){if(this.timeTicksFirst){for(var a=0;a<j.length;a++){var g=this[e](j[a]);if(!b.hasOwnProperty(g)){d.push(j[a]);this.timeValueIndices.push(a);b[g]=true}}}else{for(var a=j.length-1;a>=0;a--){var g=this[e](j[a]);if(!b.hasOwnProperty(g)){d.unshift(j[a]);this.timeValueIndices.unshift(a);b[g]=true}}}}else{for(var a=0;a<j.length;a++){this.timeValues.push(dateFormat(j[a],this.timeFormat));this.timeValueIndices.push(a)}}var h=Date.parse(d[d.length-1])-Date.parse(d[d.length-2]);if(e=="getYear"&&h<this.times.month*3){this.timeValues.pop();this.timeValueIndices.pop()}else{if(e=="getYearMonth"&&h<this.times.week*4){this.timeValues.pop();this.timeValueIndices.pop()}else{if(e=="getYearWeek"&&h<this.times.day*7){this.timeValues.pop();this.timeValueIndices.pop()}}}for(var a=0;a<d.length;a++){this.timeValues.push(dateFormat(d[a],this.timeFormat))}}};this.createRandomTimes=function(b){var f;var h=new Date();var a=h.getTime();var g=[new Date(a)];var j=this.isGroupedData?this.data.w:this.data.y;if(!b||!this.times[b]){b="day"}for(var e=0;e<j.smps.length;e++){f=Date.parse(j.smps[e]);if(!isNaN(f)){a=f}else{a-=this.times[b]}g.unshift(new Date(a))}return g};this.validateTimeAxis=function(){var g=this.isGroupedData?this.data.w:this.data.y;var a=false;var f=[];for(var b=0;b<this.smpIndices.length;b++){var e=this.smpIndices.length!=g.smps.length?Date.parse(g.smps[this.smpIndices[b]]):Date.parse(g.smps[b]);if(isNaN(e)){if(this.isExample){f=this.createRandomTimes();return f}else{a=true;break}}else{f.push(new Date(e))}}return a?false:f};this.setTimeAxis1=function(){var e=this.validateTimeAxis();if(e){this.timeValues=[];this.timeValueIndices=[];var h=e.length;var a=e[h-1]-e[0];var b=0;if(h<this.timeTicks){b=1}else{b=Math.ceil(h/this.timeTicks)}var g=b-1;while(g<h){var f=e[g];this.timeValues.push(dateFormat(new Date(f),this.timeFormat));this.timeValueIndices.push(g);g+=b}}else{alert("Not valid dates");this.isGraphTime=false}}};CanvasXpress.prototype.initAttributes=function(){this.validateNumbers=function(b){for(var d=0;d<b.length;d++){if(isNaN(b[d])){return false}}return true};this.lineTo=function(b,e,a,d){if(b==a){b=Math.round(b)+0.5;a=b}else{if(e==d){e=Math.round(e)+0.5;d=e}}this.ctx.moveTo(b,e);this.ctx.lineTo(a,d);this.ctx.stroke()};this.clip=function(v,g,k){var e,d,p,n,j,o,v;var q,f,a,m;var u=[];if(k&&k.length==4){f=k[0];q=k[1];a=f+k[2];m=q+k[3]}else{f=this.layoutComb?this.offsetX+this.left:this.left;q=this.layoutComb?this.offsetY+this.top:this.top;a=f+this.x;m=q+this.y}if(v=="rect"){e=parseInt(g[0]);p=parseInt(g[1]);d=parseInt(e+g[2]);n=parseInt(p+g[3]);if(e>a+this.outlineWidth||n>m+this.outlineWidth||d<f||p<q){return false}if(e<f){e=f}if(d>a){d=a}if(n<q){n=q}if(p>m){p=m}u=[e,p,d-e,n-p]}else{if(v=="poly"){}else{if(v=="circle"){e=parseInt(g[0]);p=parseInt(g[1]);if(e>a||e<f||p<q||p>m){return false}u=[e,p]}else{if(v=="line"){e=parseFloat(g[0]);p=parseFloat(g[1]);d=parseFloat(g[2]);n=parseFloat(g[3]);if(e==d){if(e<f||e>a){return false}else{if(p>n){if(p<q){return false}else{if(p>m){p=m}}if(n>m){return false}else{if(n<q){n=q}}}else{if(p>m){return false}else{if(p<q){p=q}}if(n<q){return false}else{if(n>m){n=m}}}}}else{if(p==n){if(p<q||p>m){return false}else{if(e>d){if(e<f){return false}else{if(e>a){e=a}}if(d>a){return false}else{if(d<f){d=f}}}else{if(e>a){return false}else{if(e<f){e=f}}if(d<f){return false}else{if(d>a){d=a}}}}}else{if(e>d){if(e<f||d>a){return false}else{if(p>n){if(p<q||n>m){return false}else{j=p-n;o=e-d;if(e>a){p-=(e-a)*j/o;e=a}if(p>m){e-=(p-m)*o/j;p=m}if(d<f){n+=(f-d)*j/o;d=f}if(n<q){d+=(q-n)*o/j;n=q}}}else{if(n<q||p>m){return false}else{j=n-p;o=e-d;if(e>a){p+=(e-a)*j/o;e=a}if(p<q){e-=(q-p)*o/j;p=q}if(d<f){n-=(f-d)*j/o;d=f}if(n>m){d+=(n-m)*o/j;n=m}}}}}else{if(d<f||e>a){return false}else{if(p>n){if(p<q||n>m){return false}else{j=p-n;o=d-e;if(e<f){p-=(f-e)*j/o;e=f}if(p>m){e+=(p-m)*o/j;p=m}if(d>a){n+=(d-a)*j/o;d=a}if(n<q){d-=(q-n)*o/j;n=q}}}else{if(n<q||p>m){return false}else{j=n-p;o=d-e;if(e<f){p+=(f-e)*j/o;e=f}if(p<q){e+=(q-p)*o/j;p=q}if(d>a){n-=(d-a)*j/o;d=a}if(n>m){d-=(n-m)*o/j;n=m}}}}}}}u=[e,p,d,n]}else{return false}}}}return u};this.lineLength=function(b,e,a,d){return Math.sqrt(Math.pow(a-b,2)+Math.pow(d-e,2))};this.shortenLine=function(b,m,a,k,n,g,o){if(this.validateNumbers([b,m,a,k,n,g])){if(o.match(/bezier/)){if(o.match(/beziery/i)){return k>m?[b,m+n,a,k-g]:[b,m-n,a,k+g]}else{return a>b?[b+n,m,a-g,k]:[b-n,m,a+g,k]}}else{if(o.match(/curved/)){return[b,m,a,k]}else{var d=Math.atan2(k-m,a-b);var f=Math.cos(d);var j=Math.sin(d);var h=this.lineLength(b,m,a,k);if(h){b+=f*n;m+=j*n;a-=f*g;k-=j*g}}}return[b,m,a,k]}};this.errorBar=function(e,g,d,f,a,h){if(!this.isGroupedData&&this.isRawData){return}if(this.showErrorBars&&this.validateNumbers([a])){var b=this.drawLine("line",e,g,d,f,h,false,false,false,false,true);if(a>0){this.drawLine("line",d,f-a/2,d,f+a/2,h,false,false,false,false,true)}else{this.drawLine("line",d-a/2,f,d+a/2,f,h,false,false,false,false,true)}return b}};this.drawLine=function(aa,G,a,D,at,am,Z,ae,ac,ao,ap,ar){var T=this;var ah;var N=[];var V=false;var z=false;var v=false;var U=function(){T.ctx.save();if(T.transparency!=null){if(am){am=T.validateColor(am,T.transparency)||T.addColorTransparency(T.foreground,T.transparency)}else{am=T.addColorTransparency(T.foreground,T.transparency)}}else{if(am){am=T.validateColor(am)||T.foreground}else{am=T.foreground}}T.ctx.fillStyle=am;T.ctx.strokeStyle=am;T.ctx.lineWidth=Z?Z:T.outlineWidth;T.ctx.lineCap=ae?ae:T.capType;if(T.showShadow){T.ctx.shadowOffsetX=T.shadowOffsetX;T.ctx.shadowOffsetY=T.shadowOffsetY;T.ctx.shadowBlur=T.shadowBlur;T.ctx.shadowColor=T.shadowColor}};var I=function(){if(T.showShadow){T.ctx.shadowOffsetX=0;T.ctx.shadowOffsetY=0;T.ctx.shadowBlur=0;T.ctx.shadowColor=T.background}T.ctx.restore()};var H=function(au){var x=function(aD,aG,aB,aH){var aC=[];for(var aE=0;aE<aD.length;aE++){aC.push([(aD[aE][0]*Math.cos(aG))-(aD[aE][1]*Math.sin(aG)),(aD[aE][0]*Math.sin(aG))+(aD[aE][1]*Math.cos(aG))])}var aF=[];for(var aE=0;aE<aC.length;aE++){aF.push([aC[aE][0]+aB,aC[aE][1]+aH])}return aF};var w=T.arrowPointSize;var t=Math.max((w/2)-1,1);var p=au?[[0,-w],[0,w]]:[[Math.floor((w/2.5)),0],[-w,-t],[-w,t]];var aA=D-G;var ay=at-a;if(z){if(z=="Y"){if(Math.abs(ay)>Math.abs(aA)){aA=0}else{aA=D>G?T.arrowPointSize:-T.arrowPointSize}}else{if(Math.abs(aA)>Math.abs(ay)){ay=0}else{ay=at>a?T.arrowPointSize:-T.arrowPointSize}}}else{if(v){var aw=T.lineLength(G,a,D,at);var n=T.shortenLine(G,a,D,at,0,aw/2,"line");var s=n[2];var b=n[3];var az=aw/2;var av=v/az;var ax=D>G?Math.asin((b-a)/az):Math.asin(-(b-a)/az);var e=ax-(Math.PI/20);if(D>G){G=s+az*Math.cos(e-av);a=b+az*Math.sin(e-av);D=s+az*Math.cos(ax-av);at=b+az*Math.sin(ax-av)}else{G=s+az*Math.cos((e-av)+Math.PI);a=b+az*Math.sin((e-av)+Math.PI);D=s+az*Math.cos((ax-av)+Math.PI);at=b+az*Math.sin((ax-av)+Math.PI)}aA=D-G;ay=at-a}}var f=x(p,Math.atan2(ay,aA),D,at);U();T.ctx.beginPath();T.ctx.moveTo(f[0][0],f[0][1]);for(var y=1;y<f.length;y++){if(!isNaN(f[y][0])&&!isNaN(f[y][1])){T.ctx.lineTo(f[y][0],f[y][1])}}if(!au){if(!isNaN(f[0][0])&&!isNaN(f[0][1])){T.ctx.lineTo(f[0][0],f[0][1])}T.ctx.closePath();T.ctx.fill()}else{T.ctx.closePath();T.ctx.stroke()}I()};var h=function(p,aw,n,av,f,au){var ax=Math.sqrt(Math.pow(n-p,2)+Math.pow(av-aw,2));var w=Math.sqrt(Math.pow(f-n,2)+Math.pow(au-av,2));var t=this.tension*ax/(ax+w);var s=this.tension-t;var e=n+t*(p-f);var b=av+t*(aw-au);var y=n-s*(p-f);var x=av-s*(aw-au);return[e,b,y,x]};if(aa=="spline"){if(G.length<3){return false}var ab=[];var aq=[];var ad=[];var ag=0;N=["poly"];for(var ak=0;ak<G.length;ak++){if(this.validateNumbers([G[ak],a[ak]])){aq.push(G[ak]);aq.push(a[ak]);N.push(G[ak]);N.push(a[ak]-2);ad.push(G[ak]);ad.push(a[ak]+2);ag+=2}else{return false}}N=N.concat(ad.reverse());U();for(var ak=0;ak<ag-4;ak+=2){ab=ab.concat(h(aq[ak],aq[ak+1],aq[ak+2],aq[ak+3],aq[ak+4],aq[ak+5]))}this.ctx.beginPath();this.ctx.moveTo(aq[0],aq[1]);for(var ak=2;ak<ag-5;ak+=2){this.ctx.bezierCurveTo(ab[2*ak-2],ab[2*ak-1],ab[2*ak],ab[2*ak+1],aq[ak+2],aq[ak+3])}this.ctx.closePath();this.ctx.stroke();this.ctx.beginPath();this.ctx.moveTo(aq[0],aq[1]);this.ctx.quadraticCurveTo(ab[0],ab[1],aq[2],aq[3]);this.ctx.closePath();this.ctx.stroke();this.ctx.beginPath();this.ctx.moveTo(aq[ag-2],aq[ag-1]);this.ctx.quadraticCurveTo(ab[2*ag-10],ab[2*ag-9],aq[ag-4],aq[ag-3]);this.ctx.closePath();this.ctx.stroke();I();return N}else{if(this.validateNumbers([G,a,D,at])){if(!ac){ac=0}if(!ao){ao=0}if(aa.match(/bezier/i)){if(aa.match(/beziery/i)){ah="bezierLine";z="Y";V="Y";if(ac||ao){if(at>a){if(a+ac>at-ao){aa=aa.replace(/beziery/i,"");ah="line";z=false;V=false}}else{if(a-ac<at+ao){aa=aa.replace(/beziery/i,"");ah="line";z=false;V=false}}}}else{ah="bezierLine";z="X";V="X";if(ac||ao){if(D>G){if(G+ac>D-ao){aa=aa.replace(/bezier[x]?/i,"");ah="line";z=false;V=false}}else{if(G-ac<D+ao){aa=aa.replace(/bezier[x]?/i,"");ah="line";z=false;V=false}}}}}else{if(aa.match(/curved/i)){if(aa.match(/curvedc/i)){ah="curvedLine";v=true;V=true}else{ah="curvedLine";v=true;V=false}}else{if(aa.match(/dashed/i)){ah="dashedLine"}else{if(aa.match(/dotted/i)){ah="dottedLine"}else{ah="line"}}}}if(ac||ao){var af=this.shortenLine(G,a,D,at,ac,ao,aa);G=af[0];a=af[1];D=af[2];at=af[3]}if(ap){var L=this.clip("line",[G,a,D,at],ar);if(L){G=L[0];a=L[1];D=L[2];at=L[3]}else{return false}}switch(ah){case"dashedLine":var m=Math.atan2(at-a,D-G);var R=Math.cos(m);var J=Math.sin(m);var M=this.lineLength(G,a,D,at);var aj=Math.floor(M/(this.dashLength*2));if(aj){var X=R*this.dashLength;var W=J*this.dashLength;var g=G;var an=a;var d=D;var al=at;d=g+X;al=an+W;for(var ak=0;ak<aj;ak++){this.drawLine("line",g,an,d,al,am,Z,ae);g+=(X*2);an+=(W*2);d=g+X;al=an+W}this.drawLine("line",g,an,d,al,am,Z,ae);N=["poly",G+2,a,D+2,at,D-2,at,G-2,a]}else{return false}break;case"dottedLine":var m=Math.atan2(at-a,D-G);var R=Math.cos(m);var J=Math.sin(m);var M=this.lineLength(G,a,D,at);var aj=Math.ceil(M/(this.dotLength*2));var S=M/aj;if(aj){var X=R*S;var W=J*S;var g=G;var an=a;var d=D;var al=at;g+=X;an+=W;for(var ak=0;ak<aj-1;ak++){this.drawShape("circle",g,an,2,2,am,am,"closed");g+=X;an+=W}N=["poly",G+2,a,D+2,at,D-2,at,G-2,a]}else{return false}break;case"bezierLine":if(G==D||a==at){return this.drawLine("line",G,a,D,at,am,Z,ae,ac,ao,ap,ar)}G=parseInt(G)+0.5;a=parseInt(a)+0.5;D=parseInt(D)+0.5;at=parseInt(at)+0.5;V=V=="Y"?"Y":"X";var P=D>G?true:false;var q=(G+D)/2;var o=(a+at)/2;if(P){if(V=="X"){N=["poly",G,a-2,q+2,a-2,q+2,at-2,D,at-2,D,at+2,q-2,at+2,q-2,a+2,G,a+2]}else{N=["poly",G-2,a,G-2,o+2,D-2,o+2,D-2,at,D+2,at,D+2,o-2,G+2,o-2,G+2,a]}}else{if(V=="X"){N=["poly",G,a-2,q-2,a-2,q-2,at-2,D,at-2,D,at+2,q+2,at+2,q+2,a+2,G,a+2]}else{N=["poly",G-2,a,G-2,o-2,D-2,o-2,D-2,at,D+2,at,D+2,o+2,G+2,o+2,G+2,a]}}U();this.ctx.moveTo(G,a);if(V=="Y"){this.ctx.bezierCurveTo(G,at,D,a,D,at)}else{this.ctx.bezierCurveTo(D,a,G,at,D,at)}this.ctx.stroke();I();break;case"curvedLine":var q=12;var u=1;var M=this.lineLength(G,a,D,at);var F=this.shortenLine(G,a,D,at,0,M/2,"line");var Q=F[2];var E=F[3];var Y=M/2;var O=ac/Y;var K=ao/Y;var k=(Q-G);var j=(E-a);var C=V&&G>D?false:!V&&D>=G?true:V;var r=D>=G?Math.asin(j/Y):Math.asin(-j/Y);var ai=r+Math.PI;var B=Math.PI/q;var A=D>=G?0:Math.PI;N=["poly"];for(var ak=u;ak<=q-u;ak++){N.push(Q-(Y+2)*Math.cos(r+((B*ak))-A));N.push(E-(Y+2)*Math.sin(r+((B*ak))-A))}for(var ak=q-u;ak>=u;ak--){N.push(Q-(Y-2)*Math.cos(r+((B*ak))-A));N.push(E-(Y-2)*Math.sin(r+((B*ak))-A))}U();this.ctx.beginPath();if(D>=G){this.ctx.arc(Q,E,Y,r-K,ai+O,C)}else{this.ctx.arc(Q,E,Y,r+O,ai-K,C)}this.ctx.stroke();I();break;case"line":N=["poly",G+2,a,D+2,at,D-2,at,G-2,a];U();this.ctx.beginPath();this.lineTo(G,a,D,at);I();break}if(aa.match(/arrowheadsquaretail|squaretailarrowhead/i)){v=v?ao:false;H(false,z,v);v=v?ac:false;H(true,z,v)}else{if(aa.match(/arrowtailsquarehead|squareheadarrowtail/i)){v=v?ao:false;H(true,z,v);v=v?ac:false;H(false,z,v)}else{if(aa.match(/arrowhead/i)){v=v?ao:false;H(false,z,v)}else{if(aa.match(/squarehead/i)){v=v?ao:false;H(true,z,v)}else{if(aa.match(/arrowtail/i)){v=v?ac:false;H(false,z,v)}else{if(aa.match(/squaretail/i)){v=v?ac:false;H(true,z,v)}else{if(aa.match(/arrow/i)){v=v?ao:false;H(false,z,v);v=v?ac:false;H(false,z,v)}else{if(aa.match(/square/i)){v=v?ac:false;H(true,z,v);v=v?ao:false;H(true,z,v)}}}}}}}}return N}else{return false}}return N};this.rectangle=function(s,q,t,g,j,e,d,a,m,k,n){return this.drawShape("rectangle",s+(t/2),q+(g/2),t,g,j,e,d,a,m,k,n)};this.rectangleHM=function(s,q,t,g,j,e,d,a,m,k,n){return this.drawShape("rectangleHM",s+(t/2),q+(g/2),t,g,j,e,d,a,m,k,n)};this.drawShape=function(M,I,H,K,Y,Z,S,R,O,G,af,ag,N,ac,L,ae){var F=this;var Q=function(){F.ctx.save();F.ctx.translate(I,H);if(O){F.ctx.rotate(O)}if(F.transparency!=null){if(Z){Z=F.validateColor(Z,F.transparency)||F.addColorTransparency(F.foreground,F.transparency)}else{Z=F.addColorTransparency(F.foreground,F.transparency)}}else{if(Z){Z=F.validateColor(Z)||F.foreground}else{Z=F.foreground}}if(F.gradient){if(F.gradientType=="radial"){F.setGradient(0,0,Math.max(Math.abs(K),Math.abs(Y)),Z)}else{F.setGradient(0,0,K,Y,Z)}}else{F.ctx.fillStyle=Z}if(S){S=F.validateColor(S)||F.foreground}F.ctx.strokeStyle=S?S:F.foreground;F.ctx.lineWidth=G?G:F.outlineWidth;if(F.showShadow){F.ctx.shadowOffsetX=F.shadowOffsetX;F.ctx.shadowOffsetY=F.shadowOffsetY;F.ctx.shadowBlur=F.shadowBlur;F.ctx.shadowColor=F.shadowColor}};var aj=function(e,b){if(M=="image"){return}if(M=="rectangleHM"){if(e){e[0][0]=Math.round(e[0][0])+0.5;e[3][0]=e[0][0];e[1][0]=Math.round(e[1][0])+1.5;e[2][0]=e[1][0];e[0][1]=Math.round(e[0][1])+0.5;e[1][1]=e[0][1];e[2][1]=Math.round(e[2][1])+1.5;e[3][1]=e[2][1];F.ctx.beginPath();F.ctx.moveTo(e[0][0],e[0][1]);for(var d=1;d<e.length;d++){F.ctx.lineTo(e[d][0],e[d][1])}if(!b){F.ctx.closePath()}if(R&&R=="open"){F.ctx.stroke()}else{F.ctx.stroke();F.ctx.fill()}}}else{if(e){F.ctx.beginPath();F.ctx.moveTo(e[0][0]+0.5,e[0][1]+0.5);for(var d=1;d<e.length;d++){F.ctx.lineTo(e[d][0]+0.5,e[d][1]+0.5)}if(!b){F.ctx.closePath()}}if(R&&R=="open"){F.ctx.stroke()}else{F.ctx.stroke();F.ctx.fill()}}if(F.showShadow){F.ctx.shadowOffsetX=0;F.ctx.shadowOffsetY=0;F.ctx.shadowBlur=0;F.ctx.shadowColor=F.background}F.ctx.restore()};var aa=function(s){if(s){if(s[0]=="circle"){return s}var f=s.shift();var p=[];if(f=="rect"){var r=s.shift()-I;var t=s.shift()-H;var e=s.shift()-I;var h=s.shift()-H;p.push((t*Math.sin(O))-(r*Math.cos(O)));p.push((t*Math.cos(O))+(r*Math.sin(O)));p.push((h*Math.sin(O))-(r*Math.cos(O)));p.push((h*Math.cos(O))+(r*Math.sin(O)));p.push((h*Math.sin(O))-(e*Math.cos(O)));p.push((h*Math.cos(O))+(e*Math.sin(O)));p.push((t*Math.sin(O))-(e*Math.cos(O)));p.push((t*Math.cos(O))+(e*Math.sin(O)))}else{while(s.length>1){var o=s.shift()-I;var b=s.shift()-H;p.push((b*Math.sin(O))-(o*Math.cos(O)));p.push((b*Math.cos(O))+(o*Math.sin(O)))}}var d=["poly"];while(p.length>1){d.push(p.shift()+I);d.push(p.shift()+H)}return d}};var D,E;if(M=="polygon"||M=="path"){var V=Number.MAX_VALUE;var B=Number.MIN_VALUE;var U=Number.MAX_VALUE;var A=Number.MIN_VALUE;var C=M=="polygon"?false:true;D=[];E=["poly"];if(I.length==H.length){for(var X=0;X<I.length;X++){if(this.validateNumbers([I[X],H[X]])){V=Math.min(V,I[X]);B=Math.max(B,I[X]);U=Math.min(U,H[X]);A=Math.max(A,H[X]);D.push([I[X],H[X]]);E.push(I[X],H[X])}else{return false}}I=(V+B)/2;H=(U+A)/2;for(var X=0;X<D.length;X++){D[X][0]-=I;D[X][1]-=H}if(O){E=aa(E)}if(D){Q(C);aj(D,C)}return E}else{return false}}else{if(this.validateNumbers([I,H,K,Y])){if(af){D=M.match(/rectangle/)?this.clip("rect",[I-(K/2),H-(Y/2),K,Y],ag):this.clip("circle",[I,H],ag);if(D){if(M.match(/rectangle/)){K=D[2];Y=D[3];I=D[0]+(K/2);H=D[1]+(Y/2)}else{I=D[0];H=D[1]}}else{return false}}var j=K/2;var ah=Y/2;var P=Y/K;var T=1.5;var E=["rect",I-j,H-ah,I+j,H+ah];switch(M){case"image":D=false;this.ctx.save();this.ctx.translate(I,H);if(O){this.ctx.rotate(O)}this.ctx.drawImage(CanvasXpress.cacheImages[L],-j*this.zoom,-ah*this.zoom,K*this.zoom,Y*this.zoom);E=["rect",I-(j*this.zoom),H-(ah*this.zoom),I+(j*this.zoom),H+(ah*this.zoom)];this.ctx.restore();break;case"circle":case"sphere":E=["circle",I,H,K/2];D=false;Q();this.ctx.beginPath();this.ctx.arc(0,0,K/2,0,Math.PI*2,true);this.ctx.closePath();aj();break;case"box":case"rect":case"rectangle":case"rectangleHM":D=[[-j,-ah],[j,-ah],[j,ah],[-j,ah]];break;case"rect2":return this.drawShape("rectangle",I,H,K,K/2,Z,S,R,O,G,af,ag,N,ac);break;case"rect3":return this.drawShape("rectangle",I,H,K,K/3,Z,S,R,O,G,af,ag,N,ac);break;case"roundrect":var J=K>Y?Y/4:K/4;D=false;Q();this.ctx.beginPath();ctx.moveTo(-j,-ah+J);ctx.lineTo(-j,ah-J);ctx.quadraticCurveTo(-j,ah,-j+J,ah);ctx.lineTo(j-J,ah);ctx.quadraticCurveTo(j,ah,j,ah-J);ctx.lineTo(j,-ah+J);ctx.quadraticCurveTo(j,-ah,j-J,-ah);ctx.lineTo(-j+J,-ah);ctx.quadraticCurveTo(-j,-ah,-j,-ah+J);this.ctx.closePath();aj();break;case"square":D=[[-j,-j],[j,-j],[j,j],[-j,j]];break;case"triangle":if(K==Y){return this.drawShape("equilateral",I,H,K,Y,Z,S,R,O,G,af,ag)}E=["poly",I,H-ah,I+j,H+ah,I-j,H+ah];D=[[0,-ah],[j,ah],[-j,ah]];break;case"equilateral":var J=K*Math.sqrt(3)/6;var g=J/2;var q=Math.sqrt((J*J)-(g*g));E=["poly",I,H-J,I+q,H+g,I-q,H+g];D=[[0,-ah],[j,ah],[-j,ah]];break;case"diamond":case"rhombus":E=["poly",I,H-ah,I+j,H,I,H+ah,I-j,H];D=[[0,-ah],[j,0],[0,ah],[-j,0]];break;case"hexagon":var ad=K/3;var m=ad-j;D=[[m,-ah],[-m,-ah],[j,0],[-m,ah],[m,ah],[-j,0]];break;case"octagon":var ai=K/4;var W=Y/4;D=[[-ai,-ah],[ai,-ah],[j,-W],[j,W],[ai,ah],[-ai,ah],[-j,W],[-j,-W]];break;case"oval":D=false;Q();this.ctx.scale(1,P);this.ctx.beginPath();this.ctx.arc(0,0,K/2,0,Math.PI*2,true);this.ctx.closePath();aj();break;case"oval2":return this.drawShape("oval",I,H,K,K/2,Z,S,R,O,G,af,ag,N,ac);break;case"oval3":return this.drawShape("oval",I,H,K,K/3,Z,S,R,O,G,af,ag,N,ac);break;case"ellipse":var a=j*0.5522848;var ab=ah*0.5522848;D=false;Q();this.ctx.beginPath();this.ctx.moveTo(0,ah);this.ctx.bezierCurveTo(0,ah-ab,j-a,0,j,0);this.ctx.bezierCurveTo(j+a,0,K,ah-ab,K,ah);this.ctx.bezierCurveTo(K,ah+ab,j+a,Y,j,Y);this.ctx.bezierCurveTo(j-a,Y,0,ah+ab,0,ah);this.ctx.closePath();aj();break;case"ellipse2":return this.drawShape("ellipse",I,H,K,K/2,Z,S,R,O,G,af,ag,N,ac);break;case"ellipse3":return this.drawShape("ellipse",I,H,K,K/3,Z,S,R,O,G,af,ag,N,ac);break;case"plus":D=[[-T,-ah],[T,-ah],[T,-T],[j,-T],[j,T],[T,T],[T,ah],[-T,ah],[-T,T],[-j,T],[-j,-T],[-T,-T],[-T,-ah]];break;case"minus":D=[[-j,-T],[j,-T],[j,T],[-j,T],[-j,-T]];break;case"mdavid":var ad=K/3;var n=Math.PI/6;E=["circle",I,H,K/2];D=false;Q();this.ctx.beginPath();this.ctx.moveTo(ad,0);for(var X=0;X<11;X++){this.ctx.rotate(n);if(X%2==0){this.ctx.lineTo((ad/0.55),0)}else{this.ctx.lineTo(ad,0)}}this.ctx.closePath();aj();break;case"star":var k=K/4;var v=Math.PI/5;E=["circle",I,H,K/2];D=false;Q();this.ctx.rotate(v*0.45);this.ctx.beginPath();this.ctx.moveTo(k,0);for(var X=0;X<9;X++){this.ctx.rotate(v);if(X%2==0){this.ctx.lineTo((k/0.35),0)}else{this.ctx.lineTo(k,0)}}this.ctx.closePath();aj();break;case"pie":if(typeof(N)=="undefined"){N=0}if(typeof(ac)=="undefined"){ac=Math.PI*2}D=false;Q();this.ctx.scale(1,P);this.ctx.beginPath();this.ctx.arc(0,0,K/2,N,ac,false);this.ctx.closePath();aj();break;case"pie0":return this.drawShape("pie",I,H,K,K/2,Z,S,R,O,G,af,ag,0,Math.PI/5);break;case"pie1":return this.drawShape("pie",I,H,K,K/2,Z,S,R,O,G,af,ag,0,Math.PI/3.5);break;case"pie2":return this.drawShape("pie",I,H,K,K/2,Z,S,R,O,G,af,ag,0,Math.PI/2);break;case"pie3":return this.drawShape("pie",I,H,K,K/2,Z,S,R,O,G,af,ag,0,Math.PI/1.5);break;case"pie4":return this.drawShape("pie",I,H,K,K/2,Z,S,R,O,G,af,ag,0,Math.PI);break;case"pie5":return this.drawShape("pie",I,H,K,K/2,Z,S,R,O,G,af,ag,0,Math.PI*1.2);break;case"pie6":return this.drawShape("pie",I,H,K,K/2,Z,S,R,O,G,af,ag,0,Math.PI*1.4);break;case"pie7":return this.drawShape("pie",I,H,K,K/2,Z,S,R,O,G,af,ag,0,Math.PI*1.6);break;case"pie8":return this.drawShape("pie",I,H,K,K/2,Z,S,R,O,G,af,ag,0,Math.PI*1.8);break;case"pie9":return this.drawShape("pie",I,H,K,K/2,Z,S,R,O,G,af,ag,0,Math.PI*2);break;case"pacman":return this.drawShape("pie",I,H,K,K/2,Z,S,R,O,G,af,ag,Math.PI*5/4,Math.PI*3/4);break}if(O){E=aa(E)}if(D){Q();aj(D)}return E}else{return false}}};this.setRGB=function(){this.reds=[];this.greens=[];this.blues=[];this.yellows=[];this.cyans=[];this.purples=[];this.indicatorBins=this.allVsAll?Math.min(this.x,this.y)/(this.layoutRows*2):Math.min(this.x,this.y)/4;this.indicatorBins=this.indicatorBins>512?1:this.indicatorBins>256?2:this.indicatorBins>128?4:8;var f=this.indicatorBins;var d=parseInt(256/f);var e;var b;if(this.indicatorCenter=="rainbow-green"){e=f-1;b=255;for(var a=0;a<d;a++){this.greens.push("rgb(0,255,"+e+")");this.cyans.push("rgb(0,"+b+",255)");this.blues.push("rgb("+e+",0,255)");this.purples.push("rgb(255,0,"+b+")");this.reds.push("rgb(255,"+e+",0)");this.yellows.push("rgb("+b+",255,0)");e+=f;b-=f}}else{if(this.indicatorCenter.match("rainbow")){e=f-1;b=255;for(var a=0;a<d;a++){this.reds.push("rgb(255,0,"+e+")");this.purples.push("rgb("+b+",0,255)");this.blues.push("rgb(0,"+e+",255)");this.cyans.push("rgb(0,255,"+b+")");this.greens.push("rgb("+e+",255,0)");this.yellows.push("rgb(255,"+b+",0)");e+=f;b-=f}}else{if(this.indicatorCenter=="black"){e=255;for(var a=0;a<d;a++){this.reds.push("rgb("+e+",0,0)");this.purples.push("rgb("+e+",0,"+e+")");this.blues.push("rgb(0,0,"+e+")");this.cyans.push("rgb(0,"+e+","+e+")");this.greens.push("rgb(0,"+e+",0)");this.yellows.push("rgb("+e+","+e+",0)");e-=f}}else{this.reds.push("rgb(255,0,0)");this.purples.push("rgb(255,0,255)");this.blues.push("rgb(0,0,255)");this.cyans.push("rgb(0,255,255)");this.greens.push("rgb(0,255,0)");this.yellows.push("rgb(255,255,0)");e=f-1;for(var a=0;a<d-1;a++){this.reds.push("rgb(255,"+e+","+e+")");this.purples.push("rgb(255,"+e+",255)");this.blues.push("rgb("+e+","+e+",255)");this.cyans.push("rgb("+e+",255,255)");this.greens.push("rgb("+e+",255,"+e+")");this.yellows.push("rgb(255,255,"+e+")");e+=f}}}}};this.setLineTypes=function(){this.lines=this.getLineTypes()};this.initializeAttributes=function(){this.setLineTypes();this.setRGB()};this.initializeAttributes()};CanvasXpress.prototype.initLayout=function(){this.isValidLayout=function(){var a=this.layout.split(/X/i);if(a.length==2){this.layoutRows=a[0];this.layoutCols=a[1]}else{this.layoutRows=1;this.layoutCols=1;this.layoutValid=false}if(!this.graphType.match(/Scatter/)&&this.layoutComb&&!this.autoExtend&&this.data.l&&(this.data.l.vars||this.data.l.smps)&&this.data.l.weight&&this.data.l.type){this.data.l.comp=[];if(this.data.l.vars&&this.data.l.smps){var f=0;for(var d=0;d<this.data.l.smps.length;d++){for(var b=0;b<this.data.l.vars.length;b++){this.data.l.comp[f]=[this.getVariableIndices(this.data.l.vars[b]),this.getSampleIndices(this.data.l.smps[d])];f++}}this.layoutRows=this.data.l.smps.length;this.layoutCols=this.data.l.vars.length}else{if(this.data.l.vars){for(var d=0;d<this.data.l.vars.length;d++){this.data.l.comp[d]=this.getVariableIndices(this.data.l.vars[d])}}else{for(var d=0;d<this.data.l.smps.length;d++){this.data.l.comp[d]=this.getSampleIndices(this.data.l.smps[d])}}if(this.graphType!="Pie"){if(this.graphOrientation=="vertical"){this.layoutRows=this.data.l.comp.length}else{this.layoutCols=this.data.l.comp.length}}}this.layoutValid=true;this.layoutAdjust=true}else{if(this.layoutComb&&!this.autoExtend&&this.data.l&&this.data.l.smps&&this.data.l.weight&&this.data.l.type){this.data.l.comp=[];var e=this.getVariableIndices(this.data.y.vars);for(var d=0;d<this.data.l.type.length;d++){this.data.l.comp[d]=e}this.layoutValid=true}else{if(!this.autoExtend&&this.data.l&&this.data.l.comp){if(this.data.l.comp.length<=(this.layoutRows*this.layoutCols)){this.layoutValid=true}else{this.layoutValid=false}}else{this.layoutValid=false}}}};this.setLayout=function(b){if(b==0){this.layoutCols=1;this.layoutRows=1;this.scaleX=1;this.scaleY=1;this.translateX=0;this.translateY=0;this.layout="1X1";this.legendBox=true;this.layoutValid=false}else{if(!this.graphType.match(/Scatter|Pie|Venn|Network|Genome/)){this.layoutCols=b;this.layoutRows=Math.ceil(this.varIndices.length/b);this.layout=this.layoutRows+"X"+this.layoutCols;this.autoExtend=false;this.data.l={};this.data.l["comp"]=[];if(this.graphType=="Candlestick"){for(var a=0;a<this.varIndices.length;a++){this.data.l["comp"].push(this.varIndices)}}else{for(var a=0;a<this.varIndices.length;a++){this.data.l["comp"].push([this.varIndices[a]])}this.legendBox=false}this.layoutValid=true}}this.draw()};this.addLayoutResizer=function(b){var a=0;if(this.resizerType&&this.resizerPosition==b){a+=this.resizerWidth+(this.margin*2);if(this.resizerType=="samples"){a+=14+this.margin}}return a};this.getLayoutResizerDimensions=function(){if(this.resizerType){var z,k,f,e;var g=this.data.l.comp.length-1;var m=this.resizerWidth;var A=this.resizerWidth;var C=this.layoutTop;var d=this.layoutRight;var s=this.layoutBottom;var j=this.layoutLeft;var B=this.getAxesVals(0);var u=0;var q=0;switch(this.resizerPosition){case"right":z="xAxis";k="y";f="v";e="r";C+=this["subGraphTop"+0];j=this.resizerType=="samples"?this.width-((this.margin*2)+this.resizerWidth+14):this.width-(this.margin+this.resizerWidth);m=this.height-(C+s+this["subGraphBottom"+g]);u+=this.resizerWidth;break;case"left":z="xAxis";k="y";f="v";e="l";C+=this["subGraphTop"+0];j=this.resizerType=="samples"?(this.margin*2)+14:this.margin;m=this.height-(C+s+this["subGraphBottom"+g]);u+=this.resizerWidth;break;case"top":z="xAxis";k="x";f="h";e="t";C=this.resizerType=="samples"?(this.margin*2)+14:this.margin;j+=this["subGraphLeft"+0];A=this.width-(j+d+this["subGraphRight"+g]);q+=this.resizerWidth;break;case"bottom":z="xAxis";k="x";f="h";e="b";C=this.resizerType=="samples"?this.height-((this.margin*2)+this.resizerWidth+14):this.width-(this.margin+this.resizerWidth);j+=this["subGraphLeft"+0];A=this.width-(j+d+this["subGraphRight"+g]);q+=this.resizerWidth;break}return([z,j+u,j+u+A,C+q,C+q+m,k,f,e,B,j,C,A,m])}};this.drawLayoutResizer=function(){if(this.resizerType){var a=this.getLayoutResizerDimensions();this.showAxesResizer(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],"",0,0,0);this.drawAxesResizerBackgroundData(a[9],a[10],a[11],a[12]);this.drawAxesResizerMasks()}};this.setLayoutLeft=function(){var a=0;if(this.graphOrientation!="vertical"&&this.segregateSamplesBy&&this.segregateVariablesBy){this.set1DVarSmpLabelFont();a=this.fontSize+(this.margin*4)+this.measureText(this.maxSmpNameStr,this.smpLabelFont)+this.getSmpOverlaysLength()}else{if(this.graphOrientation!="vertical"&&this.segregateVariablesBy){this.set1DVarSmpLabelFont();a=(this.margin*2)+this.measureText(this.maxSmpNameStr,this.smpLabelFont)+this.getSmpOverlaysLength()}else{if((this.segregateSamplesBy||this.segregateVariablesBy)&&this.graphOrientation=="vertical"){a=this.fontSize+(this.margin*2)}else{if(this.graphType=="Candlestick"&&this.graphOrientation!="vertical"){this.setTimeAxis();this.set1DVarSmpLabelFont();a=this.getSampleLabelLength()+this.getSmpOverlaysLength()}else{if(this.graphType=="Pie"){a=(this.margin*2)+this.measureText("XX",this.smpLabelFont)}}}}}return a+this.addLayoutResizer("left")};this.setLayoutRight=function(){var a=0;if(this.graphType=="Pie"&&this.showLegend){var b=this.getPieLegendDimensions();a=b[0]}return a+this.addLayoutResizer("right")};this.setLayoutTop=function(){var a=0;if(((this.segregateSamplesBy||this.segregateVariablesBy)&&this.graphOrientation!="vertical")||(this.segregateSamplesBy&&this.segregateVariablesBy)||(this.graphType=="Pie")){a=this.fontSize+(this.margin*2)}return a+this.addLayoutResizer("top")};this.setLayoutBottom=function(){var a=0;if(this.segregateSamplesBy&&this.segregateVariablesBy){a=this.getLegendHeight()}else{if(this.segregateVariablesBy&&this.graphOrientation=="vertical"){this.set1DVarSmpLabelFont();a=(this.margin*2)+this.measureText(this.maxSmpNameStr,this.smpLabelFont)+this.getSmpOverlaysLength()}else{if(this.graphType=="Candlestick"&&this.graphOrientation=="vertical"){this.setTimeAxis();this.set1DVarSmpLabelFont();a=this.getSampleLabelLength()+this.getSmpOverlaysLength()}}}return a+this.addLayoutResizer("bottom")};this.drawLayoutSampleOverlays=function(b){var a=this.smpIndices;this.smpIndices=b;this.set1DVarSmpLabelFont();this.smpIndices=a;this.showSampleNames=true;this.showOverlays=true;this.draw1DYLayout()};this.drawLayoutVariableLegend=function(){this.showLegend=true;if(this.graphType=="Pie"){this.drawPieLegend()}else{this.draw1DLegend()}this.showLegend=false};this.setLayoutDimensions=function(){this.offsetX=0;this.offsetY=0;this.layoutLeft=this.setLayoutLeft();this.layoutRight=this.setLayoutRight();this.layoutTop=this.setLayoutTop();this.layoutBottom=this.setLayoutBottom()};this.drawLabelsLayout=function(){var p=0;var o=0;var n=0;var e=0;if(this.resizerType){if(this.resizerPosition=="top"){o=this.resizerType=="samples"?(this.margin*2)+this.resizerWidth+14:this.margin+this.resizerWidth;e=o}else{if(this.resizerPosition=="left"){p=this.resizerType=="samples"?(this.margin*2)+this.resizerWidth+14:this.margin+this.resizerWidth;n=p}}}if(this.segregateSamplesBy&&this.segregateVariablesBy){o+=(this.fontSize/2)+(this.margin*2);p=this.layoutLeft;for(var r=0;r<this.data.l.vars.length;r++){var g=r*this.data.l.smps.length;var q=(this.width-(this.layoutLeft+this.layoutRight))*this["subGraphWeight"+g][0];p+=(q/2);this.drawText(this.data.l.name[g][0],p,o,this.font,this.foreground,"center","middle");p+=(q/2)}p=n+(this.fontSize/2)+this.margin;o=this.layoutTop;for(var g=0;g<this.data.l.smps.length;g++){var k=(this.height-(this.layoutTop+this.layoutBottom))*this["subGraphWeight"+g][1];o+=(k/2);this.drawText(this.data.l.name[g][1],p,o,this.font,this.foreground,"center","middle",-Math.PI/2);o+=(k/2)}}else{if((this.segregateSamplesBy||this.segregateVariablesBy)&&this.graphOrientation=="vertical"&&this.data.l.name){p+=(this.fontSize/2)+this.margin;o+=this.layoutTop;for(var g=0;g<this.data.l.name.length;g++){var k=(this.height-(this.layoutTop+this.layoutBottom))*this["subGraphWeight"+g];o+=(k/2);this.drawText(this.data.l.name[g],p,o,this.font,this.foreground,"center","middle",-Math.PI/2);o+=(k/2)}}else{if((this.segregateSamplesBy||this.segregateVariablesBy)&&this.graphOrientation=="horizontal"&&this.data.l.name){o+=(this.fontSize/2)+this.margin;p+=this.layoutLeft;for(var g=0;g<this.data.l.name.length;g++){var q=(this.width-(this.layoutLeft+this.layoutRight))*this["subGraphWeight"+g];p+=(q/2);this.drawText(this.data.l.name[g],p,o,this.font,this.foreground,"center","middle");p+=(q/2)}}else{if(this.graphType=="Pie"&&(this.showPieGrid||this.showPieSampleLabel)){var k,q;var m=0;var b=this.layoutTop;var d=this.layoutLeft;var a=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];for(var g=0;g<this.layoutRows;g++){k=(this.height-(this.layoutTop+this.layoutBottom))*this["subGraphWeight"+m][1];p=this.layoutLeft-this.margin;b+=k;if(this.showPieGrid){this.drawText(g+1,p,b-(k/2),this.font,this.foreground,"right","middle")}for(var f=0;f<this.layoutCols;f++){if(this.xAxis.length<=m){break}q=(this.width-(this.layoutLeft+this.layoutRight))*this["subGraphWeight"+m][0];d+=q;o=this.layoutTop-this.margin;if(g==0){if(this.showPieGrid){this.drawText(a[f],d-(q/2),o,this.font,this.foreground,"right","middle")}}if(this.showPieSampleLabel){this.drawText(this.xAxis[m],d-(q/1.1),b-(k/5),this.legendFont,this.foreground,"center","middle")}m++}d=this.layoutLeft}}}}}};this.setLayoutGraphAttributes=function(){var g=0;for(var d=0;d<this.layoutRows;d++){for(var b=0;b<this.layoutCols;b++){var e="subGraphType"+g;if(!this[e]){if(this.data.l.type&&this.data.l.type[g]){this[e]=this.data.l.type[g]}else{this[e]=this.graphType}}var f="subSummaryType"+g;if(this[e]=="Boxplot"||this.summaryType=="iqr"){this[f]="iqr"}else{if(this.summaryType=="median"){this[f]="median"}else{if(this.summaryType=="sum"){this[f]="sum"}else{if(this[e]=="Correlation"){this[f]="cor"}else{if(this[e]=="Candlestick"){if((this.graphOrientation=="vertical"&&d>0)||(this.graphOrientation=="horizontal"&&b==0)){this[f]="volume"}else{this[f]="candle"}}else{this[f]="mean"}}}}}var a="subTransformType"+g;if(!this[a]){if(this.data.l.transform&&this.data.l.transform[g]){this[a]=this.data.l.transform[g]}else{this[a]=this.subTransformType}}g++}}};this.setLayoutWeights=function(){if(this.data.l.weight){var e=0;var f=0;var a;var b;if(this.allVsAll){for(var d=0;d<this.layoutRows;d++){a="subGraphWeight"+d;b=this[a]?this[a]:this.data.l.weight[d];e+=b}for(var d=0;d<this.data.l.weight.length;d++){a="subGraphWeight"+d;b=this[a]?this[a]:this.data.l.weight[d];this.data.l.weight[d]=b/e;this[a]=this.data.l.weight[d]}}else{if(this.data.l.vars&&this.data.l.smps){for(var d=0;d<this.data.l.weight.length;d++){a="subGraphWeight"+d;b=this[a]?this[a]:this.data.l.weight[d];e+=b[0];f+=b[1]}for(var d=0;d<this.data.l.weight.length;d++){a="subGraphWeight"+d;b=this[a]?this[a]:this.data.l.weight[d];this.data.l.weight[d][0]=b[0]/e*this.data.l.smps.length;this.data.l.weight[d][1]=b[1]/f*this.data.l.vars.length;this[a]=this.data.l.weight[d]}}else{if(this.graphType=="Pie"){for(var d=0;d<this.data.l.comp.length;d++){a="subGraphWeight"+d;this[a]=this.data.l.weight[d]}}else{for(var d=0;d<this.data.l.weight.length;d++){a="subGraphWeight"+d;b=this[a]?this[a]:this.data.l.weight[d];e+=b}for(var d=0;d<this.data.l.weight.length;d++){a="subGraphWeight"+d;b=this[a]?this[a]:this.data.l.weight[d];this.data.l.weight[d]=b/e;this[a]=this.data.l.weight[d]}}}}}else{if(this.data.l.comp){this.data.l.weight=[];for(var d=0;d<this.data.l.comp.length;d++){a="subGraphWeight"+d;this.data.l.weight[d]=this.data.l.comp.length;this[a]=this.data.l.weight[d]}}else{alert("Wuz going on dude? This aint't gonna work!")}}};this.setMinimumLayoutAxisFonts=function(){var h=0;var e=Number.MAX_VALUE;for(var d=0;d<this.layoutRows;d++){for(var b=0;b<this.layoutCols;b++){var g,f,a;if(this.data.l.desc&&this.data.l.desc[h]){g=this.data.l.desc[h]}else{g="NA"}a=this.graphOrientation=="vertical"?this.height*this["subGraphWeight"+h]:this.width*this["subGraphWeight"+h];this.setAxisFont(g,a);f=this.getFontPt(this.axisTitleFont);if(f<e){e=f;this.minLayoutAxis=e;this.minLayoutAxisTitle=g}h++}}};this.getLayoutSummaryTypes=function(){var g=0;var a={};var e=[];for(var d=0;d<this.layoutRows;d++){for(var b=0;b<this.layoutCols;b++){var f="subSummaryType"+g;if(!a.hasOwnProperty(this[f])){e.push(this[f]);a[this[f]]=true}g++}}return e};this.setLayoutRange=function(){if(this.graphType.match(/Scatter/)){this.xAxis=this.data.y.smps;this.yAxis=this.data.y.smps;this.initAxes(true)}};this.validateLayoutSummaryGrouping=function(){if(this.isGroupedData){var b=this.getLayoutSummaryTypes();for(var a=0;a<b.length;a++){if(!this.isValidPlotData(b[a])){this.groupSamples(this.groupingFactors,b);break}}}};this.resetLayout=function(){delete (this.data.l);delete (this.layoutParams);this.offsetX=0;this.offsetY=0;this.layoutValidN=false;this.layoutValidR=false;this.layoutValidC=false;this.layoutComb=false;this.layout="1X1"};this.drawLayoutCompartments=function(h){var f,e,I,H,p,s,D,u,a;var F=0;var x=0;var B=this.varIndices;var z=this.smpIndices;var w=this.showSampleNames;var r=this.showOverlays;var n=this.showLegend;var d=this.getObjectArray(B);var g=this.getObjectArray(z);var f=this.width;var G=false;var E=["left","right","top","bottom","x","y","width","height","weight","offsetX","offsetY","varIndices","smpIndices","grpIndices","graphType","summaryType","transformType","varIndicesStart","smpIndicesStart","minData","maxData","xAxisMin","xAxisMax","xAxis2Min","xAxis2Max","yAxisMin","yAxisMax","zAxisMin","zAxisMax","xAxisAbsMin","xAxisAbsMax","xAxis2AbsMin","xAxis2AbsMax","yAxisAbsMin","yAxisAbsMax","zAxisAbsMin","zAxisAbsMax","xAxisUnit","xAxis2Unit","yAxisUnit","zAxisUnit","setMin","setMax","setMin2","setMax2","setMinX","setMaxX","setMinY","setMaxY","setMinZ","setMaxZ"];var q=["graphType","transformType","varIndicesStart","smpIndicesStart","setMin","setMax","setMin2","setMax2","setMinX","setMaxX","setMinY","setMaxY","setMinZ","setMaxZ"];var v;if(this.layoutComb){if(!this.graphType.match(/Scatter/)){if(this.data.l.vars){D=0;if(this.data.l.comp){for(var C=0;C<this.data.l.comp.length;C++){D=Math.max(D,this.data.l.comp[C].length)}}this.layoutMaxLegend=D}else{this.layoutMaxLegend=this.varIndices.length}}this.setLayoutDimensions();this.initAxes(false,true);if(this.layoutParams&&this.layoutValidN>-1){v=this.layoutParams;if(v[this.layoutValidN]){for(var C=0;C<E.length;C++){v[this.layoutValidN][E[C]]=this[E[C]]}}}this.offsetX=this.layoutLeft;this.offsetY=this.layoutTop;this.layoutMaxLegendLabel=this.data.l.vars?this.maxVarNameStr:this.maxSmpNameStr;this.layoutParams=[];if(!this.graphType.match(/Scatter/)){if(this.data.l.vars&&this.data.l.smps){this.layoutRows=this.data.l.smps.length;this.layoutCols=this.data.l.vars.length;this.layoutMaxSamples=this.smpIndices.length*this.layoutCols/this.layoutRows;this.legendPosition="bottom"}else{D=Math.max(this.layoutRows,this.layoutCols);if(this.graphType!="Pie"){if(this.graphOrientation=="vertical"){this.layoutRows=D;this.layoutCols=1;this.legendPosition="right"}else{this.layoutRows=1;this.layoutCols=D;this.legendPosition="bottom"}}}}if(this.graphType.match(/Scatter/)&&!this.layoutAdjust){this.setLayoutRange()}this.setLayoutWeights();this.setMinimumLayoutAxisFonts();this.setLayoutGraphAttributes();this.validateLayoutSummaryGrouping();this.drawLabelsLayout();for(var C=0;C<this.layoutRows;C++){for(var A=0;A<this.layoutCols;A++){this.layoutCurrent=F;if(this.graphType=="Pie"){if(this.data.l.smps.length<=F){break}}if(v){for(var y=0;y<q.length;y++){this[q[y]]=v[F][q[y]]}}this.weight=this["subGraphWeight"+F];this.graphType=this["subGraphType"+F];this.summaryType=this["subSummaryType"+F];this.transformType=this["subTransformType"+F];if(this["subTransformType"+F]){this.isTransformedData=true}if(this.data.l.log&&this.data.l.log[F]){this.isLogData=this.data.l.log[F]}if(this.graphType.match(/Scatter/)){if(this.data.l.smps[F].xAxis&&this.data.l.smps[F].yAxis){this.xAxis=this.data.l.smps[F].xAxis;this.yAxis=this.data.l.smps[F].yAxis;this.xAxisIndices=this.getSampleIndices(this.xAxis);this.yAxisIndices=this.getSampleIndices(this.yAxis)}else{this.xAxis=false;this.yAxis=false;this.xAxisIndices=false;this.yAxisIndices=false}this.layoutWidth=(this.width-(this.layoutLeft+this.layoutRight))*this["subGraphWeight"+F];this.layoutHeight=(this.height-(this.layoutTop+this.layoutBottom))*this["subGraphWeight"+F];this.varIndices=this.data.l.comp[F];if(this.graphType.match(/Scatter/)&&this.layoutAdjust&&this.xAxis&&this.yAxis){this.initAxes(true);this.layoutAxis=3}else{if(this.graphType.match(/Scatter/)){this.layoutAxis=A==0?2:0;this.layoutAxis=C==this.layoutRows&&this.layoutAxis?3:C==this.layoutRows?1:0}}}else{if(this.data.l.vars&&this.data.l.smps){G=this.graphOrientation=="vertical"?true:false;this.showLegend=false}else{if(this.graphType=="Pie"){G=false;this.showLegend=false}else{G=this.data.l.smps?true:false}}this.showSampleNames=G;this.showOverlays=G;this.xAxisTitle=this.data.l.desc&&this.data.l.desc[F]?this.data.l.desc[F]:false;if(this.data.l.vars&&this.data.l.smps){this.layoutHeight=(this.height-(this.layoutTop+this.layoutBottom))*this["subGraphWeight"+F][1];this.layoutWidth=(this.width-(this.layoutLeft+this.layoutRight))*this["subGraphWeight"+F][0];a=[];for(var y=0;y<this.data.l.comp[F][0].length;y++){if(d.hasOwnProperty(this.data.l.comp[F][0][y])){a.push(this.data.l.comp[F][0][y])}}this.varIndices=a;a=[];for(var y=0;y<this.data.l.comp[F][1].length;y++){if(g.hasOwnProperty(this.data.l.comp[F][1][y])){a.push(this.data.l.comp[F][1][y])}}this.smpIndices=a}else{if(this.graphType=="Pie"){this.layoutWidth=(this.width-(this.layoutLeft+this.layoutRight))*this["subGraphWeight"+F][0];this.layoutHeight=(this.height-(this.layoutTop+this.layoutBottom))*this["subGraphWeight"+F][1]}else{if(this.graphOrientation=="vertical"){this.layoutHeight=(this.height-(this.layoutTop+this.layoutBottom))*this["subGraphWeight"+F];this.layoutWidth=this.width-(this.layoutLeft+this.layoutRight)}else{this.layoutWidth=(this.width-(this.layoutLeft+this.layoutRight))*this["subGraphWeight"+F];this.layoutHeight=this.height-(this.layoutTop+this.layoutBottom)}}a=[];if(this.data.l.vars){for(var y=0;y<this.data.l.comp[F].length;y++){if(d.hasOwnProperty(this.data.l.comp[F][y])){a.push(this.data.l.comp[F][y])}}this.varIndices=a}else{for(var y=0;y<this.data.l.comp[F].length;y++){if(g.hasOwnProperty(this.data.l.comp[F][y])){a.push(this.data.l.comp[F][y])}}this.smpIndices=a}}if(this.layoutAdjust){this.layoutAxis=3;this.initAxes(true)}}h.call(this);this["subGraphTop"+F]=this.top;this["subGraphBottom"+F]=this.bottom;this["subGraphRight"+F]=this.right;this["subGraphLeft"+F]=this.left;this["subGraphX"+F]=this.x;this["subGraphY"+F]=this.y;var o=["rect",this.offsetX+this.left,this.offsetY+this.top,this.offsetX+this.left+this.x,this.offsetY+this.top+this.y];if(this.graphType.match(/Scatter/)){if(C==A){var t=this.scaleTextToFont(this.maxSmpNameStr,this.maxTextSize,(this.layoutWidth-(this.layoutLeft+this.layoutRight)));this.drawText(this.data.y.smps[C],this.offsetX+this.left+(this.x/2),this.offsetY+this.top+(this.y/2),t,this.foreground,"center","middle")}else{this.addGlobalArea(o,true)}}else{if(!G){this.addGlobalArea(o,true);if(this.data.l.vars&&this.data.l.smps){if(this.graphOrientation!="vertical"&&F%this.data.l.vars.length==0){this.drawLayoutSampleOverlays(z)}if(F>=this.data.l.vars.length*(this.data.l.smps.length-1)){this.drawLayoutVariableLegend()}}else{if(this.graphType!="Pie"){if((this.graphOrientation=="vertical"&&(F+1)==D)||(this.graphOrientation!="vertical"&&F==0)){this.drawLayoutSampleOverlays(z)}}else{if(this.graphType=="Pie"&&F==0){this.drawLayoutVariableLegend()}}}}else{if(this.data.l.vars&&this.data.l.smps){this.addGlobalArea(o,true);if(F>=this.data.l.vars.length*(this.data.l.smps.length-1)){this.drawLayoutVariableLegend()}}}}var b={};for(var y=0;y<E.length;y++){b[E[y]]=this[E[y]]}b.width=this.layoutWidth;b.height=this.layoutHeight;b.subGraphType=this.graphType;b.subSummaryType=this.SummaryType;b.subTransformType=this.transformType;this.layoutParams.push(b);if(this.graphType.match(/Scatter/)||(this.data.l.vars&&this.data.l.smps)){this.offsetX+=this.layoutWidth}else{if(this.graphOrientation=="vertical"){this.offsetY+=this.layoutHeight}else{this.offsetX+=this.layoutWidth}}F++}if(this.graphType.match(/Scatter|Pie/)||(this.data.l.vars&&this.data.l.smps)){this.offsetX=this.layoutLeft;this.offsetY+=this.layoutHeight}}this.drawLayoutResizer();this.varIndices=B;this.smpIndices=z;this.showSampleNames=w;this.showOverlays=r;this.showLegend=n}else{this.scaleX=1/this.layoutCols;this.scaleY=1/this.layoutRows;this.ctx.save();this.ctx.scale(this.scaleX,this.scaleY);H=0;e=this.height;for(var C=0;C<this.layoutRows;C++){this.translateY=this.height*C;f=this.width;I=0;for(var A=0;A<this.layoutCols;A++){this.translateX=this.width*A;if(this.data.l.comp.length>F){if(A==0&&this.layoutCols==1){this.layoutAxis=3}else{if(C==0&&this.layoutCols>1){this.layoutAxis=1}else{if(C==this.layoutRows-1){this.layoutAxis=2}else{this.layoutAxis=0}}}this.varIndices=this.data.l.comp[F];if(this.layoutAdjust){this.layoutAxis=3;this.initAxes(true)}if(this.data.l.type&&this.data.l.type[F]){this.graphType=this.data.l.type[F]}h.call(this);I+=parseFloat(f);this.ctx.translate(I,0);if(this.layoutCols>2){f/=Math.pow(this.layoutCols+1,this.layoutCols+1)}else{f/=Math.pow(this.layoutCols+4,this.layoutCols+4)}if(this.layoutMulticolor){this.colors.push(this.colors.shift())}F++}}H+=parseFloat(e);this.ctx.translate(-I*this.layoutCols,H);e/=Math.pow(this.layoutRows+1,this.layoutRows+1)}this.ctx.restore();this.ctx.translate(-I*(this.layoutCols-1),-H*(this.layoutRows-1));this.ctx.scale(this.layoutCols,this.layoutRows);this.varIndices=B;if(this.layoutMulticolor){for(var C=0;C<F;C++){this.colors.unshift(this.colors.pop())}}}};this.initializeLayout=function(){this.isValidLayout()};this.initializeLayout()};CanvasXpress.prototype.initConfigurator=function(){this.addConfigurator=function(a){return function(g,d){if(a.isVML||a.disableConfigurator){return}a.configuringOn=true;if(d){a.configuringNetwork=d}var p=a.adjustedCoordinates(g);if(p){var n=p.x;var m=p.y;var h=document.getElementById(a.target+"canvasXpressConfigurator");var f=document.getElementById(a.target+"canvasXpressConfiguratorKey");if(h){h.style.display="block";h.style.left=n+"px";h.style.top=m+"px";setTimeout(function(){f.focus()},300);return}else{h=document.createElement("div")}f=document.createElement("input");var q=document.createElement("select");var o=document.createElement("input");var j=document.createElement("input");h.id=a.target+"canvasXpressConfigurator";h.style.left=n+"px";h.style.top=m+"px";h.style.position="absolute";f.id=a.target+"canvasXpressConfiguratorKey";f.type="text";f.style.display="block";q.id=a.target+"canvasXpressConfiguratorSugestions";q.style.display="none";a.addEvtListener(q,"change",a.clickSelect,false);a.addEvtListener(q,"click",a.clickSelect,false);o.id=a.target+"canvasXpressConfiguratorValue";o.type="text";o.style.display="none";j.id=a.target+"canvasXpressConfiguratorButton";j.value="Draw";j.type="button";j.style.display="none";a.addEvtListener(j,"click",a.handleSelect,false);h.appendChild(f);h.appendChild(q);h.appendChild(o);h.appendChild(j);a.canvas.parentNode.appendChild(h);setTimeout(function(){f.focus()},300)}}}(this);this.selectConfig=function(j){var m;var g=document.getElementById(this.target+"canvasXpressConfiguratorSugestions");var b=document.getElementById(this.target+"canvasXpressConfiguratorKey");var a=document.getElementById(this.target+"canvasXpressConfiguratorValue");var h=[];if(this.configuringNetwork){m=this.configuringNetwork<this.data.nodes.length?this.data.nodes[this.configuringNetwork]:this.data.edges[this.configuringNetwork-this.data.nodes.length]}else{m=this}if(b&&a&&a.value&&m.hasOwnProperty(b.value)){if(this.getKeyCode(j)==13){if(typeof(this[b.value])=="function"){this.resetConfigurator();this[b.value]()}else{m[b.value]=JSON.parse(a.value);this.resetConfigurator();this.draw()}}else{return}}this.resetSugestions();if(this.configuringNetwork){for(var f in m){if(f.toLowerCase().indexOf(b.value.toLowerCase())>=0){h.push(f)}}}else{for(var f=0;f<this.config.length;f++){if(this.config[f].toLowerCase().indexOf(b.value.toLowerCase())>=0){h.push(this.config[f])}}for(var f=0;f<this.functions.length;f++){if(this.functions[f].toLowerCase().indexOf(b.value.toLowerCase())>=0){h.push(this.functions[f])}}}if(h.length>0){if(h.length==1){b.value=h[0];this.resetSugestions();this.configureSelect()}else{h.sort();var f=document.getElementById(this.target+"canvasXpressImage");f.style.zIndex=0;for(var f=0;f<h.length;f++){var m=document.createElement("option");m.text=h[f];m.value=h[f];try{g.add(m,null)}catch(d){g.add(m)}}g.style.display="block";g.size=Math.min(h.length,5)}}return false};this.resetSugestions=function(){var e=document.getElementById(this.target+"canvasXpressConfiguratorSugestions");var d=document.getElementById(this.target+"canvasXpressConfiguratorValue");var a=document.getElementById(this.target+"canvasXpressConfiguratorButton");if(e){if(e.hasChildNodes()){while(e.childNodes.length>=1){e.removeChild(e.firstChild)}}e.style.display="none"}if(d){d.value="";d.style.display="none"}if(a){a.style.display="none"}};this.clickSelect=function(a){return function(f){var b=document.getElementById(a.target+"canvasXpressConfiguratorKey");var d=document.getElementById(a.target+"canvasXpressConfiguratorSugestions");b.value=d.value;a.resetSugestions();a.configureSelect();return false}}(this);this.configureSelect=function(){var e=document.getElementById(this.target+"canvasXpressConfiguratorKey");var d=document.getElementById(this.target+"canvasXpressConfiguratorValue");var a=document.getElementById(this.target+"canvasXpressConfiguratorButton");if(e&&d&&a){d.style.display="block";a.style.display="block";if(this.configuringNetwork){if(typeof(this[e.value])=="function"){d.style.display="none"}else{if(this.configuringNetwork<this.data.nodes.length){d.value=JSON.stringify(this.data.nodes[this.configuringNetwork][e.value])}else{d.value=JSON.stringify(this.data.edges[this.configuringNetwork-this.data.nodes.length][e.value])}}}else{if(typeof(this[e.value])=="function"){d.style.display="none"}else{d.value=JSON.stringify(this[e.value])}}setTimeout(function(){d.focus();d.select()},300)}};this.handleSelect=function(a){return function(f){var d=document.getElementById(a.target+"canvasXpressConfiguratorKey");var b=document.getElementById(a.target+"canvasXpressConfiguratorValue");if(d&&b){if(a.configuringNetwork){if(a.configuringNetwork<a.data.nodes.length){if(typeof(a[d.value])=="function"){a[d.value](a.data.nodes[a.configuringNetwork])}else{a.data.nodes[a.configuringNetwork][d.value]=JSON.parse(b.value)}}else{if(typeof(a[d.value])=="function"){a[d.value](a.data.edges[a.configuringNetwork-a.data.nodes.length])}else{a.data.edges[a.configuringNetwork-a.data.nodes.length][d.value]=JSON.parse(b.value)}}}else{if(typeof(a[d.value])=="function"){a[d.value]()}else{a[d.value]=JSON.parse(b.value)}}d.value="";b.value="";a.resetConfigurator();a.draw()}return false}}(this);this.resetConfigurator=function(){var b=document.getElementById(this.target+"canvasXpressImage");var d=document.getElementById(this.target+"canvasXpressConfigurator");var a=document.getElementById(this.target+"canvasXpressConfiguratorKey");if(b&&d){this.resetSugestions();b.style.zIndex=9000;if(a){a.value=""}d.style.display="none";this.configuringOn=false;this.configuringNetwork=false}}};CanvasXpress.prototype.initDataTable=function(){this.addDataTable=function(){if(document.getElementById(this.target+"canvasXpressTable")){return}var e=function(n,h,b,j){var o=j?document.createElement("th"):document.createElement("td");o.innerHTML=h;o.style.padding="2px 5px";o.style.margin="2px 5px";o.style.border="1px solid";if(b){o["class"]=b}n.appendChild(o)};var g=document.createElement("table");var k=document.createElement("thead");var a=document.createElement("tbody");var m=document.createElement("tr");g.id=this.target+"canvasXpressTable";g.style.border="1px solid";g.style.borderCollapse="collapse";g.style.fontSize="x-small";e(m,"","b");if(this.data.x){for(var f in this.data.x){e(m,f,"x",true)}}for(var f=0;f<this.data.y.vars.length;f++){e(m,this.data.y.vars[f],"v",true)}k.appendChild(m);if(this.data.z){m=document.createElement("tr");for(var f in this.data.z){e(m,f,"z",true);if(this.data.z){for(var d in this.data.z){e(m,"","b")}}for(var d=0;d<this.data.y.vars.length;d++){e(m,this.data.z[f][d],"z")}}k.appendChild(m)}for(var f=0;f<this.data.y.smps.length;f++){m=document.createElement("tr");e(m,this.data.y.smps[f],"s",true);if(this.data.x){for(var d in this.data.x){e(m,this.data.x[d][f],"x")}}for(var d=0;d<this.data.y.vars.length;d++){e(m,this.data.y.data[d][f])}a.appendChild(m)}g.appendChild(k);g.appendChild(a);this.canvas.parentNode.appendChild(g)};this.resetDataTable=function(){this.removeTarget(this.target+"canvasXpressTable")};this.hideUnhideDataTable=function(){var a=document.getElementById(this.target+"canvasXpressTable");if(a){if(a.style.display=="block"){a.style.display="none"}else{a.style.display="block"}}}};CanvasXpress.prototype.initDendrogramEvents=function(){this.modifyDendrogram=function(h){var f=h.t.t=="varDendrogram"?this.varIndicesStart:this.smpIndicesStart;var d=h.t.t.replace("Dendrogram","s");var g=this[h.t.t].object;var j=h.t.d+"-"+h.t.o;var e=this.findDendrogramBranch(g,j);var b=this.reverseDendrogramBranch(e);var a=this.writeNewick(g,true);this.data.t[d]=a;this.draw()};this.findDendrogramBranch=function(b,d,a){if(b.id==d){a=b}if(!a){if(b.left){a=this.findDendrogramBranch(b.left,d,a)}if(b.right){a=this.findDendrogramBranch(b.right,d,a)}}else{return a}return a};this.reverseDendrogramBranch=function(b){if(b&&b.right&&b.left){b.right=this.reverseDendrogramBranch(b.right);b.left=this.reverseDendrogramBranch(b.left);var a=b.left;b.left=b.right;b.right=a;if(b.mid){b.mid=b.mid.reverse()}}return b}};CanvasXpress.prototype.initSelectEvents=function(){this.showHideSelectedDataPoint=function(f,j){this.stopEvent(f);if(j==45||j==46){var g=this.layoutComb?this.layoutValidN:0;var d=this.layoutComb?this.layoutParams[g].graphType:this.graphType;if(d=="Network"){var b=[];var a=j==45?false:true;for(var h in this.selectNode){b.push(h)}if(b.length>0){this.hideUnhideNodes(b,a)}}else{if(d.match(/Scatter/)){if(j==45){this.selectDataPoint=this.hideDataPoint;this.hideDataPoint=[]}else{this.hideDataPoint=this.selectDataPoint;this.selectDataPoint=[]}}}this.draw()}};this.addRemoveToSelectedDataPoints=function(h,f){var b=this.isBroadcasting?CanvasXpress.references:[this];for(var e=0;e<b.length;e++){var g=b[e];if(!h){var j=g.layoutComb?g.layoutValidN:0;h=g.layoutComb?g.layoutParams[j].graphType:g.graphType}if(h=="Network"){var a=parseInt(f.join(", "));if(a<g.data.nodes.length){var d=g.data.nodes[a].id;if(g.selectNode.hasOwnProperty(d)){g.isSelectNodes--;delete g.selectNode[d]}else{g.isSelectNodes++;g.selectNode[d]=true}}}else{if(h.match(/Scatter/)){var d;if(!g.selectDataPoint[f[0]]){g.selectDataPoint[f[0]]={}}if(h=="Scatter3D"){d=f[1]+":"+f[2]+":"+f[3]}else{d=f[1]+":"+f[2]}if(g.selectDataPoint[f[0]].hasOwnProperty(d)){g.isSelectDataPoints--;delete g.selectDataPoint[f[0]][d]}else{g.isSelectDataPoints++;g.selectDataPoint[f[0]][d]=true}}}}};this.resetSelectedDataPoints=function(){if(this.isSelectDataPoints){this.selectDataPoint=[];this.hideDataPoint=[];this.isSelectDataPoints=0}};this.resetSelectedNodes=function(){if(this.isSelectNodes){this.selectNode={};this.isSelectNodes=0}}};CanvasXpress.prototype.initKeyEvents=function(){this.isInFocus=function(){var b=document.activeElement;var a=b.getElementsByTagName("img");if(!a||a.length==0){a=b.parentNode.getElementsByTagName("img")}if(!a||a.length==0){a=b.parentNode.parentNode.getElementsByTagName("img")}for(i=0;i<a.length;i++){if(a[i].id.match(this.target)){return true}}return false};this.isInView=function(f){if(!this.isInFocus()){return false}var d=f.offsetTop;var b=f.offsetLeft;var a=f.offsetWidth;var e=f.offsetHeight;while(f.offsetParent){f=f.offsetParent;d+=f.offsetTop;b+=f.offsetLeft}return(d<(window.pageYOffset+window.innerHeight)&&b<(window.pageXOffset+window.innerWidth)&&(d+e)>window.pageYOffset&&(b+a)>window.pageXOffset)};this.getKeyCode=function(a){if(a){if((a.charCode)&&(a.keyCode==0)){return a.charCode}else{return a.keyCode}}};this.registerKey=function(a){if(!a){a=window.event}var b=this.getKeyCode(a);if(this.eventKeys||(a.ctrlKey&&a.altKey&&b==107)){if(b==27){if(this.animationOn){this.animationOn=false;return false}this.masterReset(a)}else{if(this.configuringOn){return}else{if(b==16){if(a.ctrlKey&&a.altKey){this.showCtrlShiftAltShorts()}else{if(a.ctrlKey){this.showCtrlShiftShorts()}else{if(a.altKey){this.showShiftAltShorts()}else{this.showShiftShorts()}}}}else{if(b==17){if(a.shiftKey&&a.altKey){this.showCtrlShiftAltShorts()}else{if(a.shiftKey){this.showCtrlShiftShorts()}else{if(a.altKey){this.showCtrlAltShorts()}else{this.showCtrlShorts()}}}}else{if(b==18||b==224){if(a.ctrlKey&&a.shiftKey){this.showCtrlShiftAltShorts()}else{if(a.ctrlKey){this.showCtrlAltShorts()}else{if(a.shiftKey){this.showShiftAltShorts()}else{this.showAltShorts()}}}}else{if(a.ctrlKey&&a.shiftKey){if(b==80){this.print()}if(b>=33&&b<=40){this.arrowMove(b,true)}else{if(b==90&&this.graphType=="Network"){this.alignDistributeSelectedNodes(a,b)}}document.defaultAction=true}else{if(a.ctrlKey&&a.altKey){if(b==80){this.print()}document.defaultAction=true}else{if(a.shiftKey&&a.altKey){if(b>=50&&b<90){this.setGraphType(b)}document.defaultAction=true}else{if(a.ctrlKey){if(b>=33&&b<=40){this.arrowMove(b)}else{if(b==45||b==46){this.showHideSelectedDataPoint(a,b)}else{if(b>=48&&b<58){this.setLayout(b-48)}else{if(b>=65&&b<=90){if(b==80){this.print()}if(this.graphType=="Network"){this.alignDistributeSelectedNodes(a,b)}}}}}document.defaultAction=true}else{if(b==107||b==109||b==61||b==187||b==189){if(b==109||b==189){this.handleWheelEvent(a,-1)}else{this.handleWheelEvent(a,1)}}else{if(b>=33&&b<=40){this.handlePanning(a,b)}else{if(a.shiftKey){document.defaultAction=true}else{if(a.altKey){document.defaultAction=true}}}}}}}}}}}}}}};this.handlePanning=function(b,h){if(this.graphType=="Network"){this.cancelEvent(b);var k=Math.abs(this.x*this.panningStep);var j=Math.abs(this.y*this.panningStep);if(h==33){this.panningY-=j*5}else{if(h==34){this.panningY+=j*5}else{if(h==35){this.panningX=k*20;this.panningY=j*20}else{if(h==36){this.panningX=0;this.panningY=0}else{if(h==37){this.panningX-=k}else{if(h==38){this.panningY-=j}else{if(h==39){this.panningX+=k}else{if(h==40){this.panningY+=j}}}}}}}}this.draw(false,false,false,true)}else{if(this.graphType=="Heatmap"){this.cancelEvent(b);var f=this.layoutComb?this.layoutValidN:0;var o;var m=this.layoutComb?this.layoutParams[f].varIndices:this.varIndices;if(this.isGroupedData){o=this.layoutComb?this.layoutParams[f].grpIndices:this.grpIndices}else{o=this.layoutComb?this.layoutParams[f].smpIndices:this.smpIndices}this.setOriginalIndices(h,m,o);if(h==35){return false}else{if(h==36){this.varIndicesStart=-1;this.smpIndicesStart=-1;this.varIndices=this.startingVarIndices[f];if(this.isGroupedData){this.grpIndices=this.startingSmpIndices[f]}else{this.smpIndices=this.startingSmpIndices[f]}this.draw()}else{if(h==37){if(this.varIndicesStart>0){this.varIndices.unshift(this.startingVarIndices[f][this.varIndicesStart-1]);this.varIndices.pop();this.varIndicesStart--;this.draw()}}else{if(h==38||h==33){var n=h==33?5:1;var g=false;for(var a=0;a<n;a++){if(this.smpIndicesStart>0){this.smpIndices.unshift(this.startingSmpIndices[f][this.smpIndicesStart-1]);this.smpIndices.pop();this.smpIndicesStart--;g=true}}if(g){this.draw()}}else{if(h==39){if(this.varIndicesStart>-1&&this.varIndicesStart+m.length<this.startingVarIndices[f].length){this.varIndices.push(this.startingVarIndices[f][this.varIndices.length]);this.varIndices.shift();this.varIndicesStart++;this.draw()}}else{if(h==40||h==34){var n=h==34?5:1;var g=false;for(var a=0;a<n;a++){if(this.smpIndicesStart>-1&&this.smpIndicesStart+o.length<this.startingSmpIndices[f].length){this.smpIndices.push(this.startingSmpIndices[f][this.smpIndices.length]);this.smpIndices.shift();this.smpIndicesStart++;g=true}}if(g){this.draw()}}}}}}}}}return false};this.showCtrlShiftAltShorts=function(){var a="<table class=shorts>";a+="<tr><th colspan=2>Ctrl + Shift + Alt</th></tr>";a+="<tr><td class=k>&nbsp;</td><td class=d>&nbsp;</td></tr>";a+="</table>";this.showInfoSpan(false,a)};this.showCtrlShiftShorts=function(){var a="<table class=shorts>";a+="<tr><th colspan=2>Shift + Ctrl</th></tr>";if(this.graphType=="Network"){if(this.is3DNetwork){a+="<tr><td class=k>&rarr;</td><td class=d>Rotate clockwise "+(this.rotationStep*1)+"&deg; continuously</td></tr>";a+="<tr><td class=k>&larr;</td><td class=d>Rotate anti-clockwise "+(this.rotationStep*1)+"&deg; continuously</td></tr>";a+="<tr><td class=k>&darr;</td><td class=d>Rotate forward "+(this.rotationStep*1)+"&deg; continuously</td></tr>";a+="<tr><td class=k>&uarr;</td><td class=d>Rotate backward "+(this.rotationStep*1)+"&deg; continuously</td></tr>";a+="<tr><td class=k>PgUp</td><td class=d>Rotate anti-clockwise and backward "+(this.rotationStep*3)+"&deg; continuously</td></tr>";a+="<tr><td class=k>PgDn</td><td class=d>Rotate clockwise and forward "+(this.rotationStep*3)+"&deg; continuously</td></tr>"}else{a+="<tr><td class=k>&rarr; or &darr;</td><td class=d>Rotate clockwise "+(this.rotationStep*1)+"&deg; continuously</td></tr>";a+="<tr><td class=k>&larr; or &uarr;</td><td class=d>Rotate anti-clockwise "+(this.rotationStep*1)+"&deg; continuously</td></tr>";a+="<tr><td class=k>PgUp</td><td class=d>Rotate anti-clockwise "+(this.rotationStep*3)+"&deg; continuously</td></tr>";a+="<tr><td class=k>PgDn</td><td class=d>Rotate clockwise "+(this.rotationStep*3)+"&deg; continuously</td></tr>"}}else{if(this.graphType=="Scatter2D"||this.graphType=="ScatterBubble2D"){if(this.type2D=="XYZ"){if(this.xAxis.length>1){a+="<tr><td class=k>&rarr; or &darr; or &larr; or &uarr;</td><td class=d>Update samples in X, Y and Z axes continuously (1x)</td></tr>";a+="<tr><td class=k>PgUp or PgDn</td><td class=d>Update samples in X, Y and Z axes continuously (2x)</td></tr>"}}else{if(this.type2D=="XY"){if(this.zAxis.length>1){a+="<tr><td class=k>&rarr; or &darr; or &larr; or &uarr;</td><td class=d>Update sample in Z axis continuously (1x)</td></tr>";a+="<tr><td class=k>PgUp or PgDn</td><td class=d>Update sample in Z axis continuously (2x)</td></tr>"}}else{if(this.type2D=="X"){if(this.yAxis.length>1){a+="<tr><td class=k>&rarr; or &darr; or &larr; or &uarr;</td><td class=d>Update samples in Y and Z axes continuously (1x)</td></tr>";a+="<tr><td class=k>PgUp or PgDn</td><td class=d>Update samples in Y and Z axes continuously (2x)</td></tr>"}}else{if(this.xAxis.length>1){a+="<tr><td class=k>&rarr; or &darr; or &larr; or &uarr;</td><td class=d>Update samples in X and Z axes continuously (1x)</td></tr>";a+="<tr><td class=k>PgUp or PgDn</td><td class=d>Update samples in X and Z axes continuously (2x)</td></tr>"}}}}}else{if(this.graphType=="Scatter3D"){a+="<tr><td class=k>&rarr; or &darr; or &larr; or &uarr;</td><td class=d>Rotate continuously</td></tr>";a+="<tr><td class=k>PgUp or PgDn</td><td class=d>Rotate continuously</td></tr>"}else{if(this.isSegregable()){a+="<tr><td class=k>Click and Drag</td><td class=d>Select Samples</td></tr>"}}}}a+="<tr><td class=k>P</td><td class=d>Print</td></tr>";a+="</table>";this.showInfoSpan(false,a)};this.showCtrlAltShorts=function(){var a="<table class=shorts>";a+="<tr><th colspan=2>Ctrl + Alt</th></tr>";a+="<tr><td class=k>P</td><td class=d>Print</td></tr>";a+="</table>";this.showInfoSpan(false,a)};this.showShiftAltShorts=function(){var a="<table class=shorts>";a+="<tr><th colspan=2>Shift + Alt</th></tr>";a+="<tr><td class=k>2</td><td class=d>Scatter2D</td></tr>";a+="<tr><td class=k>3</td><td class=d>Scatter3D</td></tr>";a+="<tr><td class=k>4</td><td class=d>ScatterBubble2D</td></tr>";a+="<tr><td class=k>A</td><td class=d>Area</td></tr>";a+="<tr><td class=k>B</td><td class=d>Bar</td></tr>";a+="<tr><td class=k>C</td><td class=d>BarLine</td></tr>";a+="<tr><td class=k>D</td><td class=d>Dotplot</td></tr>";a+="<tr><td class=k>G</td><td class=d>Genome</td></tr>";a+="<tr><td class=k>H</td><td class=d>Heatmap</td></tr>";a+="<tr><td class=k>I</td><td class=d>Boxplot</td></tr>";a+="<tr><td class=k>L</td><td class=d>Line</td></tr>";a+="<tr><td class=k>M</td><td class=d>Candlestick</td></tr>";a+="<tr><td class=k>N</td><td class=d>Network</td></tr>";a+="<tr><td class=k>P</td><td class=d>Pie</td></tr>";a+="<tr><td class=k>S</td><td class=d>Stacked</td></tr>";a+="<tr><td class=k>U</td><td class=d>StackedLine</td></tr>";a+="<tr><td class=k>T</td><td class=d>StackedPercent</td></tr>";a+="<tr><td class=k>W</td><td class=d>StackedPercentLine</td></tr>";a+="<tr><td class=k>V</td><td class=d>Venn</td></tr>";a+="<tr><td class=k>X</td><td class=d>Correlation</td></tr>";a+="</table>";this.showInfoSpan(false,a)};this.showCtrlShorts=function(){var a="<table class=shorts>";a+="<tr><th colspan=2>Ctrl</th></tr>";if(this.graphType=="Network"){if(this.is3DNetwork){a+="<tr><td class=k>&rarr;</td><td class=d>Rotate clockwise "+(this.rotationStep*1)+"&deg;</td></tr>";a+="<tr><td class=k>&larr;</td><td class=d>Rotate anti-clockwise "+(this.rotationStep*1)+"&deg;</td></tr>";a+="<tr><td class=k>&darr;</td><td class=d>Rotate forward "+(this.rotationStep*1)+"&deg;</td></tr>";a+="<tr><td class=k>&uarr;</td><td class=d>Rotate backward "+(this.rotationStep*1)+"&deg;</td></tr>";a+="<tr><td class=k>PgUp</td><td class=d>Rotate anti-clockwise and backward "+(this.rotationStep*3)+"&deg;</td></tr>";a+="<tr><td class=k>PgDn</td><td class=d>Rotate clockwise and forward "+(this.rotationStep*3)+"&deg;</td></tr>"}else{a+="<tr><td class=k>&rarr; or &darr;</td><td class=d>Rotate clockwise "+(this.rotationStep*1)+"&deg;</td></tr>";a+="<tr><td class=k>&larr; or &uarr;</td><td class=d>Rotate anti-clockwise "+(this.rotationStep*1)+"&deg;</td></tr>";a+="<tr><td class=k>PgUp</td><td class=d>Rotate anti-clockwise "+(this.rotationStep*3)+"&deg;</td></tr>";a+="<tr><td class=k>PgDn</td><td class=d>Rotate clockwise "+(this.rotationStep*3)+"&deg;</td></tr>"}a+="<tr><td class=k>click</td><td class=d>Select/Unselect node</td></tr>";if(this.isSelectNodes){a+="<tr><td class=k>Delete</td><td class=d>Hide selected nodes</td></tr>";a+="<tr><td class=k>Insert</td><td class=d>Show selected-hidden nodes</td></tr>";a+="<tr><td class=k>t</td><td class=d>Align top</td></tr>";a+="<tr><td class=k>r</td><td class=d>Align right</td></tr>";a+="<tr><td class=k>b</td><td class=d>Align bottom</td></tr>";a+="<tr><td class=k>l</td><td class=d>Align left</td></tr>";a+="<tr><td class=k>v</td><td class=d>Distribute verticaly</td></tr>";a+="<tr><td class=k>h</td><td class=d>Distribute Horizontaly</td></tr>";a+="<tr><td class=k>z</td><td class=d>Undo</td></tr>";a+="<tr><td class=k>y</td><td class=d>Redo</td></tr>"}}else{if(this.graphType=="Scatter2D"||this.graphType=="ScatterBubble2D"){if(this.type2D=="XYZ"){if(this.xAxis.length>1){a+="<tr><td class=k>&rarr; or &darr; or &larr; or &uarr;</td><td class=d>Update samples in X, Y and Z axes (1x)</td></tr>";a+="<tr><td class=k>PgUp or PgDn</td><td class=d>Update samples in X, Y and Z axes (2x)</td></tr>"}}else{if(this.type2D=="XY"){if(this.zAxis.length>1){a+="<tr><td class=k>&rarr; or &darr; or &larr; or &uarr;</td><td class=d>Update sample in Z axis (1x)</td></tr>";a+="<tr><td class=k>PgUp or PgDn</td><td class=d>Update sample in Z axis (2x)</td></tr>"}}else{if(this.type2D=="X"){if(this.yAxis.length>1){a+="<tr><td class=k>&rarr; or &darr; or &larr; or &uarr;</td><td class=d>Update samples in Y and Z axes (1x)</td></tr>";a+="<tr><td class=k>PgUp or PgDn</td><td class=d>Update samples in Y and Z axes (2x)</td></tr>"}}else{if(this.xAxis.length>1){a+="<tr><td class=k>&rarr; or &darr; or &larr; or &uarr;</td><td class=d>Update samples in X and Z axes (1x)</td></tr>";a+="<tr><td class=k>PgUp or PgDn</td><td class=d>Update samples in X and Z axes (2x)</td></tr>"}}}}if(this.isSelectDataPoints){a+="<tr><td class=k>Delete</td><td class=d>Hide selected nodes</td></tr>";a+="<tr><td class=k>Insert</td><td class=d>Show selected-hidden nodes</td></tr>"}}else{if(this.graphType=="Scatter3D"){a+="<tr><td class=k>&rarr;</td><td class=d>Rotate clockwise "+(this.rotationStep*1)+"&deg;</td></tr>";a+="<tr><td class=k>&larr;</td><td class=d>Rotate anti-clockwise "+(this.rotationStep*1)+"&deg;</td></tr>";a+="<tr><td class=k>&darr;</td><td class=d>Rotate forward "+(this.rotationStep*1)+"&deg;</td></tr>";a+="<tr><td class=k>&uarr;</td><td class=d>Rotate backward "+(this.rotationStep*1)+"&deg;</td></tr>";a+="<tr><td class=k>PgUp</td><td class=d>Rotate anti-clockwise and backward "+(this.rotationStep*3)+"&deg;</td></tr>";a+="<tr><td class=k>PgDn</td><td class=d>Rotate clockwise and forward "+(this.rotationStep*3)+"&deg;</td></tr>";a+="<tr><td class=k>click</td><td class=d>Select/Unselect data points</td></tr>";if(this.isSelectDataPoints){a+="<tr><td class=k>Delete</td><td class=d>Hide selected nodes</td></tr>";a+="<tr><td class=k>Insert</td><td class=d>Show selected-hidden nodes</td></tr>"}}else{if(this.isSegregable()){a+="<tr><td class=k>1 - 9</td><td class=d>Number of columns to plot individual variables</td></tr>";a+="<tr><td class=k>0</td><td class=d>Reset layout</td></tr>"}}}}a+="<tr><td class=k>P</td><td class=d>Print</td></tr>";a+="</table>";this.showInfoSpan(false,a)};this.showShiftShorts=function(){var a="<table class=shorts>";a+="<tr><th colspan=2>Shift</th></tr>";a+="<tr><td class=k>&nbsp;</td><td class=d>&nbsp;</td></tr>";a+="</table>";this.showInfoSpan(false,a)};this.showAltShorts=function(){var a="<table class=shorts>";a+="<tr><th colspan=2>Alt</th></tr>";if(this.graphType=="Network"){a+="<tr><td class=k>left-click node</td><td class=d>Configure Node</td></tr>"}a+="</table>";this.showInfoSpan(false,a)};this.arrowMove=function(g,b){switch(this.graphType){case"Network":if(this.is3DNetwork){if(g==33){this.xRotate+=(this.rotationStep*3);this.yRotate-=(this.rotationStep*3)}else{if(g==34){this.xRotate-=(this.rotationStep*3);this.yRotate+=(this.rotationStep*3)}else{if(g==37){this.xRotate+=this.rotationStep}else{if(g==38){this.yRotate-=this.rotationStep}else{if(g==39){this.xRotate-=this.rotationStep}else{if(g==40){this.yRotate+=this.rotationStep}}}}}}}else{if(g==33){this.network2DRotate-=(this.rotationStep*3)}else{if(g==34){this.network2DRotate+=(this.rotationStep*3)}else{if(g==37||g==38){this.network2DRotate-=this.rotationStep}else{if(g==39||g==40){this.network2DRotate+=this.rotationStep}}}}}break;case"Scatter2D":case"ScatterBubble2D":var e;var f;if(this.type2D=="XYZ"){e=["xAxisCurrent","yAxisCurrent","zAxisCurrent"];f=["xAxis","yAxis","zAxis"]}else{if(this.type2D=="XY"){e=["zAxisCurrent"];f=["zAxis"]}else{if(this.type2D=="X"){e=["yAxisCurrent","zAxisCurrent"];f=["yAxis","zAxis"]}else{e=["xAxisCurrent","zAxisCurrent"];f=["xAxis","zAxis"]}}}if(g==33){for(var d=0;d<e.length;d++){this[e[d]]+=2}}else{if(g==34){for(var d=0;d<e.length;d++){this[e[d]]-=2}}else{if(g==35){for(var d=0;d<e.length;d++){this[e[d]]=this[f[d]].length-1}}else{if(g==36){for(var d=0;d<e.length;d++){this[e[d]]=0}}else{if(g==37||g==40){for(var d=0;d<e.length;d++){this[e[d]]--}}else{if(g==38||g==39){for(var d=0;d<e.length;d++){this[e[d]]++}}}}}}}this.xAxisCurrent=this.xAxisCurrent<0?this.xAxis.length-1:this.xAxisCurrent>this.xAxis.length-1?0:this.xAxisCurrent;this.yAxisCurrent=this.yAxisCurrent<0?this.xAxis.length-1:this.yAxisCurrent>this.yAxis.length-1?0:this.yAxisCurrent;this.zAxisCurrent=this.zAxisCurrent<0?this.xAxis.length-1:this.zAxisCurrent>this.zAxis.length-1?0:this.zAxisCurrent;break;case"Scatter3D":if(g==33){this.xRotate+=(this.rotationStep*3);this.yRotate-=(this.rotationStep*3)}else{if(g==34){this.xRotate-=(this.rotationStep*3);this.yRotate+=(this.rotationStep*3)}else{if(g==35){this.xRotate=0;this.yRotate=0;this.zRotate=45}else{if(g==36){this.xRotate=45;this.yRotate=0;this.zRotate=0}else{if(g==37){this.xRotate+=this.rotationStep}else{if(g==38){this.yRotate-=this.rotationStep}else{if(g==39){this.xRotate-=this.rotationStep}else{if(g==40){this.yRotate+=this.rotationStep}}}}}}}}break}if(b&&!this.animationOn){this.animationOn=true;this.animate(g)}else{this.draw(false,false,false,true)}};this.animate=function(d){var a=this;var b=function(){this.update=function(){if(!a.animationOn){clearInterval(e)}a.arrowMove(d);switch(a.graphType){case"Network":if(this.is3DNetwork){if(d==33){this.xRotate+=(this.rotationStep*3);this.yRotate-=(this.rotationStep*3)}else{if(d==34){this.xRotate-=(this.rotationStep*3);this.yRotate+=(this.rotationStep*3)}else{if(d==37){this.xRotate-=this.rotationStep}else{if(d==38){this.yRotate-=this.rotationStep}else{if(d==39){this.xRotate+=this.rotationStep}else{if(d==40){this.yRotate+=this.rotationStep}}}}}}}else{if(d==33){this.network2DRotate+=(this.rotationStep*3)}else{if(d==34){this.network2DRotate-=(this.rotationStep*3)}else{if(d==37||d==38){this.network2DRotate-=this.rotationStep}else{if(d==39||d==40){this.network2DRotate+=this.rotationStep}}}}}break;case"Scatter2D":case"ScatterBubble2D":if(d!=37){if(a.graphType=="ScatterBubble2D"&&a.xAxisIndices.length>1&&a.xAxisIndices.length==a.yAxisIndices.length&&a.xAxisIndices.length==a.zAxisIndices.length){if(a.xAxisCurrent>=a.xAxis.length-1){a.xAxisCurrent=a.xAxis.length-1;a.yAxisCurrent=a.yAxis.length-1;a.zAxisCurrent=a.zAxis.length-1;d=37}}else{if(a.xAxisIndices.length>1&&a.xAxisIndices.length==a.yAxisIndices.length){if(a.zAxisCurrent>=a.zAxis.length-1){a.zAxisCurrent=a.zAxis.length-1;d=37}}else{if(a.xAxisIndices.length>a.yAxisIndices.length){if(a.yAxisCurrent>=a.yAxis.length-1){a.yAxisCurrent=a.yAxis.length-1}if(a.zAxisCurrent>=a.zAxis.length-1){a.zAxisCurrent=a.zAxis.length-1}if(a.yAxisCurrent>=a.yAxis.length-1&&a.zAxisCurrent>=a.zAxis.length-1){d=37}}else{if(a.xAxisCurrent>=a.xAxis.length-1){a.xAxisCurrent=a.xAxis.length-1}if(a.zAxisCurrent>=a.zAxis.length-1){a.zAxisCurrent=a.zAxis.length-1}if(a.xAxisCurrent>=a.xAxis.length-1&&a.zAxisCurrent>=a.zAxis.length-1){d=37}}}}}else{if(d!=39){if(a.graphType=="ScatterBubble2D"&&a.xAxisIndices.length>1&&a.xAxisIndices.length==a.yAxisIndices.length&&a.xAxisIndices.length==a.zAxisIndices.length){if(a.xAxisCurrent<=0){a.xAxisCurrent=0;a.yAxisCurrent=0;a.zAxisCurrent=0;d=39}}else{if(a.xAxisIndices.length>1&&a.xAxisIndices.length==a.yAxisIndices.length){if(a.zAxisCurrent<=0){a.zAxisCurrent=0;d=39}}else{if(a.xAxisIndices.length>a.yAxisIndices.length){if(a.yAxisCurrent<=0){a.yAxisCurrent=0}if(a.zAxisCurrent<=0){a.zAxisCurrent=0}if(a.yAxisCurrent<=0&&a.zAxisCurrent<=0){d=39}}else{if(a.xAxisCurrent<=0){a.xAxisCurrent=0}if(a.zAxisCurrent<=0){a.zAxisCurrent=0}if(a.xAxisCurrent<=0&&a.zAxisCurrent<=0){d=39}}}}}}break;case"Scatter3D":if(a.xRotate<=0&&(d==39||d<37)){a.xRotate=0;a.yRotate=0;d=40}else{if(a.xRotate>=90&&(d==37||d<37)){a.xRotate=90;a.yRotate=90;d=38}else{if(a.yRotate<=0&&(d==38||d<37)){a.yRotate=0;a.xRotate=90;d=39}else{if(a.yRotate>=90&&(d==40||d<37)){a.yRotate=90;a.xRotate=0;d=37}}}}break}};var e=setInterval(this.update,a.animationTime)};b.call()};this.setGraphType=function(b){var a;if(b==66){a="Bar"}else{if(b==76){a="Line"}else{if(b==65){a="Area"}else{if(b==67){a="BarLine"}else{if(b==73){a="Boxplot"}else{if(b==68){a="Dotplot"}else{if(b==72){a="Heatmap"}else{if(b==83){a="Stacked"}else{if(b==85){a="StackedLine"}else{if(b==84){a="StackedPercent"}else{if(b==87){a="StackedPercentLine"}else{if(b==50){a="Scatter2D"}else{if(b==52){a="ScatterBubble2D"}else{if(b==51){a="Scatter3D"}else{if(b==88){a="Correlation"}else{if(b==86){a="Venn"}else{if(b==80){a="Pie"}else{if(b==78){a="Network"}else{if(b==71){a="Genome"}else{if(b==77){a="Candlestick"}}}}}}}}}}}}}}}}}}}}if(a&&this.isValidGraphType(a)){this.graphType=a;this.draw()}else{alert("Dude! You cannot plot this data in a "+a+" graph")}};this.redraw=function(){this.setInitialConfig();switch(this.graphType){case"Area":case"Stacked":case"StackedLine":case"StackedPercent":case"StackedPercentLine":case"Correlation":case"Venn":case"Pie":this.setAllVariablesVisible();this.setAllSamplesVisible();return true;case"Bar":case"Line":case"BarLine":case"Boxplot":case"Dotplot":case"Genome":case"Candlestick":this.setAllVariablesVisible();this.setAllSamplesVisible();this.setMin=null;this.setMax=null;this.setMin2=null;this.setMax2=null;break;case"Scatter2D":case"ScatterBubble2D":this.resetSelectedDataPoints();this.setAllVariablesVisible();this.setAllSamplesVisible();this.setMinX=null;this.setMaxX=null;this.setMinY=null;this.setMaxY=null;break;case"Scatter3D":this.resetSelectedDataPoints();this.setAllVariablesVisible();this.setAllSamplesVisible();this.xRotate=45;this.yRotate=0;break;case"Heatmap":this.setAllVariablesVisible();this.setAllSamplesVisible();this.varIndicesStart=-1;this.smpIndicesStart=-1;break;case"Network":this.resetSelectedNodes();this.setAllNodesVisible();this.network2DRotate=0;if(this.randomNetwork){this.layoutDone=false}this.ctx.translate(-this.offsetX,-this.offsetY);this.ctx.scale(1/this.scaleFactor,1/this.scaleFactor);break}this.draw();return true};this.resetZoomPan=function(){this.zoom=1;this.panningX=0;this.panningY=0;this.panningGlobalX=0;this.panningGlobalY=0};this.masterReset=function(a){this.resetDragDiv(a);this.resetSelectedDataPoints();this.resetSelectedNodes();this.resetDataTable();this.resetConfigurator();this.resetAxesResizer(a);this.resetFlags(a);this.resetZoomPan();this.redraw()}};CanvasXpress.prototype.initDraggingEvents=function(){this.addDragDiv=function(){if(document.getElementById(this.target+"canvasXpressDrag")){return}var a=document.createElement("div");a.id=this.target+"canvasXpressDrag";a.style.width="0.5px";a.style.height="0.5px";a.style.opacity=0.5;a.style.filter="alpha(opacity = 50)";a.style.backgroundColor=this.dragAreaColor;a.style.position="absolute";a.style.zIndex=9000;this.canvas.parentNode.appendChild(a)};this.registerDragDivNetwork=function(m){var f,j,h;var k=this.modelEvent!="local"?this.isEvent(m,true):false;var b=m.target||m.srcElement;var a=this.modelEvent!="local"?k[1]:b.id;var d=false;if(a&&a.match(/-legend-/)){if(a.match(/-legend-Nodes/)){this.moveLegend="Nodes"}else{if(a.match(/-legend-Edges/)){this.moveLegend="Edges"}else{this.moveLegend=a.split(/-legend-/)[1]}}d=true}else{if(a&&a.match(/-lab$/)){if(m.shiftKey){f=this.modelEvent!="local"?k[0][0]:parseInt(a.split(/-lab/)[0].replace(this.target,""));j=true}else{if(this.modelEvent!="local"){f=k[0][0]}else{f=this.isEvent(m);f=parseInt(f.split(/-/)[0].replace(this.target,""))}}}else{if(a&&a.match(/-dec$/)){if(m.shiftKey){f=this.modelEvent!="local"?k[0][0]:parseInt(a.split(/-dec/)[0].replace(this.target,""));h=true}else{this.resetDragDiv(m);this.resetFlags(m)}}else{if(this.modelEvent!="local"){f=k?k[0][0]:"NaN"}else{f=this.isEvent(m);if(f){f=parseInt(f.split(/-/)[0].replace(this.target,""))}else{f=parseInt(a.replace(this.target,""))}}}}if(!isNaN(f)&&f<this.data.nodes.length){b.style.cursor="move";this.moveNode=true;this.moveNodeIndex=f;if(j){this.moveNodeLab=true}else{if(h){this.moveNodeDec=true}}var g=this.data.nodes[this.moveNodeIndex];this.moveNodeW=g.width?g.width:g.size?(this.nodeSize*g.size):this.nodeSize;this.moveNodeH=g.height?g.height:g.size?(this.nodeSize*g.size):this.nodeSize;if(this.moveNodeLab){this.moveNodeX=g.labelX!=null?g.labelX-((this.xMouseDown/this.scaleFactor)-this.offsetX):0;this.moveNodeY=g.labelY!=null?g.labelY-((this.yMouseDown/this.scaleFactor)-this.offsetY):0}else{if(this.moveNodeDec){this.moveNodeX=g.decorationsX?g.decorationsX-((this.xMouseDown/this.scaleFactor)-this.offsetX):0;this.moveNodeY=g.decorationsY?g.decorationsY-((this.yMouseDown/this.scaleFactor)-this.offsetY):0}else{if(this.is3DNetwork){this.moveNodeX=g.x3d-((this.xMouseDown/this.scaleFactor)-this.offsetX);this.moveNodeY=g.y3d-((this.yMouseDown/this.scaleFactor)-this.offsetY)}else{this.moveNodeX=g.x-((this.xMouseDown/this.scaleFactor)-this.offsetX);this.moveNodeY=g.y-((this.yMouseDown/this.scaleFactor)-this.offsetY)}}}d=true}}if(d){this.addToNetworkStack()}};this.registerDragDiv=function(k){if(!k){k=window.event}if(this.isCanvasResize(k)){this.resizingCanvasOn=true}else{if(!k){return}var p=this.adjustedCoordinates(k);if(p){var a=p.x;var q=p.y;var o=0;for(var f=0;f<this.layoutRows;f++){for(var b=0;b<this.layoutCols;b++){var h=this.layoutComb?this.layoutParams[o].graphType:this.graphType;if(h.match(/Correlation|Pie|Venn|Stacked|Area/)){return false}var n=this.getBoundsXY(o,f,b);if(a>=n[0]&&a<=n[1]&&q>=n[2]&&q<=n[3]){this.skipClick=false;this.draggingOn=true;this.xMouseDown=a;this.yMouseDown=q;var m=document.getElementById(this.target+"canvasXpressDrag");if(h=="Network"){this.registerDragDivNetwork(k)}if((!h.match(/Scatter|Heatmap|Network|Genome/)&&this.graphOrientation=="vertical"&&!k.shiftKey)||(!h.match(/Scatter|Heatmap|Network|Genome/)&&this.graphOrientation!="vertical"&&k.shiftKey)){m.style.left=n[0]+"px"}else{m.style.left=this.xMouseDown+"px"}if((!h.match(/Scatter|Heatmap|Network|Genome/)&&this.graphOrientation!="vertical"&&!k.shiftKey)||(!h.match(/Scatter|Heatmap|Network|Genome/)&&this.graphOrientation=="vertical"&&k.shiftKey)||h=="Genome"){m.style.top=n[2]+"px"}else{m.style.top=this.yMouseDown+"px"}if(this.layoutValid){this.layoutValidR=f;this.layoutValidC=b;this.layoutValidN=o}return false}o++}}}}};this.updateDragDivScatter3D=function(d,u,g,e,m){if(!this.rotatingOn){this.rotatingOn=new Date().getTime();var k=this;var b=this.xMouseDown;var o=this.yMouseDown;var a=d;var n=u;var f=this.lineLength(b,o,a,n);var r=this.layoutComb?this.layoutParams[m].x:this.layoutValid?this.x*this.scaleX:this.x;var h=this.layoutComb?this.layoutParams[m].y:this.layoutValid?this.y*this.scaleY:this.y;var v=((a-b)*this.rotationSensitivity)/r;var s=((n-o)*this.rotationSensitivity)/h;var q=(f*this.rotationSensitivity)/r;this.xRotate-=v;this.yRotate+=s;this.zRotate-=q;this.draw();this.rotatingOn=true;this.skipClick=false;var p=function(){this.update=function(){var t=new Date().getTime();if(t-k.rotatingOn>k.rotationDelay){k.rotatingOn=false;clearInterval(j)}};var j=setInterval(this.update,20)};p.call()}};this.updateDragDivNetwork=function(n,f,v,k,g,o){this.movingOn=true;var q=f;var p=v;var d,z,u,s;var a=n.target||n.srcElement;if(this.moveNode||this.moveLegend){if(this.moveLegend){if(this.moveLegend=="Nodes"){z=this.data.legend.pos.nodes.x-((q/this.scaleFactor)-this.offsetX);u=this.data.legend.pos.nodes.y-((p/this.scaleFactor)-this.offsetY);this.data.legend.pos.nodes.x-=z;this.data.legend.pos.nodes.y-=u}else{if(this.moveLegend=="Edges"){z=this.data.legend.pos.edges.x-((q/this.scaleFactor)-this.offsetX);u=this.data.legend.pos.edges.y-((p/this.scaleFactor)-this.offsetY);this.data.legend.pos.edges.x-=z;this.data.legend.pos.edges.y-=u}else{s=parseInt(this.moveLegend.replace("Text",""));z=this.data.legend.text[s].x-((q/this.scaleFactor)-this.offsetX);u=this.data.legend.text[s].y-((p/this.scaleFactor)-this.offsetY);this.data.legend.text[s].x-=z;this.data.legend.text[s].y-=u}}}else{if(this.data.nodes[this.moveNodeIndex]){d=this.data.nodes[this.moveNodeIndex];if(this.is3DNetwork){z=(d.x3d-((q/this.scaleFactor)-this.offsetX))-this.moveNodeX;u=(d.y3d-((p/this.scaleFactor)-this.offsetY))-this.moveNodeY}else{z=(d.x-((q/this.scaleFactor)-this.offsetX))-this.moveNodeX;u=(d.y-((p/this.scaleFactor)-this.offsetY))-this.moveNodeY}if(this.moveNodeLab){z=d.labelX!=null?(d.labelX-((q/this.scaleFactor)-this.offsetX))-this.moveNodeX:z;u=d.labelY!=null?(d.labelY-((p/this.scaleFactor)-this.offsetY))-this.moveNodeY:u;this.modifyXYNodeLab(d.id,z,u)}else{if(this.moveNodeDec){z=d.decorationsX?(d.decorationsX-((q/this.scaleFactor)-this.offsetX))-this.moveNodeX:z;u=d.decorationsY?(d.decorationsY-((p/this.scaleFactor)-this.offsetY))-this.moveNodeY:u;this.modifyXYNodeDec(d.id,z,u)}else{if(n.shiftKey){var r=(this.moveNodeW-z)+((f-this.xMouseDown)/this.scaleFactor);var m=(this.moveNodeH-u)+((v-this.yMouseDown)/this.scaleFactor);this.modifyNodeSize(d.id,Math.abs(r),Math.abs(m));for(var s in this.selectNode){if(s!=d.id){this.modifyNodeSize(s,r,m)}}}else{this.modifyXYNode(d.id,z,u);for(var s in this.selectNode){if(s!=d.id){this.modifyXYNode(s,z,u)}}}}}}}}else{this.panningX=((f-this.xMouseDown)/this.scaleFactor);this.panningY=((v-this.yMouseDown)/this.scaleFactor)}this.skipClick=z!=null||u!=null?true:false;this.draw(false,false,false,true);if(this.is3DNetwork&&d){this.moveNodeIndex=this.data.nodeIndices[d.id]}var b=document.getElementById(a.id);if(b){b.style.cursor=n.shiftKey?"se-resize":"move"}};this.updateDragDiv=function(k){if(this.draggingOn){if(!k){k=window.event}if(this.resetOn){this.resetOn=false;this.stopEvent(k);return}var p=this.adjustedCoordinates(k);if(p){var a=p.x;var q=p.y;var f=this.layoutValidR;var b=this.layoutValidC;var o=this.layoutValidN;var h=this.layoutComb?this.layoutParams[o].graphType:this.graphType;if(h.match(/Correlation|Pie|Venn|Stacked|Area/)){return false}if(h=="Scatter3D"&&!k.shiftKey){this.updateDragDivScatter3D(a,q,f,b,o)}else{if(h=="Network"&&((this.moveNode||this.moveLegend)||(!k.ctrlKey&&!k.shiftKey&&!k.altKey))){this.updateDragDivNetwork(k,a,q,f,b,o)}else{var n=this.getBoundsXY(o,f,b);var m=document.getElementById(this.target+"canvasXpressDrag");this.skipClick=true;if((!h.match(/Scatter|Heatmap|Network|Genome/)&&this.graphOrientation=="vertical"&&!k.shiftKey)||(!h.match(/Scatter|Heatmap|Network|Genome/)&&this.graphOrientation!="vertical"&&k.shiftKey)){m.style.width=(n[1]-n[0])+"px"}else{if(a>this.xMouseDown){if(a>n[1]){m.style.width=(n[1]-this.xMouseDown)+"px"}else{m.style.width=(a-this.xMouseDown)+"px"}}else{if(a<n[0]){m.style.left=n[0]+"px";m.style.width=(this.xMouseDown-n[0])+"px"}else{m.style.left=a+"px";m.style.width=(this.xMouseDown-a)+"px"}}}if((!h.match(/Scatter|Heatmap|Network|Genome/)&&this.graphOrientation!="vertical"&&!k.shiftKey)||(!h.match(/Scatter|Heatmap|Network|Genome/)&&this.graphOrientation=="vertical"&&k.shiftKey)||h=="Genome"){m.style.height=(n[3]-n[2])+"px"}else{if(q>this.yMouseDown){if(q>n[3]){m.style.height=(n[3]-this.yMouseDown)+"px"}else{m.style.height=(q-this.yMouseDown)+"px"}}else{if(q<n[2]){m.style.top=n[2]+"px";m.style.height=(this.yMouseDown-n[2])+"px"}else{m.style.top=q+"px";m.style.height=(this.yMouseDown-q)+"px"}}}}}}this.movingOn=true;this.resetOn=false}else{if(this.isVersion(k)){this.showInfoSpan(k,"CanvasXpress ("+this.version+")")}else{if(this.resizingCanvasOn&&this.resizeCanvasCursorShow){this.updateCanvasResizer(k)}else{this.updateCanvasResizerCursor(k)}}}};this.endDragDiv=function(k){if(this.draggingOn){var r=this.layoutComb?this.layoutParams[this.layoutValidN].graphType:this.graphType;if(r.match(/Correlation|Pie|Venn|Stacked|Area/)){return false}if(!k){k=window.event}var n=document.getElementById(this.target+"canvasXpressImage");if(n){n.style.cursor="default";var b=k.target||k.srcElement;b.style.cursor="default"}this.panningGlobalX+=this.panningX;this.panningGlobalY+=this.panningY;this.panningX=0;this.panningY=0;if(r=="Scatter3D"&&!k.shiftKey){this.resetDragDiv(k)}else{if(r=="Network"&&(this.moveNode||this.moveLegend)){if(n){if(this.isSelectNodes&&this.movingOn){this.resetSelectedNodes();this.draw()}if(this.userEvents.enddragnode&&this.movingOn){var j;if(this.moveLegend){j={legend:this.moveLegend}}else{var q=this.moveNodeIndex;var a=this.findChildrenNodeIndices(this.data.nodes[q].id);if(a){a.push(q)}else{a=[q]}j=this.extractDataObject(a)}this.resetDragDiv(k);this.userEvents.enddragnode.call(this,j)}else{this.resetDragDiv(k)}}}else{if(this.movingOn){var u=this.adjustedCoordinates(k);if(u){var h=u.x;var s=u.y;if(h!=this.xMouseDown||s!=this.yMouseDown){var m=document.getElementById(this.target+"canvasXpressDrag");var g=parseInt(m.style.left);var p=parseInt(m.style.top);var f=g+parseInt(m.style.width);var o=p+parseInt(m.style.height);this.handleDragEvent(k,g,p,f,o);this.resetDragDiv(k)}}}else{this.resetDragDiv(k)}}}}else{this.resetDragDiv(k)}};this.validateMinMax=function(b,a){if(!isNaN(b)&&!isNaN(a)){if(b>a){return false}return true}else{return false}};this.isObjectInsideCoordiantes=function(b,h,e,n,d,k){var m,j;switch(b){case"rect":m=(h[0]+h[2])/2;j=(h[1]+h[3])/2;break;case"circle":m=h[0];j=h[1];break;case"poly":var f=[];var a=[];for(var g=0;g<h.length;g++){if(g%2){a.push(h[g])}else{f.push(h[g])}}f.sort(function(p,o){return(p-o)});a.sort(function(p,o){return(p-o)});m=(f[0]+f[f.length-1])/2;j=(a[0]+a[a.length-1])/2;break}return this.isPointInsideArea("rect",m,j,[e,n,d,k])};this.handleDragEventNetwork=function(r,f,v,d,u){var g={};var p=[];var w=[];if(this.modelEvent=="local"){var j=document.getElementById(this.target+"canvasXpressMap");if(j){var t=j.childNodes;for(var o=0;o<t.length;o++){var k=this.toNumber(t[o].id.replace(this.target,""));var q=this.toNumber(t[o].coords.split(","));var b=t[o].shape;if(this.isObjectInsideCoordiantes(b,q,f,v,d,u)){if(k<this.data.nodes.length){g[k]=1}}}}}else{for(var o=0;o<this.dataEvent.length;o++){var k=this.dataEvent[o][0];var b=this.dataEvent[o][1];var q=this.dataEvent[o][2];if(this.isObjectInsideCoordiantes(b,q,f,v,d,u)){if(k<this.data.nodes.length){g[k]=1}}}}for(var o=0;o<this.data.nodes.length;o++){if(!g[o]){p.push(this.data.nodes[o].id)}else{w.push(this.data.nodes[o].id)}}if(p.length<this.data.nodes.length){if(r.shiftKey){this.setSelectNodes(w);this.isSelectNodes=w.length;this.draw()}else{this.resetZoomPan();this.hideUnhideNodes(p,true);this.ctx.translate(-this.offsetX,-this.offsetY);this.ctx.scale(1/this.scaleFactor,1/this.scaleFactor);this.draw(false,false,false,true)}}};this.setOriginalIndices=function(e,d,a){if(!this.startingVarIndices){this.startingVarIndices=[]}if(!this.startingSmpIndices){this.startingSmpIndices=[]}if(!this.startingVarIndices[e]){this.startingVarIndices[e]=[];for(var b=0;b<d.length;b++){this.startingVarIndices[e][b]=d[b]}}if(!this.startingSmpIndices[e]){this.startingSmpIndices[e]=[];for(var b=0;b<a.length;b++){this.startingSmpIndices[e][b]=a[b]}}};this.handleDragEventHeatmap=function(j,d,o,b,n){var p=[];var t=[];var r;var q=this.layoutComb?this.layoutParams[j].varIndices:this.varIndices;if(this.isGroupedData){r=this.layoutComb?this.layoutParams[j].grpIndices:this.grpIndices}else{r=this.layoutComb?this.layoutParams[j].smpIndices:this.smpIndices}this.setOriginalIndices(j,q,r);if(this.layoutComb){this.varIndicesStart=this.layoutParams[j].varIndicesStart<0?0:this.layoutParams[j].varIndicesStart;if(!this.isGroupedData){this.smpIndicesStart=this.layoutParams[j].smpIndicesStart<0?0:this.layoutParams[j].smpIndicesStart}}else{this.varIndicesStart=this.varIndicesStart<0?0:this.varIndicesStart;if(!this.isGroupedData){this.smpIndicesStart=this.smpIndicesStart<0?0:this.smpIndicesStart}}this.varIndices=[];if(this.isGroupedData){this.grpIndices=[]}else{this.smpIndices=[]}if(this.modelEvent=="local"){var e=document.getElementById(this.target+"canvasXpressMap");if(e){var k=e.childNodes;for(var g=0;g<k.length;g++){var f=this.toNumber(k[g].id.replace(this.target,"").split(","));var h=this.toNumber(k[g].coords.split(","));if((d<h[0]||d<h[2])&&b>h[0]&&(o<h[1]||o<h[3])&&n>h[1]){if(!p[f[0]]){this.varIndices.push(f[0]);p[f[0]]=1}if(!t[f[1]]){if(this.isGroupedData){this.grpIndices.push(f[1])}else{this.smpIndices.push(f[1])}t[f[1]]=1}}}}}else{for(var g=0;g<this.dataEvent.length;g++){var f=this.dataEvent[g][0];var h=this.dataEvent[g][2];if((d<h[0]||d<h[2])&&b>h[0]&&(o<h[1]||o<h[3])&&n>h[1]){if(!p[f[0]]){this.varIndices.push(f[0]);p[f[0]]=1}if(!t[f[1]]){if(this.isGroupedData){this.grpIndices.push(f[1])}else{this.smpIndices.push(f[1])}t[f[1]]=1}}}}for(var g=0;g<q.length;g++){if(q[g]==this.varIndices[0]){this.varIndicesStart+=g}}for(var g=0;g<r.length;g++){if(r[g]==this.smpIndices[0]){if(!this.isGroupedData){this.smpIndicesStart+=g}}}this.draw();this.skipClick=false};this.handleDragEventScatter=function(w,b,x,v,k,u,j){var h,g,d,f;this.selectDataPoint=[];var p=0;if(w.shiftKey){if(this.modelEvent=="local"){var q=document.getElementById(this.target+"canvasXpressMap");if(q){var y=q.childNodes;for(var t=0;t<y.length;t++){var o=this.toNumber(y[t].id.replace(this.target,""));var n=this.toNumber(y[t].coords.split(","));var r=y[t].shape;if(this.isObjectInsideCoordiantes(r,n,v,k,u,j)){this.addRemoveToSelectedDataPoints(b,o);p++}}}}else{for(var t=0;t<this.dataEvent.length;t++){var o=this.dataEvent[t][0];var r=this.dataEvent[t][1];var n=this.dataEvent[t][2];if(this.isObjectInsideCoordiantes(r,n,v,k,u,j)){this.addRemoveToSelectedDataPoints(b,o);p++}}}if(p>0){this.isSelectDataPoints=p;this.draw()}}else{if(this.layoutValid){if(this.layoutComb){h=this.layoutParams[x].xAxisMin+((v-(this.layoutParams[x].offsetX+this.layoutParams[x].left))/this.layoutParams[x].xAxisUnit);g=this.layoutParams[x].xAxisMin+((u-(this.layoutParams[x].offsetX+this.layoutParams[x].left))/this.layoutParams[x].xAxisUnit);d=this.layoutParams[x].yAxisMax-((k-(this.layoutParams[x].offsetY+this.layoutParams[x].top))/this.layoutParams[x].yAxisUnit);f=this.layoutParams[x].yAxisMax-((j-(this.layoutParams[x].offsetY+this.layoutParams[x].top))/this.layoutParams[x].yAxisUnit)}else{h=this.xAxisMin+((v-(this.left*this.scaleX))/(this.xAxisUnit*this.scaleX));g=this.xAxisMin+((u-(this.left*this.scaleX))/(this.xAxisUnit*this.scaleX));d=this.yAxisMax-((k-(this.top*this.scaleY))/(this.yAxisUnit*this.scaleY));f=this.yAxisMax-((j-(this.top*this.scaleY))/(this.yAxisUnit*this.scaleY))}}else{h=this.xAxisMin+((v-this.left)/this.xAxisUnit);g=this.xAxisMin+((u-this.left)/this.xAxisUnit);d=this.yAxisMax-((k-this.top)/this.yAxisUnit);f=this.yAxisMax-((j-this.top)/this.yAxisUnit)}if(this.validateMinMax(h,g)&&this.validateMinMax(f,d)){this.setMinX=h;this.setMaxX=g;this.setMaxY=d;this.setMinY=f;this.draw()}}};this.handleDragEventGenome=function(h,d,f,b,e){var a,g;if(this.layoutValid){if(this.layoutComb){a=this.layoutParams[h].xAxisMin+((d-this.layoutParams[h].left)/this.layoutParams[h].xAxisUnit);g=this.layoutParams[h].xAxisMin+((b-this.layoutParams[h].left)/this.layoutParams[h].xAxisUnit)}else{a=this.xAxisMin+((d-(this.left*this.scaleX))/(this.xAxisUnit*this.scaleX));g=this.xAxisMin+((b-(this.left*this.scaleX))/(this.xAxisUnit*this.scaleX))}}else{a=this.xAxisMin+((d-this.left)/this.xAxisUnit);g=this.xAxisMin+((b-this.left)/this.xAxisUnit)}if(this.validateMinMax(a,g)){this.setMin=a;this.setMax=g;this.draw()}};this.handleDragEventOneDimension=function(x,d,C,v,g,u,f,H){if(x.shiftKey||H){var n=[];var E=[];if(this.modelEvent=="local"){var o=document.getElementById(this.target+"canvasXpressMap");if(o){var G=o.childNodes;for(var q=1;q<G.length;q++){var j=this.toNumber(G[q].id.replace(this.target,"").split(","));var h=this.toNumber(G[q].coords.split(","));var r=G[q].shape;if(this.isObjectInsideCoordiantes(r,h,v,g,u,f)){if(!n[j[1]]){E.push(j[1]);n[j[1]]=1}}}}}else{for(var q=0;q<this.dataEvent.length;q++){var j=this.dataEvent[q][0];var r=this.dataEvent[q][1];var h=this.dataEvent[q][2];if(this.isObjectInsideCoordiantes(r,h,v,g,u,f)){if(!n[j[1]]){E.push(j[1]);n[j[1]]=1}}}}this.setSamplesVisible(E,true);this.draw()}else{var p,t,I,F;var B,z,y,w;var k,b,D,A;if(d=="Candlestick"&&C>0&&this.showVolume){I=this.xAxis2Min;F=this.xAxis2Max}else{p=this.xAxisMin;t=this.xAxisMax}if(this.layoutValid){if(this.layoutComb){if(this.layoutCurrent!=C){if(d=="Candlestick"&&C>0&&this.showVolume){I=this.layoutParams[C].xAxis2Min;F=this.layoutParams[C].xAxis2Max}else{p=this.layoutParams[C].xAxisMin;t=this.layoutParams[C].xAxisMax}}B=this.layoutParams[C].offsetX+this.layoutParams[C].left;z=B+this.layoutParams[C].x;y=this.layoutParams[C].offsetY+this.layoutParams[C].top;w=y+this.layoutParams[C].y;k=this.layoutParams[C].xAxisUnit;b=this.layoutParams[C].xAxis2Unit;D=1;A=1}else{B=((this.width/this.layoutCols)*this.layoutValidC)+(this.left*this.scaleX);z=((this.width/this.layoutCols)*this.layoutValidC)+((this.left+this.x)*this.scaleX);y=((this.height/this.layoutRows)*this.layoutValidR)+(this.top*this.scaleY);w=((this.height/this.layoutRows)*this.layoutValidR)+((this.top+this.y)*this.scaleY);k=this.xAxisUnit;b=this.xAxis2Unit;D=this.scaleX;A=this.scaleY}}else{B=this.left;z=this.left+this.x;y=this.top;w=this.top+this.y;k=this.xAxisUnit;b=this.xAxis2Unit;D=1;A=1}if(this.graphOrientation=="vertical"){if(d=="Candlestick"&&C>0&&this.showVolume){I=I+((w-f)/(b*A));F=F-((g-y)/(b*A))}else{p=p+((w-f)/(k*A));t=t-((g-y)/(k*A))}}else{if(d=="Candlestick"&&C>0&&this.showVolume){I=I+((v-B)/(b*D));F=F-((z-u)/(b*D))}else{p=p+((v-B)/(k*D));t=t-((z-u)/(k*D))}}if(d=="Candlestick"&&C>0&&this.showVolume&&this.validateMinMax(I,F)){this.setMin2=I;this.setMax2=F;this.draw()}else{if(this.validateMinMax(p,t)){this.setMin=p;this.setMax=t;this.draw()}}}};this.handleDragEvent=function(h,b,f,a,d){var j=this.layoutComb?this.layoutValidN:0;var g=this.layoutComb?this.layoutParams[j].graphType:this.graphType;if(g=="Network"){this.handleDragEventNetwork(h,b,f,a,d)}else{if(g=="Heatmap"){this.handleDragEventHeatmap(j,b,f,a,d)}else{if(g.match(/Scatter/)){this.handleDragEventScatter(h,g,j,b,f,a,d)}else{if(g=="Genome"){this.handleDragEventGenome(j,b,f,a,d)}else{this.handleDragEventOneDimension(h,g,j,b,f,a,d)}}}}};this.resetDragDiv=function(a){var b=document.getElementById(this.target+"canvasXpressDrag");if(b){b.style.left="0px";b.style.top="0px";b.style.width="0px";b.style.height="0px"}};this.initializeDraggingEvents=function(){if(!this.disableEvents){this.addDragDiv()}};this.initializeDraggingEvents()};CanvasXpress.prototype.initInfoEvents=function(){this.addInfoSpan=function(){if(document.getElementById(this.target+"canvasXpressInfo")){this.resetInfoSpan();return}var a=document.createElement("span");a.id=this.target+"canvasXpressInfo";a.style.backgroundColor=this.infoAreaColor;a.style.margin="1px 3px";a.style.padding="1px 3px";a.style.fontSize="x-small";a.style.border="1px solid";a.style.borderColor=this.background;a.style.position="absolute";a.style.display="none";a.style.zIndex=19010;this.canvas.parentNode.appendChild(a);this.addInfoSpanShadow()};this.addInfoSpanShadow=function(){if(document.getElementById(this.target+"canvasXpressInfoShadow")){return}var a=document.createElement("div");a.id=this.target+"canvasXpressInfoShadow";a.style.backgroundColor="#000000";a.style.margin="1px";a.style.padding="1px";a.style.fontSize="x-small";a.style.border="1px solid";a.style.borderColor="#999999";a.style.position="absolute";a.style.display="none";a.style.zIndex=19009;a.style.msFilter="progid:DXImageTransform.Microsoft.Alpha(Opacity=25)";a.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity=25)";a.style.mozOpacity=0.25;a.style.opacity=0.25;this.canvas.parentNode.appendChild(a)};this.resetInfoSpan=function(h,g){var b=document.getElementById(this.target+"canvasXpressInfo");var j=document.getElementById(this.target+"canvasXpressInfoShadow");if(b&&j&&this.infoStartTime){var a=new Date().getTime()-this.infoStartTime;if(a>100||g){b.style.left="0px";b.style.top="0px";b.style.borderColor=this.background;b.style.display="none";b.innerHTML="";j.style.left="0px";j.style.top="0px";j.style.borderColor="black";j.style.display="none";j.innerHTML=""}}};this.showInfoSpan=function(b,k,a){if(this.draggingOn||this.remoteUpdating){return}var o=document.getElementById(this.target+"canvasXpressInfo");var f=document.getElementById(this.target+"canvasXpressInfoShadow");if(o&&f){var n=this.adjustedCoordinates(b,o);if(n){var h=n.x;var g=b?n.y:n.y+25;if(o){o.style.borderColor=k.match("</table>")?this.background:this.foreground;o.style.left=(h+5)+"px";o.style.top=(g-20)+"px";o.style.display="inline";o.innerHTML=k;f.style.left=(h+15)+"px";f.style.top=(g-17)+"px";f.style.display="inline";f.innerHTML=k;this.infoStartTime=new Date().getTime();if(a){}var m=this;var j=function(){this.update=function(){var e=new Date().getTime();if(e-m.infoStartTime>m.infoTimeOut){m.resetInfoSpan();clearInterval(d)}};var d=setInterval(this.update,500)};j.call()}}}};this.initializeInfoEvents=function(){if(!this.disableEvents){this.addInfoSpan()}};this.initializeInfoEvents()};CanvasXpress.prototype.initImageMapEvents=function(){this.addImage=function(){if(document.getElementById(this.target+"canvasXpressImage")){return}var d=this;var a=function(){if(navigator.onLine){return d.imageDir+"canvasXpress.gif"}else{if(d.path){return d.path+"canvasXpress.gif"}else{alert("Dude! I couldn't find canvasXpress.js")}}};var e=document.getElementById(this.target);var b=document.createElement("img");b.id=this.target+"canvasXpressImage";b.src=a();b.width=this.width;b.height=this.height;b.useMap="#"+this.target+"canvasXpressMap";b.style.left="0px";b.style.top="0px";b.style.border="0px";b.style.position="absolute";b.style.zIndex=9000;this.canvas.parentNode.appendChild(b)};this.resizeImage=function(b){var a=document.getElementById("wrapper-"+this.target);var d=document.getElementById(this.target+"canvasXpressImage");if(a&&d){a.style.width=this.width+"px";a.style.height=this.height+"px";d.style.left="0px";d.style.top="0px";d.style.width=this.width+"px";d.style.height=this.height+"px";if(!b){if(this.modelEvent=="global"){this.addGlobalArea(["rect",this.left,this.top,this.left+this.x,this.top+this.y])}}}};this.mousedownImage=function(a){return function(b){if(!a.configuringOn){a.cancelEvent(b);a.registerDragDiv(b)}return false}}(this);this.mousemoveImage=function(a){return function(b){if(!a.configuringOn){a.cancelEvent(b);a.updateDragDiv(b)}return false}}(this);this.mouseupImage=function(a){return function(b){if(!a.configuringOn){a.stopEvent(b);a.endDragDiv(b);a.endCanvasResizer(b);a.endAxesResizer(b);a.resetFlags(b)}return false}}(this);this.clickImage=function(a){return function(b){if(!a.configuringOn){if(a.isVersion(b)){a.showInfoSpan(b,"CanvasXpress ("+a.version+")")}else{if(a.isAxis(b)){a.stopEvent(b)}else{if(a.axesResizerShow&&!a.resizerType){a.stopEvent(b);a.resetAxesResizer(b)}else{if(a.mobileApp){return false;a.stopEvent(b);a.addConfigurator(b)}}}}}else{a.resetConfigurator()}}}(this);this.dblclickImage=function(a){return function(b){a.cancelEvent(b);a.addConfigurator(b);return false}}(this);this.mousemoveDoc=function(a){return function(d){var b=document.getElementById(a.target+"canvasXpressImage");if(b&&a.isInView(b)){a.cancelEvent(d);a.updateDragDiv(d)}return false}}(this);this.keydownDoc=function(a){return function(d){var b=document.getElementById(a.target+"canvasXpressImage");if(b&&a.isInView(b)){a.registerKey(d)}}}(this);this.keyupDoc=function(a){return function(d){var b=document.getElementById(a.target+"canvasXpressImage");if(b&&a.isInView(b)){if(a.configuringOn){a.selectConfig(d)}}}}(this);this.resizeWindow=function(a){return function(b){a.resizeImage(true);return false}}(this);this.wheelImage=function(a){return function(b){var f=0;if(!b){b=window.event}if(b.wheelDelta){f=b.wheelDelta/120;if(window.opera){f=-f}}else{if(b.detail){f=-b.detail/3}}if(f){a.handleWheelEvent(b,f)}}}(this);this.addCanvasListeners=function(){var b=this;var a=document.getElementById(this.target+"canvasXpressImage");var e=document.getElementById(this.target+"canvasXpressDrag");if(a&&e){this.addEvtListener(a,"mousedown",this.mousedownImage,false);this.addEvtListener(a,"mousemove",this.mousemoveImage,false);this.addEvtListener(a,"mouseup",this.mouseupImage,false);this.addEvtListener(a,"click",this.clickImage,false);this.addEvtListener(a,"dblclick",this.dblclickImage,false);this.addEvtListener(a,"mousewheel",this.wheelImage,false);this.addEvtListener(e,"mousemove",this.mousemoveImage,false);this.addEvtListener(this.canvas,"click",this.clickImage,false);this.addEvtListener(document,"mousemove",this.mousemoveDoc,false);this.addEvtListener(document,"mouseup",this.mouseupImage,false);this.addEvtListener(document,"keydown",this.keydownDoc,false);this.addEvtListener(document,"keyup",this.keyupDoc,false);this.addEvtListener(window,"resize",this.resizeWindow,false)}};this.isVersion=function(b){if(this.showVersion){var a=this.adjustedCoordinates(b);return a&&a.x<=10&&a.y<=10?true:false}};this.handleWheelEvent=function(f,h){if(this.graphType=="Network"){this.cancelEvent(f);var b=this.networkFreeze?this.scaleFactor*this.zoomStep:this.zoom*this.zoomStep;if(this.networkFreeze){this.scaleFactor=h>0?this.scaleFactor+b:this.scaleFactor-b;this.widthBounds=this.x/this.scaleFactor;this.heightBounds=this.y/this.scaleFactor}else{this.zoom=h>0?this.zoom+b:this.zoom-b}this.draw(false,false,false,true)}else{if(this.graphType=="Heatmap"){this.cancelEvent(f);var j=this.layoutComb?this.layoutValidN:0;var a;var g=this.layoutComb?this.layoutParams[j].varIndices:this.varIndices;if(this.isGroupedData){a=this.layoutComb?this.layoutParams[j].grpIndices:this.grpIndices}else{a=this.layoutComb?this.layoutParams[j].smpIndices:this.smpIndices}this.setOriginalIndices(j,g,a);if(h>0){if(g.length>3){this.varIndices.shift();this.varIndices.pop();if(this.varIndicesStart<0){this.varIndicesStart++}this.varIndicesStart++}if(a.length>3){this.smpIndices.shift();this.smpIndices.pop();if(this.smpIndicesStart<0){this.smpIndicesStart++}this.smpIndicesStart++}}else{if(this.varIndicesStart>0){this.varIndices.unshift(this.startingVarIndices[j][this.varIndicesStart-1]);this.varIndicesStart--}if(this.varIndicesStart>=0&&this.varIndicesStart+g.length<this.startingVarIndices[j].length){this.varIndices.push(this.startingVarIndices[j][this.varIndices.length])}if(this.smpIndicesStart>0){this.smpIndices.unshift(this.startingSmpIndices[j][this.smpIndicesStart-1]);this.smpIndicesStart--}if(this.smpIndicesStart>=0&&this.smpIndicesStart+a.length<this.startingSmpIndices[j].length){this.smpIndices.push(this.startingSmpIndices[j][this.smpIndices.length])}}this.draw()}}return false};this.addMap=function(){if(document.getElementById(this.target+"canvasXpressMap")){return this.resetMap()}var a=document.createElement("map");a.name=this.target+"canvasXpressMap";a.id=this.target+"canvasXpressMap";this.canvas.parentNode.appendChild(a);this.addArea(["rect",0,0,10,10],[-1],false,0)};this.setLayoutValidIndices=function(k){if(this.layoutComb){var h=this.adjustedCoordinates(k);if(h){var a=h.x;var g=h.y;var m=0;for(var f=0;f<this.layoutRows;f++){for(var d=0;d<this.layoutCols;d++){var b=this.getBoundsXY(m,f,d);if(a>=b[0]&&a<=b[1]&&g>=b[2]&&g<=b[3]){if(this.layoutValid){this.layoutValidR=f;this.layoutValidC=d;this.layoutValidN=m}}m++}}}}};this.getNetworkEventAreaId=function(j){if(this.modelEvent=="local"){var b=j.target||j.srcElement;if(b){var d=b.id;var h;if(d.match(/-legend-/)){if(d.match(/-legend-Nodes/)){return false}else{if(d.match(/-legend-Edges/)){return false}else{return false}}}else{if(d.match(/-lab$|-dec$/)){h=this.isEvent(j);if(h){return[parseInt(h.split(/-/)[0].replace(this.target,""))]}else{return false}}else{h=this.isEvent(j);if(h){return[parseInt(h.split(/-/)[0].replace(this.target,""))]}else{return[parseInt(d.replace(this.target,""))]}}}}}else{var a=this.isEvent(j,true);var k=a[0];var g=a[1];if(k){return g&&g.match(/-legend-/)?false:k}else{return false}}};this.getEventAreaId=function(b){if(this.graphType=="Network"){return this.getNetworkEventAreaId(b)}if(this.modelEvent=="local"){var a=b.target||b.srcElement;if(a){this.setLayoutValidIndices(b);return a.id.replace(this.target,"").split(",")}else{this.setLayoutValidIndices(b);return this.isEvent(b)}}else{return this.isEvent(b)}};this.getEventAreaData=function(a){return this.extractDataObject(this.getEventAreaId(a))};this.handleMouseAreaEvents=function(b,d,a){if(a[0]==-1){this.showInfoSpan(d,"CanvasXpress ("+this.version+")")}else{var f=this.extractDataObject(a);if(this.userEvents[b]){if(typeof(this.userEvents[b])=="object"&&this.userEvents[b].handler&&this.userEvents[b].scope){if(d.ctrlKey&&b=="click"){this.addRemoveToSelectedDataPoints(false,this.getEventAreaId(d));this.draw()}else{if(d.shiftKey&&b=="click"&&this.graphType=="Network"&&this.networkLayoutType=="radial"){this.reRootRadialNetwork(this.getEventAreaId(d))}else{if(d.altKey&&b=="click"&&this.graphType=="Network"){this.addConfigurator.apply(this,[d,this.getEventAreaId(d)])}else{this.userEvents[b].handler.apply(this.userEvents[b].scope,[f,d])}}}}else{if(typeof(this.userEvents[b])=="object"&&this.userEvents[b].handler){if(d.ctrlKey&&b=="click"){this.addRemoveToSelectedDataPoints(false,this.getEventAreaId(d));this.draw()}else{if(d.shiftKey&&b=="click"&&this.graphType=="Network"&&this.networkLayoutType=="radial"){this.reRootRadialNetwork(this.getEventAreaId(d))}else{if(d.altKey&&b=="click"&&this.graphType=="Network"){this.addConfigurator.apply(this,[d,this.getEventAreaId(d)])}else{this.userEvents[b].handler(f,d)}}}}else{if(d.ctrlKey&&b=="click"){this.addRemoveToSelectedDataPoints(false,this.getEventAreaId(d));this.draw()}else{if(d.shiftKey&&b=="click"&&this.graphType=="Network"&&this.networkLayoutType=="radial"){this.reRootRadialNetwork(this.getEventAreaId(d))}else{if(d.altKey&&b=="click"&&this.graphType=="Network"){this.addConfigurator.apply(this,[d,this.getEventAreaId(d)])}else{this.userEvents[b](f,d)}}}}}}}};this.mouseoverArea=function(a){return function(d){var b=a.getEventAreaId(d);if(b){a.handleMouseAreaEvents("mouseover",d,b)}}}(this);this.mouseoutArea=function(a){return function(d){var b=a.getEventAreaId(d);if(b){a.handleMouseAreaEvents("mouseout",d,b)}}}(this);this.clickArea=function(a){return function(d){if(!a.skipClick){var b=a.getEventAreaId(d);if(b){a.handleMouseAreaEvents("click",d,b)}else{a.clickImage(d)}}}}(this);this.mousemoveArea=function(a){return function(d){a.mousemoveImage(d);if(a.modelEvent!="local"){var b=a.isEvent(d);if(b){a.handleMouseAreaEvents("mousemove",d,b)}else{a.resetInfoSpan(d,true)}}}}(this);this.addRemoveImageMapListeners=function(d,b){this[d](b,"mouseover",this.mouseoverArea,false);this[d](b,"mousemove",this.mousemoveArea,false);this[d](b,"mouseout",this.mouseoutArea,false);this[d](b,"mousedown",this.mousedownImage,false);this[d](b,"mouseup",this.mouseupImage,false);this[d](b,"click",this.clickArea,false);this[d](b,"dblclick",this.dblclickImage,false);this[d](b,"mousewheel",this.wheelImage,false)};this.formatCoords=function(j,k){var f=[];if(this.graphType!="Network"){for(var e=0;e<k.length;e++){if(e%2){f.push(sprintf("%.0f",(k[e]+this.translateY)*this.scaleY))}else{if(this.layoutValid&&j=="circle"&&e==2){f.push(sprintf("%.0f",k[e]*((this.scaleX+this.scaleY)/2)))}else{f.push(sprintf("%.0f",(k[e]+this.translateX)*this.scaleX))}}}}else{for(var e=0;e<k.length;e++){f.push(sprintf("%.0f",k[e]))}}if(j=="rect"){var b=Math.min(f[0],f[2]);var d=Math.min(f[1],f[3]);var a=Math.max(f[0],f[2]);var g=Math.max(f[1],f[3]);f=[b,d,a,g]}return f.join(",")};this.addArea=function(n,h,k,o){if(!n||!h){return}var u=n.shift();if(u&&n){if(this.modelEvent=="local"){var e=document.getElementById(this.target+"canvasXpressMap");if(e){var q=document.createElement("area");q.shape=u;q.coords=this.formatCoords(u,n);q.id=this.target+h.join(",");q.style.cursor="default";if(k){q.id+=k}this.addRemoveImageMapListeners("addEvtListener",q);if(o!=null){var d=e.getElementsByTagName("area")[o];e.insertBefore(q,d)}else{e.appendChild(q)}}}else{if(o!=null){var r=this.dataEvent;this.dataEvent=[];for(var g=0;g<o;g++){this.dataEvent.push(r.shift())}this.dataEvent.push([h,u,n,k]);while(r.length>0){this.dataEvent.push(r.shift())}}else{this.dataEvent.push([h,u,n,k])}}}};this.addGlobalArea=function(k,j){if(!k){return}var f=k.shift();if(f&&k){var h;if(j){h=0;var g=document.getElementById(this.target+"globalArea"+h);while(g){h++;g=document.getElementById(this.target+"globalArea"+h)}}else{h=""}var b=document.getElementById(this.target+"canvasXpressMap");var d=document.createElement("area");d.shape=f;d.coords=this.formatCoords(f,k);d.id=this.target+"globalArea"+h;this.addRemoveImageMapListeners("addEvtListener",d);b.appendChild(d)}};this.resetMap=function(){var b=document.getElementById(this.target+"canvasXpressMap");if(b){var e=b.childNodes;var h=[];var f=this.modelEvent=="local"?1:0;for(var g=f;g<e.length;g++){if(e[g].id){h.push(e[g])}}for(var g=0;g<h.length;g++){var d=h[g];if(d){this.addRemoveImageMapListeners("removeEvtListener",d);d.parentNode.removeChild(d)}}}this.dataEvent=[]};this.initializeImageMapEvents=function(){if(!this.disableEvents){this.addImage();this.addMap();this.addCanvasListeners()}};this.initializeImageMapEvents()};CanvasXpress.prototype.initCanvasResizerEvents=function(){this.addCanvasResizerDiv=function(){if(document.getElementById(this.target+"canvasXpressCanvasResize")){return}var a=document.createElement("div");a.id=this.target+"canvasXpressCanvasResize";a.style.left="0px";a.style.top="0px";a.style.width="0.5px";a.style.height="0.5px";a.style.opacity=0.5;a.style.filter="alpha(opacity = 50)";a.style.backgroundColor=this.resizerAreaColor;a.style.position="absolute";a.style.display="none";a.style.zIndex=10001;this.canvas.parentNode.appendChild(a)};this.isCanvasResize=function(d){if(!d){d=window.event}var b=this.adjustedCoordinates(d);if(b){var a=b.x;var f=b.y;if(a>this.width-18&&f>this.height-18){this.resizeCanvasCursorShow="se-resize";return true}else{if(a>this.width-18){this.resizeCanvasCursorShow="e-resize";return true}else{if(f>this.height-18){this.resizeCanvasCursorShow="s-resize";return true}else{this.resizeCanvasCursorShow=false;return false}}}}};this.updateCanvasResizerCursor=function(f){if(!f){f=window.event}var b=document.getElementById(this.target+"canvasXpressImage");if(b){var d=this.adjustedCoordinates(f);if(d){var a=d.x;var g=d.y;if(a>this.width-18&&g>this.height-18){b.style.cursor="se-resize";this.resizeCanvasCursorShow="se-resize"}else{if(a>this.width-18){b.style.cursor="e-resize";this.resizeCanvasCursorShow="e-resize"}else{if(g>this.height-18){b.style.cursor="s-resize";this.resizeCanvasCursorShow="s-resize"}else{if(!this.movingOn){b.style.cursor="default";this.resizeCanvasCursorShow=false}}}}}}};this.updateCanvasResizer=function(d){if(this.resizingCanvasOn&&this.resizeCanvasCursorShow){document.body.style.cursor=this.resizeCanvasCursorShow;var b=document.getElementById(this.target+"canvasXpressCanvasResize");var a=this.adjustedCoordinates(d);if(b&&a){if(this.resizeCanvasCursorShow=="se-resize"){b.style.width=a.x+"px";b.style.height=a.y+"px"}else{if(this.resizeCanvasCursorShow=="e-resize"){b.style.width=a.x+"px";b.style.height=this.height+"px"}else{if(this.resizeCanvasCursorShow=="s-resize"){b.style.width=this.width+"px";b.style.height=a.y+"px"}}}b.style.display="block"}}};this.endCanvasResizer=function(f){if(this.resizingCanvasOn){var b=document.getElementById(this.target+"canvasXpressImage");var d=document.getElementById(this.target+"canvasXpressCanvasResize");if(b&&d){var a=parseInt(d.style.width.replace("px",""));var g=parseInt(d.style.height.replace("px",""));this.resetAxesResizer();this.draw(a,g);d.style.width="0.5px";d.style.height="0.5px";d.style.display="none";b.style.cursor="default";this.resizeCanvasCursorShow=false;this.resizingCanvasOn=false}}};this.initializeCanvasResizerEvents=function(){if(!this.disableEvents){this.addCanvasResizerDiv()}};this.initializeCanvasResizerEvents()};CanvasXpress.prototype.initAxisResizerEvents=function(){this.addAxesResizeDiv=function(){if(document.getElementById(this.target+"canvasXpressAxesResize")){return}var e=["Previous","Next","Current","Middle","Min","Max","Close"];var b=9001;var f=document.createElement("div");f.id=this.target+"canvasXpressAxesResize";if(this.resizerTransparency){f.style.opacity=0.85;f.style.filter="alpha(opacity = 85)"}f.style.position="absolute";f.style.display="none";f.style.zIndex=b;for(var a=0;a<e.length;a++){b++;var g=document.createElement("div");g.id=this.target+"canvasXpressAxesResize"+e[a];if(this.resizerTransparency){g.style.opacity=0.85;g.style.filter="alpha(opacity = 85)"}g.style.position="absolute";g.style.zIndex=b;f.appendChild(g)}this.canvas.parentNode.appendChild(f)};this.clickAxesResizeClose=function(a){return function(b){a.stopEvent(b);a.resetAxesResizer(b);a.resetFlags(b)}}(this);this.mousemoveActiveAxesResize=function(a){return function(b){a.activateDeactivateAxesResizer(b)}}(this);this.mousedownAxesResize=function(a){return function(b){a.cancelEvent(b);a.registerAxesResizer(b);return false}}(this);this.mousemoveAxesResize=function(a){return function(b){a.cancelEvent(b);a.updateAxesResizer(b);return false}}(this);this.mouseupAxesResize=function(a){return function(b){a.stopEvent(b);a.endAxesResizer(b);return false}}(this);this.addRemoveAxesResizerListeners=function(v,a,k,d,u,e,q,s,p){var g=document.getElementById(this.target+"canvasXpressImage");var b=[a,d,u,e,q];this[v](g,"mousemove",this.mousemoveAxesResize,false);this[v](a,"mousemove",this.mousemoveActiveAxesResize,false);this[v](a,"mouseout",this.mousemoveActiveAxesResize,false);this[v](k,"click",this.clickAxesResizeClose,false);for(var f=0;f<b.length;f++){this[v](b[f],"mousedown",this.mousedownAxesResize,false);this[v](b[f],"mousemove",this.mousemoveAxesResize,false);this[v](b[f],"mouseup",this.mouseupAxesResize,false)}};this.showAxesResizer=function(b,E,D,f,e,F,u,B,o,q,a,I,H){if(!this.axesResizerShow){var t=document.getElementById(this.target+"canvasXpressAxesResize");var w=document.getElementById(this.target+"canvasXpressAxesResizeMin");var k=document.getElementById(this.target+"canvasXpressAxesResizeMax");var A=document.getElementById(this.target+"canvasXpressAxesResizeMiddle");var G=document.getElementById(this.target+"canvasXpressAxesResizeCurrent");var C=document.getElementById(this.target+"canvasXpressAxesResizeClose");var j=document.getElementById(this.target+"canvasXpressAxesResizePrevious");var g=document.getElementById(this.target+"canvasXpressAxesResizeNext");if(t&&w&&k&&G&&C&&j&&g){this.updateResizerEventData(false,false,b,E,D,f,e,F,u,B,o,q,a,I,H);this.refreshAxesResizer();t.style.display="block";if(this.resizerType&&this.layoutValid){C.style.display="none"}this.addRemoveAxesResizerListeners("addEvtListener",t,C,w,k,A,G,j,g);if(this.layoutValid){this.layoutValidR=I;this.layoutValidC=H;this.layoutValidN=a}this.axesResizerShow=true}}};this.refreshAxesResizer=function(){if(this.resizerEventData){var b=document.getElementById(this.target+"canvasXpressAxesResize");var e=document.getElementById(this.target+"canvasXpressAxesResizeMin");var p=document.getElementById(this.target+"canvasXpressAxesResizeMax");var f=document.getElementById(this.target+"canvasXpressAxesResizeMiddle");var j=document.getElementById(this.target+"canvasXpressAxesResizeCurrent");var g=document.getElementById(this.target+"canvasXpressAxesResizeClose");var o=document.getElementById(this.target+"canvasXpressAxesResizePrevious");var k=document.getElementById(this.target+"canvasXpressAxesResizeNext");if(b&&e&&p&&j&&g&&o&&k){var t=this.resizerEventData.areas.org[1]-this.resizerEventData.areas.org[0];var q=this.resizerEventData.areas.org[3]-this.resizerEventData.areas.org[2];var d=14;var a=9;var s=parseInt(a/2);if(this.resizerEventData.pos=="h"){l=this.resizerEventData.l.match(/^t/)?"top":"bottom";b.style.left=(this.resizerEventData.areas.org[0]-s)+"px";b.style.top=this.resizerEventData.areas.org[2]+"px";b.style.width=((t+a)-1)+"px";b.style.height=d+"px";b.style.backgroundImage="url('"+this.imageDir+"scroller_empty_hor_"+l+".png')";b.style.backgroundRepeat="repeat-x";o.style.left="0px";o.style.top="0px";o.style.width=a+"px";o.style.height=d+"px";o.style.backgroundImage="url('"+this.imageDir+"prev_"+l+".png')";e.style.left=this.resizerEventData.areas.min[0]+"px";e.style.top="0px";e.style.width=a+"px";e.style.height=d+"px";e.style.cursor="e-resize";e.style.backgroundImage="url('"+this.imageDir+"handle_left_"+l+".png')";j.style.left=this.resizerEventData.areas.cur[0]+"px";j.style.top="0px";j.style.width=this.resizerEventData.areas.cur[1]+"px";j.style.height=d+"px";j.style.cursor="move";j.style.backgroundImage="url('"+this.imageDir+"scroller_body_hor_"+l+".png')";j.style.backgroundRepeat="repeat-x";p.style.left=this.resizerEventData.areas.max[0]+"px";p.style.top="0px";p.style.width=a+"px";p.style.height=d+"px";p.style.cursor="e-resize";p.style.backgroundImage="url('"+this.imageDir+"handle_right_"+l+".png')";p.style.backgroundRepeat="no-repeat";f.style.left=(this.resizerEventData.areas.min[0]+((this.resizerEventData.areas.cur[1]-1)/2))+"px";f.style.top="0px";f.style.width="8px";f.style.height=d+"px";f.style.cursor="move";f.style.backgroundImage="url('"+this.imageDir+"scroller_handle_hor_"+l+".png')";k.style.left=(t-1)+"px";k.style.top="0px";k.style.width=a+"px";k.style.height=d+"px";k.style.backgroundImage="url('"+this.imageDir+"next_"+l+".png')";g.style.left=(t+a)+"px";g.style.top="0px";g.style.width=a+"px";g.style.height=d+"px";g.style.backgroundImage="url('"+this.imageDir+"close.png')"}else{l=this.resizerEventData.l.match(/^l/)?"left":"right";b.style.left=this.resizerEventData.areas.org[0]+"px";b.style.top=(this.resizerEventData.areas.org[2]-s)+"px";b.style.width=d+"px";b.style.height=(q+a)+"px";b.style.backgroundImage="url('"+this.imageDir+"scroller_empty_ver_"+l+".png')";b.style.backgroundRepeat="repeat-y";o.style.left="0px";o.style.top=q+"px";o.style.width=d+"px";o.style.height=a+"px";o.style.backgroundImage="url('"+this.imageDir+"prev_"+l+".png')";e.style.left="0px";e.style.top=this.resizerEventData.areas.min[2]+"px";e.style.width=d+"px";e.style.height=a+"px";e.style.cursor="n-resize";e.style.backgroundImage="url('"+this.imageDir+"handle_bottom_"+l+".png')";e.style.backgroundRepeat="no-repeat";j.style.left="0px";j.style.top=this.resizerEventData.areas.cur[2]+"px";j.style.width=d+"px";j.style.height=this.resizerEventData.areas.cur[3]+"px";j.style.cursor="move";j.style.backgroundImage="url('"+this.imageDir+"scroller_body_ver_"+l+".png')";j.style.backgroundRepeat="repeat-y";p.style.left="0px";p.style.top=this.resizerEventData.areas.max[2]+"px";p.style.width=d+"px";p.style.height=a+"px";p.style.cursor="n-resize";p.style.backgroundImage="url('"+this.imageDir+"handle_top_"+l+".png')";p.style.backgroundRepeat="no-repeat";f.style.left="0px";f.style.top=(this.resizerEventData.areas.max[2]+(this.resizerEventData.areas.cur[3]/2))+"px";f.style.width=d+"px";f.style.height=d+"px";f.style.cursor="move";f.style.backgroundImage="url('"+this.imageDir+"scroller_handle_ver_"+l+".png')";f.style.backgroundRepeat="no-repeat";k.style.left="0px";k.style.top="0px";k.style.width=d+"px";k.style.height=a+"px";k.style.backgroundImage="url('"+this.imageDir+"next_"+l+".png')";g.style.left=(d+1)+"px";g.style.top=-a+"px";g.style.width=a+"px";g.style.height=d+"px";g.style.backgroundImage="url('"+this.imageDir+"close.png')"}this.drawAxesResizerMasks()}}};this.updateResizerEventData=function(j,H,B,r,q,a,X,U,K,O,I,J,z,u,t){var G,F,n,m,A,y,h,e,Q,P,E,D,o,W;B=B?B:this.resizerEventData.axis;r=r?r:this.resizerEventData.areas.org[0];q=q?q:this.resizerEventData.areas.org[1];a=a?a:this.resizerEventData.areas.org[2];X=X?X:this.resizerEventData.areas.org[3];U=U?U:this.resizerEventData.dim;K=K?K:this.resizerEventData.pos;O=O?O:this.resizerEventData.l;I=I?I:this.resizerEventData.vals;J=J?J:this.resizerEventData.set?this.resizerEventData.set:"";z=z?z:this.resizerEventData.c,u=u?u:this.resizerEventData.i;t=t?t:this.resizerEventData.j;var k=this.isGroupedData?this.data.w.smps.length-1:this.data.y.smps.length-1;var S=I.graphType;var f=q-r;var b=X-a;var V=this.resizerType=="samples"?0:I[B+"AbsMin"];var C=this.resizerType=="samples"?k:I[B+"AbsMax"];var w=K=="h"?f:b;var R=w/(C-V);if(!j||isNaN(j)){if(this.resizerType=="samples"){j=this.isGroupedData?this.grpIndices[0]:this.smpIndices[0]}else{j=S.match(/Scatter/)?I["setMin"+U.toUpperCase()]:S=="BarLine"&&O.match(/b|r/)?I.setMin2:I.setMin;if(!j||isNaN(j)){j=V}}}j=Math.max(j,V);if(!H||isNaN(H)){if(this.resizerType=="samples"){H=this.isGroupedData?this.grpIndices[this.grpIndices.length-1]:this.smpIndices[this.smpIndices.length-1]}else{H=S.match(/Scatter/)?I["setMax"+U.toUpperCase()]:S=="BarLine"&&O.match(/b|r/)?I.setMax2:I.setMax;if(!H||isNaN(H)){H=C}}}H=Math.min(H,C);var x=(j-V)*R;var T=(H-V)*R;var N=14;var M=9;var L=parseInt(M/2);if(K=="h"){G=parseInt(x);F=M;n=0;m=N;Q=parseInt(x+L+1);P=parseInt(T-(x+1));E=0;D=N;A=parseInt(T-1);y=M;h=0;e=N;o=q+(M-1);W=X}else{G=0;F=N;n=parseInt(b-(x+1));m=M;Q=0;P=N;E=parseInt((b-T)+L);D=parseInt(T-x);A=0;y=N;h=parseInt(b-T);e=M;o=q;W=X+(M-1)}this.resizerEventData={g:S,axis:B,dim:U,pos:K,l:O,vals:I,min:V,max:C,smin:j,smax:H,len:w,unit:R,width:N,set:J,c:z,i:u,j:t,areas:{org:[r,q,a,X],lim:[r,o,a,W],min:[G,F,n,m],max:[A,y,h,e],cur:[Q,P,E,D]}}};this.updateAxesResizer=function(v){if(this.axesResizingOn){if(!v){v=window.event}var q=this.resizerEventData.areas;var z=this.adjustedCoordinates(v);if(z){var f=this.xMouseDown-z.x;var d=this.yMouseDown-z.y;var j,h;var s=null;var u=null;var n=this.isGroupedData?this.data.w.smps.length-1:this.data.y.smps.length-1;var A=this.resizerEventData.lastMin!=null?this.resizerEventData.lastMin:this.resizerEventData.smin!=null?this.resizerEventData.smin:0;var b=this.resizerEventData.lastMax!=null?this.resizerEventData.lastMax:this.resizerEventData.smax!=null?this.resizerEventData.smax:this.isGroupedData?this.data.w.smps.length-1:this.data.y.smps.length-1;var w="";var E=14;var D=9-1;var B=parseInt(D/2);var a=this.resizerEventData.pos=="h"?(q.org[1]-q.org[0])/n:(q.org[3]-q.org[2])/n;if(this.resizerEventData.active=="min"){j=f>q.min[0]?this.xMouseDown-q.min[0]:f<(q.min[0]+q.min[1])-q.max[0]?this.xMouseDown-((q.min[0]+q.min[1])-q.max[0]):z.x;h=d>q.min[2]-(q.max[2]+q.max[3])?this.yMouseDown-(q.min[2]-(q.max[2]+q.max[3])):d<(q.lim[2]+q.min[2]+q.min[3])-q.lim[3]?(q.lim[3]-(q.lim[2]+q.min[2]+q.min[3]))+this.yMouseDown:z.y}else{if(this.resizerEventData.active=="max"){j=f>q.max[0]-(q.min[0]+q.min[1])?this.xMouseDown-(q.max[0]-(q.min[0]+q.min[1])):f<(q.lim[0]+q.max[0]+q.max[1])-q.lim[1]?(q.lim[1]-(q.lim[0]+q.max[0]+q.max[1]))+this.xMouseDown:z.x;h=d>q.max[2]?this.yMouseDown-q.max[2]:d<(q.lim[2]+q.max[2]+q.max[3])-(q.lim[2]+q.min[2])?((q.lim[2]+q.min[2])-(q.lim[2]+q.max[2]+q.max[3]))+this.yMouseDown:z.y}else{if(this.resizerEventData.active=="cur"){j=f>q.min[0]?this.xMouseDown-q.min[0]:f<(q.lim[0]+q.max[0]+q.max[1])-q.lim[1]?(q.lim[1]-(q.lim[0]+q.max[0]+q.max[1]))+this.xMouseDown:z.x;h=d>q.max[2]?this.yMouseDown-q.max[2]:d<(q.lim[2]+q.min[2]+q.min[3])-q.lim[3]?(q.lim[3]-(q.lim[2]+q.min[2]+q.min[3]))+this.yMouseDown:z.y}else{return}}}var m=j-this.xMouseDown;var k=h-this.yMouseDown;if(this.resizerType=="samples"){m-=m%a;k-=k%a}var r=m/this.resizerEventData.unit;var p=k/this.resizerEventData.unit;var t=document.getElementById(this.target+"canvasXpressAxesResizeMin");var o=document.getElementById(this.target+"canvasXpressAxesResizeMax");var C=document.getElementById(this.target+"canvasXpressAxesResizeMiddle");var g=document.getElementById(this.target+"canvasXpressAxesResizeCurrent");if(t&&o&&C&&g){if(this.resizerEventData.active=="min"){if(this.resizerEventData.pos=="h"){t.style.left=(q.min[0]+m)+"px";C.style.left=((q.min[0]+m)+((q.cur[1]-m)/2))+"px";g.style.left=(q.min[0]+m+B+1)+"px";g.style.width=(q.cur[1]-m)+"px";A=parseInt((q.min[0]+D+m)/a);if(this.resizerType=="samples"){s=dateFormat(this.data.y.smps[A],this.timeFormat)}else{s=this.formatNumber(this.resizerEventData.smin+r)}}else{t.style.top=(q.min[2]+k)+"px";C.style.top=((q.min[2]+k)-((q.cur[3]+k)/2))+"px";g.style.height=((q.cur[3]+k))+"px";b=parseInt((q.min[2]+D+k)/a);if(this.resizerType=="samples"){s=dateFormat(this.data.y.smps[b],this.timeFormat)}else{s=this.formatNumber(this.resizerEventData.smin-p)}}this.showInfoSpan(v,s)}else{if(this.resizerEventData.active=="max"){if(this.resizerEventData.pos=="h"){o.style.left=(q.max[0]+m)+"px";C.style.left=((q.min[0]+m)+((q.cur[1]-m)/2))+"px";g.style.width=(q.cur[1]+m)+"px";b=parseInt((q.max[0]+D+m)/a);if(this.resizerType=="samples"){u=dateFormat(this.data.y.smps[b],this.timeFormat)}else{u=this.formatNumber(this.resizerEventData.smax+r)}}else{o.style.top=(q.max[2]+k)+"px";C.style.top=((q.max[2]+k)+((q.cur[3]-k)/2))+"px";g.style.top=(q.max[2]+k+B)+"px";g.style.height=(q.cur[3]-k)+"px";A=parseInt((q.max[2]+D+k)/a);if(this.resizerType=="samples"){u=dateFormat(this.data.y.smps[A],this.timeFormat)}else{u=this.formatNumber(this.resizerEventData.smax-p)}}this.showInfoSpan(v,u)}else{if(this.resizerEventData.active=="cur"){if(this.resizerEventData.pos=="h"){t.style.left=(q.min[0]+m)+"px";C.style.left=((q.min[0]+m)+(q.cur[1]/2))+"px";o.style.left=(q.max[0]+m)+"px";g.style.left=(q.min[0]+m+B+1)+"px";A=parseInt((q.min[0]+D+m)/a);b=parseInt((q.max[0]+D+m)/a);if(this.resizerType=="samples"){s=dateFormat(this.data.y.smps[A],this.timeFormat);u=dateFormat(this.data.y.smps[b],this.timeFormat)}else{s=this.formatNumber(this.resizerEventData.smin+r);u=this.formatNumber(this.resizerEventData.smax+r)}this.showInfoSpan(v,s+"--"+u)}else{t.style.top=(q.min[2]+k)+"px";C.style.top=((q.max[2]+k)+(q.cur[3]/2))+"px";o.style.top=(q.max[2]+k)+"px";g.style.top=(q.max[2]+k+B)+"px";b=parseInt((q.min[2]+D+k)/a);A=parseInt((q.max[2]+D+k)/a);if(this.resizerType=="samples"){s=dateFormat(this.data.y.smps[b],this.timeFormat);u=dateFormat(this.data.y.smps[A],this.timeFormat);this.showInfoSpan(v,u+"--"+s)}else{s=this.formatNumber(this.resizerEventData.smin-p);u=this.formatNumber(this.resizerEventData.smax-p);this.showInfoSpan(v,s+"--"+u)}}}}}this.resizerEventData.lastMin=this.resizerType=="samples"?A:s;this.resizerEventData.lastMax=this.resizerType=="samples"?b:u;if(this.resizerDraw){this.drawAxesResizerUpdate()}}}}};this.drawAxesResizerUpdate=function(d){var b=this.resizerEventData.lastMin!=null?parseFloat(this.resizerEventData.lastMin):parseFloat(this.resizerEventData.smin);var g=this.resizerEventData.lastMax!=null?parseFloat(this.resizerEventData.lastMax):parseFloat(this.resizerEventData.smax);if(this.resizerType=="samples"){var a=this.isGroupedData?this.data.w.smps.length-1:this.data.y.smps.length-1;var h=[];var f=[];for(var e=0;e<b;e++){f.push(true)}for(var e=b;e<=g;e++){h.push(e);f.push(false)}for(var e=g+1;e<a;e++){f.push(true)}if(this.isGroupedData){this.grpIndices=h;this.hiddenGrps=f}else{this.smpIndices=h;this.hiddenSmps=f}}else{if(this.resizerEventData.lastMin){this["setMin"+this.resizerEventData.set]=b}if(this.resizerEventData.lastMax){this["setMax"+this.resizerEventData.set]=g}}if(d){this.updateResizerEventData(b,g)}this.draw()};this.drawAxesResizerBackgroundData=function(e,p,b,o){if(this.resizerBackgroundImage){}if(this.resizerType&&this.resizerDataIndex>-1){this.setAllSamplesVisible();var a,k,d,n;var m=this.graphType=="Candlestick"?"close":false;var h=[];var f=[];var q=[];for(var g=0;g<this.smpIndices.length;g++){h.push(this.getDataAtPos(this.resizerDataIndex,g,m))}var j=this.range(h);if(this.resizerPosition.match(/top|bottom/)){a=b/(this.smpIndices.length-1);k=o/((j[1]-j[0])*1.2);d=(j[1]-j[0])*0.1*k;n=p+o;f.push(e);q.push(n);for(var g=0;g<h.length;g++){f.push(e);q.push(n-(((h[g]-j[0])*k)+d));e+=a}e-=a;f.push(e);q.push(n)}else{a=o/(this.smpIndices.length-1);k=b/((j[1]-j[0])*1.2);d=(j[1]-j[0])*0.1*k;f.push(e);q.push(p);for(var g=0;g<h.length;g++){f.push(e+((h[g]-j[0])*k)+d);q.push(p);p+=a}p-=a;f.push(e);q.push(p)}this.drawShape("polygon",f,q,false,false,this.resizerAreaColorCurrent,this.resizerAreaColorOutlineCurrent,"closed")}};this.drawAxesResizerMasks=function(){if(this.resizerType){var d=this.resizerEventData.areas;var b=this.isGroupedData?this.data.w.grps.length-1:this.data.y.smps.length-1;var a=this.resizerEventData.pos=="h"?(d.org[1]-d.org[0])/b:(d.org[3]-d.org[2])/b;var e=9-1;if(this.resizerEventData.pos=="h"){if(this.resizerEventData.smin>0){this.rectangle(d.org[0]-1,d.org[2]-this.resizerWidth,a*this.resizerEventData.smin,this.resizerWidth,this.resizerAreaColor,this.resizerAreaColor);this.drawLine("line",d.org[0]-1,d.org[2]-this.resizerWidth,(d.org[0]-1)+(a*this.resizerEventData.smin)+1,d.org[2]-this.resizerWidth,this.foreground);this.drawLine("line",d.org[0]+(a*this.resizerEventData.smin),d.org[2]-this.resizerWidth,d.org[0]+(a*this.resizerEventData.smin),d.org[2],this.foreground)}if(this.resizerEventData.smax<b){this.rectangle(d.org[0]+d.max[0]+1,d.org[2]-this.resizerWidth,(a*(b-this.resizerEventData.smax))+1,this.resizerWidth,this.resizerAreaColor,this.resizerAreaColor);this.drawLine("line",d.org[0]+d.max[0],d.org[2]-this.resizerWidth,d.org[0]+d.max[0]+2+(a*(b-this.resizerEventData.smax)),d.org[2]-this.resizerWidth,this.foreground);this.drawLine("line",d.org[0]+d.max[0],d.org[2]-this.resizerWidth,d.org[0]+d.max[0],d.org[2],this.foreground)}this.drawLine("line",d.org[0]+a*this.resizerEventData.smin,d.org[2]-1,d.org[0]+d.max[0],d.org[2]-1,this.foreground)}else{}}};this.registerAxesResizer=function(f){if(!f){f=window.event}var j=this.adjustedCoordinates(f);if(j){var h=j.x;var g=j.y;var d=this.resizerEventData.areas;var m=d.lim[1]-d.lim[0];var k=d.lim[3]-d.lim[2];var a=5;var b=m>k?"h":"v";if(h>=d.min[0]+d.lim[0]&&h<=d.min[0]+d.min[1]+d.lim[0]&&g>=d.min[2]+d.lim[2]&&g<=d.min[2]+d.min[3]+d.lim[2]){this.resizerEventData.active="min";this.axesResizingOn=true}else{if(h>=d.max[0]+d.lim[0]&&h<=d.max[0]+d.max[1]+d.lim[0]&&g>=d.max[2]+d.lim[2]&&g<=d.max[2]+d.max[3]+d.lim[2]){this.resizerEventData.active="max";this.axesResizingOn=true}else{if(h>=d.cur[0]+d.lim[0]&&h<=d.cur[0]+d.cur[1]+d.lim[0]&&g>=d.cur[2]+d.lim[2]&&g<=d.cur[2]+d.cur[3]+d.lim[2]){this.resizerEventData.active="cur";this.axesResizingOn=true}else{if(b=="h"){if(h>=d.lim[0]&&h<d.min[0]+d.lim[0]){this.resizerEventData.active="prev";this.axesResizingOn=true}else{if(h>d.lim[0]+d.max[0]+d.max[1]&&h<=d.lim[1]-a){this.resizerEventData.active="next";this.axesResizingOn=true}}}else{if(g>=d.lim[2]+d.min[2]+d.min[3]&&g<=d.lim[2]+d.lim[3]){this.resizerEventData.active="prev";this.axesResizingOn=true}else{if(g>=d.lim[2]&&g<=d.lim[2]+d.max[2]){this.resizerEventData.active="next";this.axesResizingOn=true}}}}}}this.xMouseDown=h;this.yMouseDown=g}};this.activateDeactivateAxesResizer=function(k){if(!k){k=window.event}var t=this.adjustedCoordinates(k);if(t){var r;var s=t.x;var q=t.y;var j=this.resizerEventData.areas;var v=j.lim[1]-j.lim[0];var u=j.lim[3]-j.lim[2];var d=5;var g=v>u?"h":"v";if(g=="h"){if(s>=j.lim[0]&&s<=j.lim[0]+j.min[0]){r="prev"}else{if(s>=j.lim[0]+j.max[0]+j.max[1]&&s<=j.lim[1]-d){r="next"}}}else{if(q>=j.lim[2]+j.min[2]+j.min[3]&&q<=j.lim[2]+j.lim[3]){r="prev"}else{if(q>=j.lim[2]&&q<=j.lim[2]+j.max[2]){r="next"}}}var f=document.getElementById(this.target+"canvasXpressAxesResizePrevious");var h=document.getElementById(this.target+"canvasXpressAxesResizeNext");if(f&&h){if(r=="prev"){var m=f.style.backgroundImage;if(k.type.match(/mouseout/i)){if(m.match(/_active.png/)){f.style.backgroundImage=m.replace("_active.png",".png")}}else{if(!m.match(/_active.png/)){f.style.backgroundImage=m.replace(".png","_active.png")}}}else{if(r=="next"){var m=h.style.backgroundImage;if(k.type.match(/mouseout/i)){if(m.match(/_active.png/)){h.style.backgroundImage=m.replace("_active.png",".png")}}else{if(!m.match(/_active.png/)){h.style.backgroundImage=m.replace(".png","_active.png")}}}else{var m=f.style.backgroundImage;if(m.match(/_active.png/)){f.style.backgroundImage=m.replace("_active.png",".png")}m=h.style.backgroundImage;if(m.match(/_active.png/)){h.style.backgroundImage=m.replace("_active.png",".png")}}}}return false}};this.moveAxesResizer=function(){var g=this.resizerEventData.smin;var k=this.resizerEventData.smax;var d=this.resizerType=="samples"?1:(k-g)/10;if(this.resizerEventData.active=="prev"){if(g-d<this.resizerEventData.min){d=g-this.resizerEventData.min;this.resizerEventData.lastMin=this.resizerEventData.min;this.resizerEventData.lastMax=k-d}else{this.resizerEventData.lastMin=g-d;this.resizerEventData.lastMax=k-d}}else{if(k+d>this.resizerEventData.max){d=this.resizerEventData.max-k;this.resizerEventData.lastMin=g+d;this.resizerEventData.lastMax=this.resizerEventData.max}else{this.resizerEventData.lastMin=g+d;this.resizerEventData.lastMax=k+d}}var f=this.resizerEventData.areas;var e=document.getElementById(this.target+"canvasXpressAxesResizeMin");var n=document.getElementById(this.target+"canvasXpressAxesResizeMax");var m=document.getElementById(this.target+"canvasXpressAxesResizeMiddle");var j=document.getElementById(this.target+"canvasXpressAxesResizeCurrent");var b=14;var a=9-1;var o=parseInt(a/2);var h=d*this.resizerEventData.unit;if(this.resizerEventData.pos=="h"&&this.resizerEventData.active=="prev"||this.resizerEventData.pos=="v"&&this.resizerEventData.active=="next"){h*=-1}if(this.resizerEventData.pos=="h"){e.style.left=(f.min[0]+h+1)+"px";m.style.left=((f.min[0]+h)+(f.cur[1]/2))+"px";n.style.left=(f.max[0]+h)+"px";j.style.left=(f.min[0]+h+o+1)+"px"}else{e.style.top=(f.min[2]+h+1)+"px";m.style.top=((f.max[2]+h)+(f.cur[3]/2))+"px";n.style.top=(f.max[2]+h)+"px";j.style.top=(f.max[2]+h+o+1)+"px"}};this.getAxesVals=function(e){var d=["minData","maxData","xAxisMin","xAxisMax","xAxis2Min","xAxis2Max","yAxisMin","yAxisMax","zAxisMin","zAxisMax","xAxisUnit","xAxis2Unit","yAxisUnit","zAxisUnit","setMin","setMax","setMin2","setMax2","setMinX","setMaxX","setMinY","setMaxY","setMinZ","setMaxZ","xAxisAbsMin","xAxisAbsMax","xAxis2AbsMin","xAxis2AbsMax","yAxisAbsMin","yAxisAbsMax","zAxisAbsMin","zAxisAbsMax","graphType","x","y"];var b={};if(this.layoutComb){for(var a=0;a<d.length;a++){b[d[a]]=this.layoutParams[e][d[a]]}}else{for(var a=0;a<d.length;a++){b[d[a]]=this[d[a]]}}return b};this.isAxis=function(h){if(!h){h=window.event}if(this.resizerType&&this.layoutValid){return false}var s=this.adjustedCoordinates(h);if(s){var q=s.x;var o=s.y;var m=0;var r=(this.margin*1);var p=(this.margin*2);var a=18;for(var d=0;d<this.layoutRows;d++){for(var b=0;b<this.layoutCols;b++){var f=this.layoutComb?this.layoutParams[m].graphType:this.graphType;if(f.match(/Network|Venn|Correlation|Heatmap/)){return false}var k=this.getBoundsXY(m,d,b);if(f.match(/Scatter/)){if(q>=k[0]&&q<=k[1]&&o>=k[3]&&o<=k[3]+a){var n=this.getAxesVals(m);this.showAxesResizer("xAxis",k[0],k[1],k[3]+r,k[3]+this.getAxisFont(n.x)+p,"x","h","b",n,"X",m,d,b);return true}else{if(q>=k[0]-a&&q<=k[0]&&o>=k[2]&&o<=k[3]){var n=this.getAxesVals(m);this.showAxesResizer("yAxis",k[0]-(this.getAxisFont(n.y)+p),k[0]-r,k[2],k[3],"y","v","l",n,"Y",m,d,b);return true}}}else{if(this.graphOrientation=="vertical"){if(q>=k[0]-a&&q<=k[0]&&o>=k[2]&&o<=k[3]){var n=this.getAxesVals(m);this.showAxesResizer("xAxis",k[0]-(this.getAxisFont(n.y)+p),k[0]-r,k[2],k[3],"y","v","l",n,"",m,d,b);return true}else{if(q>=k[1]&&q<=k[1]+a&&o>=k[2]&&o<=k[3]){var n=this.getAxesVals(m);if(f=="BarLine"){this.showAxesResizer("xAxis2",k[1]+r,k[1]+this.getAxisFont(n.y)+p,k[2],k[3],"y","v","r",n,"2",m,d,b)}else{this.showAxesResizer("xAxis",k[1]+r,k[1]+this.getAxisFont(n.y)+p,k[2],k[3],"y","v","r",n,"",m,d,b)}return true}}}else{if(q>=k[0]&&q<=k[1]&&o>=k[2]-a&&o<=k[2]){var n=this.getAxesVals(m);this.showAxesResizer("xAxis",k[0],k[1],k[2]-(this.getAxisFont(n.x)+p),k[2]-r,"x","h","t",n,"",m,d,b);return true}else{if(q>=k[0]&&q<=k[1]&&o>=k[3]&&o<=k[3]+a){var n=this.getAxesVals(m);if(f=="BarLine"){this.showAxesResizer("xAxis2",k[0],k[1],k[3]+r,k[3]+this.getAxisFont(n.x)+p,"x","h","b",n,"2",m,d,b)}else{this.showAxesResizer("xAxis",k[0],k[1],k[3]+r,k[3]+this.getAxisFont(n.x)+p,"x","h","b",n,"",m,d,b)}return true}}}}m++}}}return false};this.endAxesResizer=function(a){if(this.axesResizingOn){this.resetInfoSpan(a);if(this.resizerEventData.active=="prev"||this.resizerEventData.active=="next"){this.moveAxesResizer()}this.drawAxesResizerUpdate(true);this.axesResizingOn=false}else{if(this.resizerType){this.updateResizerEventData();this.refreshAxesResizer()}}};this.resetAxesResizer=function(g){if(this.axesResizerShow){var a=document.getElementById(this.target+"canvasXpressAxesResize");var f=document.getElementById(this.target+"canvasXpressAxesResizeClose");var b=document.getElementById(this.target+"canvasXpressAxesResizeMin");var p=document.getElementById(this.target+"canvasXpressAxesResizeMax");var d=document.getElementById(this.target+"canvasXpressAxesResizeMiddle");var k=document.getElementById(this.target+"canvasXpressAxesResizeCurrent");var o=document.getElementById(this.target+"canvasXpressAxesResizePrevious");var j=document.getElementById(this.target+"canvasXpressAxesResizeNext");if(a&&f&&b&&p&&k&&o&&j){this.addRemoveAxesResizerListeners("removeEvtListener",a,f,b,p,d,k,o,j);a.style.display="none";this.resizerEventData={};this.resetInfoSpan(g);this.axesResizerShow=false}}};this.initializeAxisResizerEvents=function(){if(!this.disableEvents){this.addAxesResizeDiv()}};this.initializeAxisResizerEvents()};CanvasXpress.prototype.initEvents=function(){this.print=function(a){return function(b){alert("A new window will open so you can right click on the graph and save it");if(a.isIE){var g=a.canvas.parentNode.childNodes[0];return window.open().document.write("<html><body>"+g.innerHTML+"</body></html>")}else{var f=a.canvas.toDataURL("image/png");return window.open().document.write('<html><body><img src="'+f+'" /></body></html>')}}}(this);this.cancelEvent=function(a){if(!a){a=window.event}if(a.preventDefault){a.preventDefault()}else{a.returnValue=true}};this.stopEvent=function(a){if(!a){a=window.event}if(a.stopPropagation){a.stopPropagation()}else{a.cancelBubble=true}};this.normalizeEvtName=function(a){return this.isIE?"on"+a:a};this.addEvtListener=function(d,b,g,a){if(this.isIE){d.attachEvent(this.normalizeEvtName(b),g)}else{d.addEventListener(b,g,a);if(b=="mousewheel"){d.addEventListener("DOMMouseScroll",g,a)}}};this.removeEvtListener=function(d,b,g,a){if(this.isIE){d.detachEvent(this.normalizeEvtName(b),g)}else{d.removeEventListener(b,g,a);if(b=="mousewheel"){d.removeEventListener("DOMMouseScroll",g,a)}}};this.adjustedCoordinates=function(g,d){if(!d){d=document.getElementById(this.target+"canvasXpressImage")}if(d){var j={};var f=d.parentNode.getClientRects();if(f&&f[0]){var b=f[0].left;var d=f[0].top;var a=g&&g.clientX?g.clientX:g&&g[0]?g[0]:b;var h=g&&g.clientY?g.clientY:g&&g[1]?g[1]:d;j.x=document.body.scrollLeft>Math.abs(b)+a&&a>document.body.scrollLeft-b?Math.abs(b)+a:a-b;j.y=document.body.scrollTop>Math.abs(d)+h&&h>document.body.scrollTop-d?Math.abs(d)+h:(h-d)}else{j.x=0;j.y=0}return j}};this.isPointInsideArea=function(o,n,m,k){switch(o){case"rect":if(k[0]>k[2]){k[4]=k[0];k[0]=k[2];k[2]=k[4]}if(k[1]>k[3]){k[4]=k[1];k[1]=k[3];k[3]=k[4]}if(n>=k[0]&&n<=k[2]&&m>=k[1]&&m<=k[3]){return true}else{return false}case"circle":var f=k[2]/2;k[0]=parseInt(k[0]);k[1]=parseInt(k[1]);if(n>=k[0]-f&&n<=k[0]+f&&m>=k[1]-f&&m<=k[1]+f){return true}else{return false}case"poly":var d=[];var a=[];var g=false;for(var e=0;e<k.length;e++){if(e%2){a.push(k[e])}else{d.push(k[e])}}if(a[0]<a[1]){a=a.reverse();d=d.reverse()}for(var e=0,b=d.length-1;e<d.length;b=e++){if(((a[e]<=m&&m<a[b])||(a[b]<=m&&m<a[e]))&&(n<(d[b]-d[e])*(m-a[e])/(a[b]-a[e])+d[e])){g=!g}}return g}};this.isEvent=function(k,d){var t=this.adjustedCoordinates(k);if(t){var r=t.x;var p=t.y;if(this.modelEvent=="local"){var g=document.getElementById(this.target+"canvasXpressMap");if(g){var q=g.childNodes;for(var h=q.length-1;h>=0;h--){var b=q[h].id.replace(this.target,"");var u=q[h].shape;var o=q[h].coords.split(",");if(this.isPointInsideArea(u,r,p,o)){return b}}}}else{var q=this.dataEvent;for(var h=q.length-1;h>=0;h--){var b=q[h][0];var u=q[h][1];var o=q[h][2];var j=q[h][3];if(this.isPointInsideArea(u,r,p,o)){if(j){j=b[0]+j}return d?[b,j]:j?[j]:b}}}}return false};this.getBoundsXY=function(d,b,a){if(this.layoutValid){if(this.layoutComb){return[this.layoutParams[d].offsetX+this.layoutParams[d].left,this.layoutParams[d].offsetX+this.layoutParams[d].left+this.layoutParams[d].x,this.layoutParams[d].offsetY+this.layoutParams[d].top,this.layoutParams[d].offsetY+this.layoutParams[d].top+this.layoutParams[d].y]}else{return[(this.width/this.layoutCols*a)+(this.left*this.scaleX),(this.width/this.layoutCols*a)+((this.left+this.x)*this.scaleX),(this.height/this.layoutRows*b)+(this.top*this.scaleY),(this.height/this.layoutRows*b)+((this.top+this.y)*this.scaleY)]}}else{return[this.left,this.left+this.x,this.top,this.top+this.y]}};this.extractDataObject=function(m){var j=this.layoutComb&&this.layoutValidN>-1?this.layoutParams[this.layoutValidN].graphType:this.graphType;switch(j){case"Area":var b={x:{},y:{},z:{}};b.x=this.data.x;b.y.vars=[];b.y.vars.push(this.data.y.vars[m[0]]);b.y.smps=this.data.y.smps;b.y.data=this.data.y.data[m[0]];for(var a in this.data.z){b.z[a]=[this.data.z[a][m[0]]]}return b;case"Bar":case"Line":case"BarLine":case"Boxplot":case"Dotplot":case"Heatmap":case"Stacked":case"StackedLine":case"StackedPercent":case"StackedPercentLine":case"Scatter2D":case"ScatterBubble2D":case"Scatter3D":case"Candlestick":if(!m||isNaN(m[0])){if(m[0].match(/Dendrogram/)){var b={t:{}};var a=m[0].split("-");b.t.d=parseInt(a[1]);b.t.o=parseInt(a[2]);b.t.t=a[3];return b}else{return}}if(this.isGroupedData){var b={x:{},w:{},z:{}};for(var a in this.data.z){b.z[a]=[this.data.z[a][m[0]]]}for(var a in this.data.w){if(a=="grps"||a=="smps"){b.w[a]=[];b.w[a].push(this.data.w[a][m[1]])}else{if(a=="vars"){b.w[a]=[];b.w[a].push(this.data.y.vars[m[0]])}else{if(this.data.w[a].length>m[0]&&this.data.w[a][m[0]].length>m[1]){b.w[a]=[];b.w[a].push(this.data.w[a][m[0]][m[1]])}}}}for(var a in this.data.x){var f=[];for(var h=0;h<b.w.grps[0].length;h++){f.push(this.data.x[a][b.w.grps[0][h]])}b.x[a]=f}}else{var b={x:{},y:{},z:{}};if(j.match(/Scatter/)){var w=[m[0]];w.push(m[1]);w.push(m[2]);if(j=="Scatter3D"||this.type2D=="XYZ"||j=="ScatterBubble2D"){w.push(m[3])}if(this.colorBy&&this.getSampleIndices(this.colorBy)>-1){w.push(this.getSampleIndices(this.colorBy))}if(this.shapeBy&&this.getSampleIndices(this.shapeBy)>-1){w.push(this.getSampleIndices(this.shapeBy))}if(this.sizeBy&&this.getSampleIndices(this.sizeBy)>-1){w.push(this.getSampleIndices(this.sizeBy))}m=w}if(this.data.x){for(var a in this.data.x){var f=[];for(var h=1;h<m.length;h++){f.push(this.data.x[a][m[h]])}b.x[a]=f}}if(this.data.z){for(var a in this.data.z){var k=[];b.z[a]=[this.data.z[a][m[0]]]}}var q=[];var x=[];if(this.isRawData&&j!="Candlestick"){for(var h=1;h<m.length;h++){q.push(this.data.y.data[m[0]][m[h]]);x.push(this.data.y.smps[m[h]])}b.y.vars=[this.data.y.vars[m[0]]];b.y.smps=x;b.y.data=q}else{for(var h=1;h<m.length;h++){x.push(this.data.y.smps[m[h]])}b.y.vars=[this.data.y.vars[m[0]]];b.y.smps=x;for(var a in this.data.y){q=[];for(var h=1;h<m.length;h++){if(a&&a!="vars"&&a!="smps"&&a!="desc"){q.push(this.data.y[a][m[0]][m[h]])}}if(a&&a!="vars"&&a!="smps"&&a!="desc"){b.y[a]=q}}}}return b;case"Pie":var b={x:{},y:{},z:{}};if(this.data.x){for(var a in this.data.x){b.x[a]=[this.data.x[a][m[m.length-1]]]}}if(this.data.z){for(var a in this.data.z){var k=[];for(var h=0;h<m.length-1;h++){b.z[a]=[this.data.z[a][m[h]]]}}}var q=[];var u=[];for(var h=0;h<m.length-1;h++){u.push(this.data.y.vars[m[h]])}b.y.vars=u;b.y.smps=[this.data.y.smps[m[m.length-1]]];for(var a in this.data.y){q=[];for(var h=0;h<m.length-1;h++){if(a&&a!="vars"&&a!="smps"&&a!="desc"){q.push(this.data.y[a][m[h]][m[m.length-1]])}}if(a&&a!="vars"&&a!="smps"&&a!="desc"){b.y[a]=q}}return b;case"Correlation":if(!m||(isNaN(m[0])&&!m[0].match(/^\d/))){return}else{var q=this.isGroupedData?this.data.w.cor:this.data.y.cor}if(this.correlationAxis=="samples"){var b={x:{},y:{}};for(var a in this.data.x){var f=[];for(var h=0;h<m.length;h++){f.push(this.data.x[a][m[h]])}b.x[a]=f}b.y.smps=[this.data.y.smps[m[0]],this.data.y.smps[m[1]]]}else{var b={y:{},z:{}};for(var a in this.data.y){var k=[];for(var h=0;h<m.length;h++){k.push(this.data.y[a][m[h]])}b.z[a]=k}b.y.vars=[this.data.y.vars[m[0]],this.data.y.vars[m[1]]]}b.y.data=q[m[0]][m[1]];return b;case"Venn":var b={venn:{data:{}}};b.venn.data[this.vennCompartments[m[0]]]=this.data.venn.data[this.vennCompartments[m[0]]];return b;case"Network":var b={};if(!m||m.length==0){return}if(isNaN(m[0])){m[0]=m[0].toString();if(m[0].match(/legend/)){if(m[0].match(/Nodes/)){b={nodeLegend:this.data.legend.nodes}}else{if(m[0].match(/Edges/)){b={edgeLegend:this.data.legend.edges}}else{if(m[0].match(/Decorations/)){b={decorationLegend:this.data.legend.decorations}}else{var w=parseInt(m[0].replace("-1-legend-Text",""));b={textLegend:this.data.legend.text[w]}}}}}}else{for(var h=0;h<m.length;h++){if(m[h]>=this.data.nodes.length){if(!b.edges){b.edges=[]}b.edges.push(this.data.edges[m[h]-this.data.nodes.length])}else{if(!b.nodes){b.nodes=[]}b.nodes.push(this.data.nodes[m[h]])}}}return b;case"Genome":var b=[];b[0]={};var w=0;for(var h=0;h<this.data.tracks.length;h++){var e=this.data.tracks[h].data.length;w+=e;if(m[0]<w){var r=m[0]-(w-e);for(var a in this.data.tracks[h]){if(a=="data"){b[0][a]=[];b[0][a].push(this.data.tracks[h][a][r])}else{b[0][a]=this.data.tracks[h][a]}}return b}}}};this.setUserEvents=function(){this.userEvents={};if(this.disableEvents){return}var b=this;if(this.events&&this.events.enddragnode){this.userEvents.enddragnode=this.events.enddragnode}if(this.events&&this.events.mouseout){this.userEvents.mouseout=this.events.mouseout}else{this.userEvents.mouseout=function(g,f){b.resetInfoSpan(f)}}if(this.events&&this.events.click){this.userEvents.click=this.events.click}else{this.userEvents.click=function(g,f){if(g&&g.t){b.modifyDendrogram(g)}else{DumperAlert(g)}return false}}var d=["mouseover"];if(b.modelEvent!="local"){d.push("mousemove")}for(var a=0;a<d.length;a++){if(this.events&&this.events[d[a]]){this.userEvents[d[a]]=this.events[d[a]]}else{switch(this.graphType){case"Bar":case"Line":case"Area":case"BarLine":case"Boxplot":case"Dotplot":case"Heatmap":case"Stacked":case"StackedLine":case"StackedPercent":case"StackedPercentLine":case"Scatter2D":case"ScatterBubble2D":case"Scatter3D":this.userEvents[d[a]]=function(k,g){if(k){var h;if(b.isGroupedData&&k.w){h="<b>"+k.w.vars[0]+"</b><br>";if(b.summaryType=="mean"){for(var f=0;f<k.w.smps.length;f++){h+="<b>"+k.w.smps[f]+"</b>: "+k.w.mean[f]+"<br>"}}else{if(b.summaryType=="median"||b.summaryType=="iqr"){for(var f=0;f<k.w.smps.length;f++){h+="<b>"+k.w.smps[f]+"</b>: "+k.w.median[f]+"<br>"}}else{if(b.summaryType=="sum"){for(var f=0;f<k.w.smps.length;f++){h+="<b>"+k.w.smps[f]+"</b>: "+k.w.sum[f]+"<br>"}}}}}else{if(k.y){h="<b>"+k.y.vars[0]+"</b><br>";for(var f=0;f<k.y.smps.length;f++){h+="<b>"+k.y.smps[f]+"</b>: "+k.y.data[f]+"<br>"}}else{if(k.t){h="<b>"+k.t.t+"</b><br>Depth: "+k.t.d+"<br>"}else{return}}}b.showInfoSpan(g,h)}};break;case"Pie":this.userEvents[d[a]]=function(m,h){if(m){var k="<b>"+m.y.smps[0]+"</b><br>";for(var f=0;f<m.y.vars.length;f++){var g=sprintf("%."+b.pieSegmentPrecision+"f",(m.y.data[f]/b.varPie.tot)*100);k+="<b>"+m.y.vars[f]+"</b>: "+m.y.data[f]+" ("+g+"%)<br>"}b.showInfoSpan(h,k)}};break;case"Candlestick":this.userEvents[d[a]]=function(h,f){if(h){var g=dateFormat(h.y.smps[0],b.timeFormat)+", "+h.y.close[0];b.showInfoSpan(f,g)}};break;case"Correlation":this.userEvents[d[a]]=function(h,f){if(h){var g;if(b.correlationAxis=="samples"){g=h.y.smps[0]+" vs "+h.y.smps[1]}else{g=h.y.vars[0]+" vs "+h.y.vars[1]}b.showInfoSpan(f,g)}};break;case"Venn":this.userEvents[d[a]]=function(j,g){if(j){var h;for(var f in j.venn.data){h=f+" = "+j.venn.data[f];break}b.showInfoSpan(g,h)}};break;case"Network":this.userEvents[d[a]]=function(k,h){if(k){var j;if(k&&k.nodes){if(k.nodes[0]){j=k.nodes[0].name||k.nodes[0].label||k.nodes[0].id}}else{if(k&&k.edges){var g=b.nodes[k.edges[0].id1];var f=b.nodes[k.edges[0].id2];j=(g.label||g.id)+" - "+(f.label||f.id)}}if(j){b.showInfoSpan(h,j)}}};break;case"Genome":this.userEvents[d[a]]=function(g,f){if(g){b.showInfoSpan(f,g[0].data[0].id)}};break}}}};this.resetFlags=function(a){this.resetOn=true;this.animationOn=false;this.draggingOn=false;this.movingOn=false;this.xMouseDown=false;this.yMouseDown=false;this.moveNode=false;this.moveNodeIndex=false;this.moveNodeLab=false;this.moveNodeDec=false;this.moveLegend=false;this.moveNodeX=false;this.moveNodeY=false;this.moveNodeW=false;this.moveNodeH=false;if(a){this.stopEvent(a)}document.defaultAction=true;document.body.style.cursor="default"};this.initializeEvents=function(){this.setUserEvents();this.initConfigurator();this.initDataTable();this.initDraggingEvents();this.initCanvasResizerEvents();this.initAxisResizerEvents();this.initInfoEvents();this.initKeyEvents();this.initSelectEvents();this.initDendrogramEvents();this.initImageMapEvents()};this.initializeEvents()};CanvasXpress.prototype.initAnimation=function(){this.saveSnapshot=function(){var a=this.cloneVisualData(this.data);if(a){this.snapshots.push(a)}};this.playSnapshot=function(b,e,d){if(this.snapshots.length<1){return}this.stopSnapshotPlay();var a=this;this.snapshotPlay={idx:0,time:b,task:setTimeout(function(){a.nextSnapshot(d)},0),callback:e,oldData:this.data};this.snapshotPaused=false};this.nextSnapshot=function(d){if(this.snapshotPlay.idx>=this.snapshots.length){if(this.snapshotPlay.callback){this.snapshotPlay.callback.call(this,d)}else{this.snapshotPlay.idx=0}}if(this.snapshotPlay){var b=this.snapshotPlay.time||this.snapshots[this.snapshotPlay.idx].time||50;this.loadData(this.snapshots[this.snapshotPlay.idx++],true);var a=this;this.snapshotPlay.task=setTimeout(function(){a.nextSnapshot(d)},b);this.snapshotPaused=false}};this.stopSnapshotPlay=function(a){if(!this.snapshotPlay){return}clearTimeout(this.snapshotPlay.task);this.loadData(this.snapshotPlay.oldData,a);delete this.snapshotPlay;this.snapshotPaused=false};this.clearSnapshot=function(){this.stopSnapshotPlay(true);this.snapshots=[];this.snapshotPaused=false};this.duplicateSnapshot=function(){if(this.snapshots.length<1){return}var a=(this.snapshotPlay?this.snapshotPlay.idx:this.snapshots.length)-1;var b=this.cloneVisualData(this.snapshots[a]);if(this.snapshotPlay){this.snapshots.splice(a+1,0,b);this.snapshotPlay.idx++}else{this.snapshots.push(b)}};this.makeSnapshotPlay=function(){if(!this.snapshotPlay){this.snapshotPlay={idx:this.snapshots.length,oldData:this.data}}else{this.pauseSnapshot()}};this.moveSnapshot=function(d){if(this.snapshots.length<1){return}this.makeSnapshotPlay();var b=this.snapshotPlay.idx-1,a=b+d;if(a>=0&&a<=this.snapshots.length){this.snapshots.splice(a,0,(this.snapshots.splice(b,1))[0])}this.snapshotPlay.idx=a+1};this.prevSnapshotOnce=function(){if(this.snapshots.length<2){return}this.makeSnapshotPlay();this.snapshotPlay.idx-=2;if(this.snapshotPlay.idx<0){this.snapshotPlay.idx=0}this.loadData(this.snapshots[this.snapshotPlay.idx++],true);this.snapshotPaused=true};this.nextSnapshotOnce=function(){if(!this.snapshotPlay){return}if(this.snapshotPlay.idx<this.snapshots.length){this.loadData(this.snapshots[this.snapshotPlay.idx++],true)}this.snapshotPaused=true};this.hasNextSnapshot=function(){return this.snapshots.length>1&&this.snapshotPlay&&this.snapshotPaused&&this.snapshotPlay.idx<this.snapshots.length};this.hasPrevSnapshot=function(){return this.snapshots.length>1&&(!this.snapshotPlay||(this.snapshotPlay.idx>1&&this.snapshotPaused))};this.updateSnapshot=function(){if(this.snapshotPlay){this.snapshots[this.snapshotPlay.idx-1]=this.cloneVisualData(this.data)}};this.pauseSnapshot=function(){if(!this.snapshotPlay){return}if(this.snapshotPlay.task){clearTimeout(this.snapshotPlay.task)}this.snapshotPaused=true};this.setSnapshotTime=function(a){if(a>0){this.snapshots[this.snapshotPlay.idx-1].time=a}};this.getSnapshotTime=function(){return this.snapshots[this.snapshotPlay.idx-1].time||50};this.assembleObj=function(b,k,p){var e=[];if(!k[p]){return b[p]}if(!k[p].indices){k[p].indices={}}for(var h=0;h<b[p].length;h++){var f=b[p][h],a=f.id||f.id1+"-"+f.id2;if(!k[p].deleted[a]){var m=k[p].changed[a];if(m){for(var g in m){f[g]=m[g]}}var q=k[p].indices[a]!=null?k[p].indices[a]:p=="nodes"?b.nodeIndices[a]:b.edgeIndices[a];e[q]=f;k[p].indices[a]=q}}for(var a in k[p].added){e[k[p].indices[a]]=k[p].added[a]}return e};this.assembleData=function(b,e){var a={};a.nodes=this.assembleObj(b,e,"nodes");a.nodeIndices=e.nodes&&e.nodes.indices?e.nodes.indices:b.nodeIndices;a.edges=this.assembleObj(b,e,"edges");a.legend=e.legend||b.legend;return a};this.loadData=function(e,f){this.data=e;switch(this.graphType){case"Bar":case"Line":case"BarLine":case"Dotplot":case"Scatter2D":case"ScatterBubble2D":break;case"Scatter3D":case"Area":case"Boxplot":case"Heatmap":case"Stacked":case"StackedLine":case"StackedPercent":case"StackedPercentLine":case"Candlestick":case"Correlation":case"Venn":case"Pie":case"Genome":return false;break;case"Network":if(this.data.type=="changedData"){this.data=this.assembleData(this.cloneObject(this.snapshotsBase),this.cloneObject(this.data))}this.edges=this.data.edges;var b={};for(var d=0;d<this.data.nodes.length;d++){var a=this.data.nodes[d];b[a.id]=a}this.nodes=b;break}if(f){this.draw(false,false,true)}};this.changedNodeData=function(e,h){var k={deleted:{},changed:{},added:{}};for(var b in e.nodeIndices){var m=h.nodeIndices[b];if(m==null){k.deleted[b]=1}else{var j=e.nodes[e.nodeIndices[b]],f=h.nodes[m],o={id:b},g=false;for(var a in f){if(!this.isSameObject(f[a],j[a])){o[a]=f[a];g=true}}if(g){k.changed[b]=o}}}for(var b in h.nodeIndices){if(e.nodeIndices[b]==null){k.added[b]=h.nodes[h.nodeIndices[b]]}}k.indices=this.changedIndices(e.nodeIndices,h.nodeIndices);return k};this.getEdgeIndices=function(g){var b={};if(g.edges.length){for(var a=0;a<g.edges.length;a++){var f=g.edges[a];b[f.id1+"-"+f.id2]=a}}return b};this.changedEdgeData=function(g,h){var e={deleted:{},changed:{},added:{}};if(!g.edgeIndices){g.edgeIndices=this.getEdgeIndices(g)}var f=this.getEdgeIndices(h);for(var j in g.edgeIndices){var a=f[j];if(a==null){e.deleted[j]=1}else{var b=h.edges[a];if(!this.isSameObject(g.edges[g.edgeIndices[j]],b)){e.changed[j]=b}}}for(var j in f){if(g.edgeIndices[j]==null){e.added[j]=h.edges[f[j]]}}e.indices=this.changedIndices(g.edgeIndices,f);return e};this.changedIndices=function(b,e){var a={};for(var f in e){if(b[f]==null||b[f]!=e[f]){a[f]=e[f]}}return a};this.getSnapshotChanged=function(b){var a=this.snapshotsBase;return{type:"changedData",nodes:this.changedNodeData(a,b),edges:this.changedEdgeData(a,b),legend:this.isSameObject(a.legend,b.legend)?null:b.legend}};this.cloneVisualData=function(g){switch(this.graphType){case"Bar":case"Line":case"BarLine":case"Dotplot":case"Scatter2D":case"ScatterBubble2D":return this.cloneObject(g);break;case"Scatter3D":case"Area":case"Boxplot":case"Heatmap":case"Stacked":case"StackedLine":case"StackedPercent":case"StackedPercentLine":case"Candlestick":case"Correlation":case"Venn":case"Pie":case"Genome":return false;break;case"Network":if(this.snapshotCopyChangeOnly){if(this.snapshots.length){return g.type=="changedData"?this.cloneObject(g):this.getSnapshotChanged(g)}else{this.snapshotsBase=this.cloneObject(g);return{type:"changedData"}}}if(!this.snapshotNoCopyData){return this.cloneObject(g)}var e={nodes:[],edges:[]};if(g.nodes&&g.nodes.length){for(var b=0;b<g.nodes.length;b++){var h={};var f=g.nodes[b];var k=["outline","width","height","pattern","rotate","color","shape","size","x","y","id","hideName","hideChildren","hideParent","label","labelX","labelY","labelSize","name","hide","anchor","parentNode"];for(var a=0;a<k.length;a++){h[k[a]]=f[k[a]]}e.nodes.push(h)}}if(g.edges&&g.edges.length){for(var b=0;b<g.edges.length;b++){var h={};var f=g.edges[b];var k=["color","width","type","id1","id2","anchor"];for(var a=0;a<k.length;a++){h[k[a]]=f[k[a]]}e.edges.push(h)}}return e;break}};this.isValidAnimation=function(){switch(this.graphType){case"Bar":case"Line":case"BarLine":case"Dotplot":case"Scatter2D":case"ScatterBubble2D":return true;case"Scatter3D":case"Area":case"Boxplot":case"Heatmap":case"Stacked":case"StackedLine":case"StackedPercent":case"StackedPercentLine":case"Candlestick":case"Correlation":case"Venn":case"Pie":case"Genome":case"Network":return false}};this.createAnimation=function(f){switch(this.graphType){case"Bar":case"Line":case"BarLine":case"Dotplot":case"Scatter2D":case"ScatterBubble2D":this.isAnimation=true;var g=this.cloneVisualData(this.data);if(f.match(/grow|spring|random/)&&this.data.y.data){var e=this.animationCycles;for(var d=0;d<e;d++){for(var b=0;b<this.data.y.data.length;b++){for(var a=0;a<this.data.y.data[b].length;a++){if(!isNaN(this.data.y.data[b][a])){var h=this.data.y.data[b][a];if(f=="grow"){this.data.y.data[b][a]=h/e*d}else{if(f=="spring"){this.data.y.data[b][a]=h/(e-1.5)*(d+1)}else{this.data.y.data[b][a]=h/e*Math.floor(Math.random()*d)}}}}}this.saveSnapshot();this.data=this.cloneVisualData(g)}}this.data=g;this.saveSnapshot();this.playSnapshot(this.animationTime,this.stopAnimation);break;case"Scatter3D":case"Area":case"Boxplot":case"Heatmap":case"Stacked":case"StackedLine":case"StackedPercent":case"StackedPercentLine":case"Candlestick":case"Correlation":case"Venn":case"Pie":case"Genome":case"Network":return;break}};this.stopAnimation=function(){this.stopSnapshotPlay();this.snapshots=[];this.isAnimation=false};this.setSnapshotsData=function(a){this.snapshots=a.ss||a;this.snapshotsBase=a.base};this.getSnapshotsData=function(){return{base:this.snapshotsBase,ss:this.snapshots}};this.createDemoNetworkAnimation=function(h){var q=[],e={},s=[];for(var v=0;v<h;v++){var o=v+1;q.push({size:0.5,x:Math.floor(Math.random()*h*5),y:Math.floor(Math.random()*h*5),outline:"rgb(255,255,255)",color:"rgb(255,0,0)",id:o,label:o,hideName:true,labelSize:0.7,name:"Node "+o,pattern:"closed",shape:"star"});e[o]=v}var d={nodes:q,nodeIndices:e,edges:[],edgeIndices:{}};s.push({type:"changedData"});var t=10;var b=5;var p=255/b;var a=0.5/b;var k=5;for(var u=0;u<t;u++){var n=Math.floor(Math.random()*q.length);for(var v=0;v<b;v++){var g=Math.floor(255-(v+1)*p);var m=Math.floor((v+1)*p),w=[g,m,m];var f={};f[q[n].id]={size:0.5+a*(v+1),color:"rgb("+w.join(",")+")"};s.push({type:"changedData",nodes:{deleted:{},added:{},changed:f},time:5})}}this.setSnapshotsData({base:d,ss:s})};this.createDemoNetworkAnimation1=function(){var b=[];var n={};var q=[];var p=10;var o=200;var a="ball";var g={width:p,x:100,y:0,color:"rgb(0,255,0)",id:a,label:a,hideName:true,labelSize:0.7,name:a,pattern:"closed",shape:"sphere"};a="plank";var h={width:200,height:5,x:100,y:o,color:"rgb(255,255,0)",id:a,label:a,hideName:true,labelSize:0.7,name:a,pattern:"closed",shape:"rectangle"};a="ref";var e={width:10,x:80,y:0,color:"rgb(0,0,255)",id:a,label:a,hideName:true,labelSize:0.7,name:a,pattern:"closed",shape:"sphere"};var d={nodes:[g,h,e],nodeIndices:{ball:0,plank:1,ref:2},edges:[],edgeIndices:{}};q.push({type:"changedData"});for(var m=1,k=0;k<o-p/2;k+=p/2,m+=0.1){var f=m*m;q.push({type:"changedData",nodes:{deleted:{},added:{},changed:{ball:{y:k,time:25*p>k?50-k*2/p:5}}},time:100/f})}this.setSnapshotsData({base:d,ss:q})}};CanvasXpress.prototype.initData=function(a){this.exampleRawData={x:{Tissue:["Kidney","Liver","Kidney","Liver","Kidney","Liver","Kidney","Liver"],Donor:["D1","D1","D1","D1","D2","D2","D2","D2"],Time:["1h","1h","2h","2h","1h","1h","2h","2h"]},z:{Symbol:["abc","def","ghi","jkl","mno","pqr"],Cat:["A","A","B","C","D","C"],Class:["A","A","A","A","A","B"]},y:{vars:["Gene1","Gene2","Gene3","Gene4","Gene5","Gene6"],smps:["Smp1","Smp2","Smp3","Smp4","Smp5","Smp6","Smp7","Smp8"],desc:["Intensity","Normalized Intensity"],data:[[10,12,3,4,100,73,42,64],[12,4,60,5,24,14,32,13],[7,12,20,13,49,52,42,92],[21,10,30,8,65,166,47,58],[15,14,100,5,34,30,82,51],[100,82,73,4,3,4,5,2]]},a:{xAxis:["Gene1","Gene2","Gene3"],xAxis2:["Gene4","Gene5","Gene6"]},t:{vars:"((Gene6:0.2,Gene3:0.3):0.2,((Gene1:0.25,(Gene4:0.15,Gene2:0.3):0.2):0.3,Gene5:0.7):0.1)",smps:"((Smp2:0.8,(Smp4:0.7,((Smp1:0.6,(Smp6:0.2,Smp5:0.1):0.2):0.15,(Smp8:0.15,Smp3:0.05):0.1):0.15):0.2):0.05,Smp7:0.9)"},d:{nlfit:[{param:[1,100,50,1,1.23e-7],label:"Fit Example",type:"reg"}]},l:{vars:[["Gene1","Gene2","Gene3","Gene4","Gene5"],["Gene6"]],weight:[0.7,0.3],type:["Bar","Line"],desc:["Intensity","Score"]},venn:{data:{A:340,B:562,C:620,D:592,AB:639,AC:456,AD:257,BC:915,BD:354,CD:143,ABC:552,ABD:578,ACD:298,BCD:613,ABCD:148},legend:{A:"List 1",B:"List 2",C:"List 3",D:"List 4"}},nodes:[{id:"Gene1",color:"rgb(255,0,0)",shape:"square",size:1},{id:"Gene2",color:"rgb(255,0,0)",shape:"square",size:1.8},{id:"Gene3",color:"rgb(255,0,0)",shape:"square",size:1.4},{id:"Gene4",color:"rgb(255,0,0)",shape:"square",size:1.2},{id:"Gene5",color:"rgb(255,0,0)",shape:"square",size:1.3},{id:"Gene6",color:"rgb(255,0,0)",shape:"square",size:1},{id:"Gene7",color:"rgb(255,0,0)",shape:"square",size:1},{id:"Gene8",color:"rgb(255,0,0)",shape:"square",size:1},{id:"SNP1",color:"rgb(0,255,0)",shape:"sphere",size:1},{id:"SNP2",color:"rgb(0,255,0)",shape:"sphere",size:1},{id:"SNP3",color:"rgb(0,255,0)",shape:"sphere",size:1},{id:"SNP4",color:"rgb(0,255,0)",shape:"sphere",size:1.5},{id:"SNP5",color:"rgb(0,255,0)",shape:"sphere",size:1},{id:"SNP6",color:"rgb(0,255,0)",shape:"sphere",size:1},{id:"SNP7",color:"rgb(0,255,0)",shape:"sphere",size:1},{id:"SNP8",color:"rgb(0,255,0)",shape:"sphere",size:1.2},{id:"PH1",color:"rgb(0,255,255,0.5)",shape:"triangle",size:1,hideChildren:false},{id:"PH2",color:"rgb(0,255,255,0.6)",shape:"triangle",size:1,parentNode:"PH1"},{id:"PH3",color:"rgb(0,255,255,0.7)",shape:"triangle",size:1,parentNode:"PH1"},{id:"PH4",color:"rgb(0,255,255,0.8)",shape:"triangle",size:1,parentNode:"PH3"}],edges:[{id1:"Gene1",id2:"Gene2",color:"rgb(51,102,255)",width:"1",type:"line"},{id1:"Gene2",id2:"Gene3",color:"rgb(51,102,255)",width:"1",type:"arrowHeadLine"},{id1:"Gene1",id2:"Gene4",color:"rgb(51,102,255)",width:"1",type:"arrowHeadLine"},{id1:"Gene3",id2:"Gene5",color:"rgb(51,102,255)",width:"1",type:"dashedArrowHeadLine"},{id1:"Gene6",id2:"Gene5",color:"rgb(51,102,255)",width:"1",type:"arrowHeadSquareTailLine"},{id1:"Gene7",id2:"Gene5",color:"rgb(153,153,255)",width:"1",type:"dottedArrowHeadLine"},{id1:"Gene8",id2:"Gene7",color:"rgb(51,102,255)",width:"1",type:"line"},{id1:"Gene4",id2:"Gene7",color:"rgb(51,102,255)",width:"1",type:"squareHeadArrowTailLine"},{id1:"Gene1",id2:"SNP2",color:"rgb(153,102,255)",width:"1",type:"bezierLine"},{id1:"SNP1",id2:"SNP4",color:"rgb(51,102,152)",width:"1",type:"line"},{id1:"SNP5",id2:"Gene5",color:"rgb(153,102,255)",width:"1",type:"arrowHeadLine"},{id1:"SNP1",id2:"PH2",color:"rgb(51,102,152)",width:"1",type:"line"},{id1:"SNP1",id2:"Gene2",color:"rgb(51,102,152)",width:"1",type:"line"},{id1:"PH4",id2:"SNP7",color:"rgb(153,102,255)",width:"1",type:"arrowHeadLine"},{id1:"PH2",id2:"Gene5",color:"rgb(51,102,152)",width:"1",type:"line"},{id1:"PH1",id2:"Gene7",color:"rgb(153,102,255)",width:"1",type:"arrowHeadLine"},{id1:"PH3",id2:"Gene2",color:"rgb(51,102,152)",width:"1",type:"line"},{id1:"SNP6",id2:"Gene2",color:"rgb(51,102,152)",width:"1",type:"line"},{id1:"SNP3",id2:"Gene4",color:"rgb(153,102,255)",width:"1",type:"arrowHeadLine"},{id1:"SNP4",id2:"Gene5",color:"rgb(51,102,152)",width:"1",type:"line"},{id1:"SNP5",id2:"Gene7",color:"rgb(153,102,255)",width:"1",type:"arrowHeadLine"},{id1:"SNP7",id2:"Gene5",color:"rgb(153,102,255)",width:"1",type:"arrowHeadLine"},{id1:"SNP8",id2:"Gene6",color:"rgb(153,102,255)",width:"1",type:"arrowHeadLine"},{id1:"SNP8",id2:"Gene2",color:"rgb(51,102,152)",width:"1",type:"line"}],legend:{nodes:[],edges:[]},tracks:[{name:"Affy Probes",type:"box",connect:true,fill:"rgb(255,255,51)",line:"rgb(0,0,0)",data:[{id:"123456_at",dir:"right",data:[[100,120],[123,132],[141,160]]},{id:"234567_at",dir:"left",data:[[181,200],[211,230],[251,270]]},{id:"345678_at",dir:"right",data:[[281,300],[311,330],[351,370]]}]},{hide:true,type:"bar",height:20,fill:["rgb(255,0,0)","rgb(0,0,255)","rgb(255,255,0)"],line:["rgb(255,0,0)","rgb(0,0,255)","rgb(255,255,0)"],data:[{id:"123456_at",data:[100,25,35,46]},{id:"234567_at",data:[181,80,45,10]},{id:"345678_at",data:[281,65,46,29]}]},{name:"Tissue Distribution (Heart, Liver, Kidney)",hide:false,type:"heatmap",autowidth:true,height:20,line:"rgb(0,0,0)",smps:["Heart","Kidney","Liver"],data:[{id:"123456_at",data:[100,25,35,46]},{id:"234567_at",data:[181,80,45,10]},{id:"345678_at",data:[281,65,46,29]}]},{name:"Ref Seq",type:"box",connect:true,fill:"rgb(0,100,0)",stroke:"rgb(0,0,0)",data:[{id:"NM_012345",dir:"left",data:[[171,190],[201,220],[241,290]]},{id:"NM_567890",dir:"right",data:[[121,140],[145,156],[168,196]]},{id:"NM_987654",dir:"right",data:[[271,290],[301,320],[341,390]]}]},{name:"SNP",type:"triangle",fill:"rgb(100,0,0)",line:"rgb(0,0,0)",data:[{id:"SNP123",data:123},{id:"SNP234",data:145},{id:"SNP789",data:220}]},{type:"sequence",subtype:"DNA",hide:true,line:"rgb(255,255,255)",data:[{id:"SNP123",data:[119,"AGCT[TA]CGAG"]},{id:"SNP234",data:[141,"ATCG[TG]AATA"]},{id:"SNP789",data:[216,"GCCC[CT]AGGG"]}]}],market:[{symbol:"BMY",data:[[20100824,26.26,26.37,25.95,26.02,11625900,26.02],[20100823,26.48,26.76,26.38,26.48,12146600,26.48],[20100820,26.31,26.54,26.08,26.44,18140100,26.44],[20100819,26.2,26.29,25.81,26.06,8218000,26.06],[20100818,26.53,26.57,26.23,26.28,12235800,26.28],[20100817,26.4,26.79,26.26,26.59,12325700,26.59],[20100816,26.24,26.34,26.04,26.28,10377700,26.28],[20100813,26.24,26.46,26.1,26.32,5760100,26.32],[20100812,26.01,26.39,26,26.33,7350500,26.33],[20100811,26.32,26.5,26.15,26.25,8808100,26.25],[20100810,26.32,26.78,26.3,26.66,7009500,26.66],[20100809,26.37,26.54,26.3,26.51,6825300,26.51],[20100806,26.29,26.45,26.05,26.37,8774900,26.37],[20100805,25.83,26.38,25.8,26.38,12264600,26.38],[20100804,25.7,26.13,25.61,26.03,10233700,26.03],[20100803,25.65,25.85,25.58,25.68,6842900,25.68],[20100802,25.33,25.61,25.29,25.53,9770900,25.53],[20100730,24.98,25.13,24.78,24.92,11435700,24.92],[20100729,25.37,25.5,24.85,25.08,9463800,25.08],[20100728,25.25,25.36,25.02,25.12,8072400,25.12],[20100727,25.09,25.35,24.84,25.32,14152600,25.32],[20100726,24.57,25.03,24.57,24.97,8817400,24.97],[20100723,24.94,24.95,24.26,24.65,13043700,24.65],[20100722,24.96,25.22,24.75,24.93,10385300,24.93],[20100721,24.92,25.11,24.59,24.75,9830000,24.75],[20100720,24.65,25.09,24.46,25.02,10655500,25.02],[20100719,25.27,25.27,24.78,24.84,11804800,24.84],[20100716,25.44,25.47,25.1,25.17,13136300,25.17]]}]};this.exampleBasicData={x:{Tissue:["Kidney","Liver","Breast","Brain"],Donor:["D1","D2","D2","D1"]},z:{Symbol:["abc","def","ghi","jkl","mno","pqr"],Desc:["blah","yeah","maybe","good","bad","awsome"]},y:{vars:["Gene1","Gene2","Gene3","Gene4","Gene5","Gene6"],smps:["Smp1","Smp2","Smp3","Smp4"],desc:["Intensity"],mean:[[1,2,3,4],[2,1,3,6],[3,2,1,5],[4,2,1,3],[4,3,2,1],[9,2,7,4]],stdev:[[1,3,2,1],[2,3,2,1],[2,2,2,1],[2,3,1,1],[1,1,1,1],[3,1,3,1]],n:[[4,5,5,5],[4,5,5,5],[6,4,4,5],[6,4,5,6],[5,5,5,5],[6,5,5,5]]},a:{xAxis:["Gene1","Gene2","Gene3"],xAxis2:["Gene4","Gene5","Gene6"]}};this.isValidPlotData=function(b){var d=this.isGroupedData?this.data.w:this.data.y;if(b=="cor"&&d.cor){return true}else{if(b=="venn"&&this.data.venn){return true}else{if(b=="network"&&this.data.nodes){return true}else{if(b=="genome"&&this.data.tracks){return true}else{if(b=="sum"&&d.sum&&d.sum[0].length>0){return true}else{if(b=="mean"&&d.mean&&d.mean[0].length>0){return true}else{if(b=="median"&&d.median&&d.median[0].length>0){return true}else{if(b=="iqr"&&d.iqr1&&d.qtl1&&d.median&&d.qtl3&&d.iqr3&&d.median[0].length>0){return true}else{if(b=="candle"&&d.close&&d.open&&d.high&&d.low&&d.close[0].length>0){return true}else{if(b=="volume"&&d.volume&&d.volume[0].length>0){return true}else{if(b=="raw"&&this.isRawData){return true}else{return false}}}}}}}}}}}};this.setAllNodesVisible=function(){this.nodes={};this.data.nodeIndices={};for(var b=0;b<this.data.nodes.length;b++){var d=this.data.nodes[b];d.hide=false;this.nodes[d.id]=d;this.data.nodeIndices[d.id]=b}};this.setNodeIndices=function(){this.nodes={};this.data.nodeIndices={};for(var b=0;b<this.data.nodes.length;b++){var d=this.data.nodes[b];this.nodes[d.id]=d;this.data.nodeIndices[d.id]=b}};this.setNodes=function(){if(this.data.nodeIndices){this.nodes={};for(var b=0;b<this.data.nodes.length;b++){var d=this.data.nodes[b];this.nodes[d.id]=d}this.data.nodes=[];for(var e in this.data.nodeIndices){this.data.nodes[this.data.nodeIndices[e]]=this.nodes[e]}}else{this.setNodeIndices()}};this.hideUnhideNodes=function(e,d){d=d?true:false;if(e){if(this.isArray(e)){for(var b=0;b<e.length;b++){var g=e[b];var f=this.data.nodes[this.data.nodeIndices[g]];f.hide=d;if(this.nodes&&this.nodes[g]){this.nodes[g].hide=d}}}}else{for(var b=0;b<this.data.nodes.length;b++){var f=this.data.nodes[b];f.hide=d;f.hideChildren=d;if(this.nodes&&this.nodes[f.id]){this.nodes[f.id].hide=d;this.nodes[f.id].hideChildren=d}}}};this.hideUnhideChildrenNodes=function(f,d){d=d?true:false;if(this.nodeParentHood[f]&&this.nodeParentHood[f].children){for(var b=0;b<this.nodeParentHood[f].children.length;b++){var e=this.nodeParentHood[f].children[b];this.data.nodes[this.data.nodeIndices[e]].hiddenParent=d;this.hideUnhideChildrenNodes(e,d)}}};this.setSelectNodes=function(d){this.selectNode={};this.isSelectNodes=0;for(var b=0;b<d.length;b++){this.selectNode[d[b]]=true;this.isSelectNodes++}};this.getAnnotations=function(d){var b=[];if(d){if(this.data.z){for(var e in this.data.z){b.push(e)}}}else{if(this.data.x){for(var e in this.data.x){b.push(e)}}}return b};this.getNetworkImages=function(){var b=[];if(this.graphType=="Network"){for(var d=0;d<this.data.nodes.length;d++){var e=this.data.nodes[d];if(e.imagePath){b.push(e.imagePath)}}}return b};this.setAllVariablesVisible=function(){if(this.data.y&&this.data.y.vars){this.varIndices=[];this.hiddenVars=[];this.xAxisVarIndices=[];this.xAxis2VarIndices=[];for(var b=0;b<this.data.y.vars.length;b++){this.varIndices.push(b);this.hiddenVars.push(false)}}if(this.data.a){if(this.data.a.xAxis){this.xAxisVarIndices=this.getVariableIndices(this.data.a.xAxis)}if(this.data.a.xAxis2){this.xAxis2VarIndices=this.getVariableIndices(this.data.a.xAxis2)}}};this.resetVariablesVisibleByAxis=function(b){if(this.data.a){this.setVariablesVisibleByAxis(b,this.getVariableIndices(this.data.a[b]))}};this.setVariablesVisibleByAxis=function(f,b){var d=f+"VarIndices";this[d]=[];for(var e=0;e<b.length;e++){this[d].push(b[e])}};this.getVariablesVisibleByAxis=function(b){return this[b+"VarIndices"]};this.getVariablesByAxis=function(b){if(this.data.a&&this.data.a[b]){return this.data.a[b]}return[]};this.setVariablesVisible=function(b){this.varIndices=[];for(var d=0;d<b.length;d++){this.varIndices.push(b[d])}};this.getVariableIndices=function(b){if(b&&this.data.y.vars){var f=[];if(this.isArray(b)){if(b.length>0){for(var e=0;e<b.length;e++){for(var d=0;d<this.data.y.vars.length;d++){if(this.data.y.vars[d]==b[e]){f.push(d);break}}}return f}}else{for(var e=0;e<this.data.y.vars.length;e++){if(this.data.y.vars[e]==b){return e}}return -1}}};this.hideUnhideVars=function(h){if(h){if(this.isArray(h)){for(var e=0;e<h.length;e++){for(var d=0;d<this.data.y.vars.length;d++){if(this.data.y.vars[d]==h[e]){if(this.hiddenVars[d]){this.hiddenVars[d]=false}else{this.hiddenVars[d]=true}break}}}}else{for(var e=0;e<this.data.y.vars.length;e++){if(this.data.y.vars[e]==h){if(this.hiddenVars[e]){this.hiddenVars[e]=false}else{this.hiddenVars[e]=true}break}}}var b=[];for(var e=0;e<this.data.y.vars.length;e++){if(!this.hiddenVars[e]){b.push(e)}}this.setVariablesVisible(b);var g=["xAxis","xAxis2"];if(this.data.a){for(var e=0;e<g.length;e++){var k=this.getVariableIndices(this.data.a[g[e]]);if(k.length>0){var b=[];for(var d=0;d<k.length;d++){var f=k[d];if(!this.hiddenVars[f]){b.push(f)}}this.setVariablesVisibleByAxis(g[e],b)}}}}};this.getVariables=function(){var f=[];for(var e=0;e<this.data.y.vars.length;e++){var b=-1;for(var d=0;d<this.varIndices.length;d++){if(this.varIndices[d]==e){b=d;break}}f.push({name:this.data.y.vars[e],hidden:this.hiddenVars[e],index:b})}return f};this.setAllSamplesVisible=function(){if(this.data.y&&this.data.y.smps){this.smpIndices=[];this.hiddenSmps=[];for(var b=0;b<this.data.y.smps.length;b++){this.smpIndices.push(b);this.hiddenSmps.push(false)}}if(this.data.w&&this.data.w.smps){this.grpIndices=[];this.hiddenGrps=[];for(var b=0;b<this.data.w.smps.length;b++){this.grpIndices.push(b);this.hiddenGrps.push(false)}}};this.getSamplesByAxis=function(b){if(this[b]){return this[b]}return[]};this.setSamplesVisible=function(b,d){if(this.isGroupedData){this.grpIndices=[];for(var f=0;f<b.length;f++){this.grpIndices.push(b[f])}}else{this.smpIndices=[];for(var f=0;f<b.length;f++){this.smpIndices.push(b[f])}}if(d){var e=this.getObjectArray(b);var h=this.isGroupedData?this.data.w:this.data.y;var g=this.isGroupedData?this.hiddenGrps:this.hiddenSmps;for(var f=0;f<h.smps.length;f++){if(e.hasOwnProperty(f)){g[f]=false}else{g[f]=true}}}};this.getSampleIndices=function(b){var g=this.isGroupedData?this.data.w:this.data.y;if(b&&g.smps){var f=[];if(this.isArray(b)){if(b.length>0){for(var e=0;e<b.length;e++){for(var d=0;d<g.smps.length;d++){if(g.smps[d]==b[e]){f.push(d);break}}}return f}}else{for(var e=0;e<g.smps.length;e++){if(g.smps[e]==b){return e}}return -1}}};this.hideUnhideSmps=function(h){if(h){var k=this.isGroupedData?this.data.w:this.data.y;var f=this.isGroupedData?this.hiddenGrps:this.hiddenSmps;var g=[];if(this.isArray(h)){for(var e=0;e<h.length;e++){for(var d=0;d<k.smps.length;d++){if(k.smps[d]==h[e]){if(f[d]){f[d]=false}else{f[d]=true}break}}}}else{for(var e=0;e<k.smps.length;e++){if(k.smps[e]==h){if(f[e]){f[e]=false}else{f[e]=true}break}}}var b=[];for(var e=0;e<k.smps.length;e++){if(!f[e]){b.push(e)}}this.setSamplesVisible(b)}};this.getSamples=function(){var e=[];var k=this.isGroupedData?this.data.w.smps:this.data.y.smps;var m=this.isGroupedData?this.data.w:this.data.y;var g=this.isGroupedData?this.hiddenGrps:this.hiddenSmps;var h=this.isGroupedData?this.grpIndices:this.smpIndices;for(var f=0;f<k.length;f++){var b=-1;for(var d=0;d<h.length;d++){if(h[d]==f){b=d;break}}e.push({name:k[f],hidden:g[f],index:b})}return e};this.setIndices=function(){if(this.graphType=="Network"){this.setNodes()}else{if(this.graphType!="Genome"&&this.graphType!="Venn"){this.setAllVariablesVisible();this.setAllSamplesVisible()}}};this.resetIndices=function(){if(this.isGroupedData){this.setIndices()}};this.setMaxSmpStringAttr=function(d,b){this.setMaxSmpStringAnnt(d,b);this.setMaxSmpStringLabel(d,b);this.setMaxSmpStringDesc(b);this.setMaxSmpStringName(b)};this.setMaxSmpStringAnnt=function(f,e){if(!e){e=this.smpLabelFont}var d=0;this.maxSmpAnnt=0;this.maxSmpAnntStr="";if(this.data.x){if(f&&this.data.x[f]){return f}else{for(var g in this.data.x){var b=this.measureText(g,e);if(b>d){d=b;this.maxSmpAnnt=g.length;this.maxSmpAnntStr=g}}}}};this.setMaxSmpStringLabel=function(g,e){if(!e){e=this.smpLabelFont}var d=0;this.maxSmpLabel=0;this.maxSmpLabelStr="";if(this.data.x){if(g&&this.data.x[g]){var j="";for(var f=0;f<this.smpIndices.length;f++){var b=this.measureText(this.data.x[g][this.smpIndices[f]],e);if(b>d){d=b;j=this.data.x[g][this.smpIndices[f]]}}return j}else{for(var h in this.data.x){for(var f=0;f<this.smpIndices.length;f++){if(this.data.x[h][this.smpIndices[f]]){var b=this.measureText(this.data.x[h][this.smpIndices[f]],e);if(b>d){d=b;this.maxSmpLabel=this.data.x[h][this.smpIndices[f]].length;this.maxSmpLabelStr=this.data.x[h][this.smpIndices[f]]}}}}}}};this.setMaxSmpStringDesc=function(e){if(!e){e=this.smpLabelFont}var d=0;this.maxSmpLabelDesc=0;this.maxSmpLabelDescStr="";if(this.data.x&&this.smpLabelDescription&&this.data.x[this.smpLabelDescription]){for(var f=0;f<this.smpIndices.length;f++){if(this.data.x[this.smpLabelDescription][this.smpIndices[f]]){var b=this.measureText(this.data.x[this.smpLabelDescription][this.smpIndices[f]],e);if(b>d){d=b;this.maxSmpLabelDesc=this.data.x[this.smpLabelDescription][this.smpIndices[f]].length;this.maxSmpLabelDescStr=this.data.x[this.smpLabelDescription][this.smpIndices[f]]}}}}};this.setMaxSmpStringName=function(e){if(!e){e=this.smpLabelFont}if(this.data.y||this.data.w){var g=this.isGroupedData?this.data.w:this.data.y;var d=0;this.maxSmpName=0;this.maxSmpNameStr="";if(this.isGroupedData){for(var f=0;f<g.smps.length;f++){var b=this.measureText(g.smps[f],e);if(b>d){d=b;this.maxSmpName=g.smps[f].length;this.maxSmpNameStr=g.smps[f]}}}else{for(var f=0;f<this.smpIndices.length;f++){var b=this.measureText(g.smps[this.smpIndices[f]],e);if(b>d){d=b;this.maxSmpName=g.smps[this.smpIndices[f]].length;this.maxSmpNameStr=g.smps[this.smpIndices[f]]}}}}};this.setMaxVarStringAttr=function(d,b){this.setMaxVarStringAnnt(d,b);this.setMaxVarStringLabel(d,b);this.setMaxVarStringDesc(b);this.setMaxVarStringName(b)};this.setMaxVarStringAnnt=function(f,e){if(!e){e=this.varLabelFont}var d=0;this.maxVarAnnt=0;this.maxVarAnntStr="";if(this.data.z){if(f&&this.data.z[f]){return f}else{for(var g in this.data.z){var b=this.measureText(g,e);if(b>d){d=b;this.maxVarAnnt=g.length;this.maxVarAnntStr=g}}}}};this.setMaxVarStringLabel=function(g,e){if(!e){e=this.varLabelFont}var d=0;this.maxVarLabel=0;this.maxVarLabelStr="";if(this.data.z){if(g&&this.data.z[g]){var j="";for(var f=0;f<this.varIndices.length;f++){var b=this.measureText(this.data.z[g][this.varIndices[f]],e);if(b>d){d=b;j=this.data.z[g][this.varIndices[f]]}}return j}else{for(var h in this.data.z){for(var f=0;f<this.varIndices.length;f++){if(this.data.z[h][this.varIndices[f]]){var b=this.measureText(this.data.z[h][this.varIndices[f]],e);if(b>d){d=b;this.maxVarLabel=this.data.z[h][this.varIndices[f]].length;this.maxVarLabelStr=this.data.z[h][this.varIndices[f]]}}}}}}};this.setMaxVarStringDesc=function(e){if(!e){e=this.varLabelFont}var d=0;this.maxVarLabelDesc=0;this.maxVarLabelDescStr="";if(this.data.z&&this.varLabelDescription&&this.data.z[this.varLabelDescription]){for(var f=0;f<this.varIndices.length;f++){if(this.data.z[this.varLabelDescription][this.varIndices[f]]){var b=this.measureText(this.data.z[this.varLabelDescription][this.varIndices[f]],e);if(b>d){d=b;this.maxVarLabelDesc=this.data.z[this.varLabelDescription][this.varIndices[f]].length;this.maxVarLabelDescStr=this.data.z[this.varLabelDescription][this.varIndices[f]]}}}}};this.setMaxVarStringName=function(e){if(!e){e=this.varLabelFont}if(this.data.y||this.data.w){var g=this.graphType.match(/BarLine|StackedLine|StackedPercentLine/)?this.data.y:this.isGroupedData?this.data.w:this.data.y;var d=0;this.maxVarName=0;this.maxVarNameStr="";if(g.vars){for(var f=0;f<this.varIndices.length;f++){var b=this.measureText(g.vars[this.varIndices[f]],e);if(b>d){d=b;this.maxVarName=g.vars[this.varIndices[f]].length;this.maxVarNameStr=g.vars[this.varIndices[f]]}}}}};this.setRangeData=function(e,f,b,w){var d=this.isGroupedData&&!f?this.data.w:this.data.y;var p=Number.MAX_VALUE;var t=Number.MIN_VALUE;if(this.setMin!=null&&this.setMax!=null){this.minData=this.setMin;this.maxData=this.setMax;return}if(this.isGroupedData&&!e){e=this.summaryType}if(e=="genome"){for(var u=0;u<this.data.tracks.length;u++){for(var r=0;r<this.data.tracks[u].data.length;r++){for(var q=0;q<this.data.tracks[u].data[r].data.length;q++){if(this.data.tracks[u].type=="box"){o=this.data.tracks[u].data[r].data[q];t=Math.max(t,Math.max(o[0],o[1]));p=Math.min(p,Math.min(o[0],o[1]))}else{if(this.data.tracks[u].type.match(/bar|heatmap|sequence/)){o=this.data.tracks[u].data[r].data;t=Math.max(t,o[0]);p=Math.min(p,o[0])}else{o=this.data.tracks[u].data[r].data;t=Math.max(t,o);p=Math.min(p,o)}}}}}}else{if(e=="percentile"&&!f){p=0;t=100}else{if((e=="mean"||e=="median"||e=="sum")&&!f){if(w){var g=this.isGroupedData?this.grpIndices:this.smpIndices;var A=this.isTransformedData?d.trans:d[this.summaryType];for(var u=0;u<g.length;u++){var n=g[u];var m=0;for(var r=0;r<this.varIndices.length;r++){var v=this.varIndices[r];var C=A[v][n];if(!isNaN(C)&&C>0){m+=C}}t=Math.max(m,t)}p=0}else{for(var u=0;u<this.varIndices.length;u++){var n=this.varIndices[u];var o;if(this.isTransformedData){o=d.trans[n]}else{if(this.summaryType=="mean"){o=d.mean[n]}else{if(this.summaryType=="median"){o=d.median[n]}else{if(this.summaryType=="sum"){o=d.sum[n]}}}}for(var r=0;r<o.length;r++){var z;var C=o[r];if(d.stdev&&!this.isTransformedData){z=d.stdev[n][r]}else{z=Number.NaN}if(!isNaN(C)){if(!isNaN(z)){if(b){if(C>0){p=Math.min(C,p);t=Math.max(C+z,t)}}else{p=Math.min(C,p);t=Math.max(C+z,t)}}else{if(b){if(C>0){p=Math.min(C,p);t=Math.max(C,t)}}else{p=Math.min(C,p);t=Math.max(C,t)}}}}}}}else{if(e=="iqr"&&!f){if(this.isTransformedData){alert("Transformation not allowed");this.isTransformedData=false}for(var u=0;u<this.varIndices.length;u++){var n=this.varIndices[u];for(var r=0;r<d.iqr1.length;r++){var y=d.iqr1[n][r];var x=d.iqr3[n][r];var s=d.out[n][r];if(!isNaN(y)&&!isNaN(x)){if(b){if(y>0&&x>0){p=Math.min(y,p);t=Math.max(x,t)}}else{p=Math.min(y,p);t=Math.max(x,t)}}if(s){for(var q=0;q<s.length;q++){if(!isNaN(s[q])){if(b){if(s[q]>0){p=Math.min(s[q],p);t=Math.max(s[q],t)}}else{p=Math.min(s[q],p);t=Math.max(s[q],t)}}}}}}}else{if(e=="candle"){if(this.isTransformedData){alert("Transformation not allowed");this.isTransformedData=false}var g=this.isGroupedData?this.grpIndices:this.smpIndices;for(var u=0;u<this.varIndices.length;u++){var n=this.varIndices[u];for(var r=0;r<g.length;r++){var v=g[r];var h=d.high[n][v];var B=d.low[n][v];if(!isNaN(h)&&!isNaN(B)){p=Math.min(B,p);t=Math.max(h,t)}}}}else{if(e=="volume"){var g=this.isGroupedData?this.grpIndices:this.smpIndices;for(var u=0;u<this.varIndices.length;u++){var n=this.varIndices[u];for(var r=0;r<g.length;r++){var v=g[r];if(!isNaN(d.volume[n][v])){p=Math.min(d.volume[n][v],p);t=Math.max(d.volume[n][v],t)}}}}else{if(e=="cor"){var g=this.correlationAxis=="variables"?this.varIndices:this.isGroupedData?this.grpIndices:this.smpIndices;for(var u=0;u<g.length;u++){for(var r=0;r<g.length;r++){var C=this.isTransformedData?d.trans[u][r]:d.cor[u][r];if(!isNaN(C)){if(b){if(C>0){p=Math.min(C,p);t=Math.max(C,t)}}else{p=Math.min(C,p);t=Math.max(C,t)}}}}}else{var A=this.isTransformedData?d.trans:d.data;if(w){for(var u=0;u<this.smpIndices.length;u++){var m=0;for(var r=0;r<this.varIndices.length;r++){var C=A[this.varIndices[r]][this.smpIndices[u]];if(!isNaN(C)&&C>0){m+=C}}t=Math.max(m,t)}p=0}else{for(var u=0;u<this.varIndices.length;u++){for(var r=0;r<this.smpIndices.length;r++){var C=A[this.varIndices[u]][this.smpIndices[r]];if(!isNaN(C)){if(b){if(C>0){p=Math.min(C,p);t=Math.max(C,t)}}else{p=Math.min(C,p);t=Math.max(C,t)}}}}}}}}}}}}this.minData=this.setMin!=null?this.setMin:p;this.maxData=this.setMax!=null?this.setMax:t};this.sortIndices=function(g,e,b,j,f){var d=this;var h=this.isGroupedData?this.grpIndices:g=="vars"?this.varIndices:this.smpIndices;if(!e){e=this.sortDir}if(b&&g=="vars"&&this.data.z[b]){this.tmpAsciiArray=this.data.z[b];this.smpSort=-1;this.varSort=b}else{if(b&&g=="smps"&&this.data.x[b]){this.tmpAsciiArray=this.data.x[b];this.varSort=-1;this.smpSort=b}else{if(j){this.tmpAsciiArray=this.getDataForSmpGrpAtIndex(j-1);this.smpSort=j-1}else{if(f){this.tmpAsciiArray=this.data.y.data[f-1];this.varSort=f-1}else{this.tmpAsciiArray=this.isGroupedData?this.data.w.smps:g=="vars"?this.data.y.vars:this.data.y.smps;if(g=="vars"){this.varSort=false}else{this.smpSort=false}}}}}if(this.isAsciiArray(this.tmpAsciiArray)){h.sort(function(m,k){return d.sortAsciibetically(m,k)})}else{h.sort(function(m,k){return d.sortNumerically(m,k)})}if(e!="ascending"){h.reverse()}this.tmpAsciiArray=[]};this.isAsciiArray=function(b){for(var d=0;d<b.length;d++){if(isNaN(b[d])){return true}}return false};this.sortAsciibetically=function(e,d){return((this.tmpAsciiArray[e]>this.tmpAsciiArray[d])?1:(this.tmpAsciiArray[e]<this.tmpAsciiArray[d])?-1:0)};this.sortNumerically=function(e,d){return(this.tmpAsciiArray[e]-this.tmpAsciiArray[d])};this.isNumeric=function(b,g,f){if(g){for(var e=0;e<this.smpIndices.length;e++){var d=this.smpIndices[e];if(b[d]&&isNaN(b[d])){return false}}}else{if(f){for(var e=0;e<this.varIndices.length;e++){var d=this.varIndices[e];if(b[d]&&isNaN(b[d])){return false}}}else{for(var d=0;d<b.length;d++){if(b[d]&&isNaN(b[d])){return false}}}}return true};this.cleanArray=function(b,h,g){var e=[];if(h){for(var f=0;f<this.smpIndices.length;f++){var d=this.smpIndices[f];if(!isNaN(b[d])){e.push(b[d])}}}else{if(g){for(var f=0;f<this.varIndices.length;f++){var d=this.varIndices[f];if(!isNaN(b[d])){e.push(b[d])}}}else{for(var d=0;d<b.length;d++){if(!isNaN(b[d])){e.push(b[d])}}}}return e};this.cleanArrays=function(d,b,k,j){var h=[];var g=[];if(k){for(var f=0;f<this.smpIndices.length;f++){var e=this.smpIndices[f];if(!isNaN(d[e])&&!isNaN(b[e])){h.push(d[e]);g.push(b[e])}}}else{if(j){for(var f=0;f<this.varIndices.length;f++){var e=this.varIndices[f];if(!isNaN(d[e])&&!isNaN(b[e])){h.push(d[e]);g.push(b[e])}}}else{for(var e=0;e<d.length;e++){if(!isNaN(d[e])&&!isNaN(b[e])){h.push(d[e]);g.push(b[e])}}}}return[h,g]};this.sortArray=function(b,d){var f=[];if(b.length!=d.length){return b}for(var e=0;e<b.length;e++){if(b[d[e]]){f[e]=b[d[e]]}else{return b}}return f};this.reverseArray=function(b){var f=[];var e=0;for(var d=b.length-1;d>=0;d--){f[e]=b[d];e++}return f};this.percentile=function(f,b,g){var d=b-f;if(d==0){return 50}var e=g-f;return e*100/d};this.rank=function(b){var e=[];for(var d=0;d<b.length;d++){e.push(d)}e.sort(function(g,f){return b[g]-b[f]});return e};this.min=function(b,g,f){b=this.cleanArray(b,g,f);var e=Number.MAX_VALUE;for(var d=0;d<b.length;d++){e=Math.min(e,b[d])}return e};this.max=function(d,g,f){d=this.cleanArray(d,g,f);var b=Number.MIN_VALUE;for(var e=0;e<d.length;e++){b=Math.max(b,d[e])}return b};this.sum=function(b,h,g,f){b=this.cleanArray(b,h,g);var e=0;for(var d=0;d<b.length;d++){if(f){if(b[d]>0){e+=b[d]}}else{e+=b[d]}}return e};this.mean=function(b,h,f){b=this.cleanArray(b,h,f);var d=0;var g=0;for(var e=0;e<b.length;e++){if(!isNaN(b[e])){d+=b[e];g++}}if(g>0){d/=g}return d};this.range=function(d,h,g){d=this.cleanArray(d,h,g);var f=Number.MAX_VALUE;var b=Number.MIN_VALUE;for(var e=0;e<d.length;e++){f=Math.min(d[e],f);b=Math.max(d[e],b)}return[f,b]};this.median=function(b,j,g){b=this.cleanArray(b,j,g);var f=[];var e=[];var h=0;f[0]=Number.NaN;f[1]=Number.NaN;for(var d=0;d<b.length;d++){e.push(b[d]);h++}if(h>0){f[1]=h;e.sort(function(m,k){return m-k});if(h%2){f[0]=e[parseInt(h/2)]}else{f[0]=(e[parseInt((h-1)/2)]+e[h/2])/2}}return f};this.meanStandardDeviationN=function(b,k,h){b=this.cleanArray(b,k,h);var g=[];var e=0;var d=0;var j=0;for(var f=0;f<b.length;f++){d+=b[f];e+=b[f]*b[f];j++}if(j>0){d/=j;e=Math.sqrt(e/j-d*d);g.push(d);g.push(e);g.push(j)}else{g.push("");g.push("");g.push("")}return g};this.quantiles=function(o,e,u){o=this.cleanArray(o,e,u);var q=[];var j=[];var f=o.length;if(f>2){var r=Math.floor(f*0.25);var m=Math.floor(f*0.5);var d=Math.floor(f*0.75);o.sort(function(v,n){return v-n});var b;var t;var s;if(f%2){t=o[m]}else{t=this.mean([o[m-1],o[m]])}if((f/2)%2){b=o[r];s=o[d]}else{b=this.mean([o[r-1],o[r]]);s=this.mean([o[d-1],o[d]])}var p=(s-b)*1.5;var h;var g;for(var k=0;k<=r;k++){if(o[k]<b-p){j.push(o[k])}else{h=o[k];break}}for(var k=f-1;k>=d;k--){if(o[k]>s+p){j.push(o[k])}else{g=o[k];break}}q.push(b);q.push(t);q.push(s);q.push(h);q.push(g);q.push(j);q.push(f)}else{if(f>1){q.push(o[0]);q.push(o[1]);q.push(o[1]);q.push(o[0]);q.push(o[1]);q.push(j);q.push(f)}else{if(f>0){q.push(o[0]);q.push(o[0]);q.push(o[0]);q.push(o[0]);q.push(o[0]);q.push(j);q.push(f)}else{q.push(Number.NaN);q.push(Number.NaN);q.push(Number.NaN);q.push(Number.NaN);q.push(Number.NaN);q.push(Number.NaN)}}}return q};this.covariance=function(h,g,b,o){var f=this.cleanArrays(h,g,b,o);h=f[0];g=f[1];var m=0;var d=0;var k=this.mean(h);var j=this.mean(g);for(var e=0;e<h.length;e++){m+=h[e]*g[e];d++}if(d>0){m/=d;return m-(k*j)}return m};this.correlation=function(j,h,d,r){var g=this.cleanArrays(j,h,d,r);j=g[0];h=g[1];var e=0;var p=0;var m=0;var b=0;var k=0;var o=this.covariance(j,h);var q=0;for(var f=0;f<j.length;f++){p+=j[f];m+=h[f];b+=j[f]*j[f];k+=h[f]*h[f];e++}if(e>0){q=(e*e)*o/Math.sqrt(((e*b)-(p*p))*((e*k)-(m*m)))}return q};this.regression=function(m,k,d,u){var j=this.cleanArrays(m,k,d,u);m=j[0];k=j[1];var e=0;var r=0;var p=0;var t=0;var b=0;var o=0;var q=this.covariance(m,k);var s=0;var h=0;var f=0;for(var g=0;g<m.length;g++){r+=m[g];p+=k[g];t+=m[g]*k[g];b+=m[g]*m[g];o+=k[g]*k[g];e++}if(e>2){h=(e*t-r*p)/(e*b-r*r);f=(p-h*r)/e;s=(e*e)*q/Math.sqrt(((e*b)-(r*r))*((e*o)-(p*p)))}return[h,f,s]};this.slope=function(d,f,b,e){return f!=e?(b-d)/(e-f):0};this.intercept=function(b,e,d){return e-(b*d)};this.slopeIntercept=function(d,g,b,f){var e=this.slope(d,g,b,f);return[e,this.intercept(d,g,e)]};this.normalize=function(g){for(var f=0;f<g.length;f++){var b=this.meanStandardDeviationN(g[f]);for(var e=0;e<g[f].length;e++){g[f][e]=(g[f][e]-b[0])/b[1]}}return g};this.euclidianDistance=function(e,b,k,j){var g=this.cleanArrays(e,b,k,j);e=g[0];b=g[1];var h=0;if(e.length==b.length){for(var f=0;f<e.length;f++){h+=Math.pow(e[f]-b[f],2)}h=Math.sqrt(h)}return h};this.manhattanDistance=function(e,b,k,j){var g=this.cleanArrays(e,b,k,j);e=g[0];b=g[1];var h=0;if(e.length==b.length){for(var f=0;f<e.length;f++){h+=Math.abs(e[f]-b[f])}}return h};this.maxDistance=function(e,b,k,j){var g=this.cleanArrays(e,b,k,j);e=g[0];b=g[1];var h=0;if(e.length==b.length){for(var f=0;f<e.length;f++){h=Math.max(h,Math.abs(e[f]-b[f]))}}return h};this.addVectors=function(e,d,j,h){var g=this.cleanArrays(e,d,j,h);e=g[0];d=g[1];var b=[];if(e.length==d.length){for(var f=0;f<e.length;f++){b.push(e[f]+d[f])}}return b};this.compareVectors=function(d,b){if(this.isArray(d)&&this.isArray(b)){if(d.length!=b.length){return false}for(var e=0;e<d.length;e++){if(this.isArray(d[e])&&this.isArray(b[e])){if(!this.compareArrays(d[e],b[e])){return false}}if(d[e]!==b[e]){return false}}return true}};this.vectorDotProduct=function(d,b,j,h){var f=this.cleanArrays(d,b,j,h);d=f[0];b=f[1];var g=0;if(d.length==b.length){for(var e=0;e<d.length;e++){g+=d[e]*b[e]}}return g};this.multiplyVectorByValue=function(b,f,g,e){b=this.cleanArray(b,g,e);for(var d=0;d<b.length;d++){b[d]*=f}return b};this.getCentroid=function(e,h,g,b){var j=[];if(h.length==b.length){var f=e+g;for(var d=0;d<h.length;d++){j.push((e*h[d]+g*b[d])/f)}}return j};this.createNode=function(k,e,f,g,j,b){var h={id:k,left:e,right:f,dist:g,centroid:j};if(b){h.mid=b}if(e==null&&f==null){h.size=1;h.depth=0}else{h.size=e.size+f.size;h.depth=1+Math.max(e.depth,f.depth)}return h};this.createRandomVectors=function(f,j){var e=j.length;if(f>e){return null}var p=[];var h=[];var b={};var q=0;var r=0;var o,d;while(r<f){if(q==e){return null}var m=Math.floor(Math.random()*e);if(m in b){continue}b[m]=1;q++;o=j[m];d=true;for(var g=0;g<r;g++){if(this.compareVectors(o,p[g])){d=false;break}}if(d){p[r]=o;h[r]=m;r++}}return{vectors:p,indices:h}};this.imputeDatum=function(b){var f=[];if(this.clusterAxis=="samples"){for(var d=0;d<this.varIndices.length;d++){var e=this.varIndices[d];f.push(this.data.y.data[e][b])}}else{for(var d=0;d<this.smpIndices.length;d++){var e=this.smpIndices[d];f.push(this.data.y.data[b][e])}}return this[this.imputeMethod](f)};this.getIdsForClustering=function(){var f=[];if(this.clusterAxis=="samples"){for(var b=0;b<this.smpIndices.length;b++){var e=this.smpIndices[b];f[b]=this.data.y.smps[e]}}else{for(var b=0;b<this.varIndices.length;b++){var e=this.varIndices[b];f[b]=this.data.y.vars[e]}}return f};this.getDataForClustering=function(){var n=[];var b=[];if(this.clusterAxis=="samples"){for(var f=0;f<this.smpIndices.length;f++){n[f]=[]}for(var f=0;f<this.varIndices.length;f++){var g=this.varIndices[f];for(var e=0;e<this.smpIndices.length;e++){var h=this.smpIndices[e];var k=this.data.y.data[g][h];if(isNaN(k)){if(!b[e]){b[e]=this.imputeDatum(h)}k=b[e]}n[e][f]=k}}}else{for(var f=0;f<this.varIndices.length;f++){n[f]=[]}for(var f=0;f<this.varIndices.length;f++){var g=this.varIndices[f];for(var e=0;e<this.smpIndices.length;e++){var h=this.smpIndices[e];var k=this.data.y.data[g][h];if(isNaN(k)){if(!b[f]){b[f]=this.imputeDatum(g)}k=b[f]}n[f][e]=k}}}if(this.centerData){n=this.normalize(n)}return n};this.cluster=function(){var w;var q=this.getDataForClustering();var h=this.getIdsForClustering();var g=[];var f=[];var r=[];var v=[];for(var o=0;o<q.length;o++){g[o]=[]}for(var o=0;o<q.length;o++){g[o][o]=Number.POSITIVE_INFINITY;for(var m=o+1;m<q.length;m++){g[o][m]=this[this.distance+"Distance"](q[o],q[m]);g[m][o]=g[o][m]}}for(var o=0;o<q.length;o++){f[o]=0;for(var m=0;m<q.length;m++){if(g[o][f[o]]>g[o][m]){f[o]=m}}}for(var o=0;o<q.length;o++){v[o]=[];v[o][0]=this.createNode(h[o],null,null,0,q[o]);r[o]=1}for(var b=0;b<q.length-1;b++){var n=0;for(var o=0;o<q.length;o++){if(g[o][f[o]]<g[n][f[n]]){n=o}}var k=f[n];var e=v[n][0];var s=v[k][0];var u=this.getCentroid(e.size,e.centroid,s.size,s.centroid);var t=this.createNode(-1,e,s,g[n][k],u);v[n].splice(0,0,t);r[n]+=r[k];for(var m=0;m<q.length;m++){if(this.linkage=="single"){if(g[n][m]>g[k][m]){g[m][n]=g[n][m]=g[k][m]}}else{if(this.linkage=="complete"){if(g[n][m]<g[k][m]){g[m][n]=g[n][m]=g[k][m]}}else{if(this.linkage=="average"){g[m][n]=g[n][m]=(r[n]*g[n][m]+r[k]*g[k][m])/(r[n]+r[m])}}}}g[n][n]=Number.POSITIVE_INFINITY;for(var o=0;o<q.length;o++){g[o][k]=g[k][o]=Number.POSITIVE_INFINITY}for(var m=0;m<q.length;m++){if(f[m]==k){f[m]=n}if(g[n][m]<g[n][f[n]]){f[n]=m}}w=t}return this.writeNewick(w)};this.isLeafNode=function(b){if(b.left==null&&b.right==null){return true}else{return false}};this.writeNewick=function(d,k){var j="";var h="";if(this.isLeafNode(d)){j=d.id}else{var b;var e=this.writeNewick(d.left,k);var g=this.writeNewick(d.right,k);if(d.mid){for(var f=0;f<d.mid.length;f++){if(k&&d.mid[f].dist){h+=","+d.mid[f].id+":"+d.mid[f].dist}else{h+=","+d.mid[f].id}h+=d.mid[f].id}}j="("+e+h+","+g+")"}if(k&&d.dist){j+=":"+d.dist}return j};this.kmeans=function(){var n;var p=this.getDataForClustering();var e=this.getIdsForClustering();var o=[];var q=[];var s=true;var r=0;var k=null;var x=this.createRandomVectors(this.kmeansClusters,p);if(x==null){return null}else{k=x.vectors}while(s){for(var m=0;m<this.kmeansClusters;m++){q[m]=0}for(var m=0;m<p.length;m++){var u=p[m];var h=Number.MAX_VALUE;var f;for(var g=0;g<this.kmeansClusters;g++){var b=this.euclidianDistance(k[g],u);if(b<h){h=b;f=g}}q[f]++;o[m]=f}var w=[];for(var m=0;m<this.kmeansClusters;m++){w[m]=null}for(var m=0;m<p.length;m++){if(w[o[m]]==null){w[o[m]]=p[m]}else{w[o[m]]=this.addVectors(w[o[m]],p[m])}}for(var m=0;m<this.kmeansClusters;m++){w[m]=this.multiplyVectorByValue(w[m],1/q[m])}s=false;for(var m=0;m<this.kmeansClusters;m++){if(!this.compareVectors(w[m],k[m])){s=true;break}}k=w;r++;if(r>this.maxIterations){s=false}}for(var m=0;m<o.length;m++){o[m]="K-"+(o[m]+1)}return o};this.transpose=function(k){if(k){var n=[];for(var g=0;g<k.length;g++){for(var f=0;f<k[g].length;f++){if(!n[f]){n[f]=[]}n[f][g]=k[g][f]}}return n}else{this.ungroupSamples();this.transform("reset");if(this.data.l){delete (this.data.l)}if(this.data.d){delete (this.data.d)}if(this.data.a){delete (this.data.a)}if(this.data.t){var e=this.data.t.vars;var h=this.data.t.smps;if(e){this.data.t.smps=e}if(h){this.data.t.vars=h}}var b=this.data.x;var m=this.data.z;if(b){this.data.z=b}if(m){this.data.x=m}var h=this.data.y.smps;this.data.y.smps=this.data.y.vars;this.data.y.vars=h;var n=this.data.y.data;this.data.y.data=[];for(var g=0;g<this.data.y.vars.length;g++){this.data.y.data[g]=[];for(var f=0;f<this.data.y.smps.length;f++){this.data.y.data[g][f]=n[f][g]}}this.initializeData(this.data);this.resetObject()}};this.checkObject=function(){var e=this.data.y;if(this.isGroupedData){this.data.w={};e=this.data.w}var d=["vars","smps","desc","data","mean","median","stdev","n","qtl1","qtl3","iqr1","iqr3","out","trans","cor","sum","grps","close","open","high","low","volume"];for(var b=0;b<d.length;b++){if(!e[d[b]]){e[d[b]]=[]}}};this.resetObject=function(b){var e=["mean","median","stdev","n","qtl1","qtl3","iqr1","iqr3","out","cor","sum","grps","close","open","high","low","volume"];if(this.isGroupedData){if(!this.isTransformedData){e.push("trans")}for(var d=0;d<e.length;d++){delete (this.data.y[e[d]])}delete (this.data.w)}else{if(!this.isTransformedData){e.push("trans")}if(this.isRawData){for(var d=0;d<e.length;d++){delete (this.data.y[e[d]])}}else{delete (this.data.y.data)}}if(b){this.checkObject()}};this.getDataAtPos=function(h,f,d,e,g,b){var k=Number.NaN;var m=this.isGroupedData?this.data.w:this.data.y;if(this.isGroupedData||!this.isRawData){if(this.isTransformedData){k=m.trans[h][f]}else{d=d?d:this.summaryType;if(m.hasOwnProperty(d)){k=m[d][h][f]}else{k=0}}}else{if(d&&m[d][h]){k=m[d][h][f]}else{if(this.isTransformedData){k=m.trans[h][f]}else{k=m.data[h][f]}}}if(e){if(!isNaN(k)){if(e=="log2"){k=Math.log(k)/Math.LN2}else{if(e=="log10"){k=Math.log(k)/Math.LN10}else{if(e=="exp2"){k=Math.pow(2,k)}else{if(e=="exp10"){k=Math.pow(2,k)}else{if(e=="percentile"){k=this.percentile(g,b,k)}}}}}}}return k};this.getDataForSmpGrpAtIndex=function(d,h){var b=[];if(!h){h=this.varIndices}if(this.isGroupedData||!this.isRawData){var j=this.isGroupedData?this.data.w:this.data.y;if(this.isTransformedData){b.push(j.trans[g][d])}else{var e=this.summaryType;if(j.hasOwnProperty(e)){for(var f=0;f<h.length;f++){var g=h[f];b.push(j[e][g][d])}}}}else{if(this.isTransformedData){for(var f=0;f<h.length;f++){var g=h[f];b.push(this.data.y.trans[g][d])}}else{for(var f=0;f<h.length;f++){var g=h[f];b.push(this.data.y.data[g][d])}}}return b};this.getMetaDataForVariableAtIndex=function(b){var e={};if(this.data.z){for(var d in this.data.z){e[d]=this.data.z[d][b]}}e[name]=this.data.y.vars[b];return e};this.getMetaDataForSampleAtIndex=function(b){if(this.isGroupedData){return this.getMetaDataForGrpAtIndex(b)}else{return this.getMetaDataForSmpAtIndex(b)}};this.getMetaDataForSmpAtIndex=function(b){var e={};if(this.data.x){for(var d in this.data.x){e[d]=this.data.x[d][b]}}e[name]=this.data.y.vars[b];return e};this.getMetaDataForGrpAtIndex=function(b){var f=[];for(var d=0;d<this.data.w.grps[b].length;d++){var e=this.data.w.grps[b][d];f.push(this.getMetaDataForSmpAtIndex[e])}return f};this.summarize=function(n,q){var b=this.isGroupedData?this.data.w:this.data.y;var d=this.isGroupedData?false:true;if(!this.isGroupedData){this.checkObject()}if(n=="cor"){this.isBoxPlotCalc=false;if(this.correlationAxis=="samples"){var r=this.isGroupedData?this.grpIndices:this.smpIndices;for(var f=0;f<r.length;f++){var s=r[f];var o=this.getDataForSmpGrpAtIndex(s);if(!b.cor[s]){b.cor[s]=[]}for(var e=f;e<r.length;e++){var h=r[e];if(!b.cor[h]){b.cor[h]=[]}var m=this.getDataForSmpGrpAtIndex(h);if(f==e){if(this.isTransformedData){b.trans[s][h]=1}b.cor[s][h]=1}else{b.cor[s][h]=this.correlation(o,m);b.cor[h][s]=b.cor[s][h];if(this.isTransformedData){b.trans[s][h]=b.cor[s][h];b.trans[h][s]=b.cor[h][s]}}}}}else{for(var f=0;f<this.varIndices.length;f++){var s=this.varIndices[f];if(!b.cor[s]){b.cor[s]=[]}for(var e=f;e<this.varIndices.length;e++){var h=this.varIndices[e];if(!b.cor[h]){b.cor[h]=[]}if(f==e){b.cor[s][h]=1;if(this.isTransformedData){b.trans[s][h]=1}}else{b.cor[s][h]=this.correlation(b.data[s],b.data[h],d);b.cor[h][s]=b.cor[s][h];if(this.isTransformedData){b.trans[s][h]=b.cor[s][h];b.trans[h][s]=b.cor[h][s]}}}}}}else{this.isBoxPlotCalc=n=="iqr"?true:false;for(var f=0;f<this.varIndices.length;f++){var g;var s=this.varIndices[f];if(!b.mean[s]){b.trans[s]=[];b.mean[s]=[];b.median[s]=[];b.stdev[s]=[];b.qtl1[s]=[];b.qtl3[s]=[];b.iqr1[s]=[];b.iqr3[s]=[];b.out[s]=[];b.n[s]=[];b.sum[s]=[]}if(this.isGroupedData){g=q[s]}else{b.grps=[];g=[];for(var e=0;e<this.smpIndices.length;e++){var h=this.smpIndices[e];b.grps[e]=[];b.grps[e].push(h);g[e]=[b.data[s][h]]}}if(n=="iqr"){this.summaryType="iqr";for(var e=0;e<g.length;e++){var p=this.quantiles(g[e],d);if(this.isTransformedData){b.trans[s][e]=p[1]}b.median[s][e]=p[1];b.qtl1[s][e]=p[0];b.qtl3[s][e]=p[2];b.iqr1[s][e]=p[3];b.iqr3[s][e]=p[4];b.out[s][e]=p[5];b.n[s][e]=p[6]}}else{if(n=="median"){this.summaryType="median";for(var e=0;e<g.length;e++){var p=this.median(g[e],d);if(this.isTransformedData){b.trans[s][e]=p[1]}b.median[s][e]=p[0];b.n[s][e]=p[1]}}else{if(n=="mean"){this.summaryType="mean";for(var e=0;e<g.length;e++){var p=this.meanStandardDeviationN(g[e],d);if(this.isTransformedData){b.trans[s][e]=p[1]}b.mean[s][e]=p[0];b.stdev[s][e]=p[1];b.n[s][e]=p[2]}}else{if(n=="sum"){this.summaryType="sum";for(var e=0;e<g.length;e++){var k=this.sum(g[e],d);if(this.isTransformedData){b.trans[s][e]=k}b.sum[s][e]=k;b.n[s][e]=g[e].length}}}}}}}};this.copySummarizedData=function(){var g=this.isGroupedData?this.data.w:this.data.y;var f;for(var d=0;d<this.varIndices.length;d++){var e=this.varIndices[d];g.data[e]=[];g.trans[e]=[];if(this.summaryType=="mean"){for(var b=0;b<g.mean[e].length;b++){g.data[e][b]=g.mean[e][b]}}else{if(this.summaryType=="median"||this.summaryType=="iqr"){for(var b=0;b<g.median[e].length;b++){g.data[e][b]=g.median[e][b]}}else{if(this.summaryType=="candle"){for(var b=0;b<g.close[e].length;b++){g.data[e][b]=g.close[e][b]}}else{if(this.summaryType=="volume"){for(var b=0;b<g.volume[e].length;b++){g.data[e][b]=g.volume[e][b]}}else{if(this.summaryType=="sum"){for(var b=0;b<g.volume[e].length;b++){g.data[e][b]=g.sum[e][b]}}}}}}if(!f){f=e}}return f};this.transformValue=function(d,e,b){switch(d){case"log2":return b?Math.pow(2,e):Math.log(e)/Math.LN2;case"log10":return b?Math.pow(10,e):Math.log(e)/Math.LN10;case"exp2":return b?Math.log(e)/Math.LN2:Math.pow(2,e);case"exp10":return b?Math.log(e)/Math.LN10:Math.pow(10,e);default:return e}};this.transform=function(e,d,b){var f=0;if(!this.isGroupedData){this.checkObject()}if(!this.isRawData||this.isGroupedData){f=this.copySummarizedData()}this.transformType=e;if(e=="reset"||e=="undo"){this.transformReset();this.transformType=false;this.isTransformedData=false}else{if(e=="save"){this.transformSave();this.transformType=false;this.isTransformedData=false}else{if(e=="log2"||e=="log10"||e=="exp2"||e=="exp10"){this.transformLogExp(e);this.isTransformedData=true}else{if(e=="ratio"||e=="ratio2"||e=="ratio10"){this.transformRatio(e,b);this.isTransformedData=true}else{this.transformRelative(e,d,f);this.isTransformedData=true}}}}};this.transformReset=function(){var f=this.isGroupedData?this.data.w:this.data.y;for(var d=0;d<this.varIndices.length;d++){var e=this.varIndices[d];for(var b=0;b<f.data[e].length;b++){if(f.trans[e]&&!isNaN(f.data[e][b])){f.trans[e][b]=f.data[e][b]}}}};this.transformSave=function(){var f=this.isGroupedData?this.data.w:this.data.y;for(var d=0;d<this.varIndices.length;d++){var e=this.varIndices[d];for(var b=0;b<f.data[e].length;b++){if(!isNaN(f.data[e][b])){f.data[e][b]=f.trans[e][b]}}}};this.transformLogExp=function(f){var g=this.isGroupedData?this.data.w:this.data.y;if(f=="log"){f=this.transformBase==2?"type2":"type10"}else{if(f=="exp"){f=this.transformBase==2?"exp2":"exp10"}}for(var d=0;d<this.varIndices.length;d++){var e=this.varIndices[d];if(!g.trans[e]){g.trans[e]=[]}for(var b=0;b<g.data[e].length;b++){if(!isNaN(g.data[e][b])){if(f=="log2"){this.isLogData=true;this.transformBase=2;g.trans[e][b]=Math.log(g.data[e][b])/Math.LN2}else{if(f=="log10"){this.isLogData=true;this.transformBase=10;g.trans[e][b]=Math.log(g.data[e][b])/Math.LN10}else{if(f=="exp2"){this.isLogData=false;this.transformBase=2;g.trans[e][b]=Math.pow(2,g.data[e][b])}else{if(f=="exp10"){this.isLogData=false;this.transformBase=10;g.trans[e][b]=Math.pow(10,g.data[e][b])}}}}}}}};this.transformRatio=function(g,b){var k=this.isGroupedData?this.data.w:this.data.y;b=b?b:this.ratioReference;for(var e=0;e<this.varIndices.length;e++){var f=this.varIndices[e];if(!k.trans[f]){k.trans[f]=[]}for(var d=0;d<k.data[f].length;d++){if(!isNaN(k.data[f][d])&&!isNaN(k.data[f][b])){if(this.isLogData){if(g=="ratio"){g=this.transformBase==2?"ratio2":"ratio10"}var h;if(k.data[f][d]>=k.data[f][b]){h=k.data[f][d]-k.data[f][b];if(g=="ratio2"){k.trans[f][d]=Math.pow(2,h)}else{if(g=="ratio10"){k.trans[f][d]=Math.pow(10,h)}}}else{h=k.data[f][b]/k.data[f][e];if(g=="ratio2"){k.trans[f][d]=Math.pow(2,h)*-1}else{k.trans[f][d]=Math.pow(10,h)*-1}}}else{if(k.data[f][d]>=k.data[f][b]){k.trans[f][d]=k.data[f][d]/k.data[f][b]}else{k.trans[f][d]=k.data[f][b]/k.data[f][d]*-1}}}}}};this.transformRelative=function(n,e,f){var b=this.isGroupedData?this.data.w:this.data.y;var d=this.isGroupedData?false:true;e=e?e:this.zscoreAxis;if(e=="samples"){for(var h=0;h<b.data[f].length;h++){var k=[];for(var g=0;g<this.varIndices.length;g++){var m=this.varIndices[g];k.push(b.data[m][h])}if(n=="percentile"){var o=this.range(k,d)}else{if(n=="zscore"){var o=this.meanStandardDeviationN(k,d)}}for(var g=0;g<this.varIndices.length;g++){var m=this.varIndices[g];if(!b.trans[m]){b.trans[m]=[]}if(!isNaN(b.data[m][h])){if(n=="percentile"){b.trans[m][h]=this.percentile(o[0],o[1],b.data[m][h])}else{if(n=="zscore"){b.trans[m][h]=(b.data[m][h]-o[0])/o[1]}}}}}}else{for(var h=0;h<this.varIndices.length;h++){var p=this.varIndices[h];b.trans[p]=[];var k=b.data[p];if(n=="percentile"){var o=this.range(k,d)}else{if(n=="zscore"){var o=this.meanStandardDeviationN(k,d)}}for(var g=0;g<k.length;g++){if(!isNaN(b.data[p][g])){if(n=="percentile"){b.trans[p][g]=this.percentile(o[0],o[1],b.data[p][g])}else{if(n=="zscore"){b.trans[p][g]=(b.data[p][g]-o[0])/o[1]}}}}}}};this.getGroupingFactors=function(b){if(b){return this.groupingFactors}else{return this.getObjectArray(this.groupingFactors)}};this.modifyGroupingFactors=function(d,b){this.modifyObjectArray(d,b,"groupingFactors")};this.segregateSamplesVariables=function(m,k,g,n){delete (this.data.l);this.deleteSubGraphAttributes();this.data.l={};this.data.l.smps=m;this.data.l.vars=k;this.data.l.weight=[];this.data.l.type=[];this.data.l.name=[];this.data.l.desc=[];var h=1/m.length;var e=1/k.length;var f=this.data.y.desc[0]?this.data.y.desc[0]:"";for(var d=0;d<k.length;d++){for(var b=0;b<m.length;b++){this.data.l.weight.push([e,h]);this.data.l.type.push(this.graphType);this.data.l.name.push([n[d],g[b]]);this.data.l.desc.push(f)}}this.layoutComb=true;this.layout=m.length+"X"+k.length;this.isValidLayout()};this.desegregateSamples=function(){this.segregateSamplesBy=false;this.showAnimation=this.showAnimationTemp;this.resetLayout();if(this.segregateVariablesBy){this.segregateVariables(this.segregateVariablesBy)}else{this.isValidLayout()}};this.segregateSamples=function(k){if(this.data.x&&this.data.x[k]){delete (this.layoutParams);var d={};var j=0;var g=[];var h=[];for(var e=0;e<this.data.x[k].length;e++){var f=this.data.x[k][e];if(!d.hasOwnProperty(f)){d[f]=[];j++}d[f].push(this.data.y.smps[e])}var b=1/j;if(this.segregateVariablesBy){vars=this.data.l.vars;for(var f in d){g.push(f);h.push(d[f])}this.segregateSamplesBy=k;this.segregateSamplesVariables(h,this.data.l.vars,g,this.data.l.name)}else{delete (this.data.l);this.deleteSubGraphAttributes();this.data.l={};this.data.l.smps=[];this.data.l.weight=[];this.data.l.type=[];this.data.l.name=[];this.data.l.desc=[];for(var f in d){this.data.l.smps.push(d[f]);this.data.l.weight.push(b);this.data.l.type.push(this.graphType);this.data.l.name.push(f);this.data.l.desc.push(this.data.y.desc&&this.data.y.desc[0]?this.data.y.desc[0]:"")}this.segregateSamplesBy=k;this.layoutComb=true;this.showAnimationTemp=this.showAnimation;this.showAnimation=false;this.layout="1X"+this.data.l.smps.length;this.isValidLayout()}}};this.desegregateVariables=function(){this.segregateVariablesBy=false;this.showAnimation=this.showAnimationTemp;this.resetLayout();if(this.segregateSamplesBy){this.segregateSamples(this.segregateSamplesBy)}else{this.isValidLayout()}};this.segregateVariables=function(b){if(this.data.z&&this.data.z[b]){delete (this.layoutParams);var e={};var m=0;var k=[];var j=[];for(var f=0;f<this.data.z[b].length;f++){var h=this.data.z[b][f];if(!e.hasOwnProperty(h)){e[h]=[];m++}e[h].push(this.data.y.vars[f])}var d=1/m;if(this.segregateSamplesBy){for(var h in e){j.push(h);k.push(e[h])}this.segregateVariablesBy=b;this.segregateSamplesVariables(this.data.l.smps,k,this.data.l.name,j)}else{delete (this.data.l);this.deleteSubGraphAttributes();this.data.l={};this.data.l.vars=[];this.data.l.weight=[];this.data.l.type=[];this.data.l.name=[];this.data.l.desc=[];for(var h in e){this.data.l.vars.push(e[h]);this.data.l.weight.push(d);this.data.l.type.push(this.graphType);this.data.l.name.push(h);this.data.l.desc.push(this.data.y.desc&&this.data.y.desc[0]?this.data.y.desc[0]:"")}this.segregateVariablesBy=b;this.layoutComb=true;this.showAnimationTemp=this.showAnimation;this.showAnimation=false;this.layout="1X"+this.data.l.vars.length;this.isValidLayout()}}};this.deleteSubGraphAttributes=function(){if(this.layoutRows&&this.layoutCols){var e=0;for(var d=0;d<this.layoutRows;d++){for(var b=0;b<this.layoutCols;b++){delete (this["subGraphWeight"+e]);delete (this["subGraphType"+e]);delete (this["subGraphSummaryType"+e]);delete (this["subGraphTransformType"+e]);e++}}}};this.unsetAllVsAll=function(){if(this.graphType.match(/Scatter/)){this.xAxis=this.xAxisTemp;this.xAxisTmp=[];this.yAxis=this.yAxisTemp;this.yAxisTmp=[];this.zAxis=this.zAxisTemp;this.zAxisTmp=[];this.allVsAll=false;this.showAnimation=this.showAnimationTemp;this.resetLayout();this.isValidLayout()}};this.setAllVsAll=function(){if(this.graphType.match(/Scatter/)){var f=this.data.y.data[0].length;var b=1/f;this.xAxisTemp=this.xAxisTemp||this.xAxis;this.xAxis=[];this.yAxisTemp=this.yAxisTemp||this.yAxis;this.yAxis=[];this.zAxisTemp=this.zAxisTemp||this.zAxis;this.zAxis=[];this.data.l={};this.data.l.smps=[];this.data.l.weight=[];this.data.l.type=[];this.data.l.desc=[];for(var e=0;e<f;e++){for(var d=0;d<f;d++){this.data.l.weight.push(b);this.data.l.desc.push(this.data.y.desc&&this.data.y.desc[0]?this.data.y.desc[0]:"");this.data.l.type.push(this.graphType);if(e==d){this.data.l.smps.push({})}else{if(this.allVsAllType=="upper"){if(d>e){this.data.l.smps.push({xAxis:[this.data.y.smps[d]],yAxis:[this.data.y.smps[e]]})}else{this.data.l.smps.push({})}}else{if(this.allVsAllType=="lower"){if(e>d){this.data.l.smps.push({xAxis:[this.data.y.smps[d]],yAxis:[this.data.y.smps[e]]})}else{this.data.l.smps.push({})}}else{this.data.l.smps.push({xAxis:[this.data.y.smps[d]],yAxis:[this.data.y.smps[e]]})}}}}}this.layoutComb=true;this.showAnimationTemp=this.showAnimation;this.showAnimation=false;this.layout=f+"X"+f;this.isValidLayout()}};this.setMultiplePies=function(){if(this.graphType.match(/Pie/)){var g,j;var h=this.xAxis.length;if(this.layout){var d=this.layout.split(/X/i);g=parseInt(d[0]);j=parseInt(d[1]);if(g*j<h){g=Math.ceil(Math.sqrt(h));j=Math.floor(Math.sqrt(h));this.layout=g+"X"+j}}else{g=Math.ceil(Math.sqrt(h));j=Math.floor(Math.sqrt(h));this.layout=g+"X"+j}var b=1/g;var f=1/j;delete (this.layoutParams);delete (this.data.l);this.deleteSubGraphAttributes();this.data.l={};this.data.l.smps=[];this.data.l.weight=[];this.data.l.type=[];this.data.l.desc=[];for(var e=0;e<h;e++){this.data.l.smps.push([this.xAxis[e]]);this.data.l.weight.push([f,b]);this.data.l.desc.push(this.data.y.desc&&this.data.y.desc[0]?this.data.y.desc[0]:"");this.data.l.type.push(this.graphType)}this.layoutComb=true;this.showAnimationTemp=this.showAnimation;this.showAnimation=false;this.isValidLayout()}};this.ungroupSamples=function(){this.isGroupedData=false;this.groupingFactors=[];this.grpIndices=[];this.hiddenGrps=[];this.setMaxSmpStringName();return};this.createHistogram=function(e){var p,m,k,r,s;var d=0;var q=[];var b=[];var o=[];var h={};h.y={};h.y.data=[];h.y.vars=[];h.y.smps=[];if(this.graphType.match(/Scatter/)){if(this.type2D=="XYZ"){p=e=="y"?this.yAxisIndices[this.yAxisCurrent]:this.xAxisIndices[this.xAxisCurrent];q.push(p)}else{if(this.type2D=="XY"){for(var g=0;g<this.xAxisIndices.length;g++){p=e=="y"?this.yAxisIndices[g]:this.xAxisIndices[g];q.push(p)}}else{if(this.type2D=="X"){if(e=="y"){q.push(this.yAxisIndices[this.yAxisCurrent])}else{for(var g=0;g<this.xAxisIndices.length;g++){q.push(this.xAxisIndices[g])}}}else{if(e=="y"){for(var g=0;g<this.yAxisIndices.length;g++){q.push(this.yAxisIndices[g])}}else{q.push(this.xAxisIndices[this.xAxisCurrent])}}}}for(var g=0;g<this.histogramBins;g++){h.y.vars.push("Bin"+(g+1));h.y.data[g]=[]}for(var g=0;g<q.length;g++){h.y.smps.push(this.data.y.smps[q[g]]);h.y.smps.push(this.data.y.smps[q[g]]+" counts");b.push(this.data.y.smps[q[g]]);o.push(this.data.y.smps[q[g]]+" counts");var n=[];for(var f=0;f<this.histogramBins;f++){n[f]=0}m=this.getDataForSmpGrpAtIndex(q[g]);k=this.range(m);r=((k[1]-k[0])/this.histogramBins)+(k[0]/(this.histogramBins*2));for(var f=0;f<m.length;f++){s=Math.floor((m[f]-k[0])/r);n[s]++}for(var f=0;f<this.histogramBins;f++){h.y.data[f][d]=r*(f+1)}d++;for(var f=0;f<this.histogramBins;f++){h.y.data[f][d]=n[f]}d++}this.isCreateHistogram=true;this.isHistogram=true;this.histogramBarWidthStndBy=this.histogramBarWidth;this.dataStndBy=this.data;this.data={};this.resetConfig(["graphType","isHistogram"]);this.xAxis=b;this.yAxis=o;this.showLegend=false;this.histogramBarWidth=1.5;this.initializeData(h)}};this.removeHistogram=function(){this.isCreateHistogram=false;this.histogramBarWidth=this.histogramBarWidthStndBy;this.switchData()};this.addRegressionLine=function(){var d,j,f,b,k,h,e;if(this.graphType.match(/Scatter/)){if(this.type2D=="XYZ"){d=this.xAxisIndices[this.xAxisCurrent];j=this.yAxisIndices[this.yAxisCurrent];h=this.data.y.smps[d]+" vs "+this.data.y.smps[j];f=this.getDataForSmpGrpAtIndex(d);b=this.getDataForSmpGrpAtIndex(j);k=this.regression(f,b);this.addRegressionDecoration(k,h,this.foreground)}else{if(this.type2D=="XY"){for(var g=0;g<this.xAxisIndices.length;g++){e=g%this.colors.length;d=this.xAxisIndices[g];j=this.yAxisIndices[g];h=this.data.y.smps[d]+" vs "+this.data.y.smps[j];f=this.getDataForSmpGrpAtIndex(d);b=this.getDataForSmpGrpAtIndex(j);k=this.regression(f,b);this.addRegressionDecoration(k,h,this.colors[e])}}else{if(this.type2D=="X"){j=this.yAxisIndices[this.yAxisCurrent];b=this.getDataForSmpGrpAtIndex(j);for(var g=0;g<this.xAxisIndices.length;g++){e=g%this.colors.length;d=this.xAxisIndices[g];h=this.data.y.smps[d]+" vs "+this.data.y.smps[j];f=this.getDataForSmpGrpAtIndex(d);k=this.regression(f,b);this.addRegressionDecoration(k,h,this.colors[e])}}else{d=this.xAxisIndices[this.xAxisCurrent];f=this.getDataForSmpGrpAtIndex(d);for(var g=0;g<this.yAxisIndices.length;g++){e=g%this.colors.length;j=this.yAxisIndices[g];b=this.getDataForSmpGrpAtIndex(j);h=this.data.y.smps[d]+" vs "+this.data.y.smps[j];k=this.regression(f,b);this.addRegressionDecoration(k,h,this.colors[e])}}}}}};this.addRegressionDecoration=function(e,d,b){this.showDecorations=true;if(!this.data.d){this.data.d={}}if(!this.data.d.reg){this.data.d.reg=[]}this.data.d.reg.push({slope:e[0],intercept:e[1],cor:e[2],label:d,color:b})};this.addNormalDistributionLine=function(d){var q,h,o,j,k,m,n,g,e,g,b,p;if(this.graphType.match(/Scatter/)){if(this.type2D=="XYZ"){o=d=="y"?this.yAxisIndices[this.yAxisCurrent]:this.xAxisIndices[this.xAxisCurrent];j=d=="y"?this.xAxisIndices[this.xAxisCurrent]:this.yAxisIndices[this.yAxisCurrent];k=this.getDataForSmpGrpAtIndex(o);m=this.getDataForSmpGrpAtIndex(j);n=this.max(m);g=this.data.y.smps[o];e=this.meanStandardDeviationN(k);this.addNormalDistributionDecoration(e,n,g,this.foreground,d)}else{q=d=="y"?this.yAxisIndices:this.xAxisIndices;h=d=="y"?this.xAxisIndices:this.yAxisIndices;p=d=="y"?this.xAxisCurrent:this.yAxisCurrent;for(var f=0;f<q.length;f++){b=f%this.colors.length;o=q[f];j=h[f]?h[f]:h[p];k=this.getDataForSmpGrpAtIndex(o);m=this.getDataForSmpGrpAtIndex(j);n=this.max(m);g=this.data.y.smps[o];e=this.meanStandardDeviationN(k);this.addNormalDistributionDecoration(e,n,g,this.colors[b],d)}}}};this.addNormalDistributionDecoration=function(g,b,e,d,f){this.showDecorations=true;if(!this.data.d){this.data.d={}}if(!this.data.d.nor){this.data.d.nor=[]}if(f&&f=="y"){this.data.d.nor.push({mu:g[0],sigma:g[1],yAxis:true,max:b,label:e,color:d})}else{this.data.d.nor.push({mu:g[0],sigma:g[1],max:b,label:e,color:d})}};this.createRandomData=function(){var f={};f.y={};f.y.data=[];f.y.vars=[];f.y.smps=[];for(var d=0;d<this.randomDataSamples;d++){f.y.smps[d]="Sample"+(d+1)}for(var d=0;d<this.randomDataVariables;d++){f.y.data[d]=[];f.y.vars[d]="Variable"+(d+1);for(var b=0;b<this.randomDataSamples;b++){f.y.data[d].push(Math.floor(((Math.random()*2-1)+(Math.random()*2-1)+(Math.random()*2-1))*this.randomDataSigma+this.randomDataMean))}}f.x={};var e=Math.floor(this.randomDataSamples/this.randomDataSampleAnnotationRatio);for(var d=0;d<this.randomDataSampleAnnotations;d++){f.x["Factor"+(d+1)]=[];for(var b=0;b<this.randomDataSamples;b++){f.x["Factor"+(d+1)][b]="Level"+(Math.floor(Math.random()*e)+1)}}f.z={};var e=Math.floor(this.randomDataVariables/this.randomDataVariableAnnotationRatio);for(var d=0;d<this.randomDataVariableAnnotations;d++){f.z["Annt"+(d+1)]=[];for(var b=0;b<this.randomDataVariables;b++){f.z["Annt"+(d+1)][b]="Desc"+(Math.floor(Math.random()*e)+1)}}if(this.data&&!this.dataStndBy){this.dataStndBy=this.data;this.data={}}this.resetConfig(["graphType"]);this.initializeData(f)};this.restoreRandomData=function(){this.switchData()};this.groupSamples=function(f,r){if(f.length<1){return this.ungroupSamples()}for(var m=0;m<f.length;m++){if(!f||!this.data.x[f[m]]){return this.ungroupSamples()}}if(this.layoutComb&&this.data.l.comp){this.varIndices=[];for(var m=0;m<this.data.l.comp.length;m++){for(var h=0;h<this.data.l.comp[m].length;h++){this.varIndices.push(this.data.l.comp[m][h])}}}this.resetIndices();this.isGroupedData=true;this.groupingFactors=f;this.resetObject(true);this.hiddenGrps=[];var x={};var b=[];var e=0;for(var m=0;m<this.smpIndices.length;m++){var u=this.smpIndices[m];var w=[];var s;for(var h=0;h<f.length;h++){var n=f[h];s=this.data.x[n][u];if(!s){s="NA"}w.push(s)}s=w.join(" - ");if(!x.hasOwnProperty(s)){this.data.w.smps.push(s);b[e]=s;x[s]=[];x[s].push(u);e++}else{x[s].push(u)}}for(var m=0;m<b.length;m++){var s=b[m];this.data.w.grps.push(x[s])}this.grpIndices=[];for(var m=0;m<this.data.w.grps.length;m++){this.grpIndices.push(m);this.hiddenGrps.push(false)}for(var m=0;m<this.varIndices.length;m++){this.data.w.vars.push(this.data.y.vars[this.varIndices[m]])}var o=[];if(r){if(this.isArray(r)){o=r}else{o.push(r)}}else{r=this.graphType=="Boxplot"?"iqr":"mean";o.push(r)}for(var v=0;v<o.length;v++){var q=[];var p=o[v];if(this.isTransformedData){a=this.data.y.trans}else{if(this.isRawData){a=this.data.y.data}else{if(this.summaryType=="median"||this.summaryType=="iqr"){a=this.data.y.median}else{if(this.summaryType=="mean"){a=this.data.y.mean}else{if(this.summaryType=="cor"){a=this.data.y.cor}else{if(this.summaryType=="sum"){a=this.data.y.sum}else{a=this.data.y[this.summaryType]}}}}}}for(var m=0;m<this.varIndices.length;m++){var u=this.varIndices[m];q[u]=[];for(var h=0;h<this.data.w.grps.length;h++){q[u][h]=[];for(var g=0;g<this.data.w.grps[h].length;g++){var d=this.data.w.grps[h][g];q[u][h].push(a[u][d])}}}this.summarize(p,q)}this.setMaxVarStringName();this.setMaxSmpStringName();this.xAxisValues=[];this.xAxis2Values=[];this.yAxisValues=[];this.zAxisValues=[];if(!this.layoutComb||!this.layoutAdjust){if(typeof(this.setAxes)=="function"){this.setAxes()}}};this.initializeDataAttributes=function(){this.setIndices();if(this.graphType!="Network"&&this.graphType!="Genome"&&this.graphType!="Venn"){this.setMaxVarStringAttr();this.setMaxSmpStringAttr()}};this.initializeData=function(b){if(a&&!b){this.isExample=false;this.data=a;delete a}else{if(b){this.isExample=false;this.data=b;delete b}else{if(!this.remoteService){this.isExample=true}this.data=this.exampleRawData}}this.validGraphTypes=[];if(this.data.y||this.data.venn||this.data.nodes||this.data.tracks||this.data.market){if(this.data.market){this.setMarketData();this.summaryType="candle";this.validGraphTypes.push("Candlestick")}if(this.data.venn){this.summaryType="venn";this.validGraphTypes.push("Venn")}if(this.data.nodes){this.summaryType="network";this.validGraphTypes.push("Network")}if(this.data.tracks){this.summaryType="genome";this.validGraphTypes.push("Genome")}if(this.data.y){if(!this.data.y.data&&!this.data.y.mean&&!this.data.y.median&&!this.data.y.cor&&!this.data.y.sum&&!this.data.y.close){alert("Dude! there is not a valid data structure");return}else{if(this.data.y.data){this.isRawData=true;this.summaryType="raw"}else{this.isRawData=false;if(this.data.y.iqr1&&this.data.y.qtl1&&this.data.y.median&&this.data.y.qtl3&&this.data.y.iqr3){this.summaryType="iqr"}else{if(this.data.y.median){this.summaryType="median"}else{if(this.data.y.mean){this.summaryType="mean"}else{if(this.data.y.cor){this.summaryType="cor"}else{if(this.data.y.sum){this.summaryType="sum"}}}}}}}this.validGraphTypes.push("Bar");this.validGraphTypes.push("Line");this.validGraphTypes.push("Area");this.validGraphTypes.push("BarLine");this.validGraphTypes.push("Boxplot");this.validGraphTypes.push("Dotplot");this.validGraphTypes.push("Heatmap");this.validGraphTypes.push("Stacked");this.validGraphTypes.push("StackedLine");this.validGraphTypes.push("StackedPercent");this.validGraphTypes.push("StackedPercentLine");this.validGraphTypes.push("Pie");this.validGraphTypes.push("Correlation");if(this.data.y.smps){if(this.data.y.smps.length>2){this.validGraphTypes.push("Scatter2D");this.validGraphTypes.push("ScatterBubble2D");this.validGraphTypes.push("Scatter3D")}else{if(this.data.y.smps.length>1){this.validGraphTypes.push("Scatter2D")}}}}this.validGraphTypes.sort()}this.initializeDataAttributes()};this.setMarketData=function(){if(this.data.market&&!this.isMarketDataFormated){var e=this.data.market;this.data.market={};this.data.market.smps=[];this.data.market.vars=[];this.data.market.close=[];this.data.market.open=[];this.data.market.high=[];this.data.market.low=[];this.data.market.volume=[];this.data.market.desc=["Price","Vol"];var m={};var h=0;for(var g=0;g<e.length;g++){this.data.market.vars.push(e[g].symbol);this.data.market.close[g]=[];this.data.market.open[g]=[];this.data.market.high[g]=[];this.data.market.low[g]=[];this.data.market.volume[g]=[];var k=e[g].data;for(var f=k.length-1;f>=0;f--){var n=this.parseDate(k[f][0]);var b=0;if(!m.hasOwnProperty(n)){b=h;m[n]=h;this.data.market.smps.push(n);h++}else{b=m[n]}this.data.market.open[g][b]=k[f][1];this.data.market.high[g][b]=k[f][2];this.data.market.low[g][b]=k[f][3];this.data.market.close[g][b]=k[f][4];this.data.market.volume[g][b]=k[f][5]}}}this.isMarketDataFormated=true};this.switchToMarketData=function(){var b=this.data.market;this.dataStndBy=this.data;this.data={};this.data.y=b;this.initializeDataAttributes();if(this.showVolume){this.deleteSubGraphAttributes();this.data.l={};this.data.l.vars=[this.data.y.vars,this.data.y.vars];this.data.l.weight=this.graphOrientation=="vertical"?[0.75,0.25]:[0.25,0.75];this.data.l.type=["Candlestick","Candlestick"];this.data.l.name=this.graphOrientation=="vertical"?["Price","Volume"]:["Volume","Price"];this.data.l.desc=this.graphOrientation=="vertical"?["Price","Volume"]:["Volume","Price"];this.segregateSamplesBy=false;this.segregateVariablesBy=false;this.layoutComb=true;this.layout="1X2";this.isValidLayout()}};this.switchFromMarketData=function(){this.switchData();if(this.showVolume){this.resetLayout();this.isValidLayout()}};this.switchData=function(){if(this.dataStndBy){this.initConfig();this.data=this.dataStndBy;this.initializeData(this.data)}};this.initializeData()};CanvasXpress.prototype.initRemote=function(){this.ajaxRequest=function(url,callback,format,method){format=format=="json"?"json":"text";method=method=="POST"?"POST":"GET";var http=false;if(window.XMLHttpRequest){try{http=new XMLHttpRequest()}catch(e){http=false}}else{if(typeof ActiveXObject!="undefined"){try{http=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{http=new ActiveXObject("Microsoft.XMLHTTP")}catch(E){http=false}}}}if(http&&url&&callback){var now="uid="+new Date().getTime();url+=(url.indexOf("?")+1)?"&":"?";url+=now;http.open(method,url,true);if(method=="GET"){if(http.overrideMimeType){http.overrideMimeType("text/xml")}}else{var parameters=false;var parts=url.split("?");url=parts[0];parameters=parts[1];http.setRequestHeader("Content-type","application/x-www-form-urlencoded");http.setRequestHeader("Content-length",parameters.length);http.setRequestHeader("Connection","close")}http.onreadystatechange=function(){if(http.readyState==4){if(http.status==200){var result="";if(http.responseText){result=http.responseText}if(format=="json"){result=result.replace(/[\n\r]/g,"");result=eval("("+result+")")}if(callback){callback(result)}}else{if(error){error(http.status)}}}};http.send(parameters)}};this.requestRemoteData=function(ini){var params="index="+this.remoteDataIndex+"&dir="+this.remoteDirection;for(var p in this.remoteParams){params+="&"+p+"="+this.remoteParams[p]}if(ini){params+="&records=true"}var url=this.remoteService+"?"+params;this.ajaxRequest(url,this.updateRemoteData,"json","GET")};this.updateRemoteData=function(t){return function(res){if(res&&res.data){var d=res.data;var a=t.remoteDirection=="next"?true:false;var w=document.getElementById("wrapper-"+t.target);var p=w.parentNode;var r=w.getClientRects();var o=document.getElementById(t.target);t.insertTarget(d.renderTo,w,o.width,o.height,a);d.hidden=true;new CanvasXpress(d);t.addSelectOptionsRemoteData(p,res.ids);t.updateSelectOptionsRemoteData(p);t.resetInfoSpan(false,true);t.animateTransition(p,r[0]);t.target=d.renderTo}else{t.remoteDataIndex=t.remoteDirection=="next"?t.remoteDataIndex-1:t.remoteDataIndex+1;t.remoteUpdating=false}}}(this);this.addSelectOptionsRemoteData=function(p,ids){if(ids){var s=p.parentNode.firstChild.lastChild;for(var i=0;i<ids.length;i++){var opt=document.createElement("option");opt.text=ids[i];opt.value=i;if(this.remoteDataIndex==i){opt.selected="selected"}try{s.add(opt,null)}catch(ex){s.add(opt)}}}};this.updateSelectOptionsRemoteData=function(p){var s=p.parentNode.firstChild.lastChild;if(s){s.selectedIndex=this.remoteDataIndex}};this.animateTransition=function(b,r){if(b&&r){var that=this;var step=15;var s=0;var c1=b.firstChild;var c2=b.lastChild;var w=r.width;var h=r.height;b.parentNode.style.overflow="hidden";if(this.isIE){if(this.remoteDirection=="next"){b.removeChild(c1)}else{b.removeChild(c2)}b.style.overflow="auto";b.parentNode.style.overflow="visible";this.remoteUpdating=false}else{var updater=function(){this.update=function(){var n=Math.atan((s/step)*10-5)*0.5/Math.atan(5)+0.5;var l=w*n;if(s>=step){clearInterval(clearUpdateInt);if(that.remoteDirection=="next"){b.removeChild(c1);c2.style.left=0+"px"}else{b.removeChild(c2);c1.style.left=0+"px"}b.style.overflow="auto";b.parentNode.style.overflow="visible";that.remoteUpdating=false}else{if(that.remoteDirection=="next"){c1.style.left=(l*-1)+"px";c2.style.left=(l*-1)+"px"}else{c1.style.left=(-w+l)+"px";c2.style.left=(-w+l)+"px"}c1.style.display="block";c2.style.display="block"}s++};var clearUpdateInt=setInterval(this.update,100)};updater.call()}}};this.handleRemoteSelect=function(t){return function(e){var i=t.isIE?e.srcElement.selectedIndex:e.target.selectedIndex;t.remoteDirection=i>t.remoteDataIndex?"next":"previous";t.remoteDataIndex=i;t.requestRemoteData()}}(this);this.handleRemoteClickStop=function(t){return function(e){t.remoteStop=true}}(this);this.handleRemoteClickPlay=function(t){return function(e){var s=t.isIE?e.srcElement.parentNode.lastChild:e.target.parentNode.lastChild;t.remoteDirection="next";t.remoteStop=false;t.playRemoteData(s)}}(this);this.playRemoteData=function(s){var that=this;var updater=function(){this.update=function(){if(!that.remoteUpdating){that.remoteUpdating=true;that.showInfoSpan(false,"Updating ...",true);if(s&&s.tagName.match(/select/i)&&that.remoteDataIndex>=s.length-1){that.remoteDataIndex=0}else{that.remoteDataIndex++}that.requestRemoteData()}if(that.remoteStop){clearInterval(cl)}};var cl=setInterval(this.update,that.remoteAutoPlayDelay)};updater.call()};this.handleRemoteClickPrev=function(t){return function(e){if(!t.remoteUpdating){var s=t.isIE?e.srcElement.parentNode.lastChild:e.target.parentNode.lastChild;t.remoteUpdating=true;t.showInfoSpan(false,"Updating ...",true);t.remoteDirection="previous";if(s&&s.tagName.match(/select/i)&&t.remoteDataIndex<=0){t.remoteDataIndex=s.length-1}else{t.remoteDataIndex--}t.requestRemoteData()}}}(this);this.handleRemoteClickNext=function(t){return function(e){if(!t.remoteUpdating){var s=t.isIE?e.srcElement.parentNode.lastChild:e.target.parentNode.lastChild;t.remoteUpdating=true;t.showInfoSpan(false,"Updating ...",true);t.remoteDirection="next";if(s&&s.tagName.match(/select/i)&&t.remoteDataIndex>=s.length-1){t.remoteDataIndex=0}else{t.remoteDataIndex++}t.requestRemoteData()}}}(this);this.addRemoteNavigationTop=function(id,w){var m="3px";var n=document.createElement("div");var r=document.createElement("img");var p=document.createElement("img");var e=document.createElement("img");var f=document.createElement("img");var s=document.createElement("select");n.id="canvasXpressRemoteWindowTopBar"+id;n.style.position="absolute";n.style.marginLeft=w+"px";r.src=this.imageDir+this.previousButton;r.style.margin=m;this.addEvtListener(r,"click",this.handleRemoteClickPrev,false);n.appendChild(r);p.src=this.imageDir+this.playButton;p.style.margin=m;this.addEvtListener(p,"click",this.handleRemoteClickPlay,false);n.appendChild(p);e.src=this.imageDir+this.stopButton;e.style.margin=m;this.addEvtListener(e,"click",this.handleRemoteClickStop,false);n.appendChild(e);f.src=this.imageDir+this.nextButton;f.style.margin=m;this.addEvtListener(f,"click",this.handleRemoteClickNext,false);n.appendChild(f);s.style.position="absolute";s.style.fontSize="x-small";this.addEvtListener(s,"change",this.handleRemoteSelect,false);n.appendChild(s);return n};this.addRemoteNavigationLeftRight=function(d,id,w,h,m,q){var n=document.createElement("div");var i=document.createElement("img");n.style.height=(h+q)+"px";n.style.width=m+"px";n.style.top="0px";i.style.position="absolute";i.style.top=(h/2)+"px";i.style.left="1px";if(d=="l"){n.style.position="relative";n.id="canvasXpressRemoteWindowPrevBar"+id;n.style.left="0px";this.addEvtListener(n,"click",this.handleRemoteClickPrev,false);i.src=this.imageDir+this.previousButton}else{n.style.position="absolute";n.id="canvasXpressRemoteWindowNextBar"+id;n.style.left=(m+w)+"px";this.addEvtListener(n,"click",this.handleRemoteClickNext,false);i.src=this.imageDir+this.nextButton}i.style.margin="auto";n.appendChild(i);return n};this.addRemoteWindow=function(){var w=document.getElementById("wrapper-"+this.target);var c=document.getElementById(this.target);var p=w.parentNode;var n=0;var x=18;var y=20;var i="canvasXpressRemoteWindow"+n;var e=document.getElementById(i);if(p.id&&!p.id.match(/canvasXpressRemoteWindow/)){while(e){n++;i="canvasXpressRemoteWindow"+n;e=document.getElementById(i)}var d=document.createElement("div");var t=this.addRemoteNavigationTop(n,x);var l=this.addRemoteNavigationLeftRight("l",n,c.width,c.height,x,y);var v=document.createElement("div");var r=this.addRemoteNavigationLeftRight("r",n,c.width,c.height,x,y);d.id="canvasXpressRemoteWindow"+n;d.style.height=(y+c.height)+"px";d.style.width=((x*2)+c.width)+"px";d.style.position="relative";v.id="canvasXpressRemoteWindowBuffer"+n;v.style.height=c.height+"px";v.style.width=(c.width*2)+"px";v.style.position="absolute";v.style.left=x+"px";v.style.top=y+"px";v.style.overflow="hidden";d.appendChild(t);d.appendChild(l);d.appendChild(v);d.appendChild(r);p.insertBefore(d,w);v.appendChild(w.parentNode.appendChild(w));this.requestRemoteData(true);this.initialRemoteDataRequest=true;if(this.remoteAutoPlay){this.remoteUpdating=true;this.remoteDirection="next";this.remoteStop=false;this.playRemoteData(t.lastChild)}}else{this.initialRemoteDataRequest=false}};this.initializeRemote=function(){if(this.remoteService){this.addRemoteWindow()}};this.initializeRemote()};CanvasXpress.prototype.initGraph=function(){this.draw=function(b,e,a,d){this.setUserEvents();this.initializeGraph(true,b,e,a,d)};this.isValidGraphType=function(a){switch(a){case"Bar":case"Line":case"Area":case"Dotplot":case"Heatmap":case"Stacked":case"StackedPercent":case"Boxplot":case"Correlation":case"Pie":if(this.data.y){return true}else{return false}case"BarLine":case"StackedLine":case"StackedPercentLine":if(this.data.y&&this.data.a&&this.data.a.xAxis&&this.data.a.xAxis2){return true}else{return false}case"Scatter2D":if(this.data.y&&this.data.y.smps&&this.data.y.smps.length>1){return true}else{return false}case"ScatterBubble2D":case"Scatter3D":if(this.data.y&&this.data.y.smps&&this.data.y.smps.length>2){return true}else{return false}case"Candlestick":if(this.data.market){return true}else{return false}case"Venn":if(this.data.venn){return true}else{return false}case"Network":if(this.data.nodes){return true}else{return false}case"Genome":if(this.data.tracks){return true}else{return false}}return false};this.setColorScheme=function(){switch(this.colorScheme){case"basic":this.colors=this.colors0;break;case"dark":this.colors=this.colors1;break;case"strong":this.colors=this.colors2;break;case"light":this.colors=this.colors3;break;case"pastel":this.colors=this.colors4;break;case"user":this.colors=this.colors;break}};this.reinitializeGraph=function(){if(this.graphType=="Candlestick"){this.isGraphTime=true;if(!this.isMarketSwitched){this.switchToMarketData();this.initAxes();this.summaryType="candle";this.initializeDataAttributes();this.isMarketSwitched=true}}else{if(this.isExample&&this.isMarketSwitched){this.switchFromMarketData();this.isMarketSwitched=false;this.summaryType=this.data.y.data?"raw":"mean";this.initializeDataAttributes();this.isGraphTime=false;if(this.showVolume){this.layoutComb=false}}else{if(this.graphType.match(/Scatter/)&&this.allVsAll){this.setAllVsAll()}else{if(this.graphType.match(/Pie/)&&this.xAxis.length>1){this.setMultiplePies()}}}}};this.initializeGraph=function(o,a,n,h,b){var e=this;var j=5;var m=0;var f=[];var k=function(){for(var p=0;p<f.length;p++){if(!CanvasXpress.cacheImages.hasOwnProperty(f[p])){return false}}return true};if(this.graphType=="Network"){f=this.getNetworkImages()}if(this.backgroundImage){f.push(this.backgroundImage)}if(f.length>0&&!k()){for(var d=0;d<f.length;d++){if(!CanvasXpress.cacheImages.hasOwnProperty(f[d])){var g=new Image;g.onload=function(){CanvasXpress.cacheImages[this.src]=this;if(m<(j*f.length)){if(k()){e.renderGraph(o,a,n,h,b)}else{m++}}else{alert("Problem loading images")}};g.src=f[d]}}}else{this.renderGraph(o,a,n,h,b)}};this.renderGraph=function(h,e,a,d,g){if(this.initialRemoteDataRequest){return}this.setColorScheme();this.reinitializeGraph();if((!this.layoutComb||!this.layoutAdjust)&&!d){if(this.graphType!="Candlestick"||(this.graphType=="Candlestick"&&!this.showVolume)){this.initAxes(h)}}if(h){this.resizeCanvas(true,e,a)}else{this.resizeCanvas(false,e,a)}if(this.isVML){this.showShadow=false}if(this.isValidAnimation()&&this.showAnimation&&!this.isAnimation){this.createAnimation(this.animationType)}else{switch(this.graphType){case"Bar":case"Line":case"Area":case"BarLine":case"Dotplot":case"Heatmap":case"Stacked":case"StackedLine":case"StackedPercent":case"StackedPercentLine":case"Candlestick":if(this.isBoxPlotCalc&&this.isGroupedData){this.groupSamples(this.getGroupingFactors(true))}this.oneDPlot();break;case"Boxplot":if(!this.isBoxPlotCalc&&this.isGroupedData){this.groupSamples(this.getGroupingFactors(true))}this.oneDPlot();break;case"Scatter2D":case"ScatterBubble2D":this.Scatter2D();break;case"Scatter3D":this.Scatter3D();break;case"Correlation":this.Correlation();break;case"Venn":this.Venn();break;case"Pie":this.Pie();break;case"Network":if(g){var b=this.calculateLayout;var f=this.randomNetwork;this.calculateLayout=false;this.randomNetwork=false;this.Network();this.calculateLayout=b;this.randomNetwork=f}else{this.Network()}break;case"Genome":this.Genome();break}this.resizeImage()}};this.initializeGraph()};CanvasXpress.prototype.initAxes=function(b,a){this.getValidAxes=function(d){var e=[];if(this.graphType=="Scatter2D"){e.push("xAxis");e.push("yAxis")}else{if(this.graphType=="ScatterBubble2D"||this.graphType=="Scatter3D"){e.push("xAxis");e.push("yAxis");e.push("zAxis")}else{if(this.graphType.match(/Network|Genome|Correlation|Venn|Heatmap|Pie/)){if(d){e.push("xAxis")}else{return false}}else{if(this.graphType.match(/BarLine|StackedLine|StackedPercentLine/)||(this.graphType=="Candlestick"&&this.showVolume)){e.push("xAxis");e.push("xAxis2")}else{e.push("xAxis")}}}}return e};this.addRemoveSamplesInAxis=function(f,e,d){if(this.graphType=="Scatter2D"||this.graphType=="ScatterBubble2D"){if(d){return this.removeSamplesFromAxis(f,e)}else{return this.addSamplesToAxis(f,e)}}else{if(this.graphType=="Scatter3D"||this.graphType=="Pie"){return this.switchSampleInAxis(f,e)}}};this.addSamplesToAxis=function(f,e){if(this[e]){if(this.isArray(f)){for(var d=0;d<f.length;d++){this[e].push(f[d])}}else{this[e].push(f)}return false}else{return"Not a valid axis"}};this.removeSamplesFromAxis=function(h,g){if(this[g]){if(this[g].length>1){var e={};var d=[];if(this.isArray(h)){for(var f=0;f<h.length;f++){e[h[f]]=1}}else{e[h]=1}for(var f=0;f<this[g].length;f++){if(!e.hasOwnProperty(this[g][f])){d.push(this[g][f])}}this[g]=d;return false}else{return g+" cannot be null"}}else{return"Not a valid axis"}};this.switchSampleInAxis=function(e,d){if(this[d]){this[d][0]=e;return false}else{return"Not a valid axis"}};this.addRemoveVariablesInAxis=function(f,e,d){if(d){return this.removeVariablesFromAxis(f,e)}else{return this.addVariablesToAxis(f,e)}};this.addVariablesToAxis=function(f,e){if(!this.data.a){this.data.a={}}if(!this.data.a[e]){this.data.a[e]=[]}if(this.isArray(f)){for(var d=0;d<f.length;d++){this.data.a[e].push(f[d])}}else{this.data.a[e].push(f)}this.resetVariablesVisibleByAxis(e);return false};this.removeVariablesFromAxis=function(h,g){if(this.data.a&&this.data.a[g]){var e={};var d=[];if(this.isArray(h)){for(var f=0;f<h.length;f++){e[h[f]]=1}}else{e[h]=1}for(var f=0;f<this.data.a[g].length;f++){if(!e.hasOwnProperty(this.data.a[g][f])){d.push(this.data.a[g][f])}}this.data.a[g]=d}this.resetVariablesVisibleByAxis(g);return false};this.getAxisRangeBySample=function(d){var h=[];if(this.isArray(d)){for(var f=0;f<this.varIndices.length;f++){var g=this.varIndices[f];for(var e=0;e<d.length;e++){h.push(this.getDataAtPos(g,e))}}}else{for(var f=0;f<this.varIndices.length;f++){var g=this.varIndices[f];h.push(this.getDataAtPos(g,d))}}return this.range(h)};this.getAxisIncrements=function(g,p,q,k){if(p-g<=Number.MIN_VALUE){return 0.1}if(k){return p==g?p*this.axisExtension/q:(p-g)/q}else{var n;var o=(p-g)*this.axisExtension;var e=p==g?g-(g*this.axisExtension):g-o;var h=p==g?p+(p*this.axisExtension):p+o;var j=h-e;var m=-Math.floor(Math.log(j/q)/Math.LN10);var f=Math.pow(10,-m);var d=((j/q)/f);if(d<1.5){n=f}else{if(d<2){n=f*2}else{if(d<2.5){n=f*2.5}else{if(d<5){n=f*5}else{if(d<7.5){n=f*7.5}else{n=f*10}}}}}if(g+(n*q)<p){return this.getAxisIncrements(g,p+n,q,k)}else{return n}}};this.getAxisMin=function(d,e){var f=e*Math.floor(d/e);return f<0&&this.minData>0?0:f};this.getAxisDecimals=function(d){var e=(d-parseInt(d)).toString().replace(/\./,"").length-1;return e};this.setAxis=function(d){var e=this.isGroupedData?this.data.w:this.data.y;if(this[d].length==0){if(d=="xAxis"){this[d].push(e.smps[this.smpIndices[0]])}else{if(d=="yAxis"){if(e.smps.length>1){this[d].push(e.smps[this.smpIndices[1]])}else{this[d].push(e.smps[this.smpIndices[0]])}}else{if(d=="zAxis"){if(e.smps.length>2){this[d].push(e.smps[this.smpIndices[2]])}else{if(e.smps.length>1){this[d].push(e.smps[this.smpIndices[1]])}else{this[d].push(e.smps[this.smpIndices[0]])}}}}}}else{if(this.graphType=="Scatter3D"&&this[d].length>1){this[d]=[this[d][0]]}}};this.setAxisValues=function(f){var A,r,o,p,q,y,m,g;var e={};var k=f+"MinorValues";var n=f+"Values";var x=f+"Ticks";var w=f+"Incr";var d=f+"Decs";var s=f+"Min";var h=f+"Transform";var v=f+"MaxStrLength";if(this[h]=="percentile"){this[d]=0;this[n]=[];this[k]=[];var z=[0,25,50,75,100];for(var u=0;u<z.length;u++){A=this.formatNumber(z[u]);if(e.hasOwnProperty(A)){m=true}else{e[A]=1}this[n].push(A)}for(var u=5;u<100;u+=5){this[k].push(u)}}else{if(this[n].length==0||b){if(b){this[n]=[];this[k]=[]}A=this[s];q=this[w]/this[x];for(var u=1;u<=this[x];u++){for(var t=1;t<this[x];t++){this[k].push(A+(q*t))}A+=this[w];if(this[d]==0&&A.toString().match(/\.5$/)){this[d]=1}r=this.formatNumber(sprintf("%."+this[d]+"f",A));if(e.hasOwnProperty(r)){m=true}else{e[r]=1}this[n].push(r)}}else{o=this[n];this[n]=[];for(var u=0;u<o.length;u++){A=o[u];p=parseFloat(A);r=this.formatNumber(sprintf("%."+this[d]+"f",p));if(e.hasOwnProperty(r)){m=true}else{e[r]=1}this[n].push(r)}}}if(m){this[d]++;this[n]=[];this[k]=[];this.setAxisValues(f)}else{g=this.getMaxText(this[n]);if(!this[v]){this[v]=g}else{this[v]=this.getMaxText([this[v],g])}}};this.setAxisAttributes=function(j,r,u,f,q){var t=f&&f.match(/log/)?true:false;var o=j+"Ticks";var e=j+"Incr";var h=j+"Exact";var d=j+"AbsMin";var n=j+"AbsMax";var k=j+"Min";var s=j+"Max";var p=j+"Range";var m=j+"Decs";var g=j+"Transform";this.setRangeData(r,u,t,q);if(f){if(f=="log2"){this.minData=Math.log(this.minData)/Math.LN2;this.maxData=Math.log(this.maxData)/Math.LN2}else{if(f=="log10"){this.minData=Math.log(this.minData)/Math.LN10;this.maxData=Math.log(this.maxData)/Math.LN10}else{if(f=="exp2"){this.minData=Math.pow(2,this.minData);this.maxData=Math.pow(2,this.maxData)}else{if(f=="exp10"){this.minData=Math.pow(10,this.minData);this.maxData=Math.pow(10,this.maxData)}else{if(f=="percentile"){this.minData=-12.5;this.maxData=112.5}}}}}}this[d]=this.setMin==null?this.minData:this[d];this[n]=this.setMax==null?this.maxData:this[n];this[e]=this.getAxisIncrements(this.minData,this.maxData,this[o],this[h]);this[m]=this.getAxisDecimals(this[e]);if(q){this[k]=0;if(this.graphType.match(/Percent/)){this[s]=100}else{this[s]=this[k]+(this[e]*this[o])}}else{if(this[h]||(f&&f=="percentile")){this[k]=this.minData;this[s]=this.maxData}else{this[k]=this.getAxisMin(this.minData,this[e]);this[s]=this[k]+(this[e]*this[o])}}this[p]=this[s]-this[k];this.setAxisValues(j)};this.setAxes=function(){if(this.graphType.match(/Correlation/)){var f=this.isGroupedData?this.data.w:this.data.y;this.setMin=null;this.setMax=null;if(this.correlationAnchorLegend){this.setAxisAttributes("xAxis")}if(!f.cor||f.cor.length==0){this.summarize("cor");this.setRangeData("cor")}if(!this.yAxisTitle){this.yAxisTitle="Correlation"}}else{if(this.graphType.match(/Scatter|Pie/)){var u=this.smpIndices;var q=["xAxis"];var d=["X"];this.setMin=null;this.setMax=null;if(this.graphType.match(/Scatter/)){q.push("yAxis");d.push("Y")}if(this.graphType.match(/ScatterBubble2D|Scatter3D/)){q.push("zAxis");d.push("Z")}if(this.graphType=="Scatter3D"){this.xAxisTicks=10;this.yAxisTicks=10;this.zAxisTicks=10}for(var k=0;k<q.length;k++){var m=q[k]+"Indices";var j="setMin"+d[k];var s="setMax"+d[k];this.setAxis(q[k]);this[m]=this.getSampleIndices(this[q[k]]);this.setSamplesVisible(this[m]);if(this[j]){this.setMin=this[j]}if(this[s]){this.setMax=this[s]}this.setAxisAttributes(q[k],false,false,this[q[k]+"Transform"]);this.setSamplesVisible(u)}if(!this.xAxisTitle){this.xAxisTitle=this.xAxis.length==1?this.xAxis[0]:" "}if(!this.yAxisTitle){this.yAxisTitle=this.yAxis.length==1?this.yAxis[0]:" "}if(!this.zAxisTitle){this.zAxisTitle=this.zAxis.length==1?this.zAxis[0]:" "}}else{if(this.graphType.match(/Genome/)){if(this.setMin==null||this.setMax==null){this.setRangeData("genome")}this.xAxisExact=true;this.xAxisTransform=false;this.xAxisMin=this.setMin!=null?this.setMin:this.minData;this.xAxisMax=this.setMax!=null?this.setMax:this.maxData;this.xAxisDecs=0;this.xAxisRange=this.xAxisMax-this.xAxisMin;this.xAxisTicks=this.ticks;this.xAxisIncr=this.xAxisRange/this.xAxisTicks;this.setAxisValues("xAxis")}else{var p=this.smpIndices;var e=this.varIndices;var h=this.grpIndices;var n=this.varIndices;var t=this.graphType=="Dotplot"&&this.isGroupedData?true:false;var g=this.graphType.match(/Percent/)?"percentile":false;var o=this.graphType.match(/Stacked|Area/)?true:false;var r=this.graphType=="Candlestick"?"candle":g?g:false;if(this.graphType=="Heatmap"){this.graphOrientation="horizontal";if(this.varIndicesStart>-1||this.smpIndicesStart>-1){this.setAllVariablesVisible();this.setAllSamplesVisible()}}else{if(this.graphType=="StackedPercent"||this.graphType=="StackedPercentLine"){this.setMin=null;this.setMax=null;this.axisExact=true;this.xAxisExact=true}else{if(this.graphType=="Boxplot"&&!this.isGroupedData){if(!this.data.y.median){this.summarize("iqr")}}}}if(this.graphType.match(/BarLine|StackedLine|StackedPercentLine/)&&this.data.a){this.setVariablesVisible(this.getVariablesVisibleByAxis("xAxis"))}this.setAxisAttributes("xAxis",r,t,g,o);this["xAxisTitle"]=!this["xAxisTitle"]&&this.data.y.desc?this.data.y.desc[0]:"";if((this.graphType.match(/BarLine|StackedLine|StackedPercentLine/)&&this.data.a)||(this.graphType=="Candlestick"&&this.showVolume)){r=this.graphType=="Candlestick"?"volume":false;if(this.graphType.match(/BarLine|StackedLine|StackedPercentLine/)){this.setVariablesVisible(n);this.setVariablesVisible(this.getVariablesVisibleByAxis("xAxis2"))}var s=this.setMax!=null?this.setMax:null;var j=this.setMin!=null?this.setMin:null;this.setMax=this.setMax2!=null?this.setMax2:null;this.setMin=this.setMin2!=null?this.setMin2:null;this.setAxisAttributes("xAxis2",r,t);this["xAxis2Title"]=!this["xAxis2Title"]&&this.data.y.desc?this.data.y.desc[1]:"";this.setMax=s!=null?s:null;this.setMin=j!=null?j:null}this.setVariablesVisible(n);this.smpIndices=p;this.varIndices=e;this.grpIndices=h}}}};this.setScatterPointSize=function(){this.scatterPointSize=this.varIndices.length>50?this.sizes[1]:this.varIndices.length>20?this.sizes[2]:this.sizes[3];if(this.layoutComb){this.scatterPointSize=Math.ceil(this.scatterPointSize/this.layoutRows)}};this.setAxisUnits=function(j,m){var k=j+"Unit";var g=j+"Range";var h=j+"Min";var d=j+"Max";var f=j+"Exact";var e=m?m:j.substring(0,1);this[k]=this[e]/this[g]};this.setAxisFont=function(j,h){var g=this.graphType=="Venn"?16:12;if(this.autoScaleFont||!this.axisTickFont||!this.decorationFont||!this.axisTitleFont){var d,f,e;if(h>=600){d=12*this.scaleTickFontFactor;e=10*this.scaleDecorationFontFactor;f=this.getFontPt(this.scaleTextToFont(j,g,h-2))*this.scaleTitleFontFactor}else{if(h>=400){d=10*this.scaleTickFontFactor;e=8*this.scaleDecorationFontFactor;f=this.getFontPt(this.scaleTextToFont(j,g,h-2))*this.scaleTitleFontFactor}else{if(h>=200){d=8*this.scaleTickFontFactor;e=6*this.scaleDecorationFontFactor;f=8*this.scaleTitleFontFactor}else{d=6*this.scaleTickFontFactor;e=4*this.scaleDecorationFontFactor;f=6*this.scaleTitleFontFactor}}}this.axisTickFont=(parseInt(d))+"Pt "+this.fontName;this.decorationFont=(parseInt(e))+"Pt "+this.fontName;this.axisTitleFont=(parseInt(f))+"Pt "+this.fontName}else{this.axisTickFont=parseInt(this.axisTickFontSize)+"Pt "+this.fontName;this.decorationFont=parseInt(this.decorationFontSize)+"Pt "+this.fontName;this.axisTitleFont=parseInt(this.axisTitleFontSize)+"Pt "+this.fontName}};this.getAxisFont=function(d){if(d>=600){return 12}else{if(d>=400){return 10}else{if(d>=200){return 8}else{return 6}}}};this.getHeatmapShades=function(d){switch(d){case"green":return this.greens;case"red":return this.reds;case"blue":return this.blues;case"yellow":return this.yellows;case"cyan":return this.cyans;case"purple":return this.purples}};this.setHeatmapColors=function(d){this.setRGB();var m=d?d:this.maxData-this.minData;var e=this.heatmapType.split("-");var o=256/this.indicatorBins;var n=this.getHeatmapShades(e[0]);this.heatmapColors=[];this.heatmapBin=m/this.indicatorBins;if(this.indicatorCenter.match("rainbow")&&e.length>1){var f=["red","purple","blue","cyan","green","yellow"];if(this.indicatorCenter=="rainbow-green"){f.reverse()}var p=null;for(var k=0;k<f.length;k++){if(f[k]==e[0]){p=k}}if(p==null){alert("Dude! "+e[0]+" ain't a valid color ... This is not looking good ...");this.heatmapColors=this.blues;return}var g=[f[p]];p++;while(g.length<6){if(p>5){p=0}g.push(f[p]);p++}p=null;for(var k=0;k<g.length;k++){if(g[k]==e[1]){p=k}}if(p==null){alert("Dude! "+e[1]+" ain't a valid color ... This is not looking good ...");this.heatmapColors=this.blues;return}for(var k=0;k<p;k++){n=this.getHeatmapShades(g[k]);for(var h=0;h<o;h++){this.heatmapColors.push(n[h])}}}else{if(e.length>1){for(var k=0;k<o;k++){this.heatmapColors.push(n[k])}if(this.indicatorCenter=="black"){this.heatmapColors.push("rgb(0,0,0)")}else{this.heatmapColors.push("rgb(255,255,255)")}n=this.getHeatmapShades(e[1]);for(var k=o-1;k>=0;k--){this.heatmapColors.push(n[k])}}else{if(this.indicatorCenter=="black"){this.heatmapColors.push("rgb(0,0,0)")}else{this.heatmapColors.push("rgb(255,255,255)")}for(var k=o-1;k>=0;k--){this.heatmapColors.push(n[k]);this.heatmapColors.push(n[k])}}}};this.initializeAxis=function(){if(!this.graphType.match(/Venn|Network/)){if(!a){this.setAxes();this.setHeatmapColors()}}};this.initializeAxis()};CanvasXpress.prototype.Pie=function(){this.setVarPie=function(){this.varPie={no:0,idso:[],ids:[],data:{},oprc:0,tot:0};var b=this.smpIndices[0];if(this.varIndices.length>=this.maxPieSectors-1){var a=this;this.varIndices.sort(function(j,h){return a.data.y.data[h][b]-a.data.y.data[j][b]})}for(var e=0;e<this.varIndices.length;e++){var f=this.varIndices[e];this.varPie.tot+=this.getDataAtPos(f,b)}for(var e=0;e<this.varIndices.length;e++){var f=this.varIndices[e];var g=this.getDataAtPos(f,b);var d=g/this.varPie.tot;this.varPie.data[f]=d;if(e>=this.maxPieSectors-1){this.varPie.oprc+=d;this.varPie.idso.push(f);this.varPie.no++}else{this.varPie.ids.push(f)}}if(this.varPie.no){this.varPie.ids.push(-1)}};this.getPieLegendDimensions=function(){this.setLegendFont();this.setVarPie();var f=this.getFontPt(this.legendFont);var e=this.shortenText(this.maxVarNameStr,this.maxVarStringLen);var b=this.measureText(e,this.legendFont);if(!this.autoExtend){if(b>this.width/2){this.legendFont=this.scaleTextToFont(b,f,this.width/2)}}var d=f+this.measureText(e,this.legendFont)+(this.margin*5);var g=this.varIndices.length>this.maxPieSectors?this.maxPieSectors:this.varIndices.length;var a=(g*(f+this.margin))+(this.margin*3);return([d,a])};this.setPieXYDimensions=function(){var a=this.getPieLegendDimensions();if(this.autoExtend){if(this.showLegend){this.right=a[0]}if((a[0]+this.left+this.right)>this.width&&this.showLegend){this.x=a[0];this.width=this.left+this.x+this.right}else{this.x=this.width-(this.left+this.right)}if((a[1]+this.top+this.bottom)>this.height&&this.showLegend){this.y=a[1];this.height=this.top+this.y+this.bottom}else{this.y=this.height-(this.top+this.bottom)}this.resizeCanvas()}else{if(this.showLegend){this.right=this.layoutComb?this.layoutRight:a[0]}this.x=this.layoutComb?this.layoutWidth:this.width-(this.left+this.right);this.y=this.layoutComb?this.layoutHeight:this.height-(this.top+this.bottom)}this.setAxisFont("Pie",this.x)};this.drawPieDataPoints=function(){var p=Math.min(this.x,this.y);var z=(p-(p/5))/2;var o=this.pieSegmentLabels=="inside"?z-(z/3):z+(z/10);var t=this.layoutComb?this.offsetX+(this.x/2):this.left+(this.x/2);var a=this.layoutComb?this.offsetY+(this.y/2):this.top+(this.y/2);var e=0;var u=this.layoutComb?this.smpIndices[0]:this.xAxisIndices[0];for(var v=0;v<this.varPie.ids.length;v++){var h=this.varPie.ids[v];var A=h>-1?this.varPie.data[h]:this.varPie.oprc;var g=v%this.colors.length;var n=Math.PI*(2*e);var f=Math.PI*(2*(e+A));var y=(n+f)/2;var r=(f-n)/32;var x=this.transparency!=null?this.validateColor(this.colors[g],this.transparency):this.colors[g];if(this.gradient){this.setRadialGradient(t,a,z*1.3,x)}else{this.ctx.fillStyle=x}this.ctx.beginPath();this.ctx.lineWidth=this.pieSegmentSeparation;this.ctx.strokeStyle=this.pieType=="separated"?this.background:this.pieType=="solid"?this.foreground:this.foreground;if(this.showShadow){this.ctx.shadowOffsetX=this.shadowOffsetX;this.ctx.shadowOffsetY=this.shadowOffsetY;this.ctx.shadowBlur=this.shadowBlur;this.ctx.shadowColor=this.shadowColor}this.ctx.moveTo(t,a);this.ctx.arc(t,a,z,n,f,false);this.ctx.lineTo(t,a);this.ctx.closePath();this.ctx.fill();this.ctx.stroke();if(this.showShadow){this.ctx.restore();this.ctx.shadowOffsetX=0;this.ctx.shadowOffsetY=0;this.ctx.shadowBlur=0;this.ctx.shadowColor=this.background}if(this.pieSegmentLabels){var w=t-Math.sin(y-(Math.PI/2))*o;var d=a+Math.cos(y-(Math.PI/2))*o;this.drawText(sprintf("%."+this.pieSegmentPrecision+"f",A*100)+"%",w,d,this.axisTickFont,this.axisTickColor,"center","middle");w=t+z*Math.cos(n);d=a+z*Math.sin(n);var b=["poly",t,a,w,d];var m=n;for(var q=0;q<32;q++){m+=r;w=t+z*Math.cos(m);d=a+z*Math.sin(m);b.push(w);b.push(d)}b.push(t);b.push(a);if(h>-1){this.addArea(b,[h,u])}else{this.varPie.idso.push(u);this.addArea(b,this.varPie.idso)}}e+=A}this.ctx.lineWidth=1};this.drawPieLegend=function(){if(this.showLegend){var m=this.getPieLegendDimensions();var n=this.getFontPt(this.legendFont);var k=n/2;var b=this.layoutComb?(this.width-m[0])+this.margin+k:this.left+this.x+(this.margin*2)+k;var a=b+k+this.margin;var h=this.layoutComb?(this.layoutTop+(this.margin*3)+((this.height-(this.layoutTop+this.layoutBottom))/2))-(m[1]/2):this.top+((this.y/2)-(m[1]/2))+this.margin;var g=h;for(var e=0;e<this.varPie.ids.length;e++){var j=this.varPie.ids[e];var d=e%this.colors.length;var f=j>-1?this.shortenText(this.data.y.vars[j],this.maxVarStringLen):"Other";this.drawShape("square",b,g,10,10,this.colors[d],this.foreground,"closed");this.drawText(f,a,g,this.legendFont,this.legendColor,"left","middle");g+=n+this.margin}if(this.legendBox){this.rectangle(b-(this.margin*2),h-(this.margin*2),m[0]-n,m[1]-n,false,this.foreground,"open")}}};this.drawPiePlot=function(){this.setPieXYDimensions();this.drawTitle();this.drawPieDataPoints();this.drawPieLegend()};this.initializePiePlot=function(){if(this.xAxisMin<0){alert("Dude you can't draw a pie chart with negative numbers!");return}if(this.layoutValid){this.autoExtend=false;this.drawLayoutCompartments(this.drawPiePlot)}else{this.drawPiePlot()}};this.initializePiePlot()};CanvasXpress.prototype.Venn=function(){this.setVennXYDimensions=function(){this.setLegendFont();var a=this.autoExtend?Math.max(this.width,this.height):this.height;this.height=a;this.setAxisFont("Venn",a);if(this.showLegend){this.bottom+=(this.getFontPt(this.legendFont)+this.margin)*this.vennGroups}this.y=this.height-(this.top+this.bottom);this.x=this.y;if(this.x<400){var b=this.getFontPt(this.axisTickFont)-2;if(this.x<200){b-=1}this.axisTickFont=b+"Pt "+this.fontName}this.width=this.left+this.x+this.right;this.resizeCanvas()};this.drawVennBubble=function(b,d,a){if(this.vennGroups==4){if(this.isVML){a=a.replace("rgb","rgba");a=a.replace(")",",0.5)");this.drawShape("ellipse2",0,0,this.x/1.4,this.x/1.4,a,this.foreground,"closed")}else{this.drawShape("ellipse2",0,0,this.x/1.4,this.x/1.4,a,this.foreground,"closed");this.ctx.globalCompositeOperation="lighter"}}else{if(this.isVML){a=a.replace("rgb","rgba");a=a.replace(")",",0.5)");this.drawShape("circle",b,d,this.x/2,this.x/2,a,this.foreground,"closed")}else{this.drawShape("circle",b,d,this.x/2,this.x/2,a,this.foreground,"closed");this.ctx.globalCompositeOperation="lighter"}}};this.drawVennLayout=function(){var h,j,b,f;var a=["A","B","C","D"];this.ctx.clearRect(0,0,this.width,this.height);if(this.vennGroups==4){this.ctx.save();h=this.margin+(this.x/4.94);j=this.top+(this.x/13);this.ctx.translate(h,j);this.ctx.rotate(Math.PI/4);this.drawVennBubble(0,0,this.vennColors&&this.validateColor(this.vennColors[0])?this.validateColor(this.vennColors[0]):"rgb(255,0,0)");h=this.x/22.4;j=-this.x/5.32;this.ctx.translate(h,j);this.drawVennBubble(0,0,this.vennColors&&this.validateColor(this.vennColors[0])?this.validateColor(this.vennColors[1]):"rgb(0,153,51)");h=this.x/1.84;j=this.x/-5.32;this.ctx.translate(h,j);this.ctx.rotate(Math.PI/2);h=-this.x/22.4;j=-this.x/5.32;this.ctx.translate(h,j);this.drawVennBubble(0,0,this.vennColors&&this.validateColor(this.vennColors[0])?this.validateColor(this.vennColors[2]):"rgb(0,0,255)");h=this.x/22.4;j=this.x/5.32;this.ctx.translate(h,j);this.drawVennBubble(0,0,this.vennColors&&this.validateColor(this.vennColors[0])?this.validateColor(this.vennColors[3]):"rgb(153,204,0)");this.ctx.restore();b=[11.2,3.05,1.46,1.08];f=[7,42,42,7]}else{if(this.vennGroups==3){this.ctx.save();h=this.left+(this.x/2);j=this.top+(this.x/2.86);this.drawVennBubble(h,j,this.vennColors&&this.validateColor(this.vennColors[0])?this.validateColor(this.vennColors[0]):"rgb(255,0,0)");j+=(this.x/3.33);h=this.left+(this.x/3);this.drawVennBubble(h,j,this.vennColors&&this.validateColor(this.vennColors[0])?this.validateColor(this.vennColors[1]):"rgb(0,255,0)");h=this.left+(this.x/1.5);this.drawVennBubble(h,j,this.vennColors&&this.validateColor(this.vennColors[0])?this.validateColor(this.vennColors[2]):"rgb(0,0,255)");this.ctx.restore();b=[2,8.66,1.13];f=[20,2.3,2.3]}else{if(this.vennGroups==2){this.ctx.save();h=this.left+(this.x/3);j=this.top+(this.x/2.67);this.drawVennBubble(h,j,this.vennColors&&this.validateColor(this.vennColors[0])?this.validateColor(this.vennColors[0]):"rgb(0,0,255)");h=this.left+(this.x/1.5);j=this.top+(this.x/2.67);this.drawVennBubble(h,j,this.vennColors&&this.validateColor(this.vennColors[0])?this.validateColor(this.vennColors[1]):"rgb(255,0,0)");this.ctx.restore();b=[3,1.5];f=[16,16]}else{if(this.vennGroups==1){h=this.left+(this.x/2);j=this.top+(this.x/2);this.drawShape("circle",h,j,this.x,this.x,this.vennColors&&this.validateColor(this.vennColors[0])?this.validateColor(this.vennColors[0]):"rgb(255,0,0)",this.foreground,"closed");b=[100];f=[100]}}}}for(var e=0;e<this.vennGroups;e++){var d=this.left+(this.x/b[e]);var g=this.top+(this.x/f[e]);this.drawText(a[e],d,g,this.axisTickFont,this.axisTickColor,"center","middle")}};this.drawVennDataPoints=function(){var a,f;if(this.vennGroups==4){a=[5.6,2.94,3.5,1.54,3.29,2,2.59,1.212,2,1.442,1.4,1.757,2.31,1.624,2];f=[2.94,7,3.92,7,1.89,4.06,2.66,2.94,1.54,1.89,3.92,1.729,1.729,2.66,2.03];this.y=(this.x*1.1)/1.4}else{if(this.vennGroups==3){a=[2,3.5,2.55,1.4,1.6,2,2];f=[3.6,1.54,2.07,1.54,2.07,1.54,1.83];this.y=this.x*0.95}else{if(this.vennGroups==2){a=[3.5,1.4,2];f=[2.66,2.66,2.66];this.y=this.x*0.65}else{if(this.vennGroups==1){a=[2];f=[2]}}}}for(var e=0;e<a.length;e++){var d=this.left+(this.x/a[e]);var g=this.top+(this.x/f[e]);var b=this.getFontPt(this.axisTickFont);var h=this.data.venn.data[this.vennCompartments[e]]?this.data.venn.data[this.vennCompartments[e]]:0;this.drawText(h,d,g,this.axisTickFont,this.axisTickColor,"center","middle");this.addArea(["circle",d,g,b],[e])}};this.drawVennLegend=function(){if(this.showLegend){var g=["A","B","C","D"];var j=this.getFontPt(this.legendFont);var f=this.left;var d=f+(j*2);var h=this.top+this.y+this.margin+(j/2);for(var e=0;e<this.vennGroups;e++){this.drawText(g[e]+": ",f,h,this.legendFont,this.legendColor,"left","middle");var b=this.data.venn.legend&&this.data.venn.legend[g[e]]?this.data.venn.legend[g[e]]:"N/A";var a=(this.measureText(b,this.legendFont)>this.x)?this.scaleTextToFont(b,j,this.x-this.margin):this.legendFont;this.drawText(b,d,h,a,this.legendColor,"left","middle");h+=this.margin+j}}};this.drawVennPlot=function(){this.setVennXYDimensions();this.drawTitle();this.showShadow=false;this.drawVennLayout();this.showShadow=this.tmpshowShadow;this.drawVennDataPoints();this.drawVennLegend()};this.initializeVennPlot=function(){this.transparency=null;this.tmpshowShadow=this.showShadow;this.background="rgb(255,255,255)";this.foreground="rgb(0,0,0)";this.drawVennPlot()};this.initializeVennPlot()};CanvasXpress.prototype.Correlation=function(){this.setCorrelationVarSmpLabelFont=function(b){var a=this.scaleTextToSize(b);a=this.correlationAxis=="samples"?a*this.scaleSmpLabelFontFactor:a*this.scaleVarLabelFontFactor;a=Math.min(a,this.maxTextSize);this.smpLabelFont=(a)+"Pt "+this.fontName;this.varLabelFont=(a)+"Pt "+this.fontName};this.getCorrelationLabelsHeight=function(){var a=0;if(this.correlationAxis=="samples"){if(this.maxSmpName>this.maxSmpStringLen){a+=this.measureText(this.maxSmpNameStr.substring(0,this.maxSmpStringLen),this.smpLabelFont)}else{a+=this.measureText(this.maxSmpNameStr,this.smpLabelFont)}}else{if(this.maxVarName>this.maxVarStringLen){a+=this.measureText(this.maxVarNameStr.substring(0,this.maxVarStringLen),this.varLabelFont)}else{a+=this.measureText(this.maxVarNameStr,this.varLabelFont)}}if(this.correlationAnchorLegend){a+=this.correlationAnchorLegendAlignWidth+this.margin}return a};this.setCorrelationXYDimensions=function(){var a=this.autoExtend?Math.max(this.width,this.height):Math.min(this.width,this.height);this.width=a;this.height=a/2;if(this.yAxisShow){this.setAxisFont(this.yAxisTitle,this.height);this.left=this.margin+this.getFontPt(this.axisTitleFont)+this.margin}this.x=this.width-(this.left+this.right);var b=this.correlationAxis=="variables"?this.varIndices.length:this.isGroupedData?this.grpIndices.length:this.smpIndices.length;this.diamondSize=this.x/b;this.setCorrelationVarSmpLabelFont(b);this.y=this.x/2+(this.diamondSize/2);if(this.xAxisShow){this.top+=this.margin+this.getCorrelationLabelsHeight()+this.margin}this.height=this.top+this.y+this.bottom;this.resizeCanvas()};this.drawCorrelationLayout=function(){if(this.yAxisShow){this.drawText(this.yAxisTitle,this.left/2,this.top+(this.y/2),this.axisTitleFont,this.axisTitleColor,"center","middle",-Math.PI/2)}if(this.xAxisShow){var d=this.left+this.diamondSize/2;var q=this.top-this.margin;var p=this.top-(this.getCorrelationLabelsHeight()+this.margin);var o=p+this.correlationAnchorLegendAlignWidth;var m,g,j;var a=this.isGroupedData?this.data.w:this.data.y;var s=this.correlationAxis=="variables"?this.varIndices:this.isGroupedData?this.grpIndices:this.smpIndices;var n=this.correlationAxis=="samples"?this.maxSmpStringLen:this.maxVarStringLen;if(this.correlationAnchorLegend){j=this.correlationAxis=="samples"?a.data[0]:this.getDataForSmpGrpAtIndex(0);s.sort(function(u,t){return j[u]-j[t]});this.setAxisUnits("xAxis")}if(this.correlationAxis=="samples"){m=a.smps;g=this.smpLabelFont}else{m=a.vars;g=this.varLabelFont}for(var h=0;h<s.length;h++){var r=s[h];var k=this.shortenText(m[r],n);var f=this.correlationAxis=="samples"?this.getSmpColor(m[r]):this.getVarColor(m[r]);if(s.length<100){this.drawText(k,d,q,g,f,"left","middle",-Math.PI/2)}else{if(h%2){this.drawText(k,d,q,g,f,"left","middle",-Math.PI/2)}}if(this.correlationAnchorLegend){var e=j[r];var b=this.left+((e-this.xAxisMin)*this.xAxisUnit);this.drawLine("line",b,p-this.margin,b,p,f);this.drawLine("line",b,p,d,o,f)}d+=this.diamondSize}}d=(this.left+(this.x/3))-(this.heatmapColors.length*this.indicatorWidth);q=this.top+(this.y*7/8);if(this.correlationAnchorLegend){this.setRangeData("cor")}this.drawColorIndicator(d,q,this.minData,this.maxData,2)};this.drawCorrelationDataPoints=function(){var d,r,b,p;var u=this.diamondSize/2;var q="rgb(255,255, 0)";var n=this.isGroupedData?this.data.w.cor:this.data.y.cor;var t=this.correlationAxis=="variables"?this.varIndices:this.isGroupedData?this.grpIndices:this.smpIndices;d=this.left+u;r=this.top+u;for(var m=0;m<Math.ceil(t.length/2);m++){var s=t[m];b=d+(this.diamondSize*m);p=r;for(var h=m;h<t.length-m;h++){var o=t[h];var f=n[s][o];var e=this.getHeatmapColor(this.minData,this.maxData,f);if(isNaN(f)){this.addArea(this.drawShape("diamond",b,p,this.diamondSize,this.diamondSize,q,q,"closed"),[s,o])}else{this.addArea(this.drawShape("diamond",b,p,this.diamondSize,this.diamondSize,e,e,"closed"),[s,o])}b+=u;p+=u}p-=this.diamondSize;for(var g=h-2;g>=m;g--){var a=t[(t.length-g)-1];var f=n[a][o];var e=this.getHeatmapColor(this.minData,this.maxData,f);if(isNaN(f)){this.addArea(this.drawShape("diamond",b,p,this.diamondSize,this.diamondSize,q,q,"closed"),[a,o])}else{this.addArea(this.drawShape("diamond",b,p,this.diamondSize,this.diamondSize,e,e,"closed"),[a,o])}b+=u;p-=u}}this.drawLine("line",this.left,this.top+u,this.left+(this.x/2),this.top+this.y,this.foreground,false,"butt");this.drawLine("line",this.left+this.x,this.top+u,this.left+(this.x/2),this.top+this.y,this.foreground,false,"butt");d=this.left+u;r=this.top;b=d+(this.x/2);p=(this.top+this.y)-u;for(var m=0;m<t.length;m++){this.drawLine("line",d,r,b,p,this.foreground,false,"butt");d+=this.diamondSize;b+=u;p-=u}d=(this.left+this.x)-u;r=this.top;b=(this.left+(this.x/2))-u;p=(this.top+this.y)-u;for(var m=0;m<t.length;m++){this.drawLine("line",d,r,b,p,this.foreground,false,"butt");d-=this.diamondSize;b-=u;p-=u}};this.drawCorrelationPlot=function(){this.setCorrelationXYDimensions();this.drawCorrelationLayout();this.drawTitle();this.drawCorrelationDataPoints()};this.initializeCorrelationPlot=function(){this.drawCorrelationPlot()};this.initializeCorrelationPlot()};CanvasXpress.prototype.Scatter2D=function(){this.get2DYAxisWidth=function(){return this.yAxisShow?this.getFontPt(this.axisTitleFont)+this.measureText(this.yAxisMaxStrLength,this.axisTickFont)+(this.margin*5):this.margin};this.get2DXAxisHeight=function(){return this.xAxisShow?this.getFontPt(this.axisTickFont)+this.getFontPt(this.axisTitleFont)+(this.margin*5):this.margin};this.set2DType=function(){if(this.graphType=="ScatterBubble2D"&&this.xAxisIndices.length>1&&this.xAxisIndices.length==this.yAxisIndices.length&&this.xAxisIndices.length==this.zAxisIndices.length){this.type2D="XYZ"}else{if(this.xAxisIndices.length>1&&this.xAxisIndices.length==this.yAxisIndices.length){this.type2D="XY"}else{if(this.xAxisIndices.length>this.yAxisIndices.length){this.type2D="X"}else{this.type2D="Y"}}}};this.set2DText=function(){var b=this.xAxisTitle.length>this.yAxisTitle.length?this.xAxisTitle:this.yAxisTitle;var a=this.layoutComb?Math.min(this.layoutWidth,this.layoutHeight):Math.min(this.width,this.height);this.setAxisFont(b,a)};this.setDecorationsLegendPositions=function(){if(this.showDecorations){this.setDecorationLegendDimension();if(this.showLegend){if(this.legendPosition=="bottom"){this.decorationsPosition="right"}else{this.decorationsPosition="bottom"}}}};this.set2DXYDimensions=function(){this.setDecorationsLegendPositions();this.setLegendDimensions();if(this.showLegend||this.showIndicators){this.right=this.legendWidth}if(this.showDecorations&&this.decorationsPosition=="right"){this.right+=this.legendDecorationWidth+(this.margin*2)}if(this.graphType=="ScatterBubble2D"&&this.zAxisShow){this.right+=this.getFontPt(this.axisTitleFont)+this.margin}else{this.right+=this.margin}this.left=this.get2DYAxisWidth();this.bottom=this.get2DXAxisHeight();if(this.showLegend||this.showIndicators){this.bottom+=this.legendHeight}if(this.showDecorations&&this.decorationsPosition=="bottom"){this.bottom+=this.legendDecorationHeight+(this.margin*2)}this.x=this.autoExtend?this.width-this.left:this.layoutComb?this.layoutWidth-(this.left+this.right):this.width-(this.left+this.right);this.y=this.layoutComb?this.layoutHeight-(this.top+this.bottom):this.height-(this.top+this.bottom);if(!this.layoutComb){this.width=this.autoExtend?this.left+this.x+this.right:this.layoutComb?this.layoutWidth:this.width;this.resizeCanvas()}this.setScatterPointSize();this.setAxisUnits("xAxis");this.setAxisUnits("yAxis")};this.set2DWireFrame=function(){var e,g,b,f,a,h;e=this.offsetX+this.left;b=e+this.x;a=this.yAxisTickStyle=="dotted"?"dottedLine":"line";if(this.yAxisMinorTicks){for(var d=0;d<this.yAxisMinorValues.length;d++){h=parseFloat(this.yAxisMinorValues[d]);g=(this.offsetY+this.top+this.y)-((h-this.yAxisMin)*this.yAxisUnit);this.drawLine(a,e,g,b,g,this.yAxisTickColor,this.outlineWidth/3,"butt")}}for(var d=0;d<this.yAxisValues.length;d++){h=parseFloat(this.yAxisValues[d]);g=(this.offsetY+this.top+this.y)-((h-this.yAxisMin)*this.yAxisUnit);this.drawLine(a,e,g,b,g,this.yAxisTickColor,false,"butt")}g=this.offsetY+this.top;f=g+this.y;a=this.xAxisTickStyle=="dotted"?"dottedLine":"line";if(this.xAxisMinorTicks){for(var d=0;d<this.xAxisMinorValues.length;d++){h=parseFloat(this.xAxisMinorValues[d]);e=(this.offsetX+this.left)+((h-this.xAxisMin)*this.xAxisUnit);this.drawLine(a,e,g,e,f,this.xAxisTickColor,this.outlineWidth/3,"butt")}}for(var d=0;d<this.xAxisValues.length;d++){h=parseFloat(this.xAxisValues[d]);e=(this.offsetX+this.left)+((h-this.xAxisMin)*this.xAxisUnit);this.drawLine(a,e,g,e,f,this.xAxisTickColor,false,"butt")}};this.set2DLayout=function(){var d=this.offsetX+this.margin+(this.getFontPt(this.axisTitleFont)/2);var e=this.offsetY+this.top+(this.y/2);if(this.yAxisShow){this.drawText(this.yAxisTitle,d,e,this.axisTitleFont,this.axisTitleColor,"center","middle",-Math.PI/2)}var b=this.measureText(this.getMaxText(this.yAxisValues),this.axisTickFont)/2;d=this.offsetX+this.margin+this.getFontPt(this.axisTitleFont)+this.margin+this.margin+b;for(var a=0;a<this.yAxisValues.length-1;a++){var g=parseFloat(this.yAxisValues[a]);var f;if(this.yAxisTransform&&!this.yAxisTransformTicks){f=sprintf("%."+this.yAxisDecs+"f",this.transformValue(this.yAxisTransform,g,true))}else{f=sprintf("%."+this.yAxisDecs+"f",g)}e=(this.offsetY+this.top+this.y)-((g-this.yAxisMin)*this.yAxisUnit);if(this.yAxisShow){this.drawText(f,d,e,this.axisTickFont,this.axisTickColor,"center","middle")}}d=this.offsetX+this.left+(this.x/2);e=this.offsetY+this.top+this.y+this.margin+this.margin+this.getFontPt(this.axisTickFont)+this.margin+this.margin+(this.getFontPt(this.axisTitleFont)/2);if(this.xAxisShow){this.drawText(this.xAxisTitle,d,e,this.axisTitleFont,this.axisTitleColor,"center","middle")}e=this.offsetY+this.top+this.y+this.margin+this.margin+(this.getFontPt(this.axisTickFont)/2);for(var a=0;a<this.xAxisValues.length-1;a++){var g=parseFloat(this.xAxisValues[a]);var f;if(this.xAxisTransform&&!this.xAxisTransformTicks){f=sprintf("%."+this.xAxisDecs+"f",this.transformValue(this.xAxisTransform,g,true))}else{f=sprintf("%."+this.xAxisDecs+"f",g)}d=(this.offsetX+this.left)+((g-this.xAxisMin)*this.xAxisUnit);if(this.xAxisShow){this.drawText(f,d,e,this.axisTickFont,this.axisTickColor,"center","middle")}}if(this.graphType=="ScatterBubble2D"){if(this.zAxisShow){d=this.offsetX+this.left+this.x+this.margin;e=this.offsetY+this.top+(this.y/2);this.drawText(this.zAxisTitle,d,e,this.axisTitleFont,this.axisTitleColor,"center","bottom",Math.PI/2)}}this.rectangle(this.offsetX+this.left,this.offsetY+this.top,this.x,this.y,false,this.foreground,"open")};this.draw2DDataPoints=function(){var r,H,G;var w,b,a;var E,h,f;if(this.type2D=="XYZ"){var u=this.xAxisIndices[this.xAxisCurrent];var I=this.yAxisIndices[this.yAxisCurrent];var m=this.zAxisIndices[this.zAxisCurrent];var J=u+":"+I;if(this.xAxisTransform=="percentile"){r=this.getAxisRangeBySample(this.xAxisIndices);G=r[0];H=r[1]}if(this.yAxisTransform=="percentile"){w=this.getAxisRangeBySample(this.yAxisIndices);a=w[0];b=w[1]}E=this.getAxisRangeBySample(this.zAxisIndices);f=E[0];h=E[1];for(var A=0;A<this.varIndices.length;A++){var F=this.varIndices[A];var p=this.getDataAtPos(F,u,false,this.xAxisTransform,G,H);var o=this.getDataAtPos(F,I,false,this.yAxisTransform,a,b);var n=this.getDataAtPos(F,m,false,"percentile",f,h);var t=this.sizeBy?this.dataSizes[A]:this.sizes[Math.floor(n/10)+1];var k=this.colorBy?this.dataColors[A]:this.colors[0];var v=this.shapeBy?this.dataShapes[A]:this.shapes[0];var D=(this.offsetX+this.left)+((p-this.xAxisMin)*this.xAxisUnit);var e=(this.offsetY+this.top+this.y)-((o-this.yAxisMin)*this.yAxisUnit);if(this.isVisibleSelectedDataPoint(F,J)){this.drawSelectedBackground(F,J,v,D,e,t,t,false,true);this.addArea(this.drawShape(v,D,e,t,t,k,this.foreground,"closed",false,false,true),[F,u,I,m]);if(this.isScatterLine&&A<this.varIndices.length-1&&this.isVisibleSelectedDataPoint(this.varIndices[A+1],J)){F=this.varIndices[A+1];p=this.getDataAtPos(F,u,false,this.xAxisTransform,G,H);o=this.getDataAtPos(F,I,false,this.yAxisTransform,a,b);var C=(this.offsetX+this.left)+((p-this.xAxisMin)*this.xAxisUnit);var d=(this.offsetY+this.top+this.y)-((o-this.yAxisMin)*this.yAxisUnit);this.drawLine("line",D,e,C,d,this.colors[0])}}}}else{if(this.type2D=="XY"){for(var B=0;B<this.xAxisIndices.length;B++){var k=B%this.colors.length;var u=this.xAxisIndices[B];var I=this.yAxisIndices[B];var m;var J=u+":"+I;if(this.xAxisTransform=="percentile"){r=this.getAxisRangeBySample(u);G=r[0];H=r[1]}if(this.yAxisTransform=="percentile"){w=this.getAxisRangeBySample(I);a=w[0];b=w[1]}if(this.graphType=="ScatterBubble2D"&&!this.sizeBy){if(this.zAxisIndices[this.zAxisCurrent]){m=this.zAxisIndices[this.zAxisCurrent];E=this.getAxisRangeBySample(m);f=E[0];h=E[1]}}for(var A=0;A<this.varIndices.length;A++){var F=this.varIndices[A];var p=this.getDataAtPos(F,u,false,this.xAxisTransform,G,H);var o=this.getDataAtPos(F,I,false,this.yAxisTransform,a,b);var n;var v=this.shapeBy?this.dataShapes[A]:this.shapes[0];var t=this.scatterPointSize;if(this.sizeBy){t=this.dataSizes[A]}else{if(this.graphType=="ScatterBubble2D"){if(this.zAxisIndices[B]){n=this.getDataAtPos(F,m,false,"percentile",f,h);t=this.sizes[Math.floor(n/10)+1]}}}var D=(this.offsetX+this.left)+((p-this.xAxisMin)*this.xAxisUnit);var e=(this.offsetY+this.top+this.y)-((o-this.yAxisMin)*this.yAxisUnit);if(this.isHistogram){var d=(this.offsetY+this.top+this.y)-e;if(this.isVisibleSelectedDataPoint(F,J)){this.drawSelectedBackground(F,J,"rectangle",D-this.histogramBarWidth,e-this.histogramBarWidth,this.histogramBarWidth*2,d,false,true);this.addArea(this.rectangle(D-this.histogramBarWidth,e,this.histogramBarWidth*2,d,this.colors[k],false,"closed",false,false,true),[F,u,I])}}else{if(this.isVisibleSelectedDataPoint(F,J)){this.drawSelectedBackground(F,J,v,D,e,t,t,false,true);if(this.graphType=="ScatterBubble2D"){if(this.colorBy){this.addArea(this.drawShape(v,D,e,t,t,this.dataColors[A],this.colors[k],"closed",false,false,true),[F,u,I,m])}else{this.addArea(this.drawShape(v,D,e,t,t,this.colors[k],this.foreground,"closed",false,false,true),[F,u,I,m])}}else{if(this.colorBy){this.addArea(this.drawShape(v,D,e,t,t,this.dataColors[A],this.colors[k],"closed",false,false,true),[F,u,I])}else{this.addArea(this.drawShape(v,D,e,t,t,this.colors[k],this.foreground,"closed",false,false,true),[F,u,I])}}if(this.isScatterLine&&A<this.varIndices.length-1&&this.isVisibleSelectedDataPoint(this.varIndices[A+1],J)){F=this.varIndices[A+1];p=this.getDataAtPos(F,u,false,this.xAxisTransform,G,H);o=this.getDataAtPos(F,I,false,this.yAxisTransform,a,b);var C=(this.offsetX+this.left)+((p-this.xAxisMin)*this.xAxisUnit);var d=(this.offsetY+this.top+this.y)-((o-this.yAxisMin)*this.yAxisUnit);this.drawLine("line",D,e,C,d,this.colors[B])}}}}}}else{if(this.type2D=="X"){var s=this.yAxisIndices[this.yAxisCurrent];if(this.yAxisTransform=="percentile"){w=this.getAxisRangeBySample(s);a=w[0];b=w[1]}var g;if(this.graphType=="ScatterBubble2D"&&!this.sizeBy){if(this.zAxisIndices[this.zAxisCurrent]){g=this.zAxisIndices[this.zAxisCurrent];E=this.getAxisRangeBySample(g);f=E[0];h=E[1]}}for(var B=0;B<this.xAxisIndices.length;B++){var k=B%this.colors.length;var q=this.xAxisIndices[B];var J=q+":"+s;if(this.xAxisTransform=="percentile"){r=this.getAxisRangeBySample(q);G=r[0];H=r[1]}for(var A=0;A<this.varIndices.length;A++){var F=this.varIndices[A];var p=this.getDataAtPos(F,q,false,this.xAxisTransform,G,H);var o=this.getDataAtPos(F,s,false,this.yAxisTransform,a,b);var n;var t=this.scatterPointSize;var v=this.shapeBy?this.dataShapes[A]:this.shapes[0];if(this.sizeBy){t=this.dataSizes[A]}else{if(this.graphType=="ScatterBubble2D"){if(this.zAxisIndices[this.zAxisCurrent]){n=this.getDataAtPos(F,g,false,"percentile",f,h);t=this.sizes[Math.floor(n/10)+1]}}}var D=(this.offsetX+this.left)+((p-this.xAxisMin)*this.xAxisUnit);var e=(this.offsetY+this.top+this.y)-((o-this.yAxisMin)*this.yAxisUnit);if(this.isHistogram){var d=(this.offsetY+this.top+this.y)-e;if(this.isVisibleSelectedDataPoint(F,J)){this.drawSelectedBackground(F,J,"rectangle",D-this.histogramBarWidth,e-this.histogramBarWidth,this.histogramBarWidth*2,d,false,true);this.addArea(this.rectangle(D-this.histogramBarWidth,e,this.histogramBarWidth*2,d,this.colors[k],false,"closed",false,false,true),[F,q,s])}}else{if(this.isVisibleSelectedDataPoint(F,J)){this.drawSelectedBackground(F,J,v,D,e,t,t,false,true);if(this.graphType=="ScatterBubble2D"){if(this.colorBy){this.addArea(this.drawShape(v,D,e,t,t,this.dataColors[A],this.colors[k],"closed",false,false,true),[F,q,s,g])}else{this.addArea(this.drawShape(v,D,e,t,t,this.colors[k],this.foreground,"closed",false,false,true),[F,q,s,g])}}else{if(this.colorBy){this.addArea(this.drawShape(v,D,e,t,t,this.dataColors[A],this.colors[k],"closed",false,false,true),[F,q,s])}else{this.addArea(this.drawShape(v,D,e,t,t,this.colors[k],this.foreground,"closed",false,false,true),[F,q,s])}}if(this.isScatterLine&&A<this.varIndices.length-1&&this.isVisibleSelectedDataPoint(this.varIndices[A+1],J)){F=this.varIndices[A+1];p=this.getDataAtPos(F,q,false,this.xAxisTransform,G,H);o=this.getDataAtPos(F,s,false,this.yAxisTransform,a,b);var C=(this.offsetX+this.left)+((p-this.xAxisMin)*this.xAxisUnit);var d=(this.offsetY+this.top+this.y)-((o-this.yAxisMin)*this.yAxisUnit);this.drawLine("line",D,e,C,d,this.colors[B])}}}}}}else{var s=this.xAxisIndices[this.xAxisCurrent];if(this.xAxisTransform=="percentile"){r=this.getAxisRangeBySample(s);G=r[0];H=r[1]}var g;if(this.graphType=="ScatterBubble2D"&&!this.sizeBy){if(this.zAxisIndices[this.zAxisCurrent]){g=this.zAxisIndices[this.zAxisCurrent];E=this.getAxisRangeBySample(g);f=E[0];h=E[1]}}for(var B=0;B<this.yAxisIndices.length;B++){var k=this.colors[B%this.colors.length];var q=this.yAxisIndices[B];var J=s+":"+q;if(this.yAxisTransform=="percentile"){w=this.getAxisRangeBySample(q);a=w[0];b=w[1]}for(var A=0;A<this.varIndices.length;A++){var F=this.varIndices[A];var p=this.getDataAtPos(F,s,false,this.xAxisTransform,G,H);var o=this.getDataAtPos(F,q,false,this.yAxisTransform,a,b);var n;var v=this.shapeBy?this.dataShapes[A]:this.shapes[0];var t=this.scatterPointSize;if(this.colorBy){k=this.dataColors[A]}if(this.sizeBy){t=this.dataSizes[A]}else{if(this.graphType=="ScatterBubble2D"){if(this.zAxisIndices[this.yAxisCurrent]){n=this.getDataAtPos(F,g,false,"percentile",f,h);t=this.sizes[Math.floor(n/10)+1]}}}var D=(this.offsetX+this.left)+((p-this.xAxisMin)*this.xAxisUnit);var e=(this.offsetY+this.top+this.y)-((o-this.yAxisMin)*this.yAxisUnit);if(this.isHistogram){var d=(this.offsetY+this.top+this.y)-e;if(this.isVisibleSelectedDataPoint(F,J)){this.drawSelectedBackground(F,J,"rectangle",D-this.histogramBarWidth,e-this.histogramBarWidth,this.histogramBarWidth*2,d,false,true);this.addArea(this.rectangle(D-this.histogramBarWidth,e,this.histogramBarWidth*2,d,k,false,"closed",false,false,true),[F,s,q])}}else{if(this.isVisibleSelectedDataPoint(F,J)){this.drawSelectedBackground(F,J,v,D,e,t,t,false,true);if(this.graphType=="ScatterBubble2D"){this.addArea(this.drawShape(v,D,e,t,t,k,this.foreground,"closed",false,false,true),[F,s,q,g])}else{this.addArea(this.drawShape(v,D,e,t,t,k,this.foreground,"closed",false,false,true),[F,s,q])}if(this.isScatterLine&&A<this.varIndices.length-1&&this.isVisibleSelectedDataPoint(this.varIndices[A+1],J)){F=this.varIndices[A+1];p=this.getDataAtPos(F,s,false,this.xAxisTransform,G,H);o=this.getDataAtPos(F,q,false,this.yAxisTransform,a,b);var C=(this.offsetX+this.left)+((p-this.xAxisMin)*this.xAxisUnit);var d=(this.offsetY+this.top+this.y)-((o-this.yAxisMin)*this.yAxisUnit);this.drawLine("line",D,e,C,d,this.colors[B])}}}}}}}}};this.draw2DLegend=function(){if(this.showLegend){this.drawScatterLegend()}if(this.showDecorations){this.drawDecorationLegend()}};this.set2DprivateParams=function(){this.set2DType();this.set2DText()};this.draw2DPlot=function(){if(this.xAxis&&this.yAxis){this.setDataColorShapeSize()}this.set2DprivateParams();this.set2DXYDimensions();if(this.xAxis&&this.yAxis){this.drawPlotWindow();this.set2DWireFrame();this.draw2DDataPoints();this.maskPlotArea();this.set2DLayout();this.drawTitle();this.drawDecorationData();this.draw2DLegend()}};this.initializeScatter2D=function(){if(this.layoutValid){this.drawLayoutCompartments(this.draw2DPlot)}else{this.draw2DPlot()}};this.initializeScatter2D()};CanvasXpress.prototype.Scatter3D=function(){this.set3DText=function(){this.setAxisFont(false,this.x)};this.set3DXYDimensions=function(){if(this.height<this.width){this.height=this.width}this.x=this.width-this.top;this.y=this.height-this.top;this.left=this.top;if(this.showLegend||this.showIndicators){this.setLegendDimensions();if(this.autoExtend){this.width=this.x+this.legendWidth;this.height=this.y+this.legendHeight}else{var a=Math.max(this.legendWidth,this.legendHeight);this.x-=a;this.y-=a;this.width=this.x+this.legendWidth;this.height=this.y+this.legendHeight}}this.resizeCanvas();this.setScatterPointSize()};this.draw3DLayout=function(h,a,n,j,b,o,g,d){var f,q,e,p,m;for(var k=0;k<h.length;k++){m=this.get3DTransfrom(h[k],a[k],n[k]);f=m[0]+this.left;q=m[1]+this.top;m=this.get3DTransfrom(j[k],b[k],o[k]);e=m[0]+this.left;p=m[1]+this.top;if(d=="dotted"){this.drawLine("dottedLine",f,q,e,p,g[k],false,"butt")}else{this.drawLine("line",f,q,e,p,g[k],false,"butt")}}};this.set3DXLayout=function(){var u=[],d=[],n=[],t=[],b=[],k=[],e=[];var r,m,o,a,v,q,j,h;var f=this.len/15;var p=(15*-f)+f;var g=this.xAxisTitle?this.xAxisTitle:this.data.y.smps[this.xAxisIndex];o=p;r=0;m=0;while(o<this.len){if((r+1)%3){u[m]=o;d[m]=-this.len;n[m]=this.len;t[m]=o;b[m]=this.len;k[m]=this.len;e.push(this.xAxisTickColor);m++;u[m]=-this.len;d[m]=o;n[m]=this.len;t[m]=this.len;b[m]=o;k[m]=this.len;e.push(this.xAxisTickColor);m++}o+=f;r++}this.draw3DLayout(u,d,n,t,b,k,e,this.xAxisTickStyle);u=[],d=[],n=[],t=[],b=[],k=[],e=[];o=p;r=0;m=0;v=this.xAxisIncr;while(o<this.len){if(!((r+1)%3)){u[m]=o;d[m]=-this.len;n[m]=this.len;t[m]=o;b[m]=this.len;k[m]=this.len;e.push(this.foreground);m++;u[m]=-this.len;d[m]=o;n[m]=this.len;t[m]=this.len;b[m]=o;k[m]=this.len;e.push(this.foreground);a=this.get3DTransfrom(o,this.len,-this.len);j=a[0]+this.left;h=a[1]+this.top;q=sprintf("%."+this.xAxisDecs+"f",this.xAxisMin+v);v+=this.xAxisIncr;if(this.xAxisShow){this.drawText(q,j,h+5,this.axisTickFont,this.axisTickColor,"right",false,-Math.PI/2)}m++}o+=f;r++}this.draw3DLayout(u,d,n,t,b,k,e,this.xAxisTickStyle);if(this.xAxisShow){this.draw3DAxisTitle(p-(f*2),this.len+f,this.len+(f*4),this.len+(f*4),-this.len-(f*4),-this.len-(f*4),g,"x")}u=[-this.len,-this.len,this.len,-this.len];d=[-this.len,-this.len,-this.len,this.len];n=[this.len,this.len,this.len,this.len];t=[-this.len,this.len,this.len,this.len];b=[this.len,-this.len,this.len,this.len];k=[this.len,this.len,this.len,this.len];e=[this.foreground,this.foreground,this.foreground,this.foreground];this.draw3DLayout(u,d,n,t,b,k,e,this.xAxisTickStyle)};this.set3DYLayout=function(){var w=[],d=[],n=[],v=[],b=[],k=[],e=[];var t,m,p,a,z,r,j,h;var f=this.len/15;var u=this.yAxisLen/30;var q=(15*-f)+f;var g=this.yAxisTitle?this.yAxisTitle:this.data.y.smps[this.yAxisIndex];var o=[];p=q;t=0;m=0;z=this.yAxisIncr;while(p<this.len){if((t+1)%3){w[m]=-this.len;d[m]=-this.len;n[m]=p;v[m]=-this.len;b[m]=this.len;k[m]=p;e.push(this.yAxisTickColor);m++;w[m]=-this.len;d[m]=p;n[m]=-this.len;v[m]=-this.len;b[m]=p;k[m]=this.len;e.push(this.yAxisTickColor);m++}else{o.push(z);z+=this.yAxisIncr}p+=f;t++}this.draw3DLayout(w,d,n,v,b,k,e,this.yAxisTickStyle);w=[],d=[],n=[],v=[],b=[],k=[],e=[];p=q;t=0;m=0;while(p<this.len){if(!((t+1)%3)){w[m]=-this.len;d[m]=-this.len;n[m]=p;v[m]=-this.len;b[m]=this.len;k[m]=p;e.push(this.foreground);m++;w[m]=-this.len;d[m]=p;n[m]=-this.len;v[m]=-this.len;b[m]=p;k[m]=this.len;e.push(this.foreground);a=this.get3DTransfrom(-this.len,p,-this.len);j=a[0]+this.left;h=a[1]+this.top;z=o.pop();r=sprintf("%."+this.yAxisDecs+"f",this.yAxisMin+z);if(this.yAxisShow){if(this.yRotate>=45&&this.xRotate>=45){this.drawText(r,j,h+5,this.axisTickFont,this.axisTickColor,"right",false,-Math.PI/2)}else{this.drawText(r,j-5,h,this.axisTickFont,this.axisTickColor,"right")}}m++}p+=f;t++}this.draw3DLayout(w,d,n,v,b,k,e,this.yAxisTickStyle);if(this.yAxisShow){this.draw3DAxisTitle(-this.len-(f*4),-this.len-(f*4),q-(f*2),this.len+f,-this.len-(f*4),-this.len-(f*4),g,"y")}w=[-this.len,-this.len,-this.len,-this.len];d=[-this.len,-this.len,-this.len,this.len];n=[-this.len,this.len,this.len,this.len];v=[-this.len,-this.len,-this.len,-this.len];b=[this.len,-this.len,this.len,this.len];k=[-this.len,-this.len,this.len,-this.len];e=[this.foreground,this.foreground,this.foreground,this.foreground];this.draw3DLayout(w,d,n,v,b,k,e,this.yAxisTickStyle)};this.set3DZLayout=function(){var u=[],d=[],n=[],t=[],b=[],k=[],e=[];var r,m,o,a,v,q,j,h;var f=this.len/15;var p=(15*-f)+f;var g=this.zAxisTitle?this.zAxisTitle:this.data.y.smps[this.zAxisIndex];o=p;r=0;m=0;while(o<this.len){if((r+1)%3){u[m]=-this.len;d[m]=this.len;n[m]=o;t[m]=this.len;b[m]=this.len;k[m]=o;e.push(this.zAxisTickColor);m++;u[m]=o;d[m]=this.len;n[m]=-this.len;t[m]=o;b[m]=this.len;k[m]=this.len;e.push(this.zAxisTickColor);m++}o+=f;r++}this.draw3DLayout(u,d,n,t,b,k,e,this.zAxisTickStyle);u=[],d=[],n=[],t=[],b=[],k=[],e=[];o=p;r=0;m=0;v=this.zAxisIncr;while(o<this.len){if(!((r+1)%3)){u[m]=-this.len;d[m]=this.len;n[m]=o;t[m]=this.len;b[m]=this.len;k[m]=o;e.push(this.foreground);m++;u[m]=o;d[m]=this.len;n[m]=-this.len;t[m]=o;b[m]=this.len;k[m]=this.len;e.push(this.foreground);a=this.get3DTransfrom(this.len,this.len,o);j=a[0]+this.left;h=a[1]+this.top;q=sprintf("%."+this.zAxisDecs+"f",this.zAxisMin+v);v+=this.zAxisIncr;if(this.zAxisShow){if(this.xRotate>=45){if(this.yRotate>=45){this.drawText(q,j+5,h,this.axisTickFont,this.axisTickColor,"left")}else{this.drawText(q,j,h+5,this.axisTickFont,this.axisTickColor,"right",false,-Math.PI/2)}}else{this.drawText(q,j+5,h,this.axisTickFont,this.axisTickColor,"left")}}m++}o+=f;r++}this.draw3DLayout(u,d,n,t,b,k,e,this.zAxisTickStyle);if(this.zAxisShow){this.draw3DAxisTitle(this.len+(f*6),this.len+(f*6),this.len+(f*6),this.len+(f*6),p-(f*2),this.len+f,g,"z")}u=[-this.len,-this.len,this.len,-this.len];d=[this.len,this.len,this.len,this.len];n=[-this.len,this.len,-this.len,-this.len];t=[-this.len,this.len,this.len,this.len];b=[this.len,this.len,this.len,this.len];k=[this.len,this.len,this.len,-this.len];e=[this.foreground,this.foreground,this.foreground,this.foreground];this.draw3DLayout(u,d,n,t,b,k,e,this.zAxisTickStyle)};this.draw3DAxisTitle=function(d,b,q,p,j,g,r,e){var a=this.measureText(r);var t=a/2;var k=r.split("");var o=(d+b)/2;var n=(q+p)/2;var m=(j+g)/2;var s=this.xRotate>=45||this.yRotate>=45?4:0;if(this.xRotate>=45||this.yRotate>=45){a+=k.length*4;t=a/2}if(e=="x"){o-=t;for(var f=0;f<k.length;f++){var h=this.get3DTransfrom(o,n,m);this.drawText(k[f],this.offsetX+h[0],this.offsetY+h[1],this.axisTitleFont,this.axisTitleColor,"left","top");o+=this.measureText(k[f])+s}}else{if(e=="y"){n+=t;for(var f=0;f<k.length;f++){var h=this.get3DTransfrom(o,n,m);this.drawText(k[f],this.offsetX+h[0],this.offsetY+h[1],this.axisTitleFont,this.axisTitleColor,"left","bottom",-Math.PI/2);n-=this.measureText(k[f])+s}}else{if(e=="z"){m-=t;for(var f=0;f<k.length;f++){var h=this.get3DTransfrom(o,n,m);this.drawText(k[f],this.offsetX+h[0],this.offsetY+h[1],this.axisTitleFont,this.axisTitleColor,"left","bottom");m+=this.measureText(k[f])+s}}}}};this.set3DLayout=function(){this.set3DXLayout();this.set3DYLayout();this.set3DZLayout()};this.set3DAxes=function(){var b=["x","y","z"];for(var a=0;a<b.length;a++){var d=this.smpIndices;this[b[a]+"AxisIndex"]=this.getSampleIndices([this[b[a]+"Axis"]])[0];this.setSamplesVisible([this[b[a]+"AxisIndex"]]);this.setRangeData();this[b[a]+"AxisMin"]=this.minData;this[b[a]+"AxisMax"]=this.maxData;this[b[a]+"AxisIncr"]=this.getAxisIncrements(this[b[a]+"AxisMin"],this[b[a]+"AxisMax"],10);this[b[a]+"AxisDecs"]=this.getAxisDecimals(this[b[a]+"AxisIncr"]);this[b[a]+"AxisMin"]=this.getAxisMin(this.minData,this[b[a]+"AxisIncr"]);this[b[a]+"AxisMax"]=this[b[a]+"AxisMin"]+(this[b[a]+"AxisIncr"]*10);this[b[a]+"AxisRange"]=this[b[a]+"AxisMax"]-this[b[a]+"AxisMin"];this[b[a]+"AxisUnit"]=this.len*2/this[b[a]+"AxisRange"];this[b[a]+"AxisOffset"]=(this[b[a]+"AxisMin"]+(this[b[a]+"AxisRange"]/2))*this[b[a]+"AxisUnit"];this.setSamplesVisible(d)}};this.set3DDataPoints=function(){this.dataPoints=[];for(var d=0;d<this.varIndices.length;d++){var e=this.varIndices[d];var a=this.getDataAtPos(e,this.xAxisIndex);var g=this.getDataAtPos(e,this.yAxisIndex);var f=this.getDataAtPos(e,this.zAxisIndex);var b=this.get3DTransfrom((a*this.xAxisUnit)-this.xAxisOffset,this.yAxisOffset-(g*this.yAxisUnit),(f*this.zAxisUnit)-this.zAxisOffset);this.dataPoints.push(b)}};this.draw3DDataPoints=function(){var m=this.xAxisIndex+":"+this.yAxisIndex+":"+this.zAxisIndex;if(this.isScatterLine){for(var g=0;g<this.varIndices.length-1;g++){if(this.isVisibleSelectedDataPoint(g,m)&&this.isVisibleSelectedDataPoint(g+1,m)){var d=this.offsetX+this.left+this.dataPoints[g][0];var k=this.offsetY+this.top+this.dataPoints[g][1];var a=this.offsetX+this.left+this.dataPoints[g+1][0];var j=this.offsetY+this.top+this.dataPoints[g+1][1];this.drawLine("line",d,k,a,j,this.colors[0])}}}var h=[];var f=[];for(var g=0;g<this.dataPoints.length;g++){f.push(g);h.push(Math.sqrt((this.dataPoints[g][0]*this.dataPoints[g][0])+(this.dataPoints[g][1]*this.dataPoints[g][1])+(this.dataPoints[g][2]*this.dataPoints[g][2])))}f.sort(function(q,p){return h[p]-h[q]});for(var n=0;n<this.dataPoints.length;n++){var g=f[n];if(this.dataPoints[g][0]>this.left&&this.dataPoints[g][0]<(this.left+this.x)&&this.dataPoints[g][1]>this.top&&this.dataPoints[g][1]<(this.top+this.y)){var e=this.colorBy?this.dataColors[g]:this.colors[0];var o=this.shapeBy?this.dataShapes[g]:this.shapes[0];var b=this.sizeBy?this.dataSizes[g]:this.scatterPointSize;if(this.isVisibleSelectedDataPoint(g,m)){this.drawSelectedBackground(g,m,o,this.offsetX+this.left+this.dataPoints[g][0],this.offsetY+this.top+this.dataPoints[g][1],b,b);this.addArea(this.drawShape(o,this.offsetX+this.left+this.dataPoints[g][0],this.offsetY+this.top+this.dataPoints[g][1],b,b,e,this.foreground,"closed"),[g,this.xAxisIndex,this.yAxisIndex,this.zAxisIndex])}}}};this.set3DprivateParams=function(){this.set3DText();this.set3DParams()};this.draw3DPlot=function(){this.setDataColorShapeSize();this.set3DXYDimensions();this.set3DprivateParams();this.set3DRotation();this.set3DAxes();this.set3DLayout();this.set3DDataPoints();this.drawTitle();this.draw3DDataPoints();this.drawScatterLegend()};this.initializeScatter3D=function(){if(this.layoutValid){this.drawLayoutCompartments(this.draw3DPlot)}else{this.draw3DPlot()}};this.initializeScatter3D()};CanvasXpress.prototype.oneDPlot=function(){this.getShapeSize=function(){if(this.x<100||this.y<100){return this.rowBlockSize/6}else{if(this.x<200||this.y<200){return this.rowBlockSize/3}else{return this.rowBlockSize/1.5}}};this.setRowColBlocks=function(){var b=this.isGroupedData?this.grpIndices.length:this.smpIndices.length;this.rowBlocks=0;if(this.graphType=="Line"||this.graphType=="Area"||this.graphType=="Heatmap"||this.graphType=="Stacked"||this.graphType=="StackedLine"||this.graphType=="StackedPercent"||this.graphType=="StackedPercentLine"){this.rowBlocks=b;if(this.graphType=="Heatmap"){this.colBlocks=this.varIndices.length}else{this.colBlocks=1}}else{if(this.graphType=="BarLine"&&this.data.a){var a=this.getVariablesVisibleByAxis("xAxis");this.rowBlocks=a.length*b;this.colBlocks=1}else{this.rowBlocks=this.varIndices.length*b;this.colBlocks=1}}};this.set1DVarSmpLabelFont=function(){if(this.autoScaleFont){var a;if(this.data.l&&this.data.l.vars&&this.data.l.smps&&this.graphOrientation=="vertical"){a=this.scaleTextToSize(this.layoutMaxSamples*2)}else{if(Math.abs(this.smpLabelRotate==90)){a=this.isGraphTime?this.scaleTextToSize(this.timeValues.length*6):this.scaleTextToSize(this.smpIndices.length*6)}else{a=this.isGraphTime?this.scaleTextToSize(this.timeValues.length*2):this.scaleTextToSize(this.smpIndices.length*2)}}a=Math.min(a*this.scaleSmpLabelFontFactor,this.maxTextSize);this.smpLabelFont=(a)+"Pt "+this.fontName;a=this.scaleTextToSize(this.varIndices.length*2);a=Math.min(a*this.scaleVarLabelFontFactor,this.maxTextSize);this.varLabelFont=(a)+"Pt "+this.fontName}else{this.smpLabelFont=parseInt(this.smpLabelFontSize)+"Pt "+this.fontName;this.varLabelFont=parseInt(this.varLabelFontSize)+"Pt "+this.fontName}};this.set1DText=function(){var a;if(!this.layoutComb){if(this.data.y.desc){if(this.data.y.desc.length>1){if(this.data.y.desc[0].length>this.data.y.desc[1].length){a=this.data.y.desc[0]}else{a=this.data.y.desc[1]}}else{a=this.data.y.desc[0]}}else{a="NA"}}if(this.layoutComb){this.setAxisFont(this.minLayoutAxisTitle,this.minLayoutAxis)}else{if(this.graphOrientation=="vertical"){this.setAxisFont(a,this.y)}else{this.setAxisFont(a,this.x)}}};this.getVariableTitleHeight=function(){if(this.varTitle){return parseInt(this.varTitleFontSize*this.scaleVarTitleFontFactor)+this.margin}else{return 0}};this.getVariableLabelLength=function(){if(this.showVariableNames){if(this.varLabelRotate&&Math.abs(this.varLabelRotate)==90){return this.getFontPt(this.varLabelFont)+this.margin}else{return this.measureText(this.maxVarNameStr,this.varLabelFont)+this.margin}}else{return 0}};this.getVariableLabelDescLength=function(){if(this.showVariableNames&&this.varLabelDescription){if(this.maxVarLabelDesc>this.maxVarStringLen){return this.measureText(this.maxVarLabelDescStr.substring(0,this.maxVarStringLen),this.varLabelFont)+(this.margin*2)}else{return this.measureText(this.maxVarLabelDescStr,this.varLabelFont)+(this.margin*2)}}else{return 0}};this.getSampleTitleHeight=function(){if(this.smpTitle){return parseInt(this.smpTitleFontSize*this.scaleSmpTitleFontFactor)+this.margin}else{return 0}};this.getSampleLabelLength=function(){if(this.showSampleNames){if(this.smpLabelRotate&&Math.abs(this.smpLabelRotate)==90){return this.getFontPt(this.smpLabelFont)+(this.margin*2)}else{if(this.isGraphTime){return this.measureText(this.getMaxText(this.timeValues),this.smpLabelFont)+(this.margin*2)}else{if(this.maxSmpName>this.maxSmpStringLen){return this.measureText(this.maxSmpNameStr.substring(0,this.maxSmpStringLen),this.smpLabelFont)+(this.margin*2)}else{return this.measureText(this.maxSmpNameStr,this.smpLabelFont)+(this.margin*2)}}}}else{return 0}};this.getSampleLabelDescLength=function(){if(this.showSampleNames&&this.smpLabelDescription){if(this.maxSmpLabelDesc>this.maxSmpStringLen){return this.measureText(this.maxSmpLabelDescStr.substring(0,this.maxSmpStringLen),this.smpLabelFont)+(this.margin*2)}else{return this.measureText(this.maxSmpLabelDescStr,this.smpLabelFont)+(this.margin*2)}}else{return 0}};this.getSmpOverlaysLength=function(){var a=0;if(this.showOverlays){if(!this.isGroupedData){for(var b=0;b<this.smpOverlays.length;b++){if(this.data.x.hasOwnProperty(this.smpOverlays[b])){a++}}if(a>0){a=(a*this.overlaysWidth)+this.margin}}}return a};this.getSmpOverlaysStrLength=function(){var a=0;if(this.showOverlays){if(this.graphType=="Heatmap"){for(var b=0;b<this.smpOverlays.length;b++){if(this.data.x.hasOwnProperty(this.smpOverlays[b])){a=Math.max(a,this.measureText(this.smpOverlays[b],this.overlayFont)+this.margin)}}}}return a};this.getVarOverlaysHeight=function(){var a=0;if(this.showOverlays){if(this.graphType=="Heatmap"){for(var b=0;b<this.varOverlays.length;b++){if(this.data.z.hasOwnProperty(this.varOverlays[b])){a++}}if(a>0){a=(a*this.overlaysWidth)+this.margin}}}return a};this.getVarOverlaysLength=function(){var a=0;if(this.showOverlays){if(this.graphType=="Heatmap"){for(var b=0;b<this.varOverlays.length;b++){if(this.data.z.hasOwnProperty(this.varOverlays[b])){a=Math.max(a,this.measureText(this.varOverlays[b],this.overlayFont)+this.margin)}}}}return a};this.getAxisTitleTickLength=function(){if(this.graphOrientation=="vertical"){var a;if(this.tickRotate&&Math.abs(this.tickRotate)==90){a=this.getFontPt(this.axisTickFont)}else{if(this.graphType=="Candlestick"){if(this.showVolume){a=Math.max(this.measureText(this.xAxisMaxStrLength,this.axisTickFont),this.measureText(this.xAxis2MaxStrLength,this.axisTickFont))}else{if(this.summaryType=="candle"){a=this.measureText(this.xAxisMaxStrLength,this.axisTickFont)}else{a=this.measureText(this.xAxis2MaxStrLength,this.axisTickFont)}}}else{a=this.measureText(this.xAxisMaxStrLength,this.axisTickFont)}}return this.getFontPt(this.axisTitleFont)+a+(this.margin*3)}else{return this.getFontPt(this.axisTitleFont)+this.getFontPt(this.axisTickFont)+(this.margin*5)}};this.getHeatmapIndicatorHeight=function(){return this.indicatorHeight+(this.margin*4)+this.getFontPt(this.legendFont)};this.getLegendHeight=function(d){if(this.graphType=="Heatmap"){return 0}else{if(this.colorBy&&this.graphType=="Bar"){if(this.legendColorsN>0){return this.legendColorHeight+this.margin}else{return this.legendPosition=="right"?this.legendColorIndicatorWidth:this.legendColorIndicatorHeight}}else{var a=Math.min(this.getFontPt(this.legendFont),this.maxTextSize);var b=this.layoutComb&&!d?this.layoutMaxLegend:this.varIndices.length;return(b*a*1.5)+(a/2)+this.margin}}};this.getLegendWidth=function(){if(this.graphType=="Heatmap"){return 0}else{if(this.colorBy&&this.graphType=="Bar"){if(this.legendColorsN>0){return this.legendColorWidth+this.margin}else{return this.legendPosition=="right"?this.legendColorIndicatorHeight:this.legendColorIndicatorWidth}}else{var b=Math.min(this.getFontPt(this.legendFont),this.maxTextSize);var a=this.layoutComb?this.layoutMaxLegendLabel:this.maxVarNameStr;var d=a.length>this.maxVarStringLen?a.substring(0,this.maxVarStringLen):a;return(b*2)+this.measureText(d,this.legendFont)+(this.margin*6)}}};this.getVarTreeHeight=function(){var a=0;if(this.graphType=="Heatmap"&&this.showVarDendrogram&&this.varDendrogram){a=((this.varDendrogram.depth+1)*this.dendrogramSpace)+this.margin}return a};this.getSmpTreeWidthHeight=function(){var a=0;if(this.showSmpDendrogram&&this.smpDendrogram&&!this.isGroupedData){a=((this.smpDendrogram.depth+1)*this.dendrogramSpace)+this.margin}return a};this.set1DXYDimensionsLeft=function(){if(this.graphOrientation=="vertical"){this.left=this.margin+this.getAxisTitleTickLength()}else{if(this.smpDendrogramPosition=="right"){this.left=this.margin+this.getSampleTitleHeight()+this.getSampleLabelLength()+this.getSmpOverlaysLength()}else{this.left=this.margin+this.getSampleTitleHeight()+this.getSmpTreeWidthHeight()+this.getSampleLabelLength()+this.getSmpOverlaysLength()}}};this.set1DXYDimensionsRight=function(){if(this.graphOrientation=="vertical"){this.right=this.margin+this.getAxisTitleTickLength()}else{if(this.smpDendrogramPosition=="right"){this.right=this.margin+this.getSmpTreeWidthHeight()}else{this.right=this.margin}}if(this.showLegend&&this.legendPosition=="right"){this.right+=this.getLegendWidth()}if(this.graphType=="Heatmap"){var b=this.getSampleLabelDescLength();var a=0;if(this.showOverlays){a=this.getVarOverlaysLength()}this.right+=Math.max(b,a)}};this.set1DXYDimensionsTop=function(){this.top=this.margin;if(this.title){this.top+=this.titleHeight+this.margin;if(this.subtitle){this.top+=this.subtitleHeight+this.margin}}if(this.graphOrientation=="vertical"){if(this.smpDendrogramPosition!="bottom"){this.top+=this.getSmpTreeWidthHeight()}}else{if(this.graphType=="Heatmap"){this.top+=this.getHeatmapIndicatorHeight();if(this.varDendrogramPosition!="bottom"){this.top+=this.getVarTreeHeight()}if(this.varTitleLabelOverlayPosition!="bottom"){this.top+=this.getVariableTitleHeight();this.top+=this.getVariableLabelLength();this.top+=this.getVarOverlaysHeight()}else{this.top+=this.getVariableLabelDescLength()}}else{this.top+=this.getAxisTitleTickLength()}}};this.set1DXYDimensionsBottom=function(){this.bottom=this.margin;if(this.graphOrientation=="vertical"){this.bottom+=this.getSampleTitleHeight()+this.getSampleLabelLength()+this.getSmpOverlaysLength();if(this.smpDendrogramPosition=="bottom"){this.bottom+=this.getSmpTreeWidthHeight()}if(this.showLegend&&this.legendPosition=="bottom"){this.bottom+=this.getLegendHeight()}}else{if(this.graphType=="Heatmap"){if(this.varTitleLabelOverlayPosition=="bottom"){this.bottom+=this.getVarOverlaysHeight();this.bottom+=this.getVariableLabelLength();this.bottom+=this.getVariableTitleHeight()}else{this.bottom+=Math.max(this.getVariableLabelDescLength(),this.getSmpOverlaysStrLength())}if(this.varDendrogramPosition=="bottom"){this.bottom+=this.getVarTreeHeight()}}else{this.bottom+=this.getAxisTitleTickLength();if(this.showLegend&&this.legendPosition=="bottom"){this.bottom+=this.getLegendHeight()}}}};this.set1DXYDimensions=function(a){if(this.isGraphTime){if(!this.showVolume||(this.layoutComb&&this.layoutCurrent==0)){this.setTimeAxis()}}if(!a){this.setRowColBlocks();this.set1DVarSmpLabelFont()}if(this.graphOrientation=="vertical"){this.set1DXYDimensionsTop();this.set1DXYDimensionsBottom();this.y=this.layoutComb?this.layoutHeight-(this.top+this.bottom):this.height-(this.top+this.bottom);if(this.y<0){this.showLegend=false;this.set1DXYDimensionsBottom();this.y=this.layoutComb?this.layoutHeight-(this.top+this.bottom):this.height-(this.top+this.bottom);if(this.y<0){alert("Dude it doesn't fit make the graph bigger because it looks ugly!")}else{alert("Dude the legend was taken out because it doesn't fit make the graph bigger!")}}this.set1DText();this.set1DXYDimensionsLeft();this.set1DXYDimensionsRight();this.x=this.layoutComb?this.layoutWidth-(this.left+this.right):this.width-(this.left+this.right);if(this.x<0){this.showLegend=false;this.set1DXYDimensionsRight();this.x=this.layoutComb?this.layoutWidth-(this.left+this.right):this.width-(this.left+this.right);if(this.x<0){alert("Dude it doesn't fit make the graph bigger because it looks ugly!")}else{alert("Dude the legend was taken out because it doesn't fit make the graph bigger!")}}}else{this.set1DXYDimensionsLeft();this.set1DXYDimensionsRight();this.x=this.layoutComb?this.layoutWidth-(this.left+this.right):this.width-(this.left+this.right);if(this.x<0){this.showLegend=false;this.set1DXYDimensionsRight();this.x=this.layoutComb?this.layoutWidth-(this.left+this.right):this.width-(this.left+this.right);if(this.x<0){alert("Dude it doesn't fit make the graph bigger because it looks ugly!")}else{alert("Dude the legend was taken out because it doesn't fit make the graph bigger!")}}this.set1DText();this.set1DXYDimensionsTop();this.set1DXYDimensionsBottom();this.y=this.layoutComb?this.layoutHeight-(this.top+this.bottom):this.height-(this.top+this.bottom);if(this.y<0){this.showLegend=false;this.set1DXYDimensionsBottom();this.y=this.layoutComb?this.layoutHeight-(this.top+this.bottom):this.height-(this.top+this.bottom);if(this.y<0){alert("Dude it doesn't fit make the graph bigger because it looks ugly!")}else{alert("Dude the legend was taken out because it doesn't fit make the graph bigger!")}}if(this.graphType=="Heatmap"&&!this.layoutComb){if(this.bottom*1.5>this.y){if(this.dendrogramSpace>2){this.dendrogramSpace-=2}var b=this.getFontPt(this.varLabelFont)-1;this.varLabelFont=b.toString()+"pt "+this.fontName;this.resizeCanvas(true);this.set1DXYDimensions(true)}}if(this.left*1.5>this.x&&!this.layoutComb){if(this.dendrogramSpace>2){this.dendrogramSpace-=2}var b=this.getFontPt(this.smpLabelFont)-1;this.smpLabelFont=b.toString()+"pt "+this.fontName;this.resizeCanvas(true);this.set1DXYDimensions(true)}}};this.set1DPrivateParams=function(){var a=this.isGroupedData?this.grpIndices.length:this.smpIndices.length;if(this.autoExtend){this.rowBlockSize=this.scaleTextToSize(this.rowBlocks)+this.scaleTextConstantAdd;this.rowBlockSize*=this.blockFactor;if(this.graphType=="Heatmap"){if(this.colBlocks<20){this.colBlockSize=this.scaleTextToSize(this.colBlocks)+this.scaleTextConstantAdd+(this.scaleTextConstantAdd*3)}else{this.colBlockSize=(parseInt(1/Math.sqrt(this.colBlocks)*this.scaleTextConstantMult))+1}this.rowBlockSize=this.rowBlockSize;this.colBlockSize=this.colBlockSize;this.blockSeparation=this.rowBlockSize/2;this.y=this.rowBlockSize*this.rowBlocks;this.x=this.colBlockSize*this.colBlocks}else{this.blockSeparation=this.rowBlockSize*this.blockSeparationFactor;if(this.graphOrientation=="vertical"){this.x=(this.rowBlockSize*this.rowBlocks)+(this.blockSeparation*a)+this.blockSeparation}else{this.y=(this.rowBlockSize*this.rowBlocks)+(this.blockSeparation*a)+this.blockSeparation}this.colBlockSize=1}this.width=(this.left+this.x+this.right)*this.layoutCols;this.height=(this.top+this.y+this.bottom)*this.layoutRows;this.resizeCanvas()}else{if(this.graphType=="Heatmap"){this.rowBlockSize=this.y/this.rowBlocks;this.blockSeparation=this.rowBlockSize;this.colBlockSize=this.x/this.varIndices.length}else{this.rowBlockSize=this.graphOrientation=="vertical"?this.x/(this.rowBlocks+a+1):this.y/(this.rowBlocks+a+1);this.blockSeparation=this.rowBlockSize;this.colBlockSize=1}}};this.setTrees=function(){if(this.showSmpDendrogram&&this.data.t.smps){this.smpDendrogram={};this.smpDendrogram.data=[];this.smpDendrogram.nodes=[];this.smpDendrogram.idxs=[];this.smpDendrogram.heights=[];this.parseNewick(this.data.t.smps,"smpDendrogram")}if(this.showVarDendrogram&&this.data.t.vars){this.varDendrogram={};this.varDendrogram.data=[];this.varDendrogram.nodes=[];this.varDendrogram.idxs=[];this.varDendrogram.heights=[];this.parseNewick(this.data.t.vars,"varDendrogram")}};this.parseNewick=function(b,e){var q=b.split(/,/);var x=0;var f=0;var g=0;var o=1;var m=0;var v=0;var a=0;var k=0;for(var t=0;t<q.length;t++){var r=q[t];var h=r.split(/:(?=[0-9\.]+)/);var y=h.shift();y=y.replace(/[\(\)]/g,"");this[e].nodes.push(y);var w=e=="smpDendrogram"?this.getSampleIndices(y):this.getVariableIndices(y);this[e].idxs.push(w);for(var s=0;s<h.length;s++){var d=h[s].replace(/[\(\)]/g,"");v=Math.max(v,d);this[e].heights.push(d)}this[e].max=v;var u=q[t].split(/ */);f=0;for(var s=0;s<u.length;s++){if(u[s]=="("){x++;f++}if(u[s]==")"){x--;f--}}k+=f;if(g>x){this[e].data.push([o,g,f,k])}else{this[e].data.push([o,x,f,k])}g=x;a=Math.max(a,g);m+=f;o++}this[e].unit=v>0?(a*this.dendrogramSpace)/v:0;this[e].depth=a;if(m>0){alert("Dude! Malformed newick tree. There are "+m+" additional right parenthesis!")}else{if(m<0){alert("Dude! Malformed newick tree. There are "+Math.abs(m)+" additional left parenthesis!")}}if(e=="varDendrogram"){if(this.varIndicesStart<0){if(this[e].nodes.length!=this.data.y.vars.length){alert("Dude! The length of the variable nodes in the dendrogram ("+this[e].nodes.length+") is different to that one in the data ("+this.data.y.vars.length+"). This ain't gonna work!");this.showVarDendrogram=false}else{if(this[e].nodes.length!=this.varIndices.length){alert("Ooops! Cannot show dendrogram with "+this[e].nodes.length+" nodes when only "+this.varIndices.length+" variables are visible.");this.showVarDendrogram=false}else{this.varIndices=this[e].idxs}}}else{var p=this.varIndicesStart+this.varIndices.length;this.varIndices=[];for(var t=this.varIndicesStart;t<p;t++){this.varIndices.push(this[e].idxs[t])}}}else{if(this.smpIndicesStart<0){if(this[e].nodes.length!=this.data.y.smps.length){alert("Dude! The length of the sample nodes in the dendrogram ("+this[e].nodes.length+") is different to that one in the data ("+this.data.y.smps.length+"). This ain't gonna work!");this.showSmpDendrogram=false}else{if(this[e].nodes.length!=this.smpIndices.length){alert("Ooops! Cannot show dendrogram with "+this[e].nodes.length+" nodes when only "+this.smpIndices.length+" samples visible.");this.showSmpDendrogram=false}else{this.smpIndices=this[e].idxs}}}else{var p=this.smpIndicesStart+this.smpIndices.length;this.smpIndices=[];for(var t=this.smpIndicesStart;t<p;t++){this.smpIndices.push(this[e].idxs[t])}}}};this.setOverlayColors=function(){var o=0;if(this.smpOverlays.length>0&&!this.isGroupedData){this.smpOverlayColors=[];for(var h=0;h<this.smpOverlays.length;h++){var a={};this.smpOverlayColors[h]=[];var g=this.smpOverlays[h];if(this.data.x.hasOwnProperty(g)){if(this.isNumeric(this.data.x[g],true)){var k=this.range(this.data.x[g],true);var n="rgb(255,255,0)";for(var f=0;f<this.smpIndices.length;f++){var m=this.smpIndices[f];var e=this.data.x[g][m];var d=!isNaN(e)?this.getHeatmapColor(k[0],k[1],e):n;this.smpOverlayColors[h].push(d)}}else{for(var f=0;f<this.smpIndices.length;f++){var m=this.smpIndices[f];var b=this.data.x[g][m];if(!a.hasOwnProperty(b)){a[b]=o%this.colors.length;o++}this.smpOverlayColors[h].push(this.colors[a[b]])}}}}}o=0;if(this.varOverlays.length>0&&this.graphType=="Heatmap"){this.varOverlayColors=[];for(var h=0;h<this.varOverlays.length;h++){var a={};this.varOverlayColors[h]=[];var g=this.varOverlays[h];if(this.data.z.hasOwnProperty(g)){if(this.isNumeric(this.data.z[g],true)){var k=this.range(this.data.z[g],true);var n="rgb(255,255,0)";for(var f=0;f<this.varIndices.length;f++){var m=this.varIndices[f];var e=this.data.z[g][m];var d=!isNaN(e)?this.getHeatmapColor(k[0],k[1],e):n;this.varOverlayColors[h].push(d)}}else{for(var f=0;f<this.varIndices.length;f++){var m=this.varIndices[f];var b=this.data.z[g][m];if(!a.hasOwnProperty(b)){a[b]=o%this.colors.length;o++}this.varOverlayColors[h].push(this.colors[a[b]])}}}}}};this.setOverlayFont=function(){var a=Math.min(this.scaleOverlayFontFactor*this.overlayFontSize,this.maxTextSize);a=parseInt(Math.max(a,this.minTextSize));this.overlayFont=(a)+"Pt "+this.fontName};this.set1DAttributes=function(){this.setLegendFont();this.setTrees();this.setOverlayColors();this.setOverlayFont();this.setDataColor(true)};this.set1DXAxis=function(){var a=this.graphOrientation=="vertical"?"y":"x";this.setAxisUnits("xAxis",a);if((this.graphType.match(/BarLine|StackedLine|StackedPercentLine/)&&this.data.a)||(this.graphType=="Candlestick"&&this.showVolume)){this.setAxisUnits("xAxis2",a)}};this.draw1DWireFrame=function(){var r,e,q,d,p,a,f,j,n;var g=this.isGroupedData?this.grpIndices:this.smpIndices;var s=this.xAxisTickStyle=="dotted"||this.yAxisTickStyle=="dotted"?"dottedLine":"line";var t=this.smpHairline=="dotted"?"dottedLine":"line";if(this.graphType!="Heatmap"){if(this.graphType=="BarLine"&&this.data.a&&this.data.y.desc[1]){var b=this.getVariablesVisibleByAxis("xAxis");n=b.length}else{if(this.graphType.match(/Stacked|Line|Area/)){n=1}else{n=this.varIndices.length}}j=n*this.rowBlockSize;if(this.graphOrientation=="vertical"){if(this.isGraphTime){var h=(this.x-this.blockSeparation)/g.length;var m=h/2;var k=this.offsetX+this.left+(this.blockSeparation*0.5)+m;e=this.offsetY+this.top;d=this.offsetY+this.top+this.y;for(var o=0;o<this.timeValueIndices.length;o++){r=(this.timeValueIndices[o]*h)+k;if(this.smpHairline){this.drawLine(t,r,e,r,d,this.smpHairlineColor,false,"butt")}}}else{r=this.offsetX+this.left+this.blockSeparation+(j/2);q=this.offsetX+this.left;p=this.offsetX+this.left+(this.blockSeparation*1.5)+j;e=this.offsetY+this.top;d=this.offsetY+this.top+this.y;for(var o=0;o<g.length;o++){if(this.blockContrast){f=o%2?this.blockContrastEvenColor:this.blockContrastOddColor;this.ctx.save();this.rectangle(q,e,p,d,f,f);this.ctx.restore();q=p;p=q+this.blockSeparation+j}if(this.smpHairline){this.drawLine(t,r,e,r,d,this.smpHairlineColor,false,"butt")}r+=this.blockSeparation+j}}if((this.xAxisMinorTicks||this.xAxis2MinorTicks)&&this.summaryType!="volume"){for(var o=0;o<this.xAxisMinorValues.length;o++){var u=parseFloat(this.xAxisMinorValues[o]);e=this.offsetY+this.top+this.y-((u-this.xAxisMin)*this.xAxisUnit);this.drawLine(s,this.offsetX+this.left,e,this.offsetX+this.left+this.x,e,this.xAxisTickColor,this.outlineWidth/3,"butt")}}r=this.offsetX+this.left-(this.margin*2);for(var o=0;o<this.xAxisValues.length;o++){var u=parseFloat(this.xAxisValues[o]);e=this.offsetY+this.top+this.y-((u-this.xAxisMin)*this.xAxisUnit);this.drawLine(s,this.offsetX+this.left,e,this.offsetX+this.left+this.x,e,this.xAxisTickColor,false,"butt")}}else{if(this.isGraphTime){var h=(this.y-this.blockSeparation)/g.length;var m=h/2;var k=this.offsetY+this.top+(this.blockSeparation*0.5)+m;r=this.offsetX+this.left;q=this.offsetX+this.left+this.x;for(var o=0;o<this.timeValueIndices.length;o++){e=(this.timeValueIndices[o]*h)+k;if(this.smpHairline){this.drawLine(t,r,e,q,e,this.smpHairlineColor,false,"butt")}}}else{r=this.offsetX+this.left;q=this.offsetX+this.left+this.x;e=this.offsetY+this.top+this.blockSeparation+(j/2);d=this.offsetY+this.top;a=this.offsetY+this.top+(this.blockSeparation*1.5)+j;for(var o=0;o<g.length;o++){if(this.blockContrast){f=o%2?this.blockContrastEvenColor:this.blockContrastOddColor;this.ctx.save();this.rectangle(r,d,q,a,f,f);this.ctx.restore();d=a;a=d+this.blockSeparation+j}if(this.smpHairline){this.drawLine(t,r,e,q,e,this.smpHairlineColor,false,"butt")}e+=this.blockSeparation+j}}if((this.xAxisMinorTicks||this.xAxis2MinorTicks)&&this.summaryType!="volume"){for(var o=0;o<this.xAxisMinorValues.length;o++){var u=parseFloat(this.xAxisMinorValues[o]);r=this.offsetX+this.left+((u-this.xAxisMin)*this.xAxisUnit);this.drawLine(s,r,this.offsetY+this.top,r,this.offsetY+this.top+this.y,this.xAxisTickColor,this.outlineWidth/3,"butt")}}e=this.offsetY+this.top-((this.margin*2)+(this.getFontPt(this.axisTickFont)/2));for(var o=0;o<this.xAxisValues.length;o++){var u=parseFloat(this.xAxisValues[o]);r=this.offsetX+this.left+((u-this.xAxisMin)*this.xAxisUnit);this.drawLine(s,r,this.offsetY+this.top,r,this.offsetY+this.top+this.y,this.xAxisTickColor,false,"butt")}}}};this.drawTrees=function(){if(!this.isGroupedData){this.drawDendrogram("smpDendrogram");if(this.graphType=="Heatmap"){this.drawDendrogram("varDendrogram")}this.maskTreeArea()}};this.getMaxDepthDendrogramXYs=function(d){if(d.length>0){var a=[];for(var b=0;b<d.length;b++){a.push(d[b][1])}a.sort(function(f,e){return e-f});for(var b=0;b<d.length;b++){if(d[b][1]==a[0]){return b}}}else{return -1}};this.drawDendrogram=function(F){var J=F=="varDendrogram"?"showVarDendrogram":"showSmpDendrogram";var g=F=="varDendrogram"?this.varIndices:this.smpIndices;var B,a,A,ad,ab,G;var E=false;var T=this.dendrogramSpace/2;if(this.graphType!="Heatmap"){if(this.graphType=="BarLine"&&this.data.a&&this.data.y.desc[1]){var F=this.getVariablesVisibleByAxis("xAxis");G=F.length}else{if(this.graphType.match(/Stacked|Line|Area/)){G=1}else{G=this.varIndices.length}}ab=G*this.rowBlockSize}else{ab=0}if(this[J]&&this[F]){var D=this[F].data;var ac=this[F].idxs;var G=this[F].depth;var p=this.getMaxDepthDendrogramXYs(D);var h=this[F].heights;var f=this[F].max;var n={};var v={};var e=[];if(F=="varDendrogram"){for(var aa=0;aa<D.length;aa++){e[aa]=this.createNode(this.data.y.vars[ac[aa]],null,null,0,null)}}else{for(var aa=0;aa<D.length;aa++){e[aa]=this.createNode(this.data.y.smps[ac[aa]],null,null,0,null)}}while(D.length>1){aa=p;var m=[aa];var N=D[aa][0];var M=D[aa][1];var L=D[aa][2];var P=D[aa][3];var s=[N];var q=[M];var o=[L];var t=[P];var H={};var S="";var C=L;H[aa]=1;for(var Y=aa+1;Y<D.length;Y++){var X=D[Y][0];var W=D[Y][1];var V=D[Y][2];var Z=D[Y][3];if(W==M&&((V==0&&Z<=P)||(Z<P))){s.push(X);q.push(W);o.push(V);t.push(Z);C+=V;H[Y]=1;m.push(Y)}else{break}}if(s.length>1){if(F=="varDendrogram"){var k=this.colBlockSize/2;var O;if(this.varDendrogramPosition=="bottom"){if(this.varTitleLabelOverlayPosition!="bottom"){O=(this.offsetY+this.top+this.y+this.bottom)-(this.margin+(this.dendrogramSpace*(G+1)))}else{O=(this.offsetY+this.top+this.y+this.bottom)-(this.margin+(this.dendrogramSpace*(G+1))+this.getVariableTitleHeight())}}else{if(this.varTitleLabelOverlayPosition!="bottom"){O=(this.offsetY+this.top)-(this.getVarOverlaysHeight()+this.getVariableLabelLength()+this.getVarTreeHeight())}else{O=(this.offsetY+this.top)-(this.margin+this.getVarTreeHeight()+this.getVariableLabelDescLength())}}if(!E&&this.modelEvent=="global"){this.addGlobalArea(["rect",this.offsetX+this.left,O,this.offsetX+this.left+this.x,O+this.getVarTreeHeight()],true);E=true}for(var aa=0;aa<s.length;aa++){e[m[aa]].dist=h[m[aa]];B=(this.offsetX+this.left+k)+(this.colBlockSize*(s[aa]-1));B=this.varIndicesStart>-1?B-(this.colBlockSize*this.varIndicesStart):B;if(this.varDendrogramPosition=="bottom"){if(this.varTitleLabelOverlayPosition!="bottom"){ad=this.height-(this.margin+(this.dendrogramSpace*q[aa]))}else{ad=this.height-(this.margin+(this.dendrogramSpace*q[aa])+this.getVariableTitleHeight())}if(this.dendrogramHeight){}else{if(this.isLeafNode(e[m[aa]])&&!this.dendrogramHang){a=O}else{a=ad-this.dendrogramSpace}}}else{a=O+(this.dendrogramSpace*q[aa]);if(this.dendrogramHeight){}else{if(this.isLeafNode(e[m[aa]])&&!this.dendrogramHang){ad=O+(this.dendrogramSpace*(G+1))}else{ad=a+this.dendrogramSpace}}}this.drawLine("line",B,a,B,ad,this.foreground,false,"butt",false,false,true,[0,0,this.width,this.height]);if(!n.hasOwnProperty(P)){n[P]=0}if(!this.isLeafNode(e[m[aa]])){this.addArea(["rect",B-T,ad-T,B+T,ad+T],[-P],"-"+n[P]+"-varDendrogram");n[P]++}if(aa<s.length-1){A=(this.offsetX+this.left+k)+(this.colBlockSize*(s[aa+1]-1));A=this.varIndicesStart>-1?A-(this.colBlockSize*this.varIndicesStart):A;if(this.varDendrogramPosition=="bottom"){this.drawLine("line",B,ad,A,ad,this.foreground,false,"butt",false,false,true,[0,0,this.width,this.height])}else{this.drawLine("line",B,a,A,a,this.foreground,false,"butt",false,false,true,[0,0,this.width,this.height])}}}}else{if(this.graphOrientation=="vertical"){var O;if(this.smpDendrogramPosition=="bottom"){O=(this.offsetY+this.top+this.y+this.bottom)-(this.margin+this.getSampleTitleHeight()+(this.dendrogramSpace*(G+1)));if(this.showLegend&&this.legendPosition=="bottom"){O-=this.getLegendHeight()}}else{O=this.offsetY+this.top-this.getSmpTreeWidthHeight()}if(!E&&this.modelEvent=="global"){this.addGlobalArea(["rect",this.offsetX+this.left,O,this.offsetX+this.left+this.x,O+this.getSmpTreeWidthHeight()],true);E=true}for(var aa=0;aa<s.length;aa++){e[m[aa]].dist=h[m[aa]];B=(this.offsetX+this.left+this.blockSeparation+(ab/2))+((this.blockSeparation+ab)*(s[aa]-1));B=this.smpIndicesStart>-1?B-((this.blockSeparation+ab)*this.smpIndicesStart):B;if(this.smpDendrogramPosition=="bottom"){ad=this.height-(this.margin+(this.dendrogramSpace*q[aa]));if(this.showLegend&&this.legendPosition=="bottom"){ad-=this.getLegendHeight()}if(this.dendrogramHeight){}else{if(this.isLeafNode(e[m[aa]])&&!this.dendrogramHang){a=O}else{a=ad-this.dendrogramSpace}}}else{a=O+(this.dendrogramSpace*q[aa]);if(this.dendrogramHeight){}else{if(this.isLeafNode(e[m[aa]])&&!this.dendrogramHang){ad=O+(this.dendrogramSpace*(G+1))}else{ad=a+this.dendrogramSpace}}}this.drawLine("line",B,a,B,ad,this.foreground,false,"butt",false,false,true,[0,0,this.width,this.height]);if(!n.hasOwnProperty(P)){n[P]=0}if(!this.isLeafNode(e[m[aa]])){this.addArea(["rect",B-T,ad-T,B+T,ad+T],[-P],"-"+n[P]+"-smpDendrogram");n[P]++}if(aa<s.length-1){A=(this.offsetX+this.left+this.blockSeparation+(ab/2))+((this.blockSeparation+ab)*(s[aa+1]-1));A=this.smpIndicesStart>-1?A-((this.blockSeparation+ab)*this.smpIndicesStart):A;if(this.smpDendrogramPosition=="bottom"){this.drawLine("line",B,ad,A,ad,this.foreground,false,"butt",false,false,true,[0,0,this.width,this.height])}else{this.drawLine("line",B,a,A,a,this.foreground,false,"butt",false,false,true,[0,0,this.width,this.height])}}}}else{if(this.smpDendrogramPosition=="right"){O=this.offsetX+this.left+this.x+this.getSampleLabelDescLength()+this.margin}else{O=this.offsetX+this.margin+this.getSampleTitleHeight()}if(!E&&this.modelEvent=="global"){this.addGlobalArea(["rect",O,this.offsetY+this.top,O+this.getSmpTreeWidthHeight(),this.offsetY+this.top+this.y],true);E=true}for(var aa=0;aa<s.length;aa++){e[m[aa]].dist=h[m[aa]];if(this.smpDendrogramPosition=="right"){A=(this.offsetX+this.left+this.x+this.getSampleLabelDescLength()+this.margin)+((this.dendrogramSpace*(G+1))-(this.dendrogramSpace*q[aa]))}else{B=this.offsetX+this.margin+this.getSampleTitleHeight()+(this.dendrogramSpace*q[aa])}if(this.graphType=="Heatmap"){a=(this.offsetY+this.top+this.blockSeparation)+(this.rowBlockSize*(s[aa]-1));a=this.smpIndicesStart>-1?a-(this.rowBlockSize*this.smpIndicesStart):a;if(!this.autoExtend){a-=this.blockSeparation/2}}else{a=(this.offsetY+this.top+this.blockSeparation+(ab/2))+((this.blockSeparation+ab)*(s[aa]-1));a=this.smpIndicesStart>-1?a-((this.blockSeparation+ab)*this.smpIndicesStart):a}if(this.smpDendrogramPosition=="right"){if(this.dendrogramHeight){}else{if(this.isLeafNode(e[m[aa]])&&!this.dendrogramHang){B=this.offsetX+this.left+this.x+this.getSampleLabelDescLength()+this.margin}else{B=A-this.dendrogramSpace}}}else{if(this.dendrogramHeight){}else{if(this.isLeafNode(e[m[aa]])&&!this.dendrogramHang){A=this.offsetX+this.margin+this.getSampleTitleHeight()+(this.dendrogramSpace*(G+1))}else{A=B+this.dendrogramSpace}}}this.drawLine("line",B,a,A,a,this.foreground,false,"butt",false,false,true,[0,0,this.width,this.height]);if(!n.hasOwnProperty(P)){n[P]=0}if(!this.isLeafNode(e[m[aa]])){this.addArea(["rect",A-T,a-T,A+T,a+T],[-P],"-"+n[P]+"-smpDendrogram");n[P]++}if(aa<s.length-1){if(this.graphType=="Heatmap"){ad=(this.offsetY+this.top+this.blockSeparation)+(this.rowBlockSize*(s[aa+1]-1));ad=this.smpIndicesStart>-1?ad-(this.rowBlockSize*this.smpIndicesStart):ad;if(!this.autoExtend){ad-=this.blockSeparation/2}}else{ad=(this.offsetY+this.top+this.blockSeparation+(ab/2))+((this.blockSeparation+ab)*(s[aa+1]-1));ad=this.smpIndicesStart>-1?ad-((this.blockSeparation+ab)*this.smpIndicesStart):ad}if(this.smpDendrogramPosition=="right"){this.drawLine("line",A,a,A,ad,this.foreground,false,"butt",false,false,true,[0,0,this.width,this.height])}else{this.drawLine("line",B,a,B,ad,this.foreground,false,"butt",false,false,true,[0,0,this.width,this.height])}}}}}var U,R;var b=[];var I=[];var Q=[];var K=[];var u=this.mean(s);var d=false;if(!v.hasOwnProperty(P)){v[P]=0}S=(P-1)+"-"+v[P];for(var R in H){K.push(e[R])}for(var Y=0;Y<D.length;Y++){if(!H.hasOwnProperty(Y)){b.push(D[Y]);I.push(e[Y])}else{if(!d){b.push([u,M-1,C,t[t.length-1]]);U=K.shift();R=K.pop();if(K.length>0){I.push(this.createNode(S,U,R,0,null,K))}else{I.push(this.createNode(S,U,R,0,null))}v[P]++;d=true}}}for(var Y=0;Y<h.length;Y++){if(!H.hasOwnProperty(Y)){Q.push(h[Y])}}D=b;e=I;h=Q;p=this.getMaxDepthDendrogramXYs(D)}}this[F].object=e[0]}};this.draw1DYLayout=function(){var A,e,z,d,y,b,n,v;if(this.smpTitle){var q=(parseInt(this.smpTitleFontSize*this.scaleSmpTitleFontFactor))+"Pt "+this.fontName;if(this.graphOrientation=="vertical"){A=this.offsetX+this.left+(this.x/2);e=this.offsetY+this.height-(this.margin+(parseInt(this.smpTitleFontSize*this.scaleSmpTitleFontFactor)/2));this.drawText(this.smpTitle,A,e,q,this.smpTitleFontColor,"center","middle")}else{A=this.offsetX+this.margin+(parseInt(this.smpTitleFontSize*this.scaleSmpTitleFontFactor)/2);e=this.offsetY+this.top+(this.y/2);this.drawText(this.smpTitle,A,e,q,this.smpTitleColor,"center","middle",-Math.PI/2)}}if(this.showSampleNames){var h=this.isGroupedData?this.grpIndices:this.smpIndices;var p=this.isGroupedData?this.data.w.smps:this.data.y.smps;if(this.graphType=="Heatmap"){var u=Math.abs(this.smpLabelRotate)==90?"center":"right";if(this.isGraphTime){var k=this.y/h.length;var t=k/2;var o=this.offsetY+this.top+t;A=(this.offsetX+this.left)-(this.margin*2);z=this.offsetX+this.left+this.x+this.margin;for(var w=0;w<this.timeValueIndices.length;w++){e=(this.timeValueIndices[w]*k)+o;if(this.smpLabelRotate){this.drawText(this.timeValues[w],A-this.margin,e,this.smpLabelFont,f,u,"middle",this.smpLabelRotate*Math.PI/180)}else{this.drawText(this.timeValues[w],A,e,this.smpLabelFont,f,"right","middle")}if(this.smpLabelDescription){var m=this.shortenText(this.data.x[this.smpLabelDescription][h[w]],this.maxSmpStringLen);this.drawText(m,z,e,this.smpLabelFont,f,"right","middle")}}}else{A=this.offsetX+this.left;z=this.offsetX+this.left+this.x+this.margin;e=this.offsetY+this.top+this.blockSeparation;if(!this.autoExtend){e-=this.blockSeparation/2}v=1;var g=this.getSmpOverlaysLength();for(var w=0;w<h.length;w++){var m=this.shortenText(p[h[w]],this.maxSmpStringLen);var x=(this.margin*2)+g;var f=this.getSmpColor(p[h[w]]);if(this.smpLabelRotate){this.drawText(m,A-(x+this.margin),e,this.smpLabelFont,f,u,"middle",this.smpLabelRotate*Math.PI/180)}else{this.drawText(m,A-x,e,this.smpLabelFont,f,"right","middle")}if(this.smpLabelDescription){var m=this.shortenText(this.data.x[this.smpLabelDescription][h[w]],this.maxSmpStringLen);this.drawText(m,z,e,this.smpLabelFont,f,"left","middle")}e+=this.rowBlockSize}}var t=this.colBlockSize/2;A=this.offsetX+this.left+t;if(this.varTitleLabelOverlayPosition!="bottom"){var u=Math.abs(this.varLabelRotate)==90?"center":"left";e=this.offsetY+this.top;e-=(this.margin+this.getVarOverlaysHeight());d=this.offsetY+this.top+this.y+this.margin;for(var w=0;w<this.varIndices.length;w++){var r=this.shortenText(this.data.y.vars[this.varIndices[w]],this.maxVarStringLen);var f=this.getVarColor(this.data.y.vars[this.varIndices[w]]);if(this.varLabelRotate){this.drawText(r,A,e,this.varLabelFont,f,u,"middle",-Math.PI/2+(this.varLabelRotate*Math.PI/180))}else{this.drawText(r,A,e,this.varLabelFont,f,"left","middle",-Math.PI/2)}if(this.varLabelDescription){var r=this.shortenText(this.data.z[this.varLabelDescription][this.varIndices[w]],this.maxVarStringLen);this.drawText(r,A,d,this.varLabelFont,f,"right","middle",-Math.PI/2)}A+=this.colBlockSize}}else{var u=Math.abs(this.varLabelRotate)==90?"center":"right";e=this.offsetY+this.top+this.y+this.margin;if(this.varOverlays.length>0){e+=(this.varOverlays.length*this.overlaysWidth)+this.margin}d=(this.offsetY+this.top)-this.margin;for(var w=0;w<this.varIndices.length;w++){var r=this.shortenText(this.data.y.vars[this.varIndices[w]],this.maxVarStringLen);var f=this.getVarColor(this.data.y.vars[this.varIndices[w]]);if(this.varLabelRotate){this.drawText(r,A,e+this.margin,this.varLabelFont,f,u,"middle",-Math.PI/2+(this.varLabelRotate*Math.PI/180))}else{this.drawText(r,A,e,this.varLabelFont,f,"right","middle",-Math.PI/2)}if(this.varLabelDescription){var r=this.shortenText(this.data.z[this.varLabelDescription][this.varIndices[w]],this.maxVarStringLen);this.drawText(r,A,d,this.varLabelFont,f,"left","middle",-Math.PI/2)}A+=this.colBlockSize}}if(this.varTitle){var q=(parseInt(this.varTitleFontSize*this.scaleVarTitleFontFactor))+"Pt "+this.fontName;A=this.offsetX+this.left+(this.x/2);if(this.varTitleLabelOverlayPosition!="bottom"){e=this.offsetY+(this.margin*2)+this.top;e-=this.getVariableTitleHeight();e-=this.getVariableLabelLength();e-=this.getVarOverlaysHeight();if(this.varDendrogramPosition=="top"){e-=this.getVarTreeHeight()}}else{e=(this.offsetY+this.top+this.y+this.bottom)-this.margin}this.drawText(this.varTitle,A,e,q,this.varTitleColor,"center","bottom")}}else{if(this.graphType=="BarLine"&&this.data.a&&this.data.y.desc[1]){var a=this.getVariablesVisibleByAxis("xAxis");v=a.length}else{if(this.graphType.match(/Stacked|Line|Area/)){v=1}else{v=this.varIndices.length}}n=v*this.rowBlockSize;if(this.graphOrientation=="vertical"){var u=Math.abs(this.smpLabelRotate)==90?"center":"right";if(this.isGraphTime){var k=(this.x-this.blockSeparation)/h.length;var t=k/2;var o=this.offsetX+this.left+(this.blockSeparation*0.5)+t;e=this.offsetY+this.top+this.y+this.getSmpOverlaysLength()+this.margin+this.margin;for(var w=0;w<this.timeValueIndices.length;w++){A=(this.timeValueIndices[w]*k)+o;if(this.smpHairline){if(this.smpLabelRotate){this.drawText(this.timeValues[w],A,e+this.margin,this.smpLabelFont,f,u,"middle",-Math.PI/2+(this.smpLabelRotate*Math.PI/180))}else{this.drawText(this.timeValues[w],A,e,this.smpLabelFont,f,"right","middle",-Math.PI/2)}}}}else{A=this.offsetX+this.left+this.blockSeparation+(n/2);e=this.offsetY+this.top;d=this.offsetY+this.top+this.y;b=d+this.getSmpOverlaysLength()+this.margin+this.margin;for(var w=0;w<h.length;w++){var m=this.shortenText(p[h[w]],this.maxSmpStringLen);var f=this.getSmpColor(p[h[w]]);if(this.smpLabelRotate){this.drawText(m,A,b+this.margin,this.smpLabelFont,f,u,"middle",-Math.PI/2+(this.smpLabelRotate*Math.PI/180))}else{this.drawText(m,A,b,this.smpLabelFont,f,"right","middle",-Math.PI/2)}A+=this.blockSeparation+n}}}else{if(this.isGraphTime){var k=(this.y-this.blockSeparation)/h.length;var t=k/2;var o=this.offsetY+this.top+(this.blockSeparation*0.5)+t;A=(this.offsetX+this.left)-(this.margin*2);for(var w=0;w<this.timeValueIndices.length;w++){e=(this.timeValueIndices[w]*k)+o;if(this.smpLabelRotate){this.drawText(this.timeValues[w],A-this.margin,e,this.smpLabelFont,f,u,"middle",this.smpLabelRotate*Math.PI/180)}else{this.drawText(this.timeValues[w],A,e,this.smpLabelFont,f,"right","middle")}}}else{A=this.offsetX+this.left;z=this.offsetX+this.left+this.x;y=A-(this.getSmpOverlaysLength()+(this.margin*2));e=this.offsetY+this.top+this.blockSeparation+(n/2);for(var w=0;w<h.length;w++){var m=this.shortenText(p[h[w]],this.maxSmpStringLen);var f=this.getSmpColor(p[h[w]]);if(this.smpLabelRotate){this.drawText(m,y-this.margin,e,this.smpLabelFont,f,u,"middle",this.smpLabelRotate*Math.PI/180)}else{this.drawText(m,y,e,this.smpLabelFont,f,"right","middle")}e+=this.blockSeparation+n}}}}}if(this.showOverlays){if(this.smpOverlays.length>0&&!this.isGroupedData){n=v*this.rowBlockSize;if(this.graphOrientation=="vertical"){A=this.offsetX+this.left;z=n;d=this.overlaysWidth;if(this.graphType!="Heatmap"){A+=this.blockSeparation/2;z+=this.blockSeparation}for(var w=0;w<this.smpIndices.length;w++){e=this.offsetY+this.top+this.y+this.margin;for(var s=0;s<this.smpOverlays.length;s++){this.rectangle(A,e,z,d,this.smpOverlayColors[s][w]);if(n>this.overlaysWidth){this.drawText(this.data.x[this.smpOverlays[s]][this.smpIndices[w]],A+(z/2),e+(d/2),this.overlayFont,this.overlayFontColor,"center","middle",false,n-2)}else{this.drawText(this.data.x[this.smpOverlays[s]][this.smpIndices[w]],A+(z/2),e+(d/2),this.overlayFont,this.overlayFontColor,"center","middle",-Math.PI/2,this.overlaysWidth-2)}e+=d}A+=z}A=this.offsetX+this.left+this.x;e=this.offsetY+this.top+this.y+this.margin+(d/2);for(var w=0;w<this.smpOverlays.length;w++){this.drawText(this.smpOverlays[w],A,e,this.overlayFont,this.overlayFontColor,"left","middle",false,n*2);e+=d}}else{z=this.overlaysWidth;e=this.offsetY+this.top;d=n;if(this.graphType!="Heatmap"){e+=this.blockSeparation/2;d+=this.blockSeparation}for(var w=0;w<this.smpIndices.length;w++){A=this.offsetX+this.left-(this.margin+(this.smpOverlays.length*this.overlaysWidth)+this.margin);for(var s=0;s<this.smpOverlays.length;s++){this.rectangle(A,e,z,d,this.smpOverlayColors[s][w]);if(n>this.overlaysWidth){this.drawText(this.data.x[this.smpOverlays[s]][this.smpIndices[w]],A+(z/2),e+(d/2),this.overlayFont,this.overlayFontColor,"center","middle",-Math.PI/2,n-2)}else{this.drawText(this.data.x[this.smpOverlays[s]][this.smpIndices[w]],A+(z/2),e+(d/2),this.overlayFont,this.overlayFontColor,"center","middle",false,this.overlaysWidth-2)}A+=z}e+=d}A=(this.offsetX+this.left+(z/2))-(this.margin+(this.smpOverlays.length*this.overlaysWidth)+this.margin);e=this.offsetY+this.top+this.y;if(this.graphType=="Heatmap"){e+=this.margin}for(var w=0;w<this.smpOverlays.length;w++){this.drawText(this.smpOverlays[w],A,e,this.overlayFont,this.overlayFontColor,"right","middle",-Math.PI/2,n*2);A+=z}}}if(this.varOverlays.length>0&&this.graphType=="Heatmap"){A=this.offsetX+this.left+(this.colBlockSize/2);d=this.overlaysWidth;for(var w=0;w<this.varIndices.length;w++){if(this.varTitleLabelOverlayPosition!="bottom"){e=(this.offsetY+this.top)-(this.margin+this.overlaysWidth)}else{e=this.offsetY+this.top+this.y+this.margin}for(var s=0;s<this.varOverlays.length;s++){this.rectangle(A-(this.colBlockSize/2),e,this.colBlockSize,d,this.varOverlayColors[s][w]);if(this.colBlockSize>this.overlaysWidth){this.drawText(this.data.z[this.varOverlays[s]][this.varIndices[w]],A,e+(d/2),this.overlayFont,this.overlayFontColor,"center","middle",false,this.colBlockSize-2)}else{this.drawText(this.data.z[this.varOverlays[s]][this.varIndices[w]],A,e+(d/2),this.overlayFont,this.overlayFontColor,"center","middle",-Math.PI/2,this.overlaysWidth-2)}e+=this.overlaysWidth}A+=this.colBlockSize}A=this.offsetX+this.left+this.x+this.margin;if(this.varTitleLabelOverlayPosition!="bottom"){e=(this.offsetY+this.top+(d/2))-(this.margin+this.overlaysWidth)}else{e=this.offsetY+this.top+this.y+this.margin+(d/2)}for(var w=0;w<this.varOverlays.length;w++){this.drawText(this.varOverlays[w],A,e,this.overlayFont,this.overlayFontColor,"left","middle",false,this.colBlockSize*2);e+=d}}}};this.draw1DXLayout=function(){if(!this.layoutValid){this.layoutAxis=3}if(this.graphType=="Heatmap"){var b=(this.offsetX+this.left+(this.x/2))-(this.heatmapColors.length*this.indicatorWidth/2);var k=this.offsetY+this.top-this.getHeatmapIndicatorHeight();if(this.varDendrogramPosition=="top"){k-=this.getVarTreeHeight()}if(this.varTitleLabelOverlayPosition!="bottom"){k-=this.getVariableTitleHeight();k-=this.getVariableLabelLength();k-=this.getVarOverlaysHeight()}else{k-=this.getVariableLabelDescLength()}this.drawColorIndicator(b,k,this.minData,this.maxData,this.xAxisDecs)}else{var f;var j;if(this.graphOrientation=="vertical"){if(this.layoutAxis==1||this.layoutAxis==3){var b=this.offsetX+this.margin+(this.getFontPt(this.axisTitleFont)/2);var k=this.offsetY+this.top+(this.y/2);f=this.graphType=="Candlestick"&&this.summaryType=="volume"?this.xAxis2Title:this.xAxisTitle?this.xAxisTitle:this.data.y.desc&&this.data.y.desc[0]?this.data.y.desc[0]:this.yAxisTitle?this.yAxisTitle:"";if(this.graphType=="BarLine"&&this.data.a&&this.data.y.desc&&this.data.y.desc[1]){this.drawText(f+" (Bars)",b,k,this.axisTitleFont,this.axisTitleColor,"center","middle",-Math.PI/2)}else{this.drawText(f,b,k,this.axisTitleFont,this.axisTitleColor,"center","middle",-Math.PI/2)}var g=Math.abs(this.tickRotate)==90?"center":"right";j=this.graphType=="Candlestick"&&this.summaryType=="volume"?this.xAxis2Values:this.xAxisValues;b=this.offsetX+this.left-(this.margin*2);for(var e=0;e<j.length-1;e++){var d=parseFloat(j[e]);var h=this.graphType=="Candlestick"&&this.summaryType=="volume"?sprintf("%."+this.xAxis2Decs+"f",d):sprintf("%."+this.xAxisDecs+"f",d);k=this.graphType=="Candlestick"&&this.summaryType=="volume"?this.offsetY+this.top+this.y-((d-this.xAxis2Min)*this.xAxis2Unit):this.offsetY+this.top+this.y-((d-this.xAxisMin)*this.xAxisUnit);if(this.tickRotate){this.drawText(h,b,k,this.axisTickFont,this.axisTickColor,g,"middle",this.tickRotate*Math.PI/180)}else{this.drawText(h,b,k,this.axisTickFont,this.axisTickColor,"right","middle")}}}if(this.layoutAxis==2||this.layoutAxis==3){var g=Math.abs(this.tickRotate)==90?"center":"left";b=this.offsetX+this.left+this.x+(this.margin*2);if(this.graphType.match(/BarLine|StackedLine|StackedPercentLine/)&&this.data.a&&this.data.y.desc&&this.data.y.desc[1]){for(var e=0;e<this.xAxis2Values.length-1;e++){var d=parseFloat(this.xAxis2Values[e]);var h=sprintf("%."+this.xAxis2Decs+"f",d);k=this.offsetY+this.top+this.y-((d-this.xAxis2Min)*this.xAxis2Unit);if(this.tickRotate){this.drawText(h,b,k,this.axisTickFont,this.axisTickColor,g,"middle",this.tickRotate*Math.PI/180)}else{this.drawText(h,b,k,this.axisTickFont,this.axisTickColor,"left","middle")}}if(this.graphType.match(/Stacked/)){f=this.data.y.desc&&this.data.y.desc[1]?this.data.y.desc[1]:""}else{f=this.data.y.desc&&this.data.y.desc[1]?this.data.y.desc[1]+" (Lines)":""}}else{j=this.graphType=="Candlestick"&&this.summaryType=="volume"?this.xAxis2Values:this.xAxisValues;for(var e=0;e<j.length-1;e++){var d=parseFloat(j[e]);var h=this.graphType=="Candlestick"&&this.summaryType=="volume"?sprintf("%."+this.xAxis2Decs+"f",d):sprintf("%."+this.xAxisDecs+"f",d);k=this.graphType=="Candlestick"&&this.summaryType=="volume"?this.offsetY+this.top+this.y-((d-this.xAxis2Min)*this.xAxis2Unit):this.offsetY+this.top+this.y-((d-this.xAxisMin)*this.xAxisUnit);if(this.tickRotate){this.drawText(h,b,k,this.axisTickFont,this.axisTickColor,g,"middle",this.tickRotate*Math.PI/180)}else{this.drawText(h,b,k,this.axisTickFont,this.axisTickColor,"left","middle")}}f=this.graphType=="Candlestick"&&this.summaryType=="volume"?this.xAxis2Title:this.xAxisTitle?this.xAxisTitle:this.data.y.desc&&this.data.y.desc[0]?this.data.y.desc[0]:this.yAxisTitle?this.yAxisTitle:""}b=(this.offsetX+this.left+this.x+this.right)-(this.margin+(this.getFontPt(this.axisTitleFont)/2));if(this.showLegend&&this.legendPosition=="right"){b-=this.getLegendWidth()}k=this.offsetY+this.top+(this.y/2);this.drawText(f,b,k,this.axisTitleFont,this.axisTitleColor,"center","middle",-Math.PI/2)}}else{if(this.layoutAxis==1||this.layoutAxis==3){var b=this.offsetX+this.left+(this.x/2);var k=this.offsetY+this.top-((this.margin*4)+this.getFontPt(this.axisTickFont)+(this.getFontPt(this.axisTitleFont)/2));f=this.graphType=="Candlestick"&&this.summaryType=="volume"?this.xAxis2Title:this.xAxisTitle?this.xAxisTitle:this.data.y.desc&&this.data.y.desc[0]?this.data.y.desc[0]:this.yAxisTitle?this.yAxisTitle:"";if(this.graphType=="BarLine"&&this.data.a&&this.data.y.desc&&this.data.y.desc[1]){this.drawText(f+" (Bars)",b,k,this.axisTitleFont,this.axisTitleColor,"center","middle")}else{this.drawText(f,b,k,this.axisTitleFont,this.axisTitleColor,"center","middle")}j=this.graphType=="Candlestick"&&this.summaryType=="volume"?this.xAxis2Values:this.xAxisValues;k=this.offsetY+this.top-((this.margin*2)+(this.getFontPt(this.axisTickFont)/2));for(var e=0;e<j.length-1;e++){var d=parseFloat(j[e]);var h=this.graphType=="Candlestick"&&this.summaryType=="volume"?sprintf("%."+this.xAxis2Decs+"f",d):sprintf("%."+this.xAxisDecs+"f",d);b=this.graphType=="Candlestick"&&this.summaryType=="volume"?this.offsetX+this.left+((d-this.xAxis2Min)*this.xAxis2Unit):this.offsetX+this.left+((d-this.xAxisMin)*this.xAxisUnit);if(this.tickRotate){this.drawText(h,b,k,this.axisTickFont,this.axisTickColor,"center","middle",this.tickRotate*Math.PI/180)}else{this.drawText(h,b,k,this.axisTickFont,this.axisTickColor,"center","middle")}}}if(this.layoutAxis==2||this.layoutAxis==3){k=this.offsetY+this.top+this.y+(this.margin*2)+(this.getFontPt(this.axisTickFont)/2);if(this.graphType.match(/BarLine|StackedLine|StackedPercentLine/)&&this.data.a&&this.data.y.desc&&this.data.y.desc[1]){for(var e=0;e<this.xAxis2Values.length-1;e++){var d=parseFloat(this.xAxis2Values[e]);var h=sprintf("%."+this.xAxis2Decs+"f",d);b=this.offsetX+this.left+((d-this.xAxis2Min)*this.xAxis2Unit);this.drawText(h,b,k,this.axisTickFont,this.axisTickColor,"center","middle")}if(this.graphType.match(/Stacked/)){f=this.data.y.desc&&this.data.y.desc[1]?this.data.y.desc[1]:""}else{f=this.data.y.desc&&this.data.y.desc[1]?this.data.y.desc[1]+" (Lines)":""}}else{j=this.graphType=="Candlestick"&&this.summaryType=="volume"?this.xAxis2Values:this.xAxisValues;for(var e=0;e<j.length-1;e++){var d=parseFloat(j[e]);var h=this.graphType=="Candlestick"&&this.summaryType=="volume"?sprintf("%."+this.xAxis2Decs+"f",d):sprintf("%."+this.xAxisDecs+"f",d);b=this.graphType=="Candlestick"&&this.summaryType=="volume"?this.offsetX+this.left+((d-this.xAxis2Min)*this.xAxis2Unit):this.offsetX+this.left+((d-this.xAxisMin)*this.xAxisUnit);if(this.tickRotate){this.drawText(h,b,k,this.axisTickFont,this.axisTickColor,"center","middle",this.tickRotate*Math.PI/180)}else{this.drawText(h,b,k,this.axisTickFont,this.axisTickColor,"center","middle")}}f=this.graphType=="Candlestick"&&this.summaryType=="volume"?this.xAxis2Title:this.xAxisTitle?this.xAxisTitle:this.data.y.desc&&this.data.y.desc[0]?this.data.y.desc[0]:this.yAxisTitle?this.yAxisTitle:""}b=this.offsetX+this.left+(this.x/2);k=this.offsetY+this.top+this.y+(this.margin*4)+this.getFontPt(this.axisTickFont)+(this.getFontPt(this.axisTitleFont)/2);this.drawText(f,b,k,this.axisTitleFont,this.axisTitleColor,"center","middle")}}var a=this.backgroundType.match(/window/i)?this.foregroundWindow:this.foreground;this.rectangle(this.offsetX+this.left,this.offsetY+this.top,this.x,this.y,false,a,"open",false,this.outlineWidth)}};this.draw1DDataPoints=function(){var Q=this.isGroupedData?this.grpIndices.length:this.smpIndices.length;var e=this.backgroundType.match(/window/i)?this.foregroundWindow:this.foreground;switch(this.graphType){case"Bar":this.draw1DBarDataPoints(this.varIndices,"xAxis");return true;case"Line":this.draw1DLineDataPoints(this.varIndices,"xAxis",this.rowBlockSize);return true;case"BarLine":var p=this.xAxisVarIndices.length==this.xAxis2VarIndices.length?0:this.xAxisVarIndices.length*this.rowBlockSize;this.draw1DBarDataPoints(this.xAxisVarIndices,"xAxis");this.draw1DLineDataPoints(this.xAxis2VarIndices,"xAxis2",p);return true;case"Stacked":case"StackedLine":case"StackedPercent":case"StackedPercentLine":var d=this.isGroupedData?this.grpIndices:this.smpIndices;var E=this.graphType.match(/Line/)?this.xAxisVarIndices:this.varIndices;var g=this.graphType=="StackedPercentLine"?this.xAxisVarIndices:false;if(this.graphOrientation=="vertical"){var B=this.offsetX+this.left+this.blockSeparation;var A=this.rowBlockSize;for(var U=0;U<Q;U++){var L=d[U];var X=this.getDataForSmpGrpAtIndex(L,g);var C=this.sum(X);var a=this.offsetY+this.top+this.y;for(var T=0;T<E.length;T++){var m=T%this.colors.length;var v=E[T];var I=this.getDataAtPos(v,L);var af=this.graphType=="StackedPercent"||this.graphType=="StackedPercentLine"?((I*100)/C)*this.xAxisUnit:I*this.xAxisUnit;this.addArea(this.rectangle(B,a,A,-af,this.colors[m]),[v,L]);a-=af}B+=A+this.blockSeparation}}else{var a=this.offsetY+this.top+this.blockSeparation;var af=this.rowBlockSize;for(var U=0;U<Q;U++){var L=d[U];var X=this.getDataForSmpGrpAtIndex(L,g);var C=this.sum(X);var B=this.offsetX+this.left;for(var T=0;T<E.length;T++){var m=T%this.colors.length;var v=E[T];var I=this.getDataAtPos(v,L);var A=this.graphType=="StackedPercent"||this.graphType=="StackedPercentLine"?((I*100)/C)*this.xAxisUnit:I*this.xAxisUnit;this.addArea(this.rectangle(B,a,A,af,this.colors[m]),[v,L]);B+=A}a+=af+this.blockSeparation}}if(this.graphType.match(/Line/)){this.draw1DLineDataPoints(this.xAxis2VarIndices,"xAxis2",this.rowBlockSize)}return true;case"Area":var d=this.isGroupedData?this.grpIndices:this.smpIndices;var G=[];var K=[];if(this.graphOrientation=="vertical"){for(var U=0;U<Q;U++){G[U]=this.offsetY+this.top+this.y;K[U]=this.offsetY+this.top+this.y}for(var U=0;U<this.varIndices.length;U++){var B=this.offsetX+this.left+this.blockSeparation+(this.rowBlockSize/2);var M=[this.offsetX+this.left];var y=[this.offsetY+this.top+this.y];var L=this.varIndices[U];var m=this.colors[U%this.colors.length];for(var T=0;T<Q;T++){var v=d[T];var I=this.getDataAtPos(L,v)-this.xAxisMin;var a=!isNaN(I)?I*this.xAxisUnit:0;M.push(B);y.push(G[T]-a);G[T]-=a;B+=this.rowBlockSize+this.blockSeparation}B-=this.rowBlockSize+this.blockSeparation;M.push(this.offsetX+this.left+this.x);y.push(this.offsetY+this.top+this.y);for(var T=Q-1;T>=0;T--){M.push(B);y.push(K[T]);K[T]=G[T];B-=this.rowBlockSize+this.blockSeparation}this.addArea(this.drawShape("polygon",M,y,false,false,m,m,"closed"),[L])}}else{for(var U=0;U<Q;U++){G[U]=this.offsetX+this.left;K[U]=this.offsetX+this.left}for(var U=0;U<this.varIndices.length;U++){var a=this.offsetY+this.top+this.blockSeparation+(this.rowBlockSize/2);var M=[this.offsetX+this.left];var y=[this.offsetY+this.top];var L=this.varIndices[U];var m=this.colors[U%this.colors.length];for(var T=0;T<Q;T++){var v=d[T];var I=this.getDataAtPos(L,v)-this.xAxisMin;var B=!isNaN(I)?I*this.xAxisUnit:0;M.push(G[T]+B);y.push(a);G[T]+=B;a+=this.rowBlockSize+this.blockSeparation}a-=this.rowBlockSize+this.blockSeparation;M.push(this.offsetX+this.left);y.push(this.offsetY+this.top+this.y);for(var T=Q-1;T>=0;T--){M.push(K[T]);y.push(a);K[T]=G[T];a-=this.rowBlockSize+this.blockSeparation}this.addArea(this.drawShape("polygon",M,y,false,false,m,m,"closed"),[L])}}return true;case"Boxplot":var d=this.isGroupedData?this.grpIndices:this.smpIndices;if(this.graphOrientation=="vertical"){var B=this.offsetX+this.left+this.blockSeparation;var A=this.rowBlockSize;for(var U=0;U<Q;U++){var L=d[U];for(var T=0;T<this.varIndices.length;T++){var m=T%this.colors.length;var v=this.varIndices[T];var w=this.getDataAtPos(v,L,"iqr1")-this.xAxisMin;var t=this.getDataAtPos(v,L,"iqr3")-this.xAxisMin;var n=this.getDataAtPos(v,L,"qtl1")-this.xAxisMin;var h=this.getDataAtPos(v,L,"qtl3")-this.xAxisMin;var D=this.getDataAtPos(v,L,"median")-this.xAxisMin;var N=this.getDataAtPos(v,L,"out");var a=(this.offsetY+this.top+this.y)-(n*this.xAxisUnit);var af=(this.offsetY+this.top+this.y)-(h*this.xAxisUnit);var ae=(this.offsetY+this.top+this.y)-(D*this.xAxisUnit);var ac=(this.offsetY+this.top+this.y)-(w*this.xAxisUnit);var aa=(this.offsetY+this.top+this.y)-(t*this.xAxisUnit);var Z=af-a;this.addArea(this.rectangle(B,a,A,Z,this.colors[m],e,"closed",false,false,true),[v,L]);this.drawLine("line",B,ae,B+(A-1),ae,e,false,"butt",false,false,true);this.errorBar(B+this.rowBlockSize/2,a,B+this.rowBlockSize/2,ac,-this.rowBlockSize/2,e);this.errorBar(B+this.rowBlockSize/2,af,B+this.rowBlockSize/2,aa,-this.rowBlockSize/2,e);if(N){for(var S=0;S<N.length;S++){a=(this.offsetY+this.top+this.y)-((N[S]-this.xAxisMin)*this.xAxisUnit);this.drawShape("sphere",B+this.rowBlockSize/2,a,this.rowBlockSize/2,this.rowBlockSize/2,this.colors[m],e,"closed",false,false,true)}}B+=A}B+=this.blockSeparation}}else{var a=this.offsetY+this.top+this.blockSeparation;var af=this.rowBlockSize;for(var U=0;U<Q;U++){var L=d[U];for(var T=0;T<this.varIndices.length;T++){var m=T%this.colors.length;var v=this.varIndices[T];var w=this.getDataAtPos(v,L,"iqr1")-this.xAxisMin;var t=this.getDataAtPos(v,L,"iqr3")-this.xAxisMin;var n=this.getDataAtPos(v,L,"qtl1")-this.xAxisMin;var h=this.getDataAtPos(v,L,"qtl3")-this.xAxisMin;var D=this.getDataAtPos(v,L,"median")-this.xAxisMin;var N=this.getDataAtPos(v,L,"out");var B=this.offsetX+this.left+(n*this.xAxisUnit);var A=this.offsetX+this.left+(h*this.xAxisUnit);var z=this.offsetX+this.left+(D*this.xAxisUnit);var x=this.offsetX+this.left+(w*this.xAxisUnit);var u=this.offsetX+this.left+(t*this.xAxisUnit);var s=A-B;this.addArea(this.rectangle(B,a,s,af,this.colors[m],e,"closed",false,false,true),[v,L]);this.drawLine("line",z,a,z,a+(af-1),e,false,"butt",false,false,true);this.errorBar(B,a+this.rowBlockSize/2,x,a+this.rowBlockSize/2,this.rowBlockSize/2,e);this.errorBar(A,a+this.rowBlockSize/2,u,a+this.rowBlockSize/2,this.rowBlockSize/2,e);if(N){for(var S=0;S<N.length;S++){B=this.offsetX+this.left+((N[S]-this.xAxisMin)*this.xAxisUnit);this.drawShape("sphere",B,a+this.rowBlockSize/2,this.rowBlockSize/2,this.rowBlockSize/2,this.colors[m],e,"closed",false,false,true)}}a+=af}a+=this.blockSeparation}}return true;case"Candlestick":var d=this.isGroupedData?this.grpIndices:this.smpIndices;var F={};var R=["5","10","25","50"];if(this.showSma5||this.showSma10||this.showSma25||this.showSma50){for(var U=0;U<R.length;U++){F[R[U]]={};F[R[U]].x=[];F[R[U]].y=[];F[R[U]].a=[];for(var T=0;T<this.varIndices.length;T++){F[R[U]].x[T]=[];F[R[U]].y[T]=[];F[R[U]].a[T]=[]}}}if(this.graphOrientation=="vertical"){var B=this.offsetX+this.left+this.blockSeparation;var A=this.rowBlockSize;for(var U=0;U<Q;U++){var L=d[U];for(var T=0;T<this.varIndices.length;T++){var m=T%this.colors.length;var v=this.varIndices[T];if(this.summaryType=="candle"){var H=this.getDataAtPos(v,L,"open")-this.xAxisMin;var O=this.getDataAtPos(v,L,"close")-this.xAxisMin;var P=this.getDataAtPos(v,L,"high")-this.xAxisMin;var b=this.getDataAtPos(v,L,"low")-this.xAxisMin;var a=(this.offsetY+this.top+this.y)-(H*this.xAxisUnit);var af=(this.offsetY+this.top+this.y)-(O*this.xAxisUnit);var ae=(this.offsetY+this.top+this.y)-(P*this.xAxisUnit);var ac=(this.offsetY+this.top+this.y)-(b*this.xAxisUnit);if(O>H){this.addArea(this.rectangle(B,a,A,af-a,false,this.colors[m],"open",false,false,true),[v,L]);this.drawLine("line",B+this.rowBlockSize/2,af,B+this.rowBlockSize/2,ae,this.colors[m],false,"butt",false,false,true);this.drawLine("line",B+this.rowBlockSize/2,ac,B+this.rowBlockSize/2,a,this.colors[m],false,"butt",false,false,true)}else{this.addArea(this.rectangle(B,a,A,af-a,this.colors[m],this.colors[m],"closed",false,false,true),[v,L]);this.drawLine("line",B+this.rowBlockSize/2,ac,B+this.rowBlockSize/2,af,this.colors[m],false,"butt",false,false,true);this.drawLine("line",B+this.rowBlockSize/2,a,B+this.rowBlockSize/2,ae,this.colors[m],false,"butt",false,false,true)}for(var S=0;S<R.length;S++){if(this["showSma"+R[S]]){F[R[S]].a[T].push(O+this.xAxisMin);if(F[R[S]].a[T].length==parseInt(R[S])){F[R[S]].x[T].push(B+(this.rowBlockSize/2));F[R[S]].y[T].push((this.offsetY+this.top+this.y)-((this.mean(F[R[S]].a[T])-this.xAxisMin)*this.xAxisUnit));if(F[R[S]].x[T].length==2){this.drawLine("line",F[R[S]].x[T][0],F[R[S]].y[T][0],F[R[S]].x[T][1],F[R[S]].y[T][1],this["sma"+R[S]+"Color"],false,"butt",false,false,true);F[R[S]].x[T].shift();F[R[S]].y[T].shift()}F[R[S]].a[T].shift()}}}}else{var ab=this.getDataAtPos(v,L,"volume")-this.xAxis2Min;var a=(this.offsetY+this.top+this.y)-(ab*this.xAxis2Unit);var af=(ab*this.xAxis2Unit);this.addArea(this.rectangle(B,a,A,af,this.colors[m],this.colors[m],"closed",false,false,true),[v,L])}B+=A}B+=this.blockSeparation}if(this.summaryType!="volume"){var B=this.offsetX+this.left+(this.margin*2);var a=this.offsetY+this.top+(this.margin*2);var q=this.getFontPt(this.legendFont);var ad=q/2;for(var S=0;S<R.length;S++){if(this["showSma"+R[S]]&&F[R[S]].x[0].length>0){this.drawLine("line",B+ad,a+ad,B+ad+q,a+ad,this["sma"+R[S]+"Color"],false,"butt",false,false,true);this.drawText("SMA"+R[S],B+q+this.margin,a+ad,this.legendFont,this["sma"+R[S]+"Color"],"left","middle");a+=this.margin+q}}}}else{var a=this.offsetY+this.top+this.blockSeparation;var af=this.rowBlockSize;for(var U=0;U<Q;U++){var L=d[U];for(var T=0;T<this.varIndices.length;T++){var m=T%this.colors.length;var v=this.varIndices[T];if(this.summaryType=="candle"){var H=this.getDataAtPos(v,L,"open")-this.xAxisMin;var O=this.getDataAtPos(v,L,"close")-this.xAxisMin;var P=this.getDataAtPos(v,L,"high")-this.xAxisMin;var b=this.getDataAtPos(v,L,"low")-this.xAxisMin;var B=this.offsetX+this.left+(H*this.xAxisUnit);var A=this.offsetX+this.left+(O*this.xAxisUnit);var z=this.offsetX+this.left+(P*this.xAxisUnit);var x=this.offsetX+this.left+(b*this.xAxisUnit);if(O>H){this.addArea(this.rectangle(B,a,A-B,af,false,this.colors[m],"open",false,false,true),[v,L]);this.drawLine("line",A,a+this.rowBlockSize/2,z,a+this.rowBlockSize/2,this.colors[m],false,"butt",false,false,true);this.drawLine("line",x,a+this.rowBlockSize/2,B,a+this.rowBlockSize/2,this.colors[m],false,"butt",false,false,true)}else{this.addArea(this.rectangle(B,a,A-B,af,this.colors[m],this.colors[m],"closed",false,false,true),[v,L]);this.drawLine("line",x,a+this.rowBlockSize/2,A,a+this.rowBlockSize/2,this.colors[m],false,"butt",false,false,true);this.drawLine("line",B,a+this.rowBlockSize/2,z,a+this.rowBlockSize/2,this.colors[m],false,"butt",false,false,true)}for(var S=0;S<R.length;S++){if(this["showSma"+R[S]]){F[R[S]].a[T].push(O+this.xAxisMin);if(F[R[S]].a[T].length==parseInt(R[S])){F[R[S]].x[T].push((this.offsetX+this.left)+((this.mean(F[R[S]].a[T])-this.xAxisMin)*this.xAxisUnit));F[R[S]].y[T].push(a+(this.rowBlockSize/2));if(F[R[S]].x[T].length==2){this.drawLine("line",F[R[S]].x[T][0],F[R[S]].y[T][0],F[R[S]].x[T][1],F[R[S]].y[T][1],this["sma"+R[S]+"Color"],false,"butt",false,false,true);F[R[S]].x[T].shift();F[R[S]].y[T].shift()}F[R[S]].a[T].shift()}}}}else{var ab=this.getDataAtPos(v,L,"volume")-this.xAxis2Min;var B=this.offsetX+this.left;var A=ab*this.xAxis2Unit;this.addArea(this.rectangle(B,a,A,af,this.colors[m],this.colors[m],"closed",false,false,true),[v,L])}a+=af}a+=this.blockSeparation}}return true;case"Dotplot":if(this.graphOrientation=="vertical"){var B=this.offsetX+this.left+this.blockSeparation+this.rowBlockSize/2;var A=this.rowBlockSize;var r=this.getShapeSize();if(this.isGroupedData){for(var U=0;U<Q;U++){var L=this.grpIndices[U];for(var T=0;T<this.varIndices.length;T++){var m=T%this.colors.length;var J=parseInt(T/this.colors.length);var v=this.varIndices[T];for(var S=0;S<this.data.w.grps[L].length;S++){var Y=this.data.w.grps[L][S];var I=this.data.y.data[v][Y]-this.xAxisMin;var a=(this.offsetY+this.top+this.y)-(I*this.xAxisUnit);if(!isNaN(I)){this.addArea(this.drawShape(this.shapes[J],B,a,r,r,this.colors[m],e,"closed",false,false,true),[v,L])}}B+=A}B+=this.blockSeparation}}else{for(var U=0;U<Q;U++){var L=this.smpIndices[U];for(var T=0;T<this.varIndices.length;T++){var m=T%this.colors.length;var J=parseInt(T/this.colors.length);var v=this.varIndices[T];var I=this.getDataAtPos(v,L)-this.xAxisMin;var a=(this.offsetY+this.top+this.y)-(I*this.xAxisUnit);if(this.data.y.hasOwnProperty("stdev")){var W=this.getDataAtPos(v,L,"stdev")-this.xAxisMin;if(!isNaN(W)){var af=(W/2)*this.xAxisUnit;this.errorBar(B,a,B,a+af,-this.blockSeparation,this.colors[m]);this.errorBar(B,a,B,a-af,-this.blockSeparation,this.colors[m])}}if(!isNaN(I)){this.addArea(this.drawShape(this.shapes[J],B,a,r,r,this.colors[m],e,"closed",false,false,true),[v,L])}B+=A}B+=this.blockSeparation}}}else{var a=this.offsetY+this.top+this.blockSeparation+this.rowBlockSize/2;var af=this.rowBlockSize;var r=this.getShapeSize();if(this.isGroupedData){for(var U=0;U<Q;U++){var L=this.grpIndices[U];for(var T=0;T<this.varIndices.length;T++){var m=T%this.colors.length;var J=parseInt(T/this.colors.length);var v=this.varIndices[T];for(var S=0;S<this.data.w.grps[L].length;S++){var Y=this.data.w.grps[L][S];var I=this.data.y.data[v][Y]-this.xAxisMin;var B=this.offsetX+this.left+I*this.xAxisUnit;if(!isNaN(I)){this.addArea(this.drawShape(this.shapes[J],B,a,r,r,this.colors[m],e,"closed",false,false,true),[v,L])}}a+=af}a+=this.blockSeparation}}else{for(var U=0;U<Q;U++){var L=this.smpIndices[U];for(var T=0;T<this.varIndices.length;T++){var m=T%this.colors.length;var J=parseInt(T/this.colors.length);var v=this.varIndices[T];var I=this.getDataAtPos(v,L)-this.xAxisMin;var B=this.offsetX+this.left+I*this.xAxisUnit;if(this.data.y.hasOwnProperty("stdev")){var W=this.getDataAtPos(v,L,"stdev")-this.xAxisMin;if(!isNaN(W)){var A=(W/2)*this.xAxisUnit;this.errorBar(B,a,B+A,a,this.blockSeparation,this.colors[m]);this.errorBar(B,a,B-A,a,this.blockSeparation,this.colors[m])}}if(!isNaN(I)){this.addArea(this.drawShape(this.shapes[J],B,a,r,r,this.colors[m],e,"closed",false,false,true),[v,L])}a+=af}a+=this.blockSeparation}}}return true;case"Heatmap":var a=this.offsetY+this.top;var A=this.colBlockSize;var af=this.rowBlockSize;var f="rgb(255,255, 0)";var d=this.isGroupedData?this.grpIndices:this.smpIndices;var o=this.varIndices.length*5>this.x?true:false;for(var U=0;U<Q;U++){var B=this.offsetX+this.left;var L=d[U];var V=0;for(var T=0;T<this.varIndices.length;T++){var v=this.varIndices[T];var I=this.getDataAtPos(v,L);if(!isNaN(I)){var m=this.getHeatmapColor(this.minData,this.maxData,I);e=o?m:e;this.addArea(this.rectangleHM(B,a,A,af,m,e,"closed",false,false,true),[v,L]);if(this.showDataValues){this.drawText(I,(B+A)-2,(a+af)-2,this.overlayFont,this.foreground,"right","bottom")}}else{this.addArea(this.rectangleHM(B,a,A,af,f,e,"closed",false,false,true),[v,L])}B=B+A}a=a+af}return true}throw'Illegal graph type "'+this.graphType+'"'};this.draw1DBarDataPoints=function(o,d){var a=this.isGroupedData?this.grpIndices.length:this.smpIndices.length;var h=this.backgroundType.match(/window/i)?this.foregroundWindow:this.foreground;var m=this.xAxisMin<0?Math.abs(this.xAxisMin)*this.xAxisUnit:0;var k=this.isGroupedData?this.grpIndices:this.smpIndices;if(this.graphOrientation=="vertical"){var u=this.offsetX+this.left+this.blockSeparation;var f=(this.offsetY+this.top+this.y)-m;var s=this.rowBlockSize;for(var q=0;q<a;q++){var n=k[q];for(var p=0;p<o.length;p++){var g=this.colorBy&&this.legendColorsN?this.dataColors[q]:this.colors[p%this.colors.length];var t=o[p];var w=this.getDataAtPos(t,n)-this[d+"Min"];var e=w*this[d+"Unit"]-m;this.addArea(this.rectangle(u,f,s,-e,g,h,"closed",false,false,true),[t,n]);if(this.isGroupedData||this.data.y.hasOwnProperty("stdev")){var v=this.getDataAtPos(t,n,"stdev")-this[d+"Min"];if(!isNaN(v)){var b=(v/2)*this[d+"Unit"]-(m/2);this.errorBar(u+this.rowBlockSize/2,f-e,u+this.rowBlockSize/2,(f-e)+b,-this.rowBlockSize/2,h);this.errorBar(u+this.rowBlockSize/2,f-e,u+this.rowBlockSize/2,(f-e)-b,-this.rowBlockSize/2,h)}}if(this.showDataValues){this.drawText(w,u+this.rowBlockSize/2,f-(e+this.overlayFontSize),this.overlayFont,g,"center","bottom")}u+=s}u+=this.blockSeparation}}else{var u=this.offsetX+this.left+m;var f=this.offsetY+this.top+this.blockSeparation;var e=this.rowBlockSize;for(var q=0;q<a;q++){var n=k[q];for(var p=0;p<o.length;p++){var g=this.colorBy&&this.legendColorsN?this.dataColors[q]:this.colors[p%this.colors.length];var t=this.varIndices[p];var w=this.getDataAtPos(t,n)-this[d+"Min"];var s=w*this[d+"Unit"]-m;this.addArea(this.rectangle(u,f,s,e,g,h,"closed",false,false,true),[t,n]);if(this.isGroupedData||this.data.y.hasOwnProperty("stdev")){var v=this.getDataAtPos(t,n,"stdev")-this[d+"Min"];if(!isNaN(v)){var r=(v/2)*this[d+"Unit"]-(m/2);this.errorBar(u+s,f+this.rowBlockSize/2,(u+s)+r,f+this.rowBlockSize/2,this.rowBlockSize/2,h);this.errorBar(u+s,f+this.rowBlockSize/2,(u+s)-r,f+this.rowBlockSize/2,this.rowBlockSize/2,h)}}if(this.showDataValues){this.drawText(w,u+s+this.axisTickFontSize,f+this.rowBlockSize/2,this.overlayFont,g,"left","middle")}f+=e}f+=this.blockSeparation}}};this.draw1DLineDataPoints=function(r,d,q){var a=this.isGroupedData?this.grpIndices.length:this.smpIndices.length;var k=this.backgroundType.match(/window/i)?this.foregroundWindow:this.foreground;var m=this.isGroupedData?this.grpIndices:this.smpIndices;if(this.graphOrientation=="vertical"){var x=this.offsetX+this.left+this.blockSeparation+(this.rowBlockSize/2);var v=this.graphType=="BarLine"?x+this.blockSeparation+(this.xAxisVarIndices.length*this.rowBlockSize):x+this.blockSeparation+this.rowBlockSize;for(var t=0;t<a-1;t++){var n=m[t];var o=m[t+1];for(var s=0;s<r.length;s++){var h=this.coordinateLineColor?this.colors[s%this.colors.length]:this.colors[(s+r.length)%this.colors.length];var f=this.lineDecoration=="symbol"?k:h;var p=this.lineDecoration=="symbol"?this.shapes[s%this.shapes.length]:"sphere";var w=r[s];var z=this.getDataAtPos(w,n)-this[d+"Min"];var y=this.getDataAtPos(w,o)-this[d+"Min"];var g=(this.offsetY+this.top+this.y)-z*this[d+"Unit"];var e=(this.offsetY+this.top+this.y)-y*this[d+"Unit"];if(!isNaN(z)&&!isNaN(y)){if(z<y){this.drawLine("line",v,e,x,g,h,this.lineThickness,"butt",false,false,true)}else{this.drawLine("line",x,g,v,e,h,this.lineThickness,"butt",false,false,true)}}if(this.isGroupedData||this.data.y.hasOwnProperty("stdev")){z=this.getDataAtPos(w,n,"stdev")-this[d+"Min"];y=this.getDataAtPos(w,o,"stdev")-this[d+"Min"];if(!isNaN(z)){var b=(z/2)*this[d+"Unit"];this.errorBar(x,g,x,g+b,-this.rowBlockSize/2,h);this.errorBar(x,g,x,g-b,-this.rowBlockSize/2,h)}if(!isNaN(y)){var b=(y/2)*this[d+"Unit"];this.errorBar(v,e,v,e+b,-this.rowBlockSize/2,h);this.errorBar(v,e,v,e-b,-this.rowBlockSize/2,h)}}if(!isNaN(z)){if(this.lineDecoration){this.addArea(this.drawShape(p,x,g,this.rowBlockSize/3,this.rowBlockSize/3,h,k,"closed",false,false,true),[w,n])}}if(!isNaN(y)){if(this.lineDecoration){if(t==a-2){this.addArea(this.drawShape(p,v,e,this.rowBlockSize/3,this.rowBlockSize/3,h,k,"closed",false,false,true),[w,o])}else{this.drawShape(p,v,e,this.rowBlockSize/3,this.rowBlockSize/3,h,k,"closed",false,false,true)}}}if(this.graphType=="BarLine"&&this.xAxisVarIndices.length==this.xAxis2VarIndices.length){x+=this.rowBlockSize;v+=this.rowBlockSize}}if(this.graphType=="BarLine"){x+=this.blockSeparation+q;v+=this.blockSeparation+q}else{x=v;v+=this.blockSeparation+q}}}else{var g=this.offsetY+this.top+this.blockSeparation+(this.rowBlockSize/2);var e=this.graphType=="BarLine"?g+this.blockSeparation+(this.xAxisVarIndices.length*this.rowBlockSize):g+this.blockSeparation+this.rowBlockSize;for(var t=0;t<a-1;t++){var n=m[t];var o=m[t+1];for(var s=0;s<r.length;s++){var h=this.coordinateLineColor?this.colors[s%this.colors.length]:this.colors[(s+r.length)%this.colors.length];var f=this.lineDecoration=="symbol"?k:h;var p=this.lineDecoration=="symbol"?this.shapes[s%this.shapes.length]:"sphere";var w=r[s];var z=this.getDataAtPos(w,n)-this[d+"Min"];var y=this.getDataAtPos(w,o)-this[d+"Min"];var x=this.offsetX+this.left+z*this[d+"Unit"];var v=this.offsetX+this.left+y*this[d+"Unit"];if(!isNaN(z)&&!isNaN(y)){this.drawLine("line",v,e,x,g,h,this.lineThickness,"butt",false,false,true)}if(this.isGroupedData||this.data.y.hasOwnProperty("stdev")){z=this.getDataAtPos(w,n,"stdev")-this[d+"Min"];y=this.getDataAtPos(w,o,"stdev")-this[d+"Min"];if(!isNaN(z)){var u=(z/2)*this[d+"Unit"];this.errorBar(x,g,x+u,g,this.rowBlockSize/2,h);this.errorBar(x,g,x-u,g,this.rowBlockSize/2,h)}if(!isNaN(y)){var u=(y/2)*this[d+"Unit"];this.errorBar(v,e,v+u,e,this.rowBlockSize/2,h);this.errorBar(v,e,v-u,e,this.rowBlockSize/2,h)}}if(!isNaN(z)){if(this.lineDecoration){this.addArea(this.drawShape(p,x,g,this.rowBlockSize/3,this.rowBlockSize/3,h,k,"closed",false,false,true),[w,n])}}if(!isNaN(y)){if(this.lineDecoration){if(t==a-2){this.addArea(this.drawShape(p,v,e,this.rowBlockSize/3,this.rowBlockSize/3,h,k,"closed",false,false,true),[w,o])}else{this.drawShape(p,v,e,this.rowBlockSize/3,this.rowBlockSize/3,h,k,"closed",false,false,true)}}}if(this.graphType=="BarLine"&&this.xAxisVarIndices.length==this.xAxis2VarIndices.length){g+=this.rowBlockSize;e+=this.rowBlockSize}}if(this.graphType=="BarLine"){g+=this.blockSeparation+q;e+=this.blockSeparation+q}else{g=e;e+=this.blockSeparation+q}}}};this.draw1DLegend=function(){if(this.showLegend&&this.graphType!="Heatmap"){if(this.colorBy&&this.graphType=="Bar"){var d=this.offsetX+this.left;var n=this.offsetY+this.top;if(this.legendPosition=="right"){if(this.legendColorsN>0){d=(d+this.x+this.right)-(this.legendColorWidth+this.margin);n+=(this.y-this.legendColorHeight)/2;this.drawColorLegend(d,n)}else{d=(d+this.x+this.right)-this.legendColorIndicatorHeight;n+=((this.y-this.legendColorIndicatorWidth)/2)+this.legendColorIndicatorWidth;this.drawColorIndicator(d,n,this.legendColorRange[0],this.legendColorRange[1],this.legendColorDecs)}}else{if(this.legendColorsN>0){d+=(this.x-this.legendColorWidth)/2;n=(n+this.y+this.bottom)-(this.legendColorHeight+this.margin);this.drawColorLegend(d,n)}else{d+=((this.x-this.legendColorIndicatorWidth)/2);n=(n+this.y+this.bottom)-this.legendColorIndicatorHeight;this.drawColorIndicator(d,n,this.legendColorRange[0],this.legendColorRange[1],this.legendColorDecs)}}}else{if(this.graphType=="BarLine"||this.graphType=="StackedLine"||this.graphType=="StackedPercentLine"){var h=this.maxVarName>this.maxVarStringLen?this.maxVarNameStr.substring(0,this.maxVarStringLen):this.maxVarNameStr;var f=this.getFontPt(this.legendFont);var d=this.legendPosition=="right"?this.offsetX+this.left+this.x+(this.margin*4):(this.offsetX+this.left+(this.x/2))-((this.measureText(h,this.legendFont)+f)/2);var n=this.legendPosition=="right"?(this.offsetY+this.top+(this.y/2))-(this.getLegendHeight(true)/2):this.offsetY+this.top+this.y;if(this.smpDendrogramPosition=="right"){d+=this.getSmpTreeWidthHeight()}if(this.legendPosition=="bottom"){if(this.graphOrientation=="vertical"){n+=this.getSampleTitleHeight()+this.getSampleLabelLength()+this.getSmpOverlaysLength()+this.margin}else{n+=this.getAxisTitleTickLength()+this.margin}if(this.showSmpDendrogram&&this.smpDendrogramPosition=="bottom"){n+=this.getSmpTreeWidthHeight()}}else{if(this.graphOrientation=="vertical"){d+=this.getAxisTitleTickLength()}}var m=n-this.margin;if(this.legendBox&&this.legendBackgroundColor){var h=this.maxVarName>this.maxVarStringLen?this.maxVarNameStr.substring(0,this.maxVarStringLen):this.maxVarNameStr;var k=((this.xAxisVarIndices.length+this.xAxis2VarIndices.length)*f*1.5)+this.margin;var a=(this.margin*3)+(f*2)+this.measureText(h,this.legendFont);this.rectangle(d-this.margin*2,m,a,k,this.legendBackgroundColor,this.legendBackgroundColor,"close")}for(var g=0;g<this.xAxisVarIndices.length;g++){var o=this.xAxisVarIndices[g];var e=g%this.colors.length;var h=this.shortenText(this.data.y.vars[o],this.maxVarStringLen);var j=this.getVarColor(this.data.y.vars[o]);this.rectangle(d,n,f,f,this.colors[e]);this.drawText(h,d+(f*2),n+(f/2),this.legendFont,j,"left","middle");n+=f*1.5}for(var g=0;g<this.xAxis2VarIndices.length;g++){var o=this.xAxis2VarIndices[g];var e=this.coordinateLineColor?g%this.colors.length:(g+this.xAxisVarIndices.length)%this.colors.length;var p=this.shapes[g%this.shapes.length];var h=this.shortenText(this.data.y.vars[o],this.maxVarStringLen);var j=this.getVarColor(this.data.y.vars[o]);var b=this.getFontPt(this.legendFont)/2;if(this.lineDecoration){if(this.lineDecoration=="symbol"){this.drawLine("line",d,n+(f/2),d+f,n+(f/2),this.foreground);this.drawShape(p,d+(f/2),n+(f/2),b,b,this.colors[e],this.foreground,"closed")}else{if(this.lineDecoration=="dot"){this.drawLine("line",d,n+(f/2),d+f,n+(f/2),this.colors[e]);this.drawShape("circle",d+(f/2),n+(f/2),b,b,this.colors[e],this.foreground,"closed")}}}else{this.drawLine("line",d,n+(f/2),d+f,n+(f/2),this.colors[e])}this.drawText(h,d+(f*2),n+(f/2),this.legendFont,j,"left","middle");n+=f*1.5}if(this.legendBox){var h=this.maxVarName>this.maxVarStringLen?this.maxVarNameStr.substring(0,this.maxVarStringLen):this.maxVarNameStr;var k=((n-m)-(f/2))+this.margin;var a=(this.margin*3)+(f*2)+this.measureText(h,this.legendFont);this.rectangle(d-this.margin*2,m,a,k,false,this.foreground,"open")}}else{var h=this.maxVarName>this.maxVarStringLen?this.maxVarNameStr.substring(0,this.maxVarStringLen):this.maxVarNameStr;var f=this.getFontPt(this.legendFont);var d=this.legendPosition=="right"?this.offsetX+this.left+this.x+(this.margin*4):(this.offsetX+this.left+(this.x/2))-((this.measureText(h,this.legendFont)+f)/2);var n=this.legendPosition=="right"?(this.offsetY+this.top+(this.y/2))-(this.getLegendHeight(true)/2):this.offsetY+this.top+this.y;if(this.legendPosition=="bottom"){if(this.graphOrientation=="vertical"){n+=this.getSampleTitleHeight()+this.getSampleLabelLength()+this.getSmpOverlaysLength()+this.margin}else{n+=this.getAxisTitleTickLength()+this.margin}if(this.showSmpDendrogram&&this.smpDendrogramPosition=="bottom"){n+=this.getSmpTreeWidthHeight()}}else{if(this.graphOrientation=="vertical"){d+=this.getAxisTitleTickLength()}}if(this.smpDendrogramPosition=="right"&&this.showLegend&&this.legendPosition=="right"){d+=this.getSmpTreeWidthHeight()}var m=n-this.margin;if(this.legendBox&&this.legendBackgroundColor){var h=this.maxVarName>this.maxVarStringLen?this.maxVarNameStr.substring(0,this.maxVarStringLen):this.maxVarNameStr;var k=((this.varIndices.length*f*1.5))+this.margin;var a=(this.margin*3)+(f*2)+this.measureText(h,this.legendFont);this.disableGradientTransparency();this.rectangle(d-this.margin*2,m,a,k,this.legendBackgroundColor,this.legendBackgroundColor,"close");this.enableGradientTransparency()}for(var g=0;g<this.varIndices.length;g++){var o=this.varIndices[g];var e=g%this.colors.length;var p=this.shapes[g%this.shapes.length];var h=this.shortenText(this.data.y.vars[o],this.maxVarStringLen);var j=this.getVarColor(this.data.y.vars[o]);var b=this.getFontPt(this.legendFont)/2;if(this.graphType=="Line"){if(this.lineDecoration){if(this.lineDecoration=="symbol"){this.drawLine("line",d,n+(f/2),d+f,n+(f/2),this.foreground);this.drawShape(p,d+(f/2),n+(f/2),b,b,this.colors[e],this.foreground,"closed")}else{if(this.lineDecoration=="dot"){this.drawLine("line",d,n+(f/2),d+f,n+(f/2),this.colors[e]);this.drawShape("circle",d+(f/2),n+(f/2),b,b,this.colors[e],this.foreground,"closed")}}}else{this.drawLine("line",d,n+(f/2),d+f,n+(f/2),this.colors[e])}}else{if(this.graphType=="Dotplot"){p=this.shapes[parseInt(g/this.colors.length)];this.drawShape(p,d+(f/2),n+(f/2),f,f,this.colors[e],this.foreground,"closed")}else{this.rectangle(d,n,f,f,this.colors[e])}}this.drawText(h,d+(f*2),n+(f/2),this.legendFont,j,"left","middle");n+=f*1.5}if(this.legendBox){var h=this.maxVarName>this.maxVarStringLen?this.maxVarNameStr.substring(0,this.maxVarStringLen):this.maxVarNameStr;var k=((n-m)-(f/2))+this.margin;var a=(this.margin*3)+(f*2)+this.measureText(h,this.legendFont);this.rectangle(d-this.margin*2,m,a,k,false,this.foreground,"open")}}}}};this.setIndicatorsLegendPositions=function(){if(this.colorBy&&this.graphType=="Bar"){this.indicatorsPosition=this.legendPosition}};this.draw1DLayout=function(){this.drawTrees();this.draw1DXLayout();this.draw1DYLayout()};this.draw1DData=function(){this.drawPlotWindow();this.draw1DWireFrame();this.draw1DDataPoints();this.maskPlotArea();this.draw1DLayout();this.draw1DLegend();this.drawTitle()};this.draw1DPlot=function(){this.setIndicatorsLegendPositions();this.set1DAttributes();this.set1DXYDimensions();this.set1DPrivateParams();this.set1DXAxis();this.draw1DData()};this.initialize1DPlot=function(){if(this.layoutValid){this.drawLayoutCompartments(this.draw1DPlot)}else{this.draw1DPlot()}};this.initialize1DPlot()};CanvasXpress.prototype.Network=function(){this.findXYCoordinates=function(b){var a=this.adjustedCoordinates(b);var d={};d.x=(a.x/this.scaleFactor||1)-this.offsetX;d.y=(a.y/this.scaleFactor||1)-this.offsetY;return d};this.addNode=function(e,d){if(e){if(!e.id){var a=0;var f="id"+a;while(this.nodes.hasOwnProperty(f)){a++;f="id"+a}e.id=f}if(!e.color){e.color=this.colors[0]}if(!e.shape){e.shape=this.shapes[0]}if(!e.size){e.size=1}if(d){var b=this.findXYCoordinates(d);e.x=b.x;e.y=b.y}this.data.nodeIndices[e.id]=this.data.nodes.length;this.data.nodes.push(e);this.nodes[e.id]=e;return e}};this.removeNode=function(d,k){if(d&&d.id){var a=k?this.getObjectArray(this.findChildrenNodeIndices(d.id)):false;var g=[];var b=0;if(this.nodeParentHood[d.id]){for(var h=0;h<this.nodeParentHood[d.id].children.length;h++){var m=this.nodeParentHood[d.id].children[h];delete (this.data.nodes[this.data.nodeIndices[m]].parentNode)}}this.data.nodeIndices={};for(var h=0;h<this.data.nodes.length;h++){if(this.data.nodes[h].id!=d.id){if(a&&a.hasOwnProperty(h)){var f=this.edgesForNode(this.data.edges,this.data.nodes[h].id);for(var e=0;e<f.length;e++){this.removeEdge(f[e])}}else{g.push(this.data.nodes[h]);this.data.nodeIndices[this.data.nodes[h].id]=b;b++}}else{var f=this.edgesForNode(this.data.edges,d.id);for(var e=0;e<f.length;e++){this.removeEdge(f[e])}}}this.data.nodes=g}};this.addEdge=function(a){if(a&&a.id1&&a.id2){if(!a.color){a.color=this.colors[0]}if(!a.width){a.width=1}if(!a.type){a.type="line"}this.data.edges.push(a)}};this.removeEdge=function(d){if(d&&d.id1&&d.id2){var b=[];for(var a=0;a<this.data.edges.length;a++){if(this.data.edges[a].id1!=d.id1||this.data.edges[a].id2!=d.id2){b.push(this.data.edges[a])}}this.data.edges=b}};this.getAllObjectAttributes=function(d){var e=[];if(this.data[d]){for(var b=0;b<this.data[d].length;b++){for(var a in this.data[d][b]){if(e.hasOwnProperty(a)){e[a]++}else{e[a]=1}}}}return e};this.setAllObjectAttributes=function(m,n,r){if(this.data[m]){var o=this.getAllObjectAttributeValues(m,r);if(o){if(this.isNumeric(o)){var j=this.range(o);if(n=="color"){var p="rgb(255,255,0)";this.setHeatmapColors(j[1]-j[0]);for(var g=0;g<this.data[m].length;g++){if(this.data[m][g].hasOwnProperty(r)){var e=this.data[m][g][r];var d=this.getHeatmapColor(j[0],j[1],e);this.data[m][g][n]=d}else{this.data[m][g][n]=p}}}else{if(n=="size"){for(var g=0;g<this.data[m].length;g++){if(this.data[m][g].hasOwnProperty(r)){var e=this.data[m][g][r];var f=this.percentile(j[0],j[1],e);var b=parseInt(f*25/10);this.data[m][g][n]=1+(b/100)}else{this.data[m][g][n]=0.5}}}else{if(n=="shape"&&m=="nodes"){var t="square";for(var g=0;g<this.data[m].length;g++){if(this.data[m][g].hasOwnProperty(r)){var e=this.data[m][g][r];var f=this.percentile(j[0],j[1],e);var s=parseInt(f/10);if(s>0){s--}this.data[m][g][n]="pie"+s}else{this.data[m][g][n]=t}}}}}}else{var q=0;var h=0;var k=0.1;var a={color:{},shape:{},size:{}};for(var g=0;g<o.length;g++){if(!a.color.hasOwnProperty(o[g])){a.color[o[g]]=this.colors[q%this.colors.length];q++}if(m=="nodes"){if(!a.shape.hasOwnProperty(o[g])){a.shape[o[g]]=this.shapes[h%this.shapes.length];h++}}else{if(!a.shape.hasOwnProperty(o[g])){a.lines[o[g]]=this.lines[h%this.lines.length];h++}}if(!a.size.hasOwnProperty(o[g])){a.size[o[g]]=k;k+=0.1}}for(var g=0;g<this.data[m].length;g++){if(this.data[m][g].hasOwnProperty(r)){var e=this.data[m][g][r];this.data[m][g][n]=a[n][e]}}}}}};this.getAllObjectAttributeValues=function(d,a){var e=[];if(this.data[d]){for(var b=0;b<this.data[d].length;b++){if(this.data[d][b].hasOwnProperty(a)){e.push(this.data[d][b][a])}}}return e};this.modifyNodeSize=function(e,a,b){var d=this.data.nodes[this.data.nodeIndices[e]];delete (d.size);d.width=a;d.height=b};this.modifyXYNode=function(h,d,a){var g=this.data.nodes[this.data.nodeIndices[h]];g.x-=d;g.y-=a;if(g.labelX!=null&&g.labelY!=null){this.modifyXYNodeLab(h,d,a)}if(this.networkLayoutType!="radial"){if(this.nodeParentHood[g.id]&&this.nodeParentHood[g.id]["children"]){for(var f=0;f<this.nodeParentHood[g.id]["children"].length;f++){var b=this.nodeParentHood[g.id]["children"][f];var e=this.data.nodes[this.data.nodeIndices[b]];this.modifyXYNode(b,d,a)}}}};this.modifyXYNodeLab=function(d,k,j){var e=this.data.nodes[this.data.nodeIndices[d]];var g=e.label!=null?e.label:e.name?e.name:e.id;var a=this.measureText(g,this.nodeFont);var h=this.nodeFontSize;var f=e.width?e.width:e.size?(this.nodeSize*e.size):this.nodeSize;var b=e.height?e.height:e.size?(this.nodeSize*e.size):this.nodeSize;if(e.labelX!=null&&e.labelY!=null){e.labelX-=k;e.labelY-=j}else{if(this.rangeX>this.rangeY){e.labelX=(e.x-(a/2))-k;e.labelY=(e.y+(b/1.3))-j}else{e.labelX=(e.x+(f/1.3))-k;e.labelY=(e.y-(h/2))-j}}};this.modifyXYNodeDec=function(e,b,a){var d=this.data.nodes[this.data.nodeIndices[e]];d.decorationsX-=b;d.decorationsY-=a};this.getHiddenNodes=function(){var b=[];if(this.data.nodes){for(var a=0;a<this.data.nodes.length;a++){if(this.data.nodes[a].hide){b.push(this.data.nodes[a])}}}return b};this.sendNodeToBack=function(d){var b=[d];for(var a=0;a<this.data.nodes.length;a++){if(this.data.nodes[a].id!=d.id){b.push(this.data.nodes[a])}}this.data.nodes=b;this.setNodeIndices()};this.sendNodeBackward=function(e){var d=[];var a=this.data.nodeIndices[e.id];if(a>0){for(var b=0;b<a-1;b++){d.push(this.data.nodes[b])}d.push(this.data.nodes[a]);d.push(this.data.nodes[a-1]);for(var b=a+1;b<this.data.nodes.length;b++){d.push(this.data.nodes[b])}this.data.nodes=d;this.setNodeIndices()}};this.bringNodeToFront=function(d){var b=[];for(var a=0;a<this.data.nodes.length;a++){if(this.data.nodes[a].id!=d.id){b.push(this.data.nodes[a])}}b.push(d);this.data.nodes=b;this.setNodeIndices()};this.bringNodeForward=function(e){var d=[];var a=this.data.nodeIndices[e.id];if(this.data.nodes.length-1>a){for(var b=0;b<a;b++){d.push(this.data.nodes[b])}d.push(this.data.nodes[a+1]);d.push(this.data.nodes[a]);for(var b=a+2;b<this.data.nodes.length;b++){d.push(this.data.nodes[b])}this.data.nodes=d;this.setNodeIndices()}};this.addToNetworkStack=function(a){if(!a){a=0}if(this.networkStack[a].length>=this.networkStackStates){this.networkStack[a].shift()}this.networkStack[a].push(this.cloneObject(this.data))};this.undoNetworkOp=function(){if(this.networkStack[0].length>0){this.addToNetworkStack(1);this.nodes={};this.updateData(this.networkStack[0].pop())}else{if(this.debug){alert("No data in Undo Stack")}}};this.canNetworkUndoOp=function(){return this.networkStack[0].length>0?true:false};this.redoNetworkOp=function(){if(this.networkStack[1].length>0){this.addToNetworkStack(0);this.nodes={};this.updateData(this.networkStack[1].pop())}else{if(this.debug){alert("No data in Redo Stack")}}};this.canNetworkRedoOp=function(){return this.networkStack[1].length>0?true:false};this.addLegend=function(a,e,d){this.inititalizeNetworkLegend();if(a&&e){if(d&&a=="text"){var b=this.findXYCoordinates(d);e.x=b.x;e.y=b.y}this.data.legend[a].push(e);return e}};this.deleteLegend=function(d,e){if(d&&e&&e.id){var b=[];for(var a=0;a<this.data.legend[d].length;a++){if(this.data.legend[d][a].id!=e.id){b.push(this.data.legend[d][a])}}this.data.legend[d]=b;delete this.data.legend.ids[d][e.id]}};this.alignDistributeSelectedNodes=function(j,b){var f,a,h,q,g;var k=this.getSelectedNodeCoordinates();if(k||b==89|b==90){this.cancelEvent(j);this.stopEvent(j);if(b!=90||(b==90&&j.shiftKey)){this.addToNetworkStack(0)}if(b==84){f=this.min(k.y);for(var g in this.selectNode){var d=this.data.nodes[this.data.nodeIndices[g]];d.y=f}}else{if(b==82){f=this.max(k.x);for(var g in this.selectNode){var d=this.data.nodes[this.data.nodeIndices[g]];d.x=f}}else{if(b==66){f=this.max(k.y);for(var g in this.selectNode){var d=this.data.nodes[this.data.nodeIndices[g]];d.y=f}}else{if(b==76){f=this.min(k.x);for(var g in this.selectNode){var d=this.data.nodes[this.data.nodeIndices[g]];d.x=f}}else{if(b==86){a=this.range(k.y);h=this.rank(k.y);q=(a[1]-a[0])/(this.isSelectNodes-1);f=a[0];for(var p=0;p<h.length;p++){g=k.i[h[p]];var d=this.data.nodes[this.data.nodeIndices[g]];d.y=f+(p*q)}}else{if(b==72){a=this.range(k.x);h=this.rank(k.x);q=(a[1]-a[0])/(this.isSelectNodes-1);f=a[0];for(var p=0;p<h.length;p++){g=k.i[h[p]];var d=this.data.nodes[this.data.nodeIndices[g]];d.x=f+(p*q)}}else{if(b==90&&!j.shiftKey){if(this.canNetworkUndoOp){this.addToNetworkStack(1);this.resetSelectedNodes();this.undoNetworkOp()}return false}else{if(b==89||b==90){if(this.canNetworkRedoOp){if(!this.canNetworkUndoOp){this.addToNetworkStack(0)}this.resetSelectedNodes();this.redoNetworkOp()}return false}}}}}}}}this.draw(false,false,false,true)}return false};this.getSelectedNodeCoordinates=function(){var f={x:[],y:[],i:[]};var b=false;for(var d in this.selectNode){var e=this.data.nodes[this.data.nodeIndices[d]];f.x.push(e.x);f.y.push(e.y);f.i.push(d);b=true}return b?f:false};this.findNodesBy=function(g){var a=[];var k=0;for(var b in g){g[b]=this.toArray(g[b]);k++}for(var h=0;h<this.data.nodes.length;h++){var d=this.data.nodes[h];var e=0;for(var b in g){var o=g[b];for(var f=0;f<o.length;f++){if(d[b]&&d[b]==o[f]){e++}}}if(e==k){a.push(d)}}return a};this.setNetworkDimensions=function(){this.left=0;this.top=0;this.x=this.width;this.y=this.height};this.setNetworkPrivateParams=function(){if(this.data.nodes.length>0){this.layoutDone=false;this.x=this.width;this.y=this.height;if(this.networkLayoutType=="radial"){if(this.width>this.height){this.width=this.height}else{this.height=this.width}this.x=this.width;this.y=this.height;this.networkXCenter=this.x/2;this.networkYCenter=this.y/2}else{this.x=this.width;this.y=this.height;this.set3DParams();this.area=this.x*this.y;this.k=Math.sqrt(this.area/this.data.nodes.length);this.temperature=this.data.nodes.length+Math.floor(Math.sqrt(this.data.edges.length));this.minimumTemperature=1;this.initialTemperature=this.temperature;this.iteration=0}if(this.x<=400||this.y<=400){this.nodeSize-=4;this.nodeFont=(this.nodeSize-6)+"Pt "+this.fontName;this.showAnimationFont=this.nodeFont+"Pt "+this.fontName}else{this.edgeWidth=2}}else{this.layoutDone=true}};this.networkContains=function(a,b){return this.findNode(a,b)!=null};this.findNode=function(b,e){for(var d in b){var a=b[d];if(e.call(a)){return a}}return null};this.filterEdges=function(b,f){var e=[];for(var d in b){var a=b[d];if(f.call(a)){e.push(a)}}return e};this.reduceNetwork=function(a,f,d){var e=null;for(var b in a){if(e==null){if(d){e=d.apply(d,[a[b]])}else{e=a[b]}}else{e=f.apply(a[b],[e,a[b]])}}return e};this.vectorDifference=function(b,a){return{x:b.x-a.x,y:b.y-a.y,z:b.z-a.z}};this.vectorMagnitude=function(a){if(this.is3DNetwork){var b=Math.sqrt((a.x*a.x)+(a.y*a.y)+(a.z*a.z));return isNaN(b)?0:b}else{return Math.sqrt((a.x*a.x)+(a.y*a.y))}};this.normalizeGraph=function(j){var h=[];var a={};var k=this;for(var f in j.nodes){if(!a.hasOwnProperty(j.nodes[f].id)){var e=j.nodes[f];var d=[];a[e.id]=1;if(!this.networkContains(d,function(){return k.networkContains(this.nodes,function(){return this.id=e.id})})){var b={};b.nodes=[];b.edges=[];this.addNodeToGraph(e,b,j);if(b.nodes.length>0){h.push(b)}for(var g=0;g<b.nodes.length;g++){a[b.nodes[g].id]=1}}}}return h};this.addNodeToGraph=function(d,f,e){if(this.findNodeForId(d.id,f)==null){f.nodes.push(d);var a=this.edgesForNode(e.edges,d.id);for(edgeIndex in a){var b=a[edgeIndex];f.edges.push(b);if(b.id1==d.id){this.addNodeToGraph(this.findNodeForId(b.id2,e),f,e)}else{this.addNodeToGraph(this.findNodeForId(b.id1,e),f,e)}}}};this.findNodeForId=function(b,a){return this.findNode(a.nodes,function(){return b==this.id})};this.edgesForNode=function(a,b){return this.filterEdges(a,function(d){return(this.id1==b||this.id2==b)})};this.attractiveForce=function(b,a){return(b*b)/a};this.repulsiveForce=function(b,a){return(a*a)/b};this.storePositions=function(){var e={};for(var b=0;b<this.data.nodes.length;b++){var d=this.data.nodes[b];if(!d.hide&&!d.hiddenParent){var a={x:d.x,y:d.y,z:d.z};e[d.id]=a}}return e};this.calculateRepulsiveDisplacement=function(f){for(var e=0;e<this.data.nodes.length;e++){var k=this.data.nodes[e];if(!k.hide&&!k.hiddenParent){var a={x:0,y:0,z:0};for(var b=0;b<this.data.nodes.length;b++){var g=this.data.nodes[b];if(!g.hide&&!g.hiddenParent){var h=this.vectorDifference(k,g);var d=this.vectorMagnitude(h);if(d!=0){a.x+=(h.x/d)*this.repulsiveForce(d,this.k);a.y+=(h.y/d)*this.repulsiveForce(d,this.k);a.z+=(h.z/d)*this.repulsiveForce(d,this.k)}}f[k.id]=a}}}};this.calculateAttractiveDisplacement=function(f){for(var d=0;d<this.data.edges.length;d++){var e=this.data.edges[d];if(!this.nodes||!this.nodes[e.id1]||!this.nodes[e.id2]){alert('Nodes "'+e.id1+'" and/or "'+e.id2+'" are missing!');return}if(this.nodes&&!this.nodes[e.id1].hide&&!this.nodes[e.id2].hide&&!this.nodes[e.id1].hiddenParent&&!this.nodes[e.id2].hiddenParent){var h=this.vectorDifference(this.nodes[e.id1],this.nodes[e.id2]);var b=this.vectorMagnitude(h);if(b!=0){var g=f[e.id1];g.x-=(h.x/b)*this.attractiveForce(b,this.k);g.y-=(h.y/b)*this.attractiveForce(b,this.k);g.z-=(h.z/b)*this.attractiveForce(b,this.k);var a=f[e.id2];a.x+=(h.x/b)*this.attractiveForce(b,this.k);a.y+=(h.y/b)*this.attractiveForce(b,this.k);a.z+=(h.z/b)*this.attractiveForce(b,this.k)}}}};this.isLayoutDone=function(){var j=this.storePositions();var k=0;var b=0;var e;var h;for(var g=0;g<this.data.nodes.length;g++){if(!this.data.nodes[g].hide&&!this.data.nodes[g].hiddenParent){var d=this.data.nodes[g].id;var a=j[d];if(e){e.x=Math.min(e.x,a.x);e.y=Math.min(e.y,a.y);e.z=Math.min(e.z,a.z);h.x=Math.max(h.x,a.x);h.y=Math.max(h.y,a.y);h.z=Math.max(h.z,a.z)}else{e={};h={};e.x=a.x;e.y=a.y;e.z=a.z;h.x=a.x;h.y=a.y;h.z=a.z}var m=Math.abs(this.vectorMagnitude(this.vectorDifference(this.previousNodePositions[d],a)));k+=m;b++}}var p=k/b;var f=Math.abs(this.vectorMagnitude(this.vectorDifference(e,h)));var o=Math.abs(this.vectorMagnitude({x:this.x,y:this.y,z:parseInt((this.x+this.y)/2)}));this.minimumTemperature=(f/o);this.layoutDone=p<(this.minimumTemperature/2);this.previousNodePositions=j;if(this.initialProgress==null&&this.temperature<=this.minimumTemperature){this.initialProgress=p-(this.minimumTemperature/2)}if(this.initialProgress!=null){this.layoutProgress=Math.max(this.layoutProgress,1-((p-(this.minimumTemperature/2))/this.initialProgress))}};this.applyDisplacement=function(e){if(this.nodes){for(var f in e){var d=this.nodes[f];var b=e[f];var a=this.vectorMagnitude(b);if(a!=0){d.x+=(b.x/a)*Math.min(this.temperature,Math.abs(b.x));d.y+=(b.y/a)*Math.min(this.temperature,Math.abs(b.y));d.z+=(b.z/a)*Math.min(this.temperature,Math.abs(b.z))}}}};this.setInitialForceDirectedLayout=function(){this.layoutProgress=0;for(var a=0;a<this.data.nodes.length;a++){if(!this.data.nodes[a].hide&&!this.data.nodes[a].hiddenParent){this.data.nodes[a].x=Math.floor(Math.random()*this.x);this.data.nodes[a].y=Math.floor(Math.random()*this.y);this.data.nodes[a].z=this.is3DNetwork?Math.floor(Math.random()*parseInt((this.x+this.y)/2)):0}}this.previousNodePositions=this.storePositions()};this.updateForceDirectedLayout=function(d){var e=new Date().getTime();var b=e;if(this.data.edges.length<1){this.layoutDone=true}if(!this.layoutDone){while(b-e<d){var a={};this.calculateRepulsiveDisplacement(a);this.calculateAttractiveDisplacement(a);this.applyDisplacement(a);this.iteration++;this.temperature=Math.max(this.temperature-(this.initialTemperature/100),this.minimumTemperature);if(this.iteration%10==0){this.isLayoutDone()}b=new Date().getTime()}}return this.layoutDone};this.renderNetwork=function(){this.ctx.shadowOffsetX=this.shadowOffsetX;this.ctx.shadowOffsetY=this.shadowOffsetY;this.ctx.shadowBlur=this.shadowBlur;this.ctx.shadowColor=this.shadowColor;this.setNetworkRotation();this.resizeCanvas();if(!this.layoutDone&&!this.showAnimation){this.drawNetworkProgressBar(true);return}if(this.data.nodes.length>0){if(this.layoutDone){this.setXYNodePrecision()}this.setNetworkMinMaxRangeXY();this.setNetworkScaleFactor();if(this.scaleFactor){if(this.showAnimation){if(this.preScaleNetwork){this.centerNetwork();this.ctx.save();this.ctx.scale(1/this.scaleFactor,1/this.scaleFactor);this.ctx.translate(this.offsetX,this.offsetY);this.ctx.restore();this.drawNetworkNodes();this.drawNetworkEdges();if(this.layoutDone){this.drawNetworkLegend()}this.ctx.save();this.ctx.translate(-this.offsetX,-this.offsetY);this.ctx.scale(this.scaleFactor,this.scaleFactor);this.ctx.restore()}else{this.ctx.scale(this.scaleFactor,this.scaleFactor);this.ctx.translate(this.offsetX,this.offsetY);if(this.networkLayoutType=="radial"&&this.showNetworkRadialLayout){this.renderRadialLayout()}this.drawNetworkNodes();this.drawNetworkEdges();if(this.layoutDone){this.drawNetworkDecorations();this.drawNetworkLegend()}this.ctx.translate(-this.offsetX,-this.offsetY);this.ctx.scale(1/this.scaleFactor,1/this.scaleFactor)}}else{if(this.preScaleNetwork){this.centerNetwork();this.ctx.save();this.ctx.scale(this.scaleFactor,this.scaleFactor);this.ctx.translate(this.offsetX,this.offsetY);this.ctx.restore()}else{this.ctx.scale(this.scaleFactor,this.scaleFactor);this.ctx.translate(this.offsetX,this.offsetY)}if(this.networkLayoutType=="radial"&&this.showNetworkRadialLayout){for(var a=1;a<this.networkDepth;a++){this.drawShape("circle",this.networkXCenter,this.networkYCenter,a*this.networkLevelSize*2,a*this.networkLevelSize*2,this.background,this.infoAreaColor,"open")}}this.drawNetworkNodes();this.drawNetworkEdges();if(this.layoutDone){this.drawNetworkDecorations();this.drawNetworkLegend()}}this.drawNetworkProgressBar()}}};this.reRootRadialNetwork=function(f){var e=this.data.nodes[f].id;this.networkCurrentAngle=this.getAngle(this.finalRadialNodePositions[e].x,this.finalRadialNodePositions[e].y,this.finalRadialNodePositions[this.networkRoot].x,this.finalRadialNodePositions[this.networkRoot].y,0)+180;this.orderRadialNetwork={};var b=this.data.nodeIndices[e];var d=0;for(var a=b;a<this.data.nodes.length;a++){this.orderRadialNetwork[this.data.nodes[a].id]=d;d++}for(var a=0;a<b;a++){this.orderRadialNetwork[this.data.nodes[a].id]=d;d++}this.networkXCenter=this.finalRadialNodePositions[e].x;this.networkYCenter=this.finalRadialNodePositions[e].y;this.networkRoot=e;this.layoutDone=false;this.draw()};this.renderRadialLayout=function(){var a=this.data.nodes[this.data.nodeIndices[this.networkRoot]];for(var b=1;b<this.networkDepth;b++){this.drawShape("circle",a.x,a.y,b*this.networkLevelSize*2,b*this.networkLevelSize*2,this.background,this.infoAreaColor,"open")}};this.centerNetwork=function(){for(var a=0;a<this.data.nodes.length;a++){var b=this.data.nodes[a];if(!b.hide&&!b.hiddenParent){b.x=(this.offsetX+b.x)*this.scaleFactor;b.y=(this.offsetY+b.y)*this.scaleFactor}}this.scaleFactor=0.9;this.offsetX=this.x*0.05;this.offsetY=this.y*0.05};this.adjustNetworkObjects=function(b){if(b){if(b[0]=="circle"){b[1]=(this.offsetX+b[1])*this.scaleFactor;b[2]=(this.offsetY+b[2])*this.scaleFactor;b[3]=b[3]*this.scaleFactor}else{for(var a=1;a<b.length;a++){if(a%2){b[a]=(this.offsetX+b[a])*this.scaleFactor}else{b[a]=(this.offsetY+b[a])*this.scaleFactor}}}}else{return false}return b};this.setXYNodePrecision=function(){if(this.approximateNodePositions){for(var a=0;a<this.data.nodes.length;a++){var b=this.data.nodes[a];if(b.x){b.x=parseInt(b.x);this.nodes[b.id].x=b.x}if(b.y){b.y=parseInt(b.y);this.nodes[b.id].y=b.y}if(b.z){b.z=parseInt(b.z);this.nodes[b.id].z=b.z}}}};this.getLengthToNodeBoundary=function(d,k,b,j,f,e){if(f){var h=f.size?f.size:1;var a=e&&f.height?f.height:f.width?f.width:this.nodeSize*h;var g=e&&f.width?f.width:f.height?f.height:this.nodeSize*h;var m=this.clip("line",[d,k,b,j],[d-(a/2),k-(g/2),a,g]);return this.lineLength(m[0],m[1],m[2],m[3])+(this.margin*2)}else{return this.margin*2}};this.drawNetworkEdges=function(){if(this.nodes){var a={};var b=1;var f=this.foreground;for(var r=0;r<this.data.edges.length;r++){var g=this.data.edges[r];var q=this.nodes[g.id1];var p=this.nodes[g.id2];var v=false;if(!q.hide&&!q.hiddenParent&&!p.hide&&!p.hiddenParent&&!g.anchor){v=true}else{if(this.showHiddenChildEdges){if(q.hide||q.hiddenParent||(q.parentNode&&this.nodes[q.parentNode].hideChildren)){q=this.findVisibleParentNode(g.id1);if(q){v=true}}if(p.hide||p.hiddenParent||(p.parentNode&&this.nodes[p.parentNode].hideChildren)){p=this.findVisibleParentNode(g.id2);if(p){v=true}}}}var x=q.id+":"+p.id;if(v){if(!a.hasOwnProperty(x)){var d=this.selectNode.hasOwnProperty(q.id)&&this.selectNode.hasOwnProperty(p.id)?this.nodeHighlightColor:g.color?g.color:f;var j=g.width?g.width:1;var h=g.cap?g.cap:false;var n,k,t,s;if(this.is3DNetwork){n=q.x3d;k=q.y3d;t=p.x3d;s=p.y3d}else{n=q.x;k=q.y;t=p.x;s=p.y}var m=g.type?g.type:"line";var o=m.match(/curved/)?true:false;var w=this.getLengthToNodeBoundary(n,k,t,s,q,o);var e=this.getLengthToNodeBoundary(t,s,n,k,p,o);var u=this.drawLine(m,n,k,t,s,d,j,h,w,e);if(this.layoutDone&&!this.isAnimation){if(this.preScaleNetwork){this.addArea(u,[r+this.data.nodes.length],false,b)}else{this.addArea(this.adjustNetworkObjects(u),[r+this.data.nodes.length],false,b)}b++}this.ctx.lineWidth=1;a[x]=1}}}}};this.drawNetworkNodes=function(){var n=this.data.nodes.length<this.showNodeNameThreshold?true:false;var j=this.foreground;var B=this.shapes[0];var a=6001;var k=this.rangeX>this.rangeY?"bottom":"right";for(var C=0;C<this.data.nodes.length;C++){var z=this.data.nodes[C];if(!z.hide&&!z.hiddenParent&&!z.anchor){var r=this.is3DNetwork?z.x3d:z.x;var F=this.is3DNetwork?z.y3d:z.y;var v=z.shape?z.shape:B;var h=this.selectNode.hasOwnProperty(z.id)?this.nodeHighlightColor:z.color?z.color:j;var D=z.outline?z.outline:this.foreground;var E=z.size?z.size:1;var q=z.width?z.width:this.nodeSize*E;var y=z.height?z.height:this.nodeSize*E;var s=z.pattern?z.pattern:"closed";var o=z.rotate?z.rotate*Math.PI/180:false;var x=z.outlineWidth?z.outlineWidth:false;var g=z.imagePath?z.imagePath:false;var b=z.zIndex?z.zIndex:g?a:false;var G=this.drawShape(v,r,F,q,y,h,D,s,o,x,false,false,false,false,g,b);if(this.layoutDone&&!this.isAnimation){if(this.preScaleNetwork){this.addArea(G,[C])}else{this.addArea(this.adjustNetworkObjects(G),[C])}if(n&&!z.hideName){var e,d;var m=z.label?z.label:z.name?z.name:z.id;var A=this.getNodeColor(z.id);var f=z.labelSize?this.nodeFontSize*z.labelSize*this.scaleNodeFontFactor:this.nodeFontSize*this.scaleNodeFontFactor;var t=(parseInt(f))+"Pt "+this.fontName;var w=this.measureText(m,t);var u=f;if(z.labelX!=null&&z.labelY!=null){e=z.labelX-(w/2);d=z.labelY-(u/2);this.drawText(m,z.labelX,z.labelY,t,A,"center","middle")}else{if(z.labelPosition){switch(z.labelPosition){case"top":e=r-(w/2);d=F-((y/1.3)+u);this.drawText(m,r,d,t,A,"center","top");break;case"bottom":e=r-(w/2);d=F+(y/1.3);this.drawText(m,r,d,t,A,"center","top");break;case"right":e=r+(q/1.3);d=F-(u/2);this.drawText(m,e,F,t,A,"left","middle");break;case"left":e=r-((q/1.3)+w);d=F-(u/2);this.drawText(m,e,F,t,A,"left","middle");break;case"center":this.drawText(m,r,F,t,A,"center","middle");break}}else{if(k=="right"){e=r+(q/1.3);d=F-(u/2);this.drawText(m,e,F,t,A,"left","middle")}else{e=r-(w/2);d=F+(y/1.3);this.drawText(m,r,d,t,A,"center","top")}}}var p=["rect",e,d,e+w,d+u];if(this.preScaleNetwork&&!this.isAnimation){this.addArea(p,[C],"-lab")}else{this.addArea(this.adjustNetworkObjects(p),[C],"-lab")}}}a++}}};this.drawNetworkDecorations=function(){if(this.showDecorations&&this.decorations.length>0){var n=this.decorations.length*this.decorationsWidth;var u=n/2;var e=this.decorationsHeight/2;var v=this.decorationsHeight*2/3;var g=this.decorationsHeight/3;this.setHeatmapColors(this.decorationsRange[1]-this.decorationsRange[0]);for(var q=0;q<this.data.nodes.length;q++){var o=this.data.nodes[q];if(!o.hide&&!o.hiddenParent&&!o.anchor){var h=this.is3DNetwork?o.x3d:o.x;var s=this.is3DNetwork?o.y3d:o.y;var w=o.size?this.nodeSize*o.size:this.nodeSize;var a=w/2;var t,d,r,b,m,f,k;switch(this.decorationsPosition){case"top":t=h-u;d=s-(a+this.decorationsHeight+this.decorationsWidth);break;case"bottom":t=h-u;d=s+(a+this.decorationsHeight+this.decorationsWidth);break;case"right":t=h+a+this.decorationsWidth;d=s-e;break;case"left":t=h-(a+(this.decorationsWidth*(this.decorations.length+1)));d=s-e;break}if(o.decorationsX!=null&&o.decorationsY!=null){t=o.decorationsX;d=o.decorationsY}if(this.preScaleNetwork&&!this.isAnimation){this.addArea(["rect",t,d,t+n,d-this.decorationsHeight],[q],"-dec")}else{this.addArea(this.adjustNetworkObjects(["rect",t,d,t+n,d-this.decorationsHeight]),[q],"-dec")}if(this.decorationsType=="bar"){k=this.decorationsRange[1]<0?d:this.decorationsRange[0]>=0?d+this.decorationsHeight:(d+this.decorationsHeight)-Math.abs(this.decorationsRange[0]*this.decorationsUnits);for(var p=0;p<this.decorations.length;p++){m=this.decorations[p];if(o[m]&&!isNaN(o[m])){this.rectangle(t,k,this.decorationsWidth,-o[m]*this.decorationsUnits,this.decorationsColors[p])}t+=this.decorationsWidth}}else{for(var p=0;p<this.decorations.length;p++){m=this.decorations[p];if(o[m]!=null&&!isNaN(o[m])){f=this.getHeatmapColor(this.decorationsRange[0],this.decorationsRange[1],o[m])}else{f="rgb(255,255, 0)"}this.rectangle(t,d,this.decorationsWidth,v,f);this.drawShape("circle",t+this.decorationsWidth/2,(d+this.decorationsHeight)-(g/3),g/3,g/3,this.decorationsColors[p],this.foreground,"closed");t+=this.decorationsWidth}}}}}};this.getLegendId=function(b,d){if(b){if(!d){var a=0;d=b+"LegendId"+a;while(this.data.legend.ids[b].hasOwnProperty(d)){a++;d=b+"LegendId"+a}}this.data.legend.ids[b][d]=true;return d}};this.findNetworkXYRange=function(){if(this.data.nodes.length>0){var a=Number.MAX_VALUE;var f=Number.MIN_VALUE;var g=Number.MAX_VALUE;var e=Number.MIN_VALUE;if(this.is3DNetwork&&this.layoutDone&&this.scaleFactor){for(var b=0;b<this.data.nodes.length;b++){var d=this.data.nodes[b];if(!d.hide&&!d.hiddenParent&&!d.anchor){a=Math.min(a,d.x3d);f=Math.max(f,d.x3d);g=Math.min(g,d.y3d);e=Math.max(e,d.y3d)}}}else{for(var b=0;b<this.data.nodes.length;b++){var d=this.data.nodes[b];if(!d.hide&&!d.hiddenParent&&!d.anchor){a=Math.min(a,d.x);f=Math.max(f,d.x);g=Math.min(g,d.y);e=Math.max(e,d.y)}}}}return({minX:a,maxX:f,minY:g,maxY:e})};this.inititalizeNetworkLegend=function(){if(!this.data.legend){this.data.legend={}}if(!this.data.legend.pos){this.data.legend.pos={nodes:{x:false,y:false},edges:{x:false,y:false},decorations:{x:false,y:false}}}if(!this.data.legend.ids){this.data.legend.ids={nodes:{},edges:{},text:{},decorations:{}}}};this.drawNetworkLegend=function(){this.inititalizeNetworkLegend();var a=this.findNetworkXYRange();this.curLegendX=a.minX;this.curLegendY=a.minY;this.drawNetworkLegendNodes();this.drawNetworkLegendEdges();this.drawNetworkLegendText();this.drawNetworkLegendDecorations()};this.drawNetworkLegendNodes=function(){if(this.data.legend.nodes&&this.data.legend.nodes.length>0){var g=this.data.legend.pos.nodes.x||this.curLegendX;var e=this.data.legend.pos.nodes.y||this.curLegendY;this.data.legend.pos.nodes.x=parseInt(g);this.data.legend.pos.nodes.y=parseInt(e);var w=0;var v=0;for(var x=0;x<this.data.legend.nodes.length;x++){this.data.legend.nodes[x].id=this.getLegendId("nodes",this.data.legend.nodes[x].id);var u=this.data.legend.nodes[x].color||this.nodeFontColor;var y=this.data.legend.nodes[x].outline?this.data.legend.nodes[x].outline:this.foreground;var a=this.data.legend.nodes[x].shape||this.shapes[0];var q=this.data.legend.nodes[x].size?this.data.legend.nodes[x].size*this.nodeFontSize:this.nodeFontSize;var m=this.data.legend.nodes[x].width?this.data.legend.nodes[x].width:q;var s=this.data.legend.nodes[x].height?this.data.legend.nodes[x].height:q;var n=this.data.legend.nodes[x].pattern?this.data.legend.nodes[x].pattern:"closed";var k=this.data.legend.nodes[x].rotate?this.data.legend.nodes[x].rotate*Math.PI/180:false;var t=this.data.legend.nodes[x].outlineWidth?this.data.legend.nodes[x].outlineWidth:false;var h=this.data.legend.nodes[x].imagePath?this.data.legend.nodes[x].imagePath:false;var b=this.data.legend.nodes[x].zIndex?this.data.legend.nodes[x].zIndex:false;var j=this.data.legend.nodes[x].font?this.data.legend.nodes[x].font*this.nodeFontSize*this.scaleNodeFontFactor:this.nodeFontSize*this.scaleNodeFontFactor;var p=(parseInt(j))+"Pt "+this.fontName;var o=this.data.legend.nodes[x].text?this.data.legend.nodes[x].text:"";var r=this.measureText(o,p);q=parseFloat(sprintf("%.1f",q));w=Math.max(w,(this.margin*3)+q+r);v=q/2;e+=v;this.drawShape(a,this.margin+g+v,this.margin+e+v,m,s,u,y,n,k,t,false,false,false,false,h,b);this.drawText(o,(this.margin*2)+g+q,this.margin+e+v,p,this.nodeFontColor,"left","middle");e+=q}e+=this.margin+v;var A=this.data.legend.pos.nodes.x;var f=this.data.legend.pos.nodes.y;var z=w;var d=e-this.data.legend.pos.nodes.y;if(this.legendBox){this.rectangle(A,f,z,d,false,this.nodeFontColor,"open")}var B=["rect",A,f,A+z,f+d];if(this.preScaleNetwork){this.addArea(B,[-1],"-legend-Nodes")}else{this.addArea(this.adjustNetworkObjects(B),[-1],"-legend-Nodes")}this.curLegendX=g;this.curLegendY=e}};this.drawNetworkLegendEdges=function(){if(this.data.legend.edges&&this.data.legend.edges.length>0){var e=this.data.legend.pos.edges.x||this.curLegendX;var b=this.data.legend.pos.edges.y||this.curLegendY;this.data.legend.pos.edges.x=parseInt(e);this.data.legend.pos.edges.y=parseInt(b);var p=0;var o=0;for(var q=0;q<this.data.legend.edges.length;q++){this.data.legend.edges[q].id=this.getLegendId("edges",this.data.legend.edges[q].id);var n=this.data.legend.edges[q].color||this.nodeFontColor;var g=this.data.legend.edges[q].type||"line";var m=this.data.legend.edges[q].width||1;var k=this.data.legend.edges[q].size?this.data.legend.edges[q].size*this.nodeFontSize:this.nodeFontSize;var f=this.data.legend.edges[q].font?this.data.legend.edges[q].font*this.nodeFontSize*this.scaleNodeFontFactor:this.nodeFontSize*this.scaleNodeFontFactor;var j=(parseInt(f))+"Pt "+this.fontName;var h=this.data.legend.edges[q].text||"";var r=this.measureText(h,j);k=parseFloat(sprintf("%.1f",k));p=Math.max(p,(this.margin*3)+k+r);o=f/2;b+=o;this.ctx.lineWidth=m*this.edgeWidth;this.drawLine(g,this.margin+e,this.margin+b+o,e+k,this.margin+b+o,n,false,false,0,0);this.drawText(h,(this.margin*2)+e+k,this.margin+b+o,j,this.nodeFontColor,"left","middle");b+=f}b+=this.margin+o;var t=this.data.legend.pos.edges.x;var d=this.data.legend.pos.edges.y;var s=p;var a=b-this.data.legend.pos.edges.y;if(this.legendBox){this.rectangle(t,d,s,a,false,this.nodeFontColor,"open")}var u=["rect",t,d,t+s,d+a];if(this.preScaleNetwork){this.addArea(u,[-1],"-legend-Edges")}else{this.addArea(this.adjustNetworkObjects(u),[-1],"-legend-Edges")}this.curLegendX=e;this.curLegendY=b}};this.drawNetworkLegendText=function(){if(this.data.legend.text&&this.data.legend.text.length>0){var t=0;for(var n=0;n<this.data.legend.text.length;n++){this.data.legend.text[n].id=this.getLegendId("text",this.data.legend.text[n].id);var k=this.data.legend.text[n].x||this.curLegendX;var g=this.data.legend.text[n].y||this.curLegendY;this.data.legend.text[n].x=parseInt(k);this.data.legend.text[n].y=parseInt(g);var e=this.data.legend.text[n].boxed||this.legendBox;var h=this.data.legend.text[n].margin||this.margin;var o=this.setNetworkLegendMargins(h);var j=this.data.legend.text[n].color||this.nodeFontColor;var s=this.data.legend.text[n].text||"";var q=this.data.legend.text[n].font?this.data.legend.text[n].font*this.nodeFontSize*this.scaleNodeFontFactor:this.nodeFontSize*this.scaleNodeFontFactor;q=parseInt(q);var f=(q)+"Pt "+this.fontName;var d=this.measureText(s,f);t=q/2;this.drawText(s,o[3]+k,o[0]+g+t,f,j,"left","middle");var b=this.data.legend.text[n].x;var r=this.data.legend.text[n].y;var a=o[1]+o[3]+d;var p=o[0]+o[2]+q;if(e){this.rectangle(b,r,a,p,false,this.nodeFontColor,"open")}g+=o[0]+o[2]+q;var m=["rect",b,r,b+a,r+p];if(this.preScaleNetwork){this.addArea(m,[-1],"-legend-Text"+n)}else{this.addArea(this.adjustNetworkObjects(m),[-1],"-legend-Text"+n)}this.curLegendX=k;this.curLegendY=g}}};this.drawNetworkLegendDecorations=function(){if(this.data.legend.decorations&&this.data.legend.decorations.length>0){var f=this.data.legend.pos.decorations.x||this.curLegendX;var d=this.data.legend.pos.decorations.y||this.curLegendY;this.data.legend.pos.decorations.x=parseInt(f);this.data.legend.pos.decorations.y=parseInt(d);var u=0;var t=0;for(var v=0;v<this.data.legend.decorations.length;v++){this.data.legend.decorations[v].id=this.getLegendId("decorations",this.data.legend.decorations[v].id);var s=this.data.legend.decorations[v].color||this.nodeFontColor;var w=this.data.legend.decorations[v].outline?this.data.legend.decorations[v].outline:this.foreground;var a=this.data.legend.decorations[v].shape||this.shapes[0];var o=this.data.legend.decorations[v].size?this.data.legend.decorations[v].size*this.nodeFontSize:this.nodeFontSize;var j=this.data.legend.decorations[v].width?this.data.legend.decorations[v].width:o;var q=this.data.legend.decorations[v].height?this.data.legend.decorations[v].height:o;var k=this.data.legend.decorations[v].pattern?this.data.legend.decorations[v].pattern:"closed";var h=this.data.legend.decorations[v].rotate?this.data.legend.decorations[v].rotate*Math.PI/180:false;var r=this.data.legend.decorations[v].outlineWidth?this.data.legend.decorations[v].otlineWidth:false;var g=this.data.legend.decorations[v].font?this.data.legend.decorations[v].font*this.nodeFontSize*this.scaleNodeFontFactor:this.nodeFontSize*this.scaleNodeFontFactor;var n=(parseInt(g))+"Pt "+this.fontName;var m=this.data.legend.decorations[v].text?this.data.legend.decorations[v].text:"";var p=this.measureText(m,n);o=parseFloat(sprintf("%.1f",o));u=Math.max(u,(this.margin*3)+o+p);t=o/2;d+=t;this.drawShape(a,this.margin+f+t,this.margin+d+t,j,q,s,w,k,h,r);this.drawText(m,(this.margin*2)+f+o,this.margin+d+t,n,this.nodeFontColor,"left","middle");d+=o}d+=this.margin+t;var y=this.data.legend.pos.decorations.x;var e=this.data.legend.pos.decorations.y;var x=u;var b=d-this.data.legend.pos.decorations.y;if(this.legendBox){this.rectangle(y,e,x,b,false,this.nodeFontColor,"open")}var z=["rect",y,e,y+x,e+b];if(this.preScaleNetwork){this.addArea(z,[-1],"-legend-Decorations")}else{this.addArea(this.adjustNetworkObjects(z),[-1],"-legend-Decorations")}this.curLegendX=f;this.curLegendY=d}};this.setNetworkLegendMargins=function(a){if(isNaN(a)){var b=a.split(/[,\s]+/);if(b.length>3){return[parseInt(b[0]),parseInt(b[1]),parseInt(b[2]),parseInt(b[3])]}else{if(b.length==3){return[parseInt(b[0]),parseInt(b[1]),parseInt(b[2]),parseInt(b[1])]}else{if(b.length==2){return[parseInt(b[0]),parseInt(b[1]),parseInt(b[0]),parseInt(b[1])]}else{return[parseInt(b[0]),parseInt(b[0]),parseInt(b[0]),parseInt(b[0])]}}}}else{return[parseInt(a),parseInt(a),parseInt(a),parseInt(a)]}};this.drawNetworkProgressBar=function(b){if(!this.layoutDone){this.ctx.save();this.ctx.fillStyle="#fff";this.ctx.strokeStyle="#fff";var a=(new Date().getTime()-this.preUpdateTime)/(this.layoutTime*1000);a=Math.max(a,this.layoutProgress);if(b){this.ctx.strokeRect((this.width/2)-50,(this.height/2)-5,100,10);this.ctx.fillRect((this.width/2)-50,(this.height/2)-5,a*100,10);this.drawText("Calculating ...",(this.width/2)-50,(this.height/2)+10,this.showAnimationFont,this.showAnimationFontColor,"left","top")}else{this.ctx.strokeRect(this.width-110,this.height-20,100,10);this.ctx.fillRect(this.width-110,this.height-20,a*100,10)}this.ctx.restore()}};this.setNetworkMinMaxRangeXY=function(){if(!this.networkFreeze||(this.rangeX==null||this.rangeY==null)){this.minX=Number.MAX_VALUE;this.minY=Number.MAX_VALUE;this.maxX=0;this.maxY=0;if(this.is3DNetwork&&this.layoutDone){for(var b=0;b<this.data.nodes.length;b++){var e=this.data.nodes[b];var a=e.width?e.width:e.size?(this.nodeSize*e.size):this.nodeSize;var d=e.height?e.height:e.size?(this.nodeSize*e.size):this.nodeSize;if(!e.hide){this.minX=Math.min(this.minX,e.x3d-a/2);this.minY=Math.min(this.minY,e.y3d-d/2);this.maxX=Math.max(this.maxX,e.x3d+a/2);this.maxY=Math.max(this.maxY,e.y3d+d/2)}}}else{for(var b=0;b<this.data.nodes.length;b++){var e=this.data.nodes[b];var a=e.width?e.width:e.size?(this.nodeSize*e.size):this.nodeSize;var d=e.height?e.height:e.size?(this.nodeSize*e.size):this.nodeSize;if(!e.hide){this.minX=Math.min(this.minX,e.x-a/2);this.minY=Math.min(this.minY,e.y-d/2);this.maxX=Math.max(this.maxX,e.x+a/2);this.maxY=Math.max(this.maxY,e.y+d/2)}}}this.minX-=(this.nodeSize*3);this.minY-=(this.nodeSize*3);this.maxX+=(this.nodeSize*3);this.maxY+=(this.nodeSize*3);this.rangeX=this.maxX-this.minX;this.rangeY=this.maxY-this.minY}};this.setNetworkRotation=function(){if(this.is3DNetwork&&this.layoutDone){var f=[];var b=[];var m=[];this.set3DRotation();for(var d=0;d<this.data.nodes.length;d++){b.push(d);var a=this.data.nodes[d];var e=this.get3DTransfrom(a.x,a.y,a.z);a.x3d=e[0];a.y3d=e[1];a.z3d=e[2];f.push(Math.sqrt((a.x3d*a.x3d)+(a.y3d*a.y3d)+(a.z3d*a.z3d)))}b.sort(function(o,n){return f[n]-f[o]});for(var k=0;k<this.data.nodes.length;k++){var d=b[k];var a=this.data.nodes[d];m.push(a)}this.data.nodes=m;this.setNodeIndices()}else{if(this.network2DRotate!=0){if(this.network2DRotate>=Math.abs(360)){this.network2DRotate=0}var g=Math.PI*this.network2DRotate/360;for(var d=0;d<this.data.nodes.length;d++){var a=this.data.nodes[d];if(a.x!=null&&a.y!=null){var j=a.x;var h=a.y;a.x=(j*Math.cos(g))-(h*Math.sin(g));a.y=(h*Math.cos(g))+(j*Math.sin(g))}}if(this.data.legend.pos.nodes.x&&this.data.legend.pos.nodes.y){var j=this.data.legend.pos.nodes.x;var h=this.data.legend.pos.nodes.y;this.data.legend.pos.nodes.x=(j*Math.cos(g))-(h*Math.sin(g));this.data.legend.pos.nodes.y=(h*Math.cos(g))+(j*Math.sin(g))}if(this.data.legend.pos.edges.x&&this.data.legend.pos.edges.y){var j=this.data.legend.pos.edges.x;var h=this.data.legend.pos.edges.y;this.data.legend.pos.edges.x=(j*Math.cos(g))-(h*Math.sin(g));this.data.legend.pos.edges.y=(h*Math.cos(g))+(j*Math.sin(g))}if(this.data.legend.text){for(var d=0;d<this.data.legend.text.length;d++){var j=this.data.legend.text[d].x;var h=this.data.legend.text[d].y;this.data.legend.text[d].x=(j*Math.cos(g))-(h*Math.sin(g));this.data.legend.text[d].y=(h*Math.cos(g))+(j*Math.sin(g))}}this.network2DRotate=0}}};this.setNetworkScaleFactor=function(){if(!this.networkFreeze||this.scaleFactor==null){this.scaleFactor=this.networkLayoutType=="radial"?0.3:Math.min(this.x/(this.maxX-this.minX),this.y/(this.maxY-this.minY));this.scaleFactor*=this.zoom;this.widthBounds=this.x/this.scaleFactor;this.heightBounds=this.y/this.scaleFactor}this.offsetX=((this.widthBounds/2)-((this.minX+this.maxX)/2))+this.panningX+this.panningGlobalX;this.offsetY=((this.heightBounds/2)-((this.minY+this.maxY)/2))+this.panningY+this.panningGlobalY};this.optimizeNetworkLayout=function(){if(this.data.nodes.length>0){this.isAnimation=true;this.setInitialForceDirectedLayout();this.preUpdateTime=new Date().getTime();var a=this.layoutTime*1000;var b=this;var d=function(){this.update=function(){if(b.updateForceDirectedLayout(1000/30)||(a&&new Date().getTime()-b.preUpdateTime>a)){b.layoutDone=true;clearInterval(e);b.isAnimation=false}b.renderNetwork()};var e=setInterval(this.update,1000/30)};d.call()}};this.getAngle=function(f,h,d,g,e){var b=(Math.atan2(g-h,d-f)*180/Math.PI)%360;if(!e){e=0}while(b<e){b+=360}while(b>=(e+360)){b-=360}return b};this.getPolar=function(d,b){return{x:this.networkXCenter+d*Math.cos(b*Math.PI/180),y:this.networkYCenter+d*Math.sin(b*Math.PI/180)}};this.setNodePositions=function(a){for(var d in a){var b=this.data.nodes[this.data.nodeIndices[d]];b.x=a[d].x;b.y=a[d].y}};this.animateRadialNodePositions=function(){this.isAnimation=true;var f=this;var e=50;var d=0;var b=0;for(var h in f.finalRadialNodePositions){if(this.initialRadialNodePositions[h].r==0){this.initialRadialNodePositions[h].a=this.finalRadialNodePositions[h].a}if(this.finalRadialNodePositions[h].r==0){this.finalRadialNodePositions[h].a=this.initialRadialNodePositions[h].a}var a=(this.finalRadialNodePositions[h].a-this.initialRadialNodePositions[h].a);if(a<0){a+=360}if(a>360){a-=360}if(a>180){a-=360}this.finalRadialNodePositions[h].a=(this.initialRadialNodePositions[h].a+a)}var g=function(){this.update=function(){var m={};var u=Math.atan((d/e)*10-5)*0.5/Math.atan(5)+0.5;var s=1-u;for(var q in f.finalRadialNodePositions){var k=((s*f.initialRadialNodePositions[q].a)+(u*f.finalRadialNodePositions[q].a));var p=((s*f.initialRadialNodePositions[q].r)+(u*f.finalRadialNodePositions[q].r));var t=f.getPolar(p,k);m[q]={x:t.x,y:t.y}}if(d>=e){clearInterval(j);f.isAnimation=false;m=f.finalRadialNodePositions}d++;f.setNodePositions(m);f.renderNetwork()};var j=setInterval(this.update,50)};g.call()};this.setFinalRadialNodePositions=function(e,d){if(!this.finalRadialNodePositions){this.finalRadialNodePositions={}}if(!this.nodeParentHood.drawn.hasOwnProperty(e)){var m,o,g,n,b;var f=this.data.nodes[this.data.nodeIndices[e]];if(!f.hide&&!f.hiddenParent){if(this.nodeParentHood[e].children.length>1&&!d){var k=[];var j=this;if(this.orderRadialNetwork){this.nodeParentHood[e].children.sort(function(q,p){return j.orderRadialNetwork[q]-j.orderRadialNetwork[p]})}for(var h=0;h<this.nodeParentHood[e].children.length;h++){if(this.nodeParentHood[this.nodeParentHood[e].children[h]].level>this.nodeParentHood[e].level){this.setFinalRadialNodePositions(this.nodeParentHood[e].children[h]);k.push(this.nodeParentHood[this.nodeParentHood[e].children[h]].angle)}}if(k.length>0){if(k.length==1){n=k[0]}else{if(k[0]>k[k.length-1]){n=((k[0]+k[k.length-1])%360)/2}else{n=(k[0]+k[k.length-1])/2}}}else{this.setFinalRadialNodePositions(e,true)}}else{n=this.networkCurrentAngle;this.networkCurrentAngle=(this.networkCurrentAngle+this.networkAngleStep)}g=(this.networkDepth-1)-this.nodeParentHood[e].level;m=this.getPolar(this.networkRadialRadius,n);o=this.shortenLine(this.networkXCenter,this.networkYCenter,m.x,m.y,0,this.networkLevelSize*g,"line");b=this.lineLength(this.networkXCenter,this.networkYCenter,o[2],o[3]);if(this.nodeParentHood[e].level==0){n=0;b=0}this.finalRadialNodePositions[f.id]={x:o[2],y:o[3],r:b,a:n%360};this.nodeParentHood.drawn[e]=true;this.nodeParentHood[e].angle=n}}};this.setInitialRadialNodePositions=function(){if(!this.initialRadialNodePositions){this.initialRadialNodePositions={};for(var a=0;a<this.data.nodes.length;a++){if(!this.data.nodes[a].hide&&!this.data.nodes[a].hiddenParent){var b=this.data.nodes[a];this.initialRadialNodePositions[b.id]={x:this.networkXCenter,y:this.networkYCenter,r:0,a:0}}}}else{this.initialRadialNodePositions=this.finalRadialNodePositions;this.finalRadialNodePositions=false}};this.setRadialNetwrorkLayout=function(){if(this.data.nodes.length>0){this.networkLevelSize=this.x*4/(this.networkDepth*2);this.networkAngleStep=360/this.networkDivisions;this.networkCurrentAngle=this.networkCurrentAngle?this.networkCurrentAngle:0;this.networkRadialRadius=this.networkLevelSize*(this.networkDepth-1);this.setInitialRadialNodePositions();this.setFinalRadialNodePositions(this.networkRoot);this.layoutDone=true;if(this.showAnimation){this.animateRadialNodePositions()}else{this.setNodePositions(this.finalRadialNodePositions);this.renderNetwork()}}};this.createRandomNetwork=function(v){var o={};var a={};if(v){o=this.createMesh()}else{o.nodes=[];var e=Math.floor(Math.random()*this.randomNetworkNodes)+1;for(var p=0;p<e;p++){var h={};var t=Math.floor(Math.random()*this.shapes.length);var f=Math.floor(Math.random()*this.colors.length);h.id="id"+p;h.shape=this.shapes[t];h.color=this.colors[f];h.size=1;o.nodes.push(h)}o.edges=[];for(var p=0;p<o.nodes.length;p++){var g=o.nodes[p];var m=[];for(var k=0;k<Math.floor(Math.random()*this.randomNetworkNodeEdgesMax)-1;k++){m.push(Math.floor(Math.random()*e))}for(var k=0;k<m.length;k++){var d=o.nodes[m[k]];var s=p+":"+m[k];var r=m[k]+":"+p;if(g.id!=d.id&&!a.hasOwnProperty(s)&&!a.hasOwnProperty(s)){var b={};var u=Math.floor(Math.random()*this.lines.length);var f=Math.floor(Math.random()*this.colors.length);b.id1=g.id;b.id2=d.id;b.width=1;b.type=this.lines[u];b.color=this.colors[f];o.edges.push(b);a[s]=1;a[r]=1}}}}if(this.reduceRandomNetwork){var q=this.normalizeGraph(o);o=this.reduceNetwork(q,function(n,j){if(n.nodes&&j.nodes){if(n.nodes.length>=j.nodes.length){return n}else{return j}}else{if(n.nodes){return n}else{if(j.nodes){return j}else{return null}}}})}if(o.nodes.length<5){return this.createRandomNetwork(true)}else{var m=[];for(var p=0;p<o.edges.length;p++){if(o.edges[p].id1&&o.edges[p].id2){m.push(o.edges[p])}}o.edges=m;return o}};this.createMesh=function(){var g={};g.nodes=[];g.edges=[];var f=7;var a=this;for(var j=0;j<f*f;j++){var d={};var h=Math.floor(Math.random()*this.shapes.length);var b=Math.floor(Math.random()*this.colors.length);d.id="id"+j;d.shape=this.shapes[h];d.color=this.colors[b];d.size=1;g.nodes.push(d)}var e=function(p,o){var n={};var k=Math.floor(Math.random()*a.lines.length);var m=Math.floor(Math.random()*a.colors.length);n.id1=g.nodes[p].id;n.id2=g.nodes[o].id;n.width=1;n.type=a.lines[k];n.color=a.colors[m];return n};for(var j=0;j<g.nodes.length;j++){if(Math.floor(Math.random()*f)!=0){if(j+1<g.nodes.length&&(j+1)%f!=0){g.edges.push(e(j,j+1))}if(j+f<g.nodes.length){g.edges.push(e(j,j+f))}}}return g};this.setNodeChildren=function(g,b,h){this.networkDepth=b>this.networkDepth?b:this.networkDepth;var e=this.data.nodes[this.data.nodeIndices[g]];if(!e.hide&&!e.hiddenParent){var a=this.edgesForNode(this.data.edges,g);if(!this.nodeParentHood.hasOwnProperty(g)){if(a.length==1){this.networkDivisions++}if(a.length>0){for(var d=0;d<a.length;d++){if(!this.nodeParentHood[g]){this.nodeParentHood[g]={};this.nodeParentHood[g].children=[];this.nodeParentHood[g].level=b;this.nodeParentHood[g].angle=0;this.nodeParentHood[g].parent=h}this.nodeParentHood[g].level=b<this.nodeParentHood[g].level?b:this.nodeParentHood[g].level;if(a[d].id1==g){this.nodeParentHood[g].children.push(a[d].id2);this.setNodeChildren(a[d].id2,b+1,g)}else{if(a[d].id2==g){this.nodeParentHood[g].children.push(a[d].id1);this.setNodeChildren(a[d].id1,b+1,g)}}}}}else{this.nodeParentHood[g].level=b<this.nodeParentHood[g].level?b:this.nodeParentHood[g].level;for(var d=0;d<this.nodeParentHood[g].children.length;d++){var f=this.nodeParentHood[g].children[d];if(this.nodeParentHood[f]){if((b+1)<this.nodeParentHood[f].level){this.nodeParentHood[f].level=b+1;this.nodeParentHood[f].parent=g}}}}}};this.setNodeParentHood=function(){this.nodeParentHood={};if(this.networkLayoutType=="radial"){if(!this.networkRoot){this.networkRoot=this.data.nodes[0].id}this.nodeParentHood.drawn={};this.networkDepth=0;this.networkDivisions=0;this.setNodeChildren(this.networkRoot,0,false)}else{for(var a=0;a<this.data.nodes.length;a++){if(!this.data.nodes[a].hide){if(this.data.nodes[a].parentNode||this.data.nodes[a].hideChildren){if(this.data.nodes[a].parentNode&&!this.nodeParentHood.hasOwnProperty(this.data.nodes[a].parentNode)){this.nodeParentHood[this.data.nodes[a].parentNode]={}}if(this.data.nodes[a].parentNode){if(!this.nodeParentHood[this.data.nodes[a].parentNode].children){this.nodeParentHood[this.data.nodes[a].parentNode].children=[]}this.nodeParentHood[this.data.nodes[a].parentNode].children.push(this.data.nodes[a].id);if(this.data.nodes[this.data.nodeIndices[this.data.nodes[a].parentNode]].hideChildren){this.data.nodes[a].hiddenParent=true}}if(this.data.nodes[a].hideChildren){if(!this.nodeParentHood.hasOwnProperty(this.data.nodes[a].id)){this.nodeParentHood[this.data.nodes[a].id]={}}this.nodeParentHood[this.data.nodes[a].id].hideChildren=true}}}}for(var b in this.nodeParentHood){if(this.data.nodes[this.data.nodeIndices[b]].hideChildren||this.isParentHidden(b)){this.hideUnhideChildrenNodes(b,true)}else{if(this.nodeParentHood[b].children){this.hideUnhideChildrenNodes(b,false)}}}}};this.isParentHidden=function(d){var b=this.findParentNodes(d);if(b){for(var a=0;a<b.length;a++){if(this.data.nodes[this.data.nodeIndices[b[a]]].hideChildren){return true}}}return false};this.findParentNodes=function(d,a){if(this.data.nodes[this.data.nodeIndices[d]].parentNode){var b=this.data.nodes[this.data.nodeIndices[d]].parentNode;if(!a){a=[]}a.push(b);a=this.findParentNodes(b,a);return a}else{return a?a.reverse():false}};this.findChildrenNodeIndices=function(d,b){if(!b){b=[]}if(this.nodeParentHood[d]&&this.nodeParentHood[d]["children"]){for(var a=0;a<this.nodeParentHood[d]["children"].length;a++){b.push(this.data.nodeIndices[this.nodeParentHood[d]["children"][a]]);b=this.findChildrenNodeIndices(this.nodeParentHood[d]["children"][a],b)}}return b.length>0?b:false};this.hasChildren=function(a){return this.nodeParentHood[a]&&this.nodeParentHood[a].children};this.findVisibleParentNode=function(d){var b=this.findParentNodes(d);if(b){b.reverse();for(var a=0;a<b.length;a++){if(!this.nodes[b[a]].hide&&!this.nodes[b[a]].hiddenParent){return this.nodes[b[a]]}}}return false};this.collateNetworks=function(){if(this.data.nodes.length>0){var b=this.normalizeGraph({nodes:this.data.nodes,edges:this.data.edges});if(b.length>1){var f={id:"canvasXpressAnchorNode",anchor:true};this.addNode(f);for(var d=0;d<b.length;d++){var a=b[d].nodes[0];var e={id1:"canvasXpressAnchorNode",id2:a.id,anchor:true};this.addEdge(e)}}}};this.setObjectAttributes=function(){if(this.colorNodeBy){this.setAllObjectAttributes("nodes","color",this.colorNodeBy)}if(this.shapeNodeBy){this.setAllObjectAttributes("nodes","shape",this.shapeNodeBy)}if(this.sizeNodeBy){this.setAllObjectAttributes("nodes","size",this.sizeNodeBy)}if(this.colorEgdeBy){this.setAllObjectAttributes("egdes","color",this.colorEgdeBy)}if(this.shapeEgdeBy){this.setAllObjectAttributes("egdes","shape",this.shapeEgdeBy)}if(this.sizeEgdeBy){this.setAllObjectAttributes("egdes","size",this.sizeEgdeBy)}};this.setDecorationsRangeUnits=function(){this.decorationsRange=[];var d={};if(this.showDecorations&&this.decorations.length>0){var h=[];for(var f=0;f<this.data.nodes.length;f++){var g=this.data.nodes[f];for(var e=0;e<this.decorations.length;e++){if(g[this.decorations[e]]&&!isNaN(g[this.decorations[e]])){h.push(g[this.decorations[e]])}}}this.decorationsRange=this.range(h);var a=this.decorationsRange[1]-this.decorationsRange[0];var b=this.decorationsRange[0]-(a*0.05);if(b>0){this.decorationsRange[0]=b;a=this.decorationsRange[1]-this.decorationsRange[0]}this.decorationsUnits=this.decorationsHeight/a;if(!this.data.legend){this.data.legend={}}this.data.legend.decorations=[];for(var f=0;f<this.decorations.length;f++){if(this.decorationsColors[f]){d[this.decorationsColors[f]]=true;this.data.legend.decorations.push({shape:"square",color:this.decorationsColors[f],text:this.decorations[f],size:0.5,font:0.5})}else{for(var e=0;e<this.colors.length;e++){if(!d.hasOwnProperty(this.colors[e])){this.decorationsColors[f]=this.colors[e];d[this.colors[e]]=true;this.data.legend.decorations.push({shape:"square",color:this.decorationsColors[f],text:this.decorations[f],size:0.5,font:0.5});break}}}}}};this.drawNetworkPlot=function(){this.showAnimationFont=(this.showAnimationFontSize)+"Pt "+this.fontName;this.setNodeParentHood();this.setObjectAttributes();this.setDecorationsRangeUnits();if(this.calculateLayout){this.collateNetworks();this.setNetworkPrivateParams();if(this.networkLayoutType=="radial"){this.setRadialNetwrorkLayout()}else{this.optimizeNetworkLayout()}}else{this.layoutDone=true;this.renderNetwork()}if(this.networkFreezeOnLoad&&this.layoutDone){this.networkFreezeOnLoad=false;this.networkFreeze=true}};this.initializeNetwork=function(){this.setNetworkDimensions();if(!this.nodes&&this.data.nodes){this.setNodes()}if(this.randomNetwork){var a=this.createRandomNetwork();this.data.nodes=a.nodes;this.data.edges=a.edges;this.setAllNodesVisible();this.setNodes();this.layoutDone=false}this.drawNetworkPlot()};this.initializeNetwork()};CanvasXpress.prototype.Genome=function(){this.setGenomeSubtracks=function(){this.subtracks=[];this.y=this.margin*2;var f=0;for(var m=0;m<this.data.tracks.length;m++){if(this.data.tracks[m].name){this.y+=this.getFontPt(this.trackNameFont)+(this.margin*2)}var d=this.data.tracks[m];var q=d.data.length>this.showFeatureNameThereshold||d.hide?false:true;var o=d.type?d.type:"line";var b=d.width?d.width:this.featureWidthDefault;var r=d.height?d.height:this.featureHeightDefault;this.subtracks[m]={features:[],cur:[]};this.subtracks[m].cur[0]=-3;this.subtracks[m].features[0]=[];if(q){this.y+=this.getFontPt(this.featureNameFont)+this.margin}this.y+=r+this.margin;for(var h=0;h<d.data.length;h++){var e=0;var a,g;var s=d.data[h];var n=this.measureText(s.id,this.featureNameFont);var k=s.data;s.counter=f++;if(o=="box"){a=k[0][0]*this.xAxisUnit;g=k[k.length-1][1]*this.xAxisUnit}else{if(o.match(/bar|heatmap/)){a=k[0]*this.xAxisUnit;g=a+b}else{if(o=="sequence"){a=k[0]*this.xAxisUnit;g=a+(k[1].length*this.xAxisUnit)}else{a=k*this.xAxisUnit;g=a+1}}}var p=q?Math.max(a+n,g):g;while(a<(this.subtracks[m].cur[e]+2)){e++;if(!this.subtracks[m].cur[e]){if(q){this.y+=this.getFontPt(this.featureNameFont)+this.margin}this.y+=r+this.margin;this.subtracks[m].cur[e]=-3;this.subtracks[m].features[e]=[]}}this.subtracks[m].features[e].push(h);this.subtracks[m].cur[e]=p}this.y+=this.margin*2}};this.getGenomeRange=function(a){var f=[];for(var d=0;d<a.length;d++){var e=a[d].data;for(var b=1;b<e.length;b++){f.push(e[b])}}return this.range(f)};this.plotGenomeData=function(){var y,Y,x,w;var E=this.getFontPt(this.trackNameFont);var K=this.getFontPt(this.featureNameFont);var b=this.top+(this.margin*2);for(var T=0;T<this.data.tracks.length;T++){var z=this.left;if(this.data.tracks[T].name){this.drawText(this.data.tracks[T].name,z,b+(E/2),this.trackNameFont,this.trackNameFontColor,"left","middle");b+=E+(this.margin*2)}var D=this.cloneObject(this.data.tracks[T]);var o=D.data.length>this.showFeatureNameThereshold||D.hide?false:true;var X=D.type?D.type:"line";var g=D.height?D.height:this.featureHeightDefault;var A=D.fills?D.fills:D.fill?D.fill:this.foreground;var F=D.lines?D.lines:D.line?D.line:this.foreground;var r=X.match(/bar|heatmap/)?this.getGenomeRange(D.data):false;for(var S=0;S<this.subtracks[T].features.length;S++){var u=this.subtracks[T].features[S];for(var R=0;R<u.length;R++){var W=u[R];var J=D.data[W];var V=J.data;var v=J.id;if(X=="box"){if(V.length>0){z=this.left+((V[0][0]-this.xAxisMin)*this.xAxisUnit);if(o){this.drawText(v,z,b+(K/2),this.featureNameFont,this.featureNameFontColor,"left","middle");b+=K+this.margin}this.addArea(["rect",z,b,((V[V.length-1][1]-this.xAxisMin)*this.xAxisUnit),b+g],[J.counter]);var C=Math.floor(g*this.xAxisUnit);if(J.dir=="right"){y=(V[V.length-1][1]-this.xAxisMin)*this.xAxisUnit;if(y-C<(V[V.length-1][0]-this.xAxisMin)*this.xAxisUnit){V.pop()}else{V[V.length-1][1]-=g}z=this.left+((V[V.length-1][0]-this.xAxisMin)*this.xAxisUnit);Y=b+(g/2);this.drawLine("line",z,Y,y,Y,A,false,"butt");z=y-((g/2)*this.xAxisUnit);this.drawLine("line",z,b,y,Y,A,false,"butt");this.drawLine("line",z,b+g,y,Y,A,false,"butt")}else{if(J.dir=="left"){if(z+C>(V[0][1]-this.xAxisMin)*this.xAxisUnit){V.shift()}else{V[0][0]+=g}y=this.left+((V[0][0]-this.xAxisMin)*this.xAxisUnit);Y=b+(g/2);this.drawLine("line",z,Y,y,Y,A,false,"butt");y=z+((g/2)*this.xAxisUnit);this.drawLine("line",z,Y,y,b,A,false,"butt");this.drawLine("line",z,Y,y,b+g,A,false,"butt")}}for(var Q=0;Q<V.length;Q++){z=this.left+((V[Q][0]-this.xAxisMin)*this.xAxisUnit);y=((V[Q][1]-this.xAxisMin)*this.xAxisUnit)-z;if(D.connect){if(Q<V.length-1){Y=b+(g/2);x=this.left+((V[Q+1][0]-this.xAxisMin)*this.xAxisUnit);w=(((V[Q][1]+((V[Q+1][0]-V[Q][1])/2))-this.xAxisMin)*this.xAxisUnit);this.drawLine("line",z+y,Y,w,b,A,false,"butt");this.drawLine("line",w,b,x,Y,A,false,"butt")}}this.rectangle(z,b,y,g,A,F)}}}else{if(X=="bar"){var a=D.autowidth?this.xAxisUnit/(V.length-1):D.width?D.width:this.featureWidthDefault;z=this.left+((V[0]-this.xAxisMin)*this.xAxisUnit);if(o){this.drawText(v,z,b+(K/2),this.featureNameFont,this.featureNameFontColor,"left","middle");b+=K+this.margin}this.addArea(["rect",z,b,z+(V.length*a),b+g],[J.counter]);y=z;var N=r[1]-r[0];var e=r[0]-(N*0.05);if(e>0){r[0]=e;N=r[1]-r[0]}var B=g/N;var d=r[1]<0?b:r[0]>=0?b+g:(b+g)-Math.abs(r[0]*B);for(var M=1;M<V.length;M++){var H=typeof A==="object"&&A[M-1]?A[M-1]:A[0];var t=typeof F==="object"&&F[M-1]?F[M-1]:F[0];var U=V[M]*B;this.rectangle(y,d,a,-U,H,t);if(D.autowidth){y+=a}else{y+=a+2}}}else{if(X=="heatmap"){var a=D.autowidth?this.xAxisUnit:D.width?D.width:this.featureWidthDefault;z=this.left+((V[0]-this.xAxisMin)*this.xAxisUnit);if(o){this.drawText(v,z,b+(K/2),this.featureNameFont,this.featureNameFontColor,"left","middle");b+=K+this.margin}this.addArea(["rect",z,b,z+a,b+g],[J.counter]);var U=g/(V.length-1);var p="rgb(255,255,0)";Y=b;for(var M=1;M<V.length;M++){var G=V[M];var q=this.getHeatmapColor(r[0],r[1],G);if(isNaN(G)){this.rectangle(z,Y,a,U,p,p)}else{this.rectangle(z,Y,a,U,q,q)}Y+=U}}else{if(X=="sequence"){var P=D.subtype;z=this.left+((V[0]-this.xAxisMin)*this.xAxisUnit);if(o){this.drawText(v,z,b+(K/2),this.featureNameFont,this.featureNameFontColor,"left","middle");b+=K+this.margin}var m=V[1].split(/ */);this.addArea(["rect",z,b,z+(m.length*this.xAxisUnit),b+K],[J.counter]);var O=0;var M=P=="DNA"?1:3;var Q=this.measureText("A",this.sequenceFont)>M*this.xAxisUnit?true:false;while(m.length>0){var f=m.shift();if(f=="["){f=m.shift();var I=[];while(f!="]"){I.push(f);f=m.shift()}if(Q){this.drawLine("line",z+(O*this.xAxisUnit),b,z+(O*this.xAxisUnit),b+K,this.sequenceMColor,false,"butt")}else{this.drawText(I.join("/"),z+(O*this.xAxisUnit),b+(K/2),this.sequenceFont,this.sequenceMColor,"center","middle")}O+=M}else{var q="sequence"+f.toUpperCase()+"Color";if(q=="sequenceTColor"){var L=true}if(Q){this.drawLine("line",z+(O*this.xAxisUnit),b,z+(O*this.xAxisUnit),b+K,this[q],false,"butt")}else{this.drawText(f,z+(O*this.xAxisUnit),b+(K/2),this.sequenceFont,this[q],"center","middle")}O+=M}}}else{if(X=="triangle"){z=this.left+((V-this.xAxisMin)*this.xAxisUnit);if(o){this.drawText(v,z,b+(K/2),this.featureNameFont,this.featureNameFontColor,"left","middle");b+=K+this.margin}this.addArea(this.drawShape("triangle",z,b+(g/2),g,g,A,F,"closed"),[J.counter])}else{z=this.left+((V-this.xAxisMin)*this.xAxisUnit);if(o){this.drawText(v,z,b+(K/2),this.featureNameFont,this.featureNameFontColor,"left","middle");b+=K+this.margin}this.addArea(this.drawLine("line",z,b,z,b+g,F,false,"butt"),[J.counter])}}}}}if(o){b-=(K+this.margin)}}if(o){b+=K+this.margin}b+=g+this.margin}b+=(this.margin*2)}};this.setGenomeWireFrame=function(){var d=this.getFontPt(this.featureNameFont)/2;if(this.xAxisTickStyle=="dotted"){this.drawLine("dottedLine",this.left,this.top,this.left,this.top+this.y,this.wireColor,false,"butt")}else{this.drawLine("line",this.left,this.top,this.left,this.top+this.y,this.wireColor,false,"butt")}for(var b=0;b<this.xAxisValues.length;b++){var e=parseFloat(this.xAxisValues[b]);var a=this.left+((e-this.xAxisMin)*this.xAxisUnit);if(this.xAxisTickStyle=="dotted"){this.drawLine("dottedLine",a,this.top,a,this.top+this.y,this.wireColor,false,"butt")}else{this.drawLine("line",a,this.top,a,this.top+this.y,this.wireColor,false,"butt")}if(!((b+(this.periodTicksLabels+1))%this.periodTicksLabels)){this.drawText(parseInt(e),a,this.top+this.y+this.margin+d,this.featureNameFont,this.xAxisTickColor,"center","middle")}}if(this.xAxisTickStyle=="dotted"){this.drawLine("dottedLine",this.left+this.x,this.top,this.left+this.x,this.top+this.y,this.wireColor,false,"butt")}else{this.drawLine("line",this.left+this.x,this.top,this.left+this.x,this.top+this.y,this.wireColor,false,"butt")}};this.setGenomeAxisUnits=function(){this.setAxisUnits("xAxis")};this.setGenomeFontsColors=function(){this.trackNameFont=(this.trackNameFontSize)+"Pt "+this.fontName;this.featureNameFont=(this.featureNameFontSize)+"Pt "+this.fontName;this.sequenceFont=(this.sequenceFontSize)+"Pt "+this.fontName;if(!this.wireColor.match(/,0.1\)$/)){this.wireColor=this.wireColor.replace(/\)$/,",0.1)")}};this.setGenomeDimentions=function(){this.bottom+=this.margin+this.getFontPt(this.featureNameFont);if(this.width){this.x=this.width-(this.left+this.right)}else{this.width=this.left+this.x+this.right}this.height=this.top+this.y+this.bottom;this.resizeCanvas()};this.drawGenome=function(){this.setGenomeFontsColors();this.setGenomeAxisUnits();this.setGenomeSubtracks();this.setGenomeDimentions();this.setGenomeWireFrame();this.plotGenomeData()};this.initializeGenome=function(){this.drawGenome()};this.initializeGenome()};